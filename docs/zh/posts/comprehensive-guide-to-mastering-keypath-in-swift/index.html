<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>从基础到进阶：Swift 中的 KeyPath 完全指南 | 肘子的 Swift 记事本</title>
<meta name="description" content="深入解析Swift KeyPath，探索其强大功能、类型家族和高级用法，掌握属性访问的利器，提升Swift编程效率。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/comprehensive-guide-to-mastering-keypath-in-swift/">
<meta property="og:title" content="从基础到进阶：Swift 中的 KeyPath 完全指南 | 肘子的 Swift 记事本">
<meta property="og:description" content="深入解析Swift KeyPath，探索其强大功能、类型家族和高级用法，掌握属性访问的利器，提升Swift编程效率。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/comprehensive-guide-to-mastering-keypath-in-swift/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/comprehensive-guide-to-mastering-keypath-in-swift-zh.webp">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/comprehensive-guide-to-mastering-keypath-in-swift/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/comprehensive-guide-to-mastering-keypath-in-swift/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/about.ef6e_bru.css" />
<link rel="stylesheet" href="/_astro/about.Y66QztvF.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default tracking-tight bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/comprehensive-guide-to-mastering-keypath-in-swift/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/Swift/">
#Swift </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/comprehensive-guide-to-mastering-keypath-in-swift/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">从基础到进阶：Swift 中的 KeyPath 完全指南</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2024-10-23T14:00:00.000Z">2024 年 10 月 23 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>在 Swift 的世界里，<code>KeyPath</code> 是一个强大而又常被低估的特性。许多开发者在日常编程中不经意间使用它，却未能充分认识到它的潜力和重要性。本文旨在深入剖析 <code>KeyPath</code> 的功能特性，揭示其在 Swift 编程中的独特魅力，帮助你将它转化为开发过程中的得力助手。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="什么是-keypath">什么是 KeyPath</h2>
<p><code>KeyPath</code> 是 Swift 4 引入的一种强大特性，用于引用（ 表示 ）类型中的属性或下标。</p>
<p>它具备以下特征：</p>
<ul>
<li><strong>与具体实例无关</strong>：<code>KeyPath</code> 描述了从某种类型到其属性或下标的访问路径，独立于任何具体的对象实例。它可以被视为一种静态引用，精确定位类型中特定属性或下标的位置。这种抽象可以通过类比来理解：比如”我的车的左前轮”是基于特定实例的描述，而 <code>KeyPath</code> 更像是”汽车的左前轮”——一个基于类型的、普遍适用的描述。这种设计使得 <code>KeyPath</code> 在泛型编程和元编程中特别有用，因为它允许我们在不知道具体实例的情况下操作类型的结构。</li>
<li><strong>仅限描述属性</strong>：<code>KeyPath</code> 仅能用于描述类型中的属性或下标，不能用于引用类型中的方法。</li>
<li><strong>线程安全</strong>：尽管 <code>KeyPath</code> 本身未标注为 <code>Sendable</code>，但它被设计为不可变的，因此可以安全地在线程之间传递。然而，使用 <code>KeyPath</code> 访问的数据本身的线程安全性仍需要单独考虑。</li>
<li><strong>编译时类型检查</strong>：<code>KeyPath</code> 提供了编译时的类型检查，确保对属性的访问是类型安全的。这样可以避免运行时类型错误。</li>
<li><strong>元编程的组成部分</strong>：<code>KeyPath</code> 是 Swift 元编程的重要组成部分。它允许开发者通过类型安全的方式动态访问属性，实现了代码的高度灵活性和通用性。</li>
<li><strong>符合 <code>Hashable</code> 和 <code>Equatable</code> 协议</strong>：<code>KeyPath</code> 遵循 <code>Hashable</code> 和 <code>Equatable</code> 协议，这使得它们可以作为字典的键或存储在集合中，拓展了其使用场景。</li>
<li><strong>丰富的变体</strong>：<code>KeyPath</code> 实际上是一个类型家族的总称，包括 <code>KeyPath</code>、<code>WritableKeyPath</code> 和 <code>ReferenceWritableKeyPath</code> 等。虽然这些变体本质上都描述了属性的访问路径，但它们各自适用于不同的场景。</li>
<li><strong>组合性</strong>：<code>KeyPath</code> 具有强大的组合能力，允许开发者将多个 <code>KeyPath</code> 串联在一起。这种特性使得我们可以轻松地表达和访问深层嵌套的属性。</li>
</ul>
<h2 id="基本用法">基本用法</h2>
<h3 id="声明">声明</h3>
<p>Swift 并没有为 <code>KeyPath</code> 提供公开的构造方法，开发者需要通过字面量语法来进行声明：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> People</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fat</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> age: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 100</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> addresses: [</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 描述了访问 People 类型中 name 属性的路径</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> namePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \People.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 描述了访问 People 类型中 addresses 属性第一个元素的路径</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstAddressPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \People.addresses[</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">]</span></span></code></pre></div>
<p><code>KeyPath</code> 的声明语法是在 <code>类型.属性</code> 之前添加反斜杠 <code>\</code>。</p>
<h3 id="通过-keypath-读取值">通过 KeyPath 读取值</h3>
<p>Swift 为每个类型都自动生成了一个 <code>subscript[keyPath:]</code> 下标方法，允许我们通过 <code>KeyPath</code> 访问特定实例中的属性值：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> people1 </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> People</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(people1[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: firstAddressPath]) </span><span style="color:#6272A4">// &quot;world&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> people2 </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> People</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">people2.name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">bob</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(people2[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: namePath]) </span><span style="color:#6272A4">// &quot;bob&quot;</span></span></code></pre></div>
<h3 id="通过-keypath-设置值">通过 KeyPath 设置值</h3>
<p>与读取值相似，设置值也需要通过 <code>subscript[keyPath:]</code> 来完成：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> people </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> People</span><span style="color:#F8F8F2">() </span><span style="color:#6272A4">// 使用 var 来声明值类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">people[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: namePath] </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">bob</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(people[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: \.name]) </span><span style="color:#6272A4">// &quot;bob&quot;</span></span></code></pre></div>
<p>设置值时有一些要求和限制，会在后续详细讨论。</p>
<h3 id="将-keypath-作为参数">将 KeyPath 作为参数</h3>
<p><code>KeyPath</code> 的另一个重要特性是它可以作为参数传递，使得我们能够在不知道具体属性名的情况下操作实例的属性：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> People</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fat</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> age: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 100</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> addresses: [</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">  // 接收一个 KeyPath，其 Root 为 People, Value 为 String</span></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> getInfo</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">keyPath</span><span style="color:#F8F8F2">: KeyPath&lt;</span><span style="color:#BD93F9;font-style:italic">Self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    self</span><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: keyPath]</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(people.</span><span style="color:#8BE9FD">getInfo</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: \.name)) </span><span style="color:#6272A4">// &quot;fat&quot;</span></span></code></pre></div>
<h2 id="keypath-的家族成员">KeyPath 的家族成员</h2>
<p>在深入 <code>KeyPath</code> 的细节之前，我们首先需要了解，<code>KeyPath</code> 通常并非特指单一类型，而是一个包含了五种不同类型的家族。</p>
<h3 id="家族成员">家族成员</h3>
<p><code>KeyPath</code> 家族的类型层次如下：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Shell</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#50FA7B">-</span><span style="color:#F1FA8C"> AnyKeyPath</span></span>
<span class="line"><span style="color:#50FA7B">    -</span><span style="color:#F1FA8C"> PartialKeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F1FA8C">Roo</span><span style="color:#F8F8F2">t</span><span style="color:#FF79C6">&gt;</span></span>
<span class="line"><span style="color:#50FA7B">        -</span><span style="color:#F1FA8C"> KeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F1FA8C">Root,</span><span style="color:#F1FA8C"> Valu</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">&gt;</span></span>
<span class="line"><span style="color:#50FA7B">            -</span><span style="color:#F1FA8C"> WritableKeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F1FA8C">Root,</span><span style="color:#F1FA8C"> Valu</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">&gt;</span></span>
<span class="line"><span style="color:#50FA7B">                -</span><span style="color:#F1FA8C"> ReferenceWritableKeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F1FA8C">Root,</span><span style="color:#F1FA8C"> Valu</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">&gt;</span></span>
<span class="line"></span></code></pre></div>
<h4 id="1-anykeypath">1. <strong><code>AnyKeyPath</code></strong></h4>
<ul>
<li><code>KeyPath</code> 家族中所有类型的<strong>基类</strong>。</li>
<li>不指定 <code>Root</code> 或 <code>Value</code> 类型。</li>
<li><strong>只读</strong>访问，不允许写操作。</li>
<li>最大的特点是<strong>不使用任何泛型</strong>，因此它能够泛化所有 <code>KeyPath</code> 类型。</li>
</ul>
<h4 id="2-partialkeypathroot">2. <strong><code>PartialKeyPath&lt;Root&gt;</code></strong></h4>
<ul>
<li>指定 <code>Root</code> 类型，但不指定 <code>Value</code> 类型。</li>
<li><strong>只读</strong>访问，不允许写操作。</li>
<li>使用<strong>一个泛型</strong>（<code>Root</code>），可用于部分特化的 <code>KeyPath</code>。</li>
</ul>
<h4 id="3-keypathroot-value">3. <strong><code>KeyPath&lt;Root, Value&gt;</code></strong></h4>
<ul>
<li>同时指定 <code>Root</code> 和 <code>Value</code> 类型。</li>
<li><strong>只读</strong>访问，不允许写操作。</li>
<li>使用两个泛型，提供了 <code>Root</code> 到 <code>Value</code> 的具体映射。</li>
</ul>
<h4 id="4-writablekeypathroot-value">4. <strong><code>WritableKeyPath&lt;Root, Value&gt;</code></strong></h4>
<ul>
<li>允许对属性进行<strong>读取和写入</strong>操作。</li>
<li>适用于值类型和引用类型。</li>
<li>是 <code>KeyPath</code> 的可写版本。</li>
</ul>
<h4 id="5-referencewritablekeypathroot-value">5. <strong><code>ReferenceWritableKeyPath&lt;Root, Value&gt;</code></strong></h4>
<ul>
<li>专门用于<strong>引用类型</strong>的属性。</li>
<li>允许对属性进行<strong>读取和写入</strong>操作。</li>
<li>提供额外的性能优化，特别是对 <code>let</code> 属性的支持。</li>
</ul>
<p>从以上结构可以看出，<code>KeyPath</code> 家族的传承具有以下特点：</p>
<ul>
<li>泛型的特化程度逐渐增加，从无泛型到使用两个泛型。</li>
<li>访问权限逐渐增强，从只读到可读写。</li>
</ul>
<h3 id="声明与转换">声明与转换</h3>
<p>虽然 <code>KeyPath</code> 家族有多种类型，但它们的声明方式非常统一，都通过字面量语法进行：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> namePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \People.name </span><span style="color:#6272A4">// 推断为 WritableKeyPath&lt;People, String&gt;</span></span></code></pre></div>
<p>在上面的示例中，为什么 <code>namePath</code> 的类型被推断为 <code>WritableKeyPath&lt;People, String&gt;</code> 呢？</p>
<p>这是因为 Swift 编译器会根据类型的种类（值类型或引用类型）以及属性的可读写状态（只读或可读写），<strong>自动推断出 <code>KeyPath</code> 家族中最为特化的类型</strong>。这种推断确保 <code>KeyPath</code> 能够精确匹配属性的特性，提供更准确的访问或操作能力。</p>
<p>在上述示例中，<code>People</code> 是一个值类型，<code>name</code> 是一个可读写的属性，因此推断为 <code>WritableKeyPath&lt;People, String&gt;</code>。其中，<code>People</code> 对应泛型中的 <code>Root</code>，<code>String</code> 对应泛型中的 <code>Value</code>。</p>
<p><strong>其他自动推断的例子</strong>：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> People</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  let</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> peopleNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \People.name </span><span style="color:#6272A4">// 推断为 KeyPath&lt;People, String&gt;，因为 name 是只读的</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> firstName: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> lastName: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    get</span><span style="color:#F8F8F2"> { firstName }</span></span>
<span class="line"><span style="color:#FF79C6">    set</span><span style="color:#F8F8F2"> { firstName </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> newValue }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 推断为 ReferenceWritableKeyPath&lt;Item, String&gt;，因为 Item 是引用类型，firstName 是可写的</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 推断为 ReferenceWritableKeyPath&lt;Item, String&gt;，因为 name 有 setter，可写</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> itemNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 推断为 KeyPath&lt;Item, Int&gt;，因为 count 是 String 的只读计算属性</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName.</span><span style="color:#BD93F9">count</span></span></code></pre></div>
<p>因此，如果我们想明确声明一个特定类型的 <code>KeyPath</code>，可以在声明时显式指定类型：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 显式声明为 WritableKeyPath</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNamePath: WritableKeyPath&lt;Item, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName </span><span style="color:#6272A4">// 声明为比 ReferenceWritableKeyPath 高一级的类型</span></span>
<span class="line"><span style="color:#6272A4">// 显式声明为 KeyPath</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> itemNamePath: KeyPath&lt;Item, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.name </span><span style="color:#6272A4">// 声明为比 ReferenceWritableKeyPath 级别更高的类型</span></span>
<span class="line"><span style="color:#6272A4">// 直接声明为 AnyKeyPath，避免使用泛型</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountAnyPath: AnyKeyPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName.</span><span style="color:#BD93F9">count</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// ❌，声明失败，因为 count 不可写</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountAnyPath: WritableKeyPath&lt;Item, </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName.</span><span style="color:#BD93F9">count</span><span style="color:#F8F8F2"> </span></span></code></pre></div>
<p><strong>转换</strong></p>
<p>在 <code>KeyPath</code> 家族中，可以将更特化的类型转换为更泛化的类型。例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameAnyPath: AnyKeyPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> firstNamePath</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> itemNameAnyPath: PartialKeyPath&lt;Item&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> itemNamePath</span></span></code></pre></div>
<p>这种转换方式与 Swift 中父类和子类的转换机制不同，只要类型和属性特性满足条件，我们可以在 <code>KeyPath</code> 的层次结构中自由转换类型。比如，将 <code>AnyKeyPath</code> 转换为更特化的类型：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountAnyPath: AnyKeyPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.firstName.</span><span style="color:#BD93F9">count</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 成功转换为 KeyPath</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountPath1 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> firstNameCountAnyPath </span><span style="color:#FF79C6">as!</span><span style="color:#F8F8F2"> KeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">Item, </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 转换失败，因为 count 是不可写的</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstNameCountPath2 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> firstNameCountAnyPath </span><span style="color:#FF79C6">as!</span><span style="color:#F8F8F2"> WritableKeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">Item, </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6">&gt;</span></span></code></pre></div>
<p>这种转换之所以可能，是因为即便是最泛化的 <code>AnyKeyPath</code> 类型，内部也保留了特化类型的所有信息。</p>
<h2 id="anykeypath非一般的类型抹除工具">AnyKeyPath，非一般的类型抹除工具</h2>
<p>看到 <code>AnyKeyPath</code>，许多开发者可能会联想到诸如 <code>AnyHashable</code>、<code>AnyPublisher</code>、<code>AnyView</code> 等类型擦除工具。虽然 <code>AnyKeyPath</code> 确实具有类型擦除的特性（尤其是泛型擦除），但本质上它不仅仅是一个类型擦除工具。<code>AnyKeyPath</code> 是一个<strong>包含全面信息的基类</strong>，其子类如 <code>PartialKeyPath</code> 和 <code>KeyPath</code> 则通过添加泛型约束，进一步提供了额外的类型安全和编译时检查。这种设计巧妙结合了运行时的灵活性和编译时的安全性，使得键路径系统既强大又安全。</p>
<p>与其他具备类型擦除功能的工具类似，<code>AnyKeyPath</code> 在某些场景下特别有用，尤其是在需要避免泛型约束时，比如数组或字典的声明：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> keys:[AnyKeyPath] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [\Item.name, \People.age]</span></span></code></pre></div>
<p>而只带有一个泛型的 <code>PartialKeyPath</code> 则适用于已明确 <code>Root</code> 类型的场景。一方面，它对可以使用的键路径进行了约束；另一方面，由于上下文中提供了 <code>Root</code> 类型，开发者也能更方便地录入键路径：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> keys:[PartialKeyPath&lt;People&gt;] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [\.name, \.age]</span></span></code></pre></div>
<h2 id="组合-keypath">组合 KeyPath</h2>
<p><code>KeyPath</code> 可以轻松表达深层嵌套的属性。例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> A</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> b:B</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> B</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name:</span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> namePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.b.name </span><span style="color:#6272A4">// WritableKeyPath&lt;A, String&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> nameCountPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.b.name.</span><span style="color:#BD93F9">count</span><span style="color:#6272A4"> // KeyPath&lt;A, Int&gt;</span></span></code></pre></div>
<p>对于一个包含两个泛型约束的 <code>KeyPath</code> 类型来说，无论路径的深度如何，<code>Root</code> 和 <code>Value</code> 的规则始终保持一致：</p>
<ul>
<li><strong>Root</strong>：访问路径的起点类型。</li>
<li><strong>Value</strong>：访问路径终点属性的类型。</li>
</ul>
<p>因此，<code>\A.b.name.count</code> 的推断类型为 <code>KeyPath&lt;A, Int&gt;</code>，因为 <code>count</code> 属性的类型是 <code>Int</code>。</p>
<p>在很多情况下，我们不需要直接声明嵌套层次较深的路径，可以通过 <code>appending(path:)</code> 将两个 <code>KeyPath</code> 组合成一个新路径：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;A, B&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.b</span></span>
<span class="line"><span style="color:#6272A4">// KeyPath&lt;B, Int&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bNameCountPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \B.name.</span><span style="color:#BD93F9">count</span></span>
<span class="line"><span style="color:#6272A4">// KeyPath&lt;A, Int&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> nameCountPath1 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> bPath.</span><span style="color:#8BE9FD">appending</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">path</span><span style="color:#F8F8F2">: bNameCountPath)</span></span></code></pre></div>
<p>组合 <code>KeyPath</code> 的基本要求是，追加的 <code>KeyPath</code> 的 <code>Root</code> 类型必须与被追加的 <code>KeyPath</code> 的 <code>Value</code> 类型一致。组合后的 <code>KeyPath</code> 泛型为：原 <code>KeyPath</code> 的 <code>Root</code> 和追加的 <code>KeyPath</code> 的 <code>Value</code>。</p>
<p>当使用 <code>AnyKeyPath</code> 或 <code>PartialKeyPath</code> 时，与其他 <code>KeyPath</code> 类型组合将返回一个可选的 <code>KeyPath</code>，如果类型不匹配，运行时将返回 <code>nil</code>：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// AnyKeyPath</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bPath: AnyKeyPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.b</span></span>
<span class="line"><span style="color:#6272A4">// KeyPath&lt;B, Int&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bNameCountPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \B.name.</span><span style="color:#BD93F9">count</span></span>
<span class="line"><span style="color:#6272A4">// AnyKeyPath?</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> nameCountPath1 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> bPath.</span><span style="color:#8BE9FD">appending</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">path</span><span style="color:#F8F8F2">: bNameCountPath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Root 为 Item</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> itemNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \Item.name</span></span>
<span class="line"><span style="color:#6272A4">// nil</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> combinePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> bPath.</span><span style="color:#8BE9FD">appending</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">path</span><span style="color:#F8F8F2">: itemNamePath)</span></span></code></pre></div>
<p>需要注意的是，<strong>并非所有不同类型的 <code>KeyPath</code> 都可以成功组合</strong>。例如，尝试使用 <code>KeyPath.appending(path: AnyKeyPath)</code> 进行组合时会失败，尽管 <code>AnyKeyPath</code> 实际上包含了组合所需的全部信息。在实际使用中，开发者应进行额外测试来确保类型的兼容性。</p>
<h2 id="writablekeypath-vs-referencewritablekeypath">WritableKeyPath vs ReferenceWritableKeyPath</h2>
<p><code>WritableKeyPath</code> 和 <code>ReferenceWritableKeyPath</code> 都可以用于表示一个可写的属性路径。两者的主要区别如下：</p>
<ol>
<li>
<p><strong>适用类型</strong>：</p>
<p><code>WritableKeyPath</code> 适用于<strong>值类型</strong>和<strong>引用类型</strong>，而 <code>ReferenceWritableKeyPath</code> 只能用于<strong>引用类型</strong>。</p>
</li>
</ol>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> A</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;A, String&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> aNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> B</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;B, String&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bNamePath: WritableKeyPath&lt;B, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \B.name</span></span></code></pre></div>
<ol start="2">
<li>
<p><strong>实例声明要求</strong>：</p>
<p>使用 <code>WritableKeyPath</code> 时，实例必须由 <code>var</code> 声明才能修改属性；而使用 <code>ReferenceWritableKeyPath</code> 时，即使实例由 <code>let</code> 声明，属性依然可以被修改。</p>
</li>
</ol>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;A, String&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> aNamePath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \A.name</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> a </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> A</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">a[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: aNamePath] </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fat</span><span style="color:#E9F284">&quot;</span><span style="color:#6272A4"> // 编译错误，因 a 是 let 声明的</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// ReferenceWritableKeyPath&lt;B, String&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> bNamePath: ReferenceWritableKeyPath&lt;B, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \B.name</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> b </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> B</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">b[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: bNamePath] </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">bob</span><span style="color:#E9F284">&quot;</span><span style="color:#6272A4"> // 正确执行，尽管 b 是 let 声明的</span></span></code></pre></div>
<ol start="3">
<li>
<p><strong>专为引用类型设计</strong>：</p>
<p><code>ReferenceWritableKeyPath</code> 是专门为引用类型属性设计的。它是 <code>WritableKeyPath</code> 的一个特殊子类，为引用类型提供了额外的保证和潜在的优化。</p>
</li>
</ol>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> strLength</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B;font-style:italic">obj</span><span style="color:#F8F8F2">: T, </span><span style="color:#50FA7B;font-style:italic">strKeyPath</span><span style="color:#F8F8F2">: ReferenceWritableKeyPath&lt;T, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Int</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">  obj[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: strKeyPath].</span><span style="color:#BD93F9">count</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">strLength</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">obj</span><span style="color:#F8F8F2">: b, </span><span style="color:#8BE9FD">strKeyPath</span><span style="color:#F8F8F2">: \.name) </span><span style="color:#6272A4">// 正常运行，B 是引用类型</span></span>
<span class="line"><span style="color:#8BE9FD">strLength</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">obj</span><span style="color:#F8F8F2">: a, </span><span style="color:#8BE9FD">strKeyPath</span><span style="color:#F8F8F2">: \.name) </span><span style="color:#6272A4">// 编译错误，A 是值类型</span></span></code></pre></div>
<h2 id="hashable-和-equatable">Hashable 和 Equatable</h2>
<p>虽然许多类型都遵循 <code>Hashable</code> 和 <code>Equatable</code> 协议，但 <code>KeyPath</code> 家族的成员在实现这些协议时有其独特之处。</p>
<p>由于 <code>KeyPath</code> 家族中的不同层级类型（如 <code>KeyPath</code> 和 <code>AnyKeyPath</code>）在内部实际上共享相同的信息，这使得<strong>跨类型</strong>的比较成为可能：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> nameKeyPath: KeyPath&lt;People, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \.name</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> nameAnyKeyPath: AnyKeyPath </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \People.name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 比较 KeyPath&lt;People, String&gt; 和 AnyKeyPath</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(nameKeyPath </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> nameAnyKeyPath) </span><span style="color:#6272A4">// true</span></span></code></pre></div>
<p>同样，它们的 <code>hashValue</code> 计算也基于相同的内部信息：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(nameKeyPath.</span><span style="color:#BD93F9">hashValue</span><span style="color:#FF79C6"> ==</span><span style="color:#F8F8F2"> nameAnyKeyPath.</span><span style="color:#BD93F9">hashValue</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// true</span></span></code></pre></div>
<p>这一特性使得开发者在进行 <code>KeyPath</code> 比较或将 <code>KeyPath</code> 用作字典键时更加便捷。无论使用哪种类型的 <code>KeyPath</code>，只要描述的是同一路径，都能作为相同的键：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> keysCount: [AnyKeyPath</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Int</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">keysCount[nameKeyPath, </span><span style="color:#8BE9FD">default</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> keysCount[nameKeyPath, </span><span style="color:#8BE9FD">default</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">+</span><span style="color:#BD93F9"> 1</span><span style="color:#6272A4"> // KeyPath&lt;People, String&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">keysCount[nameKeyPath, </span><span style="color:#8BE9FD">default</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> keysCount[nameAnyKeyPath, </span><span style="color:#8BE9FD">default</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">+</span><span style="color:#BD93F9"> 1</span><span style="color:#6272A4"> // AnyKeyPath</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(keysCount[\People.name]) </span><span style="color:#6272A4">// Optional(2)</span></span></code></pre></div>
<h2 id="self"><code>\.self</code></h2>
<p>在声明 <code>KeyPath</code> 时，当希望 <code>Value</code> 表示类型本身时，可以使用 <code>.self</code>。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> texts </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">b</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">o</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">b</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;[String], [String]&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> array </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \[</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">].</span><span style="color:#FF79C6">self</span></span>
<span class="line"><span style="color:#F8F8F2">texts[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: array] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">f</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">t</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(texts) </span><span style="color:#6272A4">// [&quot;f&quot;, &quot;a&quot;, &quot;t&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> numbers </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#BD93F9">3</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">5</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">6</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#6272A4">// WritableKeyPath&lt;[Int], Int&gt;</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> firstElement </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> \[</span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">].</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">[</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">] </span><span style="color:#6272A4">// `self` 可以被省略，写成 `\[Int].[0]`</span></span>
<span class="line"><span style="color:#F8F8F2">numbers[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: firstElement] </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 10</span></span>
<span class="line"><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(numbers) </span><span style="color:#6272A4">// [10, 5, 6]</span></span></code></pre></div>
<p>不少开发者在 SwiftUI 视图中会使用类似的代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> DemoView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> numbers </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#BD93F9">3</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">5</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">6</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">8</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">5</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">3</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            ForEach</span><span style="color:#F8F8F2">(numbers, </span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: \.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">) { number </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(number, </span><span style="color:#8BE9FD">format</span><span style="color:#F8F8F2">: .number)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>此时，<code>ForEach</code> 的构造方法如下：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">Data</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">RandomAccessCollection</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9;font-style:italic">ID</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Hashable</span><span style="color:#F8F8F2">&gt;(</span></span>
<span class="line"><span style="color:#50FA7B">    _</span><span style="color:#FFB86C;font-style:italic"> data</span><span style="color:#F8F8F2">: Data,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">    id</span><span style="color:#F8F8F2">: KeyPath&lt;Data.</span><span style="color:#8BE9FD;font-style:italic">Element</span><span style="color:#F8F8F2">, ID&gt;,</span></span>
<span class="line"><span style="color:#F8F8F2">    @</span><span style="color:#50FA7B">ViewBuilder</span><span style="color:#FFB86C;font-style:italic"> content</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (Data.</span><span style="color:#8BE9FD;font-style:italic">Element</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Content</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span></code></pre></div>
<p>通过 <code>id: \.self</code>，我们将数组中的每个元素作为 <code>ForEach</code> 的唯一标识符（ID）。但如果数组中有重复的元素，<code>ForEach</code> 中的视图标识符会发生冲突，这个问题在添加或删除元素时尤为明显。因此，最佳做法是让元素遵循 <code>Identifiable</code> 协议，而不是直接使用元素本身作为 ID，以避免潜在的冲突。</p>
<h2 id="性能">性能</h2>
<p>在之前的版本中，我认为通过 <code>KeyPath</code> 访问属性与直接访问属性的性能相当。然而，文章发布后，Rick van Voorden 与我通过邮件分享了他对 <code>KeyPath</code> 性能的研究。根据他的测试，<code>KeyPath</code> 的性能目前落后于直接属性访问（尤其是在引用类型中）。他认为，这可能是由于当前实现中缺少必要的优化所致。</p>
<p>他指出了一些需要关注的源码部分：</p>
<ol>
<li><a href="https://github.com/swiftlang/swift/blob/swift-6.0.1-RELEASE/stdlib/public/core/KeyPath.swift#L334-L341?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">KeyPath.swift 第334-341行</a></li>
<li><a href="https://github.com/swiftlang/swift/blob/swift-6.0.1-RELEASE/stdlib/public/core/KeyPath.swift#L405-L414?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">KeyPath.swift 第405-414行</a></li>
<li><a href="https://github.com/swiftlang/swift/blob/swift-6.0.1-RELEASE/stdlib/public/core/KeyPath.swift#L2389-L2405?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">KeyPath.swift 第2389-2405行</a></li>
</ol>
<p>或许在未来的 Swift 版本中，<code>KeyPath</code> 在访问引用类型和结构体时能够提供相同的性能表现。</p>
<blockquote>
<p>Rick van Voorden 是 <a href="https://github.com/Swift-CowBox/Swift-CowBox?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Swift-CowBox</a> 宏的开发者。该宏简化了为自定义类型实现写时复制（Copy On Write，COW）的过程，减少了重复编写代码的负担。</p>
</blockquote>
<h2 id="keypath-重要吗">KeyPath 重要吗？</h2>
<p>越来越多的开发者逐渐意识到了 <code>KeyPath</code> 的重要性和便利性，如今它已经被广泛应用于系统框架和第三方框架中。</p>
<p>例如，过去使用闭包的高阶函数，现在可以通过更优雅的 <code>KeyPath</code> 来实现：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> peoples: [People] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#6272A4">// 传统方式</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> names1 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> peoples.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">.name }</span></span>
<span class="line"><span style="color:#6272A4">// 基于 KeyPath 的方式</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> names2 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> peoples.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2">(\.name)</span></span></code></pre></div>
<p>在新的谓词宏中，<code>KeyPath</code> 也扮演了重要角色。由于它与实例无关的特性，可以很好地描述谓词条件：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> predicate </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> #Predicate</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">Settings</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    $0</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">==</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">abc</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 宏展开后</span></span>
<span class="line"><span style="color:#F8F8F2">Foundation.Predicate</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">Settings</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">({</span></span>
<span class="line"><span style="color:#F8F8F2">    PredicateExpressions.</span><span style="color:#8BE9FD">build_Equal</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">        lhs</span><span style="color:#F8F8F2">: PredicateExpressions.</span><span style="color:#8BE9FD">build_KeyPath</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">            root</span><span style="color:#F8F8F2">: PredicateExpressions.</span><span style="color:#8BE9FD">build_Arg</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#8BE9FD">            keyPath</span><span style="color:#F8F8F2">: \.name</span></span>
<span class="line"><span style="color:#F8F8F2">        ),</span></span>
<span class="line"><span style="color:#8BE9FD">        rhs</span><span style="color:#F8F8F2">: PredicateExpressions.</span><span style="color:#8BE9FD">build_Arg</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">abc</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">})</span></span></code></pre></div>
<p>在 Observation 框架中，<code>KeyPath</code> 还用于触发属性变化的通知：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">internal</span><span style="color:#FF79C6"> nonisolated</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> withMutation</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">Member</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B;font-style:italic">keyPath</span><span style="color:#F8F8F2">: KeyPath&lt;Settings, Member&gt;, </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> mutation</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">throws</span><span style="color:#FF79C6"> -&gt;</span><span style="color:#F8F8F2"> T) </span><span style="color:#FF79C6">rethrows</span><span style="color:#FF79C6"> -&gt;</span><span style="color:#F8F8F2"> T {</span></span>
<span class="line"><span style="color:#FF79C6">  try</span><span style="color:#BD93F9"> _</span><span style="color:#F8F8F2">$observationRegistrar.</span><span style="color:#8BE9FD">withMutation</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">of</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: keyPath, mutation)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><code>KeyPath</code> 与 <code>@dynamicMemberLookup</code> 结合使用也是一种常见的应用场景。这种方式既保证了内部数据的封装，又提供了灵活且类型安全的属性访问：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@dynamicMemberLookup</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Store</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">State</span><span style="color:#F8F8F2">&gt;: ObservableObject {</span></span>
<span class="line"><span style="color:#FF79C6">    @Published</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> state: State</span></span>
<span class="line"><span style="color:#FF79C6">    subscript&lt;</span><span style="color:#F8F8F2">T</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">(dynamicMember keyPath</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> KeyPath</span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">State, T</span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T {</span></span>
<span class="line"><span style="color:#F8F8F2">        state[</span><span style="color:#8BE9FD">keyPath</span><span style="color:#F8F8F2">: keyPath]</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> userName </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> store.user </span><span style="color:#6272A4">// 对应 store.state.user</span></span></code></pre></div>
<p>许多苹果官方框架提供的属性包装器（如 <code>@ObservedObject</code>、<code>@StateObject</code>）都体现了这一应用。</p>
<p><code>KeyPath</code> 使开发者的代码更加优雅、安全，并具备更强的通用性。它是 Swift 语言功能逐步完善和强大的一个重要体现。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="总结">总结</h2>
<p><code>KeyPath</code> 是 Swift 语言中的核心特性之一，为我们提供了优雅、类型安全且灵活的方式来引用和操作类型的属性。它不仅在访问嵌套属性、处理泛型数据时提供了强大的能力，还能通过其与实例无关的特性，在编译时进行类型检查，确保代码的安全性与稳定性。</p>
<p><code>KeyPath</code> 的引入标志着 Swift 语言向类型安全、灵活性和性能优化的进一步发展，它为开发者提供了在大型项目中管理复杂数据结构的工具。在未来，<code>KeyPath</code> 很可能会在更多框架和场景中继续发挥作用，成为 Swift 语言日益成熟和强大的重要体现。</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2024-10-23T14:00:00.000Z",
  "datePublished": "2024-10-23T14:00:00.000Z",
  "description": "深入解析Swift KeyPath，探索其强大功能、类型家族和高级用法，掌握属性访问的利器，提升Swift编程效率。",
  "headline": "从基础到进阶：Swift 中的 KeyPath 完全指南",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/comprehensive-guide-to-mastering-keypath-in-swift-zh.webp"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/comprehensive-guide-to-mastering-keypath-in-swift/"
  },
  "url": "https://fatbobman.com/zh/posts/comprehensive-guide-to-mastering-keypath-in-swift/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <img src="/images/aifadian.svg" alt="" width="18" height="18" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  fetch(url)
    .then(response => response.text())
    .then(html => {
      // 获取所有的广告位元素
      const adSlots = document.querySelectorAll('.dynamic-ad-container');
      // 将广告内容填充到每一个广告位中
      adSlots.forEach(slot => {
        slot.innerHTML = html;
      });
    })
    .catch(error => console.error('Error loading the ad:', error));
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/mastering-the-swift-testing-framework/" id="relatedPosts-Swifter and Swifty：掌握 Swift Testing 框架"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Swifter and Swifty：掌握 Swift Testing 框架</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/swift-predicate-usage-composition-and-considerations/" id="relatedPosts-Swift Predicate: 用法、构成及注意事项"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Swift Predicate: 用法、构成及注意事项</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/mastering-observation/" id="relatedPosts-深度解读 Observation —— SwiftUI 性能提升的新途径"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">深度解读 Observation —— SwiftUI 性能提升的新途径</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-049" id="relatedPosts-Weekly #49 - 创新可以有很多种"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #49 - 创新可以有很多种</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/adding-published-ability-to-custom-property-wrapper-types/" id="relatedPosts-为自定义属性包装类型添加类 @Published 的能力"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">为自定义属性包装类型添加类 @Published 的能力</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/combineandasync/" id="relatedPosts-聊聊 Combine 和 async/await 之间的合作"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">聊聊 Combine 和 async/await 之间的合作</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/attributedstring/" id="relatedPosts-AttributedString —— 不仅仅让文字更漂亮"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">AttributedString —— 不仅仅让文字更漂亮</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/userdefaults-and-observation/" id="relatedPosts-SwiftUI 中的 UserDefaults 与 Observation：如何实现精准响应"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI 中的 UserDefaults 与 Observation：如何实现精准响应</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="从基础到进阶：Swift 中的 KeyPath 完全指南" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#什么是-keypath" class=""> 什么是 KeyPath </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#基本用法" class=""> 基本用法 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#声明" class=""> 声明 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#通过-keypath-读取值" class=""> 通过 KeyPath 读取值 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#通过-keypath-设置值" class=""> 通过 KeyPath 设置值 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#将-keypath-作为参数" class=""> 将 KeyPath 作为参数 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#keypath-的家族成员" class=""> KeyPath 的家族成员 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#家族成员" class=""> 家族成员 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#声明与转换" class=""> 声明与转换 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#anykeypath非一般的类型抹除工具" class=""> AnyKeyPath，非一般的类型抹除工具 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#组合-keypath" class=""> 组合 KeyPath </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#writablekeypath-vs-referencewritablekeypath" class=""> WritableKeyPath vs ReferenceWritableKeyPath </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#hashable-和-equatable" class=""> Hashable 和 Equatable </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#" class=""> \.self </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#性能" class=""> 性能 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#keypath-重要吗？" class=""> KeyPath 重要吗？ </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#总结" class=""> 总结 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    console.log(sidebarOffsetTop, window.scrollY, initialTop - stickyPoint);
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/reinventing-core-data-development-with-swiftdata-principles/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>以 SwiftData 之道，重塑 Core Data 开发</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/reinventing-core-data-development-with-swiftdata-principles/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/starting-with-project-refactoring-sharing-five-swift-modules/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>从项目重构说起：五个 Swift 模块分享</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/starting-with-project-refactoring-sharing-five-swift-modules/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E8%BF%9B%E9%98%B6%EF%BC%9ASwift%20%E4%B8%AD%E7%9A%84%20KeyPath%20%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97&#38;url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcomprehensive-guide-to-mastering-keypath-in-swift%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E8%BF%9B%E9%98%B6%EF%BC%9ASwift%20%E4%B8%AD%E7%9A%84%20KeyPath%20%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcomprehensive-guide-to-mastering-keypath-in-swift%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fcomprehensive-guide-to-mastering-keypath-in-swift%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcomprehensive-guide-to-mastering-keypath-in-swift%2F&#38;title=%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E8%BF%9B%E9%98%B6%EF%BC%9ASwift%20%E4%B8%AD%E7%9A%84%20KeyPath%20%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcomprehensive-guide-to-mastering-keypath-in-swift%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E8%BF%9B%E9%98%B6%EF%BC%9ASwift%20%E4%B8%AD%E7%9A%84%20KeyPath%20%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0A%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E8%BF%9B%E9%98%B6%EF%BC%9ASwift%20%E4%B8%AD%E7%9A%84%20KeyPath%20%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcomprehensive-guide-to-mastering-keypath-in-swift%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>在 SwiftUI 下定制手势 | 肘子的 Swift 记事本</title>
<meta name="description" content="探索SwiftUI手势定制，详解预置手势、GestureState及组合手势，并展示轻扫、计时按压等自定义手势实现。iOS 18引入UIGestureRecognizerRepresentable，解决手势冲突。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/swiftuigesture/">
<meta property="og:title" content="在 SwiftUI 下定制手势 | 肘子的 Swift 记事本">
<meta property="og:description" content="探索SwiftUI手势定制，详解预置手势、GestureState及组合手势，并展示轻扫、计时按压等自定义手势实现。iOS 18引入UIGestureRecognizerRepresentable，解决手势冲突。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/swiftuigesture/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/swiftuigesture-zh.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/swiftuigesture/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/swiftuigesture/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/about.U6Ns_EvO.css" />
<link rel="stylesheet" href="/_astro/about.A2eLQKU2.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default tracking-tight bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/swiftuigesture/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/swiftuigesture/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">在 SwiftUI 下定制手势</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2022-01-10T00:12:00.000Z">2022 年 1 月 10 日</time>  <span> 更新于  </span> <time datetime="2024-06-15T00:12:00.000Z"> 2024 年 6 月 15 日 </time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>不同于众多的内置控件，SwiftUI 没有采用对 UIGestureRecognizer（或 NSGestureRecognizer）进行包装的形式，而是重构了自己的手势体系。SwiftUI 手势在某种程度上降低了使用门槛，但由于缺乏提供底层数据的 API，严重制约了开发者的深度定制能力。在 SwiftUI 下，我们无法拥有类似构建全新 UIGestureRecongnizer 的能力。所谓的自定义手势，其实只是对系统预置手势的重构而已。本文将通过几个示例，演示如何使用 SwiftUI 提供的原生手段定制所需手势。</p>
<blockquote>
<p>2024 年 6 月更新：在 WWDC 2024 中，SwiftUI 引入了 <code>UIGestureRecognizerRepresentable</code>。这一新特性使得在 SwiftUI 视图中可以直接使用 UIKit 的手势，有效地解决了预设手势功能不足及手势冲突的问题。有关此功能的更多详细信息，请参见文章结尾部分。</p>
</blockquote>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="基础">基础</h2>
<h3 id="预置手势">预置手势</h3>
<p>SwiftUI 目前提供了 5 种预置手势，分别为点击、长按、拖拽、缩放和旋转。像 <code>onTapGesture</code> 之类的调用方式，实际上是为了便捷而创建的视图扩展。</p>
<ul>
<li>
<p>点击（TapGesture）</p>
<p>可设定点击次数（单击、双击）。是使用频率最高的手势之一。</p>
</li>
<li>
<p>长按（LongPressGesture）</p>
<p>当按压满足了设定时长后，可触发指定闭包。</p>
</li>
<li>
<p>拖拽（DragGesture）</p>
<p>SwiftUI 将 Pan 和 Swipe 合二为一，位置变化时，提供拖动数据。</p>
</li>
<li>
<p>缩放（MagnificationGesture）</p>
<p>两指缩放。</p>
</li>
<li>
<p>旋转（RotationGesture）</p>
<p>两指旋转。</p>
</li>
</ul>
<p>点击、长按、拖拽仅支持单指。SwiftUI 没有提供手指数设定功能。</p>
<p>除了上述提供给开发者使用的手势外，SwiftUI 其实还有大量的内部（非公开）手势给系统控件使用，例如：<code>ScrollGesture</code>、<code>_ButtonGesture</code> 等。</p>
<blockquote>
<p><code>Button</code> 内置手势的实现比 <code>TapGesture</code> 更复杂。除了提供了更多的调用时机外，而且支持了对按压区域尺寸的智能处理（提高手指触击成功率）。</p>
</blockquote>
<h3 id="value">Value</h3>
<p>SwiftUI 会依据手势的类型提供不同的数据内容。</p>
<ul>
<li>点击：数据类型为 <code>Void</code>（ SwiftUI 4.0 中，数据类型为 CGPoint，指示了在特定坐标空间中的点击位置 ）</li>
<li>长按：数据类型为 <code>Bool</code>，开始按压后提供 <code>true</code></li>
<li>拖拽：提供了最全面的数据信息，包含当前位置、偏移量、事件时间、预测终点、预测偏移量等内容</li>
<li>缩放：数据类型为 <code>CGFloat</code>，缩放量</li>
<li>旋转：数据类型为 <code>Angle</code>，旋转角度</li>
</ul>
<p>使用 <code>map</code> 方法，可以将手势提供的数据转换成其他的类型，方便之后的调用。</p>
<h3 id="时机">时机</h3>
<p>SwiftUI 手势内部没有状态一说，通过设置与指定时机对应的闭包，手势会在适当的时机自动进行调用。</p>
<ul>
<li>
<p>onEnded</p>
<p>在手势结束时执行的操作</p>
</li>
<li>
<p>onChanged</p>
<p>当手势提供的值发生变化时执行的操作。只在 <code>Value</code> 符合 <code>Equatable</code> 时提供，因此 <code>TapGesture</code> 不支持。</p>
</li>
<li>
<p>updating</p>
<p>执行时机同 <code>onChanged</code> 相同。对 <code>Value</code> 没有特别约定，相较 <code>onChanged</code> ，增加了更新手势属性（<code>GestureState</code>）和获取 <code>Transaction</code> 的能力。</p>
</li>
</ul>
<p>不同的手势，对时机的关注点有所区别。点击通常只关注 <code>onEnded</code>；<code>onChanged</code>（或 <code>updating</code>）在拖拽、缩放、旋转中作用更大；长按只有在满足了设定时长的情况下，才会调用 <code>onEnded</code>。</p>
<h3 id="gesturestate">GestureState</h3>
<p>专门为 SwiftUI 手势开发的属性包装器类型，可作为依赖项驱动视图更新。相较 State 有如下不同：</p>
<ul>
<li>只能在手势的 <code>updating</code> 方法中修改，在视图其它的地方为只读</li>
<li>在手势结束时，与之关联（使用 <code>updating</code> 进行关联）的手势会自动将其内容恢复到它的初始值</li>
<li>通过 <code>resetTransaction</code> 可以设置恢复初始数据时的动画状态</li>
</ul>
<h3 id="组合手势的手段">组合手势的手段</h3>
<p>SwiftUI 提供了几个用于手势的组合方法，可以将多个手势连接起来，重构成其他用途的手势。</p>
<ul>
<li>
<p>simltaneously（同时识别）</p>
<p>将一个手势与另一个手势相结合，创建一个同时识别两个手势的新手势。例如将缩放手势与旋转手势组合，实现同时对图片进行缩放和旋转。</p>
</li>
<li>
<p>sequenced（序列识别）</p>
<p>将两个手势连接起来，只有在第一个手势成功后，才会执行第二个手势。譬如，将长按和拖拽连接起来，实现只有当按压满足一定时间后才允许拖拽。</p>
</li>
<li>
<p>exclusively（排他性识别）</p>
<p>合并两个手势，但只有其中一种手势可以被识别。系统会优先考虑第一个手势。</p>
</li>
</ul>
<p>组合后的手势，<code>Value</code> 类型也将发生变化。仍可使用 <code>map</code> 将其转换成更加易用的数据类型。</p>
<h3 id="手势的定义形式">手势的定义形式</h3>
<p>通常开发者会在视图内部创建自定义手势，如此代码量较少，且容易与视图中其它数据结合。例如，下面的代码在视图中创建了一个可同时支持缩放和旋转的手势：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GestureDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @GestureState</span><span style="color:#F8F8F2">(resetTransaction</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">animation</span><span style="color:#F8F8F2">: .easeInOut)) </span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> gestureValue </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> RotateAndMagnify</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> rotateAndMagnifyGesture </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> MagnificationGesture</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">simultaneously</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">with</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">RotationGesture</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">updating</span><span style="color:#F8F8F2">($gestureValue) { value, state, </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#F8F8F2">                state.angle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value.second </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .zero</span></span>
<span class="line"><span style="color:#F8F8F2">                state.scale </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value.</span><span style="color:#BD93F9">first</span><span style="color:#FF79C6"> ??</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD"> Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">LinearGradient</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">colors</span><span style="color:#F8F8F2">: [.blue, .green, .pink], </span><span style="color:#8BE9FD">startPoint</span><span style="color:#F8F8F2">: .top, </span><span style="color:#8BE9FD">endPoint</span><span style="color:#F8F8F2">: .bottom))</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">shadow</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">radius</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">8</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">rotationEffect</span><span style="color:#F8F8F2">(gestureValue.angle)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(gestureValue.scale)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">gesture</span><span style="color:#F8F8F2">(rotateAndMagnifyGesture)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    struct</span><span style="color:#8BE9FD;font-style:italic"> RotateAndMagnify</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> scale: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1.0</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> angle: Angle </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .zero</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>另外，也可以将手势创建成符合 <code>Gesture</code> 协议的结构体，如此定义的手势，非常适合被反复使用。</p>
<p>通过将手势或手势处理逻辑封装成视图扩展可进一步简化使用难度。</p>
<blockquote>
<p>为了突显某些方面的功能，下文中提供的演示代码或许看起来比较繁琐。实际使用时，可自行简化。</p>
</blockquote>
<h2 id="示例一轻扫">示例一：轻扫</h2>
<h3 id="11-目标">1.1 目标</h3>
<p>创建一个轻扫（Swipe）手势，着重演示如何创建符合 Gesture 协议的结构体，并对手势数据进行转换。</p>
<h3 id="12-思路">1.2 思路</h3>
<p>在 SwiftUI 预置手势中，仅有 DragGesture 提供了可用于判断移动方向的数据。根据偏移量来确定轻扫方向，使用 map 将繁杂的数据转换成简单的方向数据。</p>
<h3 id="13-实现">1.3 实现</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> SwipeGesture</span><span style="color:#F8F8F2">: Gesture {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> enum</span><span style="color:#8BE9FD;font-style:italic"> Direction</span><span style="color:#F8F8F2">: String {</span></span>
<span class="line"><span style="color:#FF79C6">        case</span><span style="color:#F8F8F2"> left, right, up, down</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> typealias</span><span style="color:#8BE9FD;font-style:italic"> Value</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> Direction</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> minimumDistance: CGFloat</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> coordinateSpace: CoordinateSpace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">minimumDistance</span><span style="color:#F8F8F2">: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">coordinateSpace</span><span style="color:#F8F8F2">: CoordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .local) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.minimumDistance </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> minimumDistance</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.coordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> coordinateSpace</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> body: AnyGesture&lt;</span><span style="color:#8BE9FD;font-style:italic">Value</span><span style="color:#F8F8F2">&gt; {</span></span>
<span class="line"><span style="color:#8BE9FD">        AnyGesture</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">            DragGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">minimumDistance</span><span style="color:#F8F8F2">: minimumDistance, </span><span style="color:#8BE9FD">coordinateSpace</span><span style="color:#F8F8F2">: coordinateSpace)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { value </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#F8F8F2"> horizontalAmount </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value.translation.width</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#F8F8F2"> verticalAmount </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value.translation.height</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">                    if</span><span style="color:#8BE9FD"> abs</span><span style="color:#F8F8F2">(horizontalAmount) </span><span style="color:#FF79C6">&gt;</span><span style="color:#8BE9FD"> abs</span><span style="color:#F8F8F2">(verticalAmount) {</span></span>
<span class="line"><span style="color:#FF79C6">                        if</span><span style="color:#F8F8F2"> horizontalAmount </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> .left } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> .right }</span></span>
<span class="line"><span style="color:#F8F8F2">                    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">                        if</span><span style="color:#F8F8F2"> verticalAmount </span><span style="color:#FF79C6">&lt;</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> .</span><span style="color:#BD93F9">up</span><span style="color:#F8F8F2"> } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> .</span><span style="color:#BD93F9">down</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">        )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> onSwipe</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">minimumDistance</span><span style="color:#F8F8F2">: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">                 coordinateSpace</span><span style="color:#F8F8F2">: CoordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .local,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">                 perform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (SwipeGesture.Direction) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        gesture</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">            SwipeGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">minimumDistance</span><span style="color:#F8F8F2">: minimumDistance, </span><span style="color:#8BE9FD">coordinateSpace</span><span style="color:#F8F8F2">: coordinateSpace)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">onEnded</span><span style="color:#F8F8F2">(perform)</span></span>
<span class="line"><span style="color:#F8F8F2">        )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="14-演示">1.4 演示</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> SwipeTestView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> direction </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(direction))</span></span>
<span class="line"><span style="color:#F8F8F2">            .onSwipe { direction </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                self</span><span style="color:#F8F8F2">.direction </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> direction.</span><span style="color:#BD93F9">rawValue</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><img src="https://cdn.fatbobman.com/swipeGestureDemo2.gif" alt="swipeGestureDemo2"/></p>
<h3 id="15-说明">1.5 说明</h3>
<ul>
<li>
<p>为什么使用 AnyGesture</p>
<p>在 <code>Gesture</code> 协议中，需要实现一个隐藏的类型方法：<code>_makeGesture</code>。苹果目前并没有提供应该如何实现它的文档，好在 SwiftUI 提供了一个含有约束的默认实现。当我们不在结构体中使用自定义的 Value 类型时，SwiftUI 可以推断出 <code>Self.Body.Value</code>，此时可以将 body 声明为 <code>some Gesture</code>。但由于本例中使用了自定义 <code>Value</code> 类型，因此必须将 <code>body</code> 声明为 <code>AnyGesture&lt;Value&gt;</code>，方可满足启用 <code>_makeGesture</code> 默认实现的条件。</p>
</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">  extension</span><span style="color:#8BE9FD;font-style:italic"> Gesture</span><span style="color:#FF79C6"> where</span><span style="color:#F8F8F2"> Self.Value == Self.Body.Value {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> _makeGesture</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">gesture</span><span style="color:#F8F8F2">: SwiftUI._GraphValue&lt;</span><span style="color:#BD93F9;font-style:italic">Self</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#50FA7B;font-style:italic">inputs</span><span style="color:#F8F8F2">: SwiftUI._GestureInputs) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> SwiftUI._GestureOutputs&lt;</span><span style="color:#BD93F9;font-style:italic">Self</span><span style="color:#F8F8F2">.Body.</span><span style="color:#8BE9FD;font-style:italic">Value</span><span style="color:#F8F8F2">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span></code></pre></div>
<h3 id="16-不足与改善方法">1.6 不足与改善方法</h3>
<p>本例中并没有对手势的持续时间、移动速度等因素进行综合考量，当前的实现严格意义上并不能算是真正轻扫。如果想实现严格意义上的轻扫可以采用如下的实现方法：</p>
<ul>
<li>改成示例 2 的方式，用 <code>ViewModifier</code> 来包装 <code>DragGesture</code></li>
<li>用 <code>State</code> 记录滑动时间</li>
<li>在 <code>onEnded</code> 中，只有满足速度、距离、偏差等要求的情况下，才回调用户的闭包，并传递方向</li>
</ul>
<h2 id="示例二计时按压">示例二：计时按压</h2>
<h3 id="21-目标">2.1 目标</h3>
<p>实现一个可以记录时长的按压手势。手势在按压过程中，可以根据指定的时间间隔进行类似 <code>onChanged</code> 的回调。本例程着重演示如何通过视图修饰器包装手势的方法以及 <code>GestureState</code> 的使用。</p>
<h3 id="22-思路">2.2 思路</h3>
<p>通过计时器在指定时间间隔后向闭包传递当前按压的持续时间。使用 GestureState 保存点击开始的时间，按压结束后，上次按压的起始时间会被手势自动清除。</p>
<h3 id="23-实现">2.3 实现</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> PressGestureViewModifier</span><span style="color:#F8F8F2">: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    @GestureState</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> startTimestamp: Date</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> timePublisher: Publishers.Autoconnect&lt;Timer.TimerPublisher&gt;</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> onPressing: (TimeInterval) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> onEnded: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">interval</span><span style="color:#F8F8F2">: TimeInterval </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.016</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">onPressing</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (TimeInterval) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">onEnded</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">        _timePublisher </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> State</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">wrappedValue</span><span style="color:#F8F8F2">: Timer.</span><span style="color:#8BE9FD">publish</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">every</span><span style="color:#F8F8F2">: interval, </span><span style="color:#8BE9FD">tolerance</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">nil</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">on</span><span style="color:#F8F8F2">: .current, </span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: .common).</span><span style="color:#8BE9FD">autoconnect</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.onPressing </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onPressing</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.onEnded </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onEnded</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">gesture</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">                DragGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">minimumDistance</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">coordinateSpace</span><span style="color:#F8F8F2">: .local)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">updating</span><span style="color:#F8F8F2">($startTimestamp, </span><span style="color:#8BE9FD">body</span><span style="color:#F8F8F2">: { </span><span style="color:#BD93F9">_</span><span style="color:#F8F8F2">, current, </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#FF79C6">                        if</span><span style="color:#F8F8F2"> current </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">                            current </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Date</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                    })</span></span>
<span class="line"><span style="color:#F8F8F2">                    .onEnded { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#8BE9FD">                        onEnded</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">onReceive</span><span style="color:#F8F8F2">(timePublisher, </span><span style="color:#8BE9FD">perform</span><span style="color:#F8F8F2">: { timer </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> startTimestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> startTimestamp {</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#F8F8F2"> duration </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timer.</span><span style="color:#8BE9FD">timeIntervalSince</span><span style="color:#F8F8F2">(startTimestamp)</span></span>
<span class="line"><span style="color:#8BE9FD">                    onPressing</span><span style="color:#F8F8F2">(duration)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            })</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> onPress</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">interval</span><span style="color:#F8F8F2">: TimeInterval </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0.016</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">onPressing</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (TimeInterval) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">onEnded</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">PressGestureViewModifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">interval</span><span style="color:#F8F8F2">: interval, </span><span style="color:#8BE9FD">onPressing</span><span style="color:#F8F8F2">: onPressing, </span><span style="color:#8BE9FD">onEnded</span><span style="color:#F8F8F2">: onEnded))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="24-演示">2.4 演示</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> PressGestureView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> scale: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> duration: TimeInterval </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            Circle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(scale </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> 1</span><span style="color:#FF79C6"> ?</span><span style="color:#F8F8F2"> .blue </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> .orange)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(scale)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(duration, </span><span style="color:#8BE9FD">format</span><span style="color:#F8F8F2">: .number.</span><span style="color:#8BE9FD">precision</span><span style="color:#F8F8F2">(.</span><span style="color:#8BE9FD">fractionLength</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">))))</span></span>
<span class="line"><span style="color:#F8F8F2">                .onPress { duration </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                    self</span><span style="color:#F8F8F2">.duration </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> duration</span></span>
<span class="line"><span style="color:#F8F8F2">                    scale </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1</span><span style="color:#FF79C6"> +</span><span style="color:#F8F8F2"> duration </span><span style="color:#FF79C6">*</span><span style="color:#BD93F9"> 2</span></span>
<span class="line"><span style="color:#F8F8F2">                } onEnded</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">                    if</span><span style="color:#F8F8F2"> duration </span><span style="color:#FF79C6">&gt;</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">                        withAnimation</span><span style="color:#F8F8F2">(.</span><span style="color:#8BE9FD">easeInOut</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">duration</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">)) {</span></span>
<span class="line"><span style="color:#F8F8F2">                            scale </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">                        withAnimation</span><span style="color:#F8F8F2">(.easeInOut) {</span></span>
<span class="line"><span style="color:#F8F8F2">                            scale </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 1</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                    duration </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 0</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><img src="https://cdn.fatbobman.com/pressGestureDemo.2022-01-08%2013_50_59.gif" alt="pressGestureDemo.2022-01-08 13_50_59"/></p>
<h3 id="25-说明">2.5 说明</h3>
<ul>
<li><code>GestureState</code> 数据的复原时间在 <code>onEnded</code> 之前，在 <code>onEnded</code> 中，<code>startTimestamp</code> 已经恢复为 <code>nil</code></li>
<li><code>DragGesture</code> 仍是最好的实现载体。<code>TapGesture</code>、<code>LongPressGesture</code> 均在满足触发条件后会自动终止手势，无法实现对任意时长的支持</li>
</ul>
<h3 id="26-不足及改善方法">2.6 不足及改善方法</h3>
<p>当前的解决方案没有提供类似 <code>LongPressGesture</code> 按压中位置偏移限定设置，另外尚未在 <code>onEnded</code> 中提供本次按压的总持续时长。</p>
<ul>
<li>在 <code>updating</code> 中对偏移量进行判断，如果按压点的偏移超出了指定的范围，则中断计时。并在 <code>updating</code> 中，调用用户提供的 <code>onEnded</code> 闭包，并进行标记</li>
<li>在手势的 <code>onEnded</code> 中，如果用户提供的 <code>onEnded</code> 闭包已经被调用，则不会再此调用</li>
<li>使用 <code>State</code> 替换 <code>GestureState</code>，这样就可以在手势的 <code>onEnded</code> 中提供总持续时间。需自行编写 <code>State</code> 的数据恢复代码</li>
<li>由于使用了 <code>State</code> 替换 <code>GestureState</code>，逻辑判断就可以从 <code>updating</code> 移动到 <code>onChanged</code> 中</li>
</ul>
<h2 id="示例三附带位置信息的点击">示例三：附带位置信息的点击</h2>
<blockquote>
<p>SwiftUI 4.0 提供了新的 Gesture —— <code>SpatialTapGesture</code> , 使用它可以直接获得点击位置。<code>onTapGesture</code> 也获得提升，<code>onChange</code> 和 <code>onEnd</code> 中 <code>value</code> 将表示在特定坐标空间中的点击位置（ <code>CGPoint</code> ）</p>
</blockquote>
<h3 id="31-目标">3.1 目标</h3>
<p>实现提供触摸位置信息的点击手势（支持点击次数设定）。本例主要演示 <code>simultaneously</code> 的用法以及如何选择合适的回调时间点（<code>onEnded</code>）。</p>
<h3 id="32-思路">3.2 思路</h3>
<p>手势的响应感觉应与 <code>TapGesture</code> 完全一致。使用 <code>simultaneously</code> 将两种手势联合起来，从 <code>DragGesture</code> 中获取位置数据，从 <code>TapGesture</code> 中退出。</p>
<h3 id="33-实现">3.3 实现</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> TapWithLocation</span><span style="color:#F8F8F2">: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> locations: CGPoint</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> count: </span><span style="color:#8BE9FD;font-style:italic">Int</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> coordinateSpace: CoordinateSpace</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> perform: (CGPoint) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">coordinateSpace</span><span style="color:#F8F8F2">: CoordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .local, </span><span style="color:#50FA7B;font-style:italic">perform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (CGPoint) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> count</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.coordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> coordinateSpace</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.perform </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> perform</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">gesture</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">                DragGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">minimumDistance</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">coordinateSpace</span><span style="color:#F8F8F2">: coordinateSpace)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .onChanged { value </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                        locations </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value.location</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">simultaneously</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">with</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#8BE9FD">                        TapGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">count</span><span style="color:#F8F8F2">: count)</span></span>
<span class="line"><span style="color:#F8F8F2">                            .onEnded {</span></span>
<span class="line"><span style="color:#8BE9FD">                                perform</span><span style="color:#F8F8F2">(locations </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .zero)</span></span>
<span class="line"><span style="color:#F8F8F2">                                locations </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> nil</span></span>
<span class="line"><span style="color:#F8F8F2">                            }</span></span>
<span class="line"><span style="color:#F8F8F2">                    )</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> onTapGesture</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">coordinateSpace</span><span style="color:#F8F8F2">: CoordinateSpace </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .local, </span><span style="color:#50FA7B;font-style:italic">perform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (CGPoint) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">TapWithLocation</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">count</span><span style="color:#F8F8F2">: count, </span><span style="color:#8BE9FD">coordinateSpace</span><span style="color:#F8F8F2">: coordinateSpace, </span><span style="color:#8BE9FD">perform</span><span style="color:#F8F8F2">: perform))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<h3 id="34-演示">3.4 演示</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TapWithLocationView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> unitPoint: UnitPoint </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .center</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">RadialGradient</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">colors</span><span style="color:#F8F8F2">: [.yellow, .orange, .red, .pink], </span><span style="color:#8BE9FD">center</span><span style="color:#F8F8F2">: unitPoint, </span><span style="color:#8BE9FD">startRadius</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">10</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">endRadius</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">170</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">300</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">300</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">onTapGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">count</span><span style="color:#F8F8F2">:</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">) { point </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">                withAnimation</span><span style="color:#F8F8F2">(.easeInOut) {</span></span>
<span class="line"><span style="color:#F8F8F2">                    unitPoint </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UnitPoint</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: point.x </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 300</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: point.y </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 300</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><img src="https://cdn.fatbobman.com/TapWithLocationDemo.gif" alt="TapWithLocationDemo"/></p>
<h3 id="35-说明">3.5 说明</h3>
<ul>
<li>当 <code>DragGesture</code> 的 <code>minimumDistance</code> 设置为 <code>0</code> 时，其第一条数据的产生时间一定早于 <code>TapGesture (count:1)</code> 的激活时间</li>
<li>在 <code>simultaneously</code> 中，一共有三个 <code>onEndend</code> 时机。手势 1 的 <code>onEnded</code>，手势 2 的 <code>onEnded</code>，以及合并后手势的 <code>onEnded</code>。在本例中，我们选择在 <code>TapGesture</code> 的 <code>onEnded</code> 中回调用户的闭包</li>
</ul>
<h2 id="在-swiftui-中整合-uikit-手势">在 SwiftUI 中整合 UIKit 手势</h2>
<p>正如前文所述，SwiftUI 的原生手势系统虽然简洁易用，但种类相对有限。在某些复杂场景中，我们可能需要借助 UIKit 扩展手势功能，以实现那些 SwiftUI 本身难以应对的特定需求。</p>
<h3 id="实现双指触控">实现双指触控</h3>
<p>iPhone 和 iPad 支持复杂的多点触控手势，这在增强用户体验方面具有巨大潜力。然而，在 SwiftUI 中，这些能力尚未得到充分利用。为了使特定视图响应双指触控，我们可以按照以下步骤操作：</p>
<ul>
<li>创建一个能够识别双指点击的 <code>UIView</code>。</li>
<li>利用 <code>UIViewRepresentable</code> 协议，将其封装为一个 SwiftUI 视图。</li>
<li>定义一个视图扩展，将封装后的视图叠加到需要双指触控响应的视图上。</li>
</ul>
<p>以下是实现此功能的示例代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TowFingerTapDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">      .</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.orange)</span></span>
<span class="line"><span style="color:#F8F8F2">      .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      .onTwoFingerTap {</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">two touches</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">      .onTapGesture {</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">One Touch</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> onTwoFingerTap</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">perform</span><span style="color:#FFB86C;font-style:italic"> action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    overlay</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">      TwoFingerTapLayer</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">action</span><span style="color:#F8F8F2">: action)</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TwoFingerTapLayer</span><span style="color:#F8F8F2">: UIViewRepresentable {</span></span>
<span class="line"><span style="color:#FF79C6">  let</span><span style="color:#F8F8F2"> action: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">  init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    self</span><span style="color:#F8F8F2">.action </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> action</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> makeUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">context</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: Context) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> UIView {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> view </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> TwoFingerTapUIView</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">action</span><span style="color:#F8F8F2">: action)</span></span>
<span class="line"><span style="color:#F8F8F2">    view.backgroundColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .clear</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> view</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> updateUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">_</span><span style="color:#F8F8F2">: UIViewType, </span><span style="color:#50FA7B">context</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: Context) {}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> TwoFingerTapUIView</span><span style="color:#F8F8F2">: UIView {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> gesture: UITapGestureRecognizer</span><span style="color:#FF79C6">!</span></span>
<span class="line"><span style="color:#FF79C6">  let</span><span style="color:#F8F8F2"> action: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">  init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    self</span><span style="color:#F8F8F2">.action </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> action</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">    super</span><span style="color:#F8F8F2">.</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">: .zero)</span></span>
<span class="line"><span style="color:#8BE9FD">    setupGesture</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  @available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">unavailable</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">  required</span><span style="color:#FF79C6"> init?</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">coder</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: NSCoder) {</span></span>
<span class="line"><span style="color:#8BE9FD">    fatalError</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">init(coder:) has not been implemented</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  private</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> setupGesture</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">    gesture </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UITapGestureRecognizer</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">target</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">action</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">#selector</span><span style="color:#F8F8F2">(handleGesture))</span></span>
<span class="line"><span style="color:#F8F8F2">    gesture</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.numberOfTouchesRequired </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 2</span></span>
<span class="line"><span style="color:#8BE9FD">    addGestureRecognizer</span><span style="color:#F8F8F2">(gesture)</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  @objc</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> handleGesture</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">gesture</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: UILongPressGestureRecognizer) {</span></span>
<span class="line"><span style="color:#8BE9FD">    action</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>现在，屏幕中的橙色矩形已能响应单指或双指点击操作。但需注意，如 <code>onTapGesture</code> 等原生手势应置于我们封装的 UIKit 手势之后，以确保它们正确地接收和处理用户输入。</p>
<h3 id="解决特定组件手势冲突问题">解决特定组件手势冲突问题</h3>
<p>在 SwiftUI 中，开发者常面临一个棘手的问题：手势冲突。尤其是当我们尝试为某些底层对应 UIKit 组件且已具备内置手势的 SwiftUI 组件添加自定义手势时。这种情况下，新添加的手势很可能会与组件原有的手势发生冲突，导致无法共存。举例来说，如下代码尝试为 <code>List</code> 组件添加一个 <code>LongPressGesture</code>，结果导致列表无法正常响应滚动操作：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ListTapDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    List</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#FF79C6"> ..&lt;</span><span style="color:#BD93F9"> 30</span><span style="color:#F8F8F2">) { i </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">      Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">){</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(i)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">gesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">LongPressGesture</span><span style="color:#F8F8F2">().onEnded { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#8BE9FD">      print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">List Long Press</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>如果你面临这样的需求，在 iOS 18 发布之前，可以使用 <a href="https://github.com/siteline/swiftui-introspect?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">SwiftUI Introspect</a> 库来应对。该库为开发者提供了访问 SwiftUI 视图底层 UIKit 组件的功能。通过这种方式，我们可以将手势直接添加至底层组件，实现例如使 <code>List</code> 同时支持滚动和长按手势的复合功能。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">import</span><span style="color:#8BE9FD;font-style:italic"> Foundation</span></span>
<span class="line"><span style="color:#FF79C6">import</span><span style="color:#8BE9FD;font-style:italic"> SwiftUI</span></span>
<span class="line"><span style="color:#FF79C6">import</span><span style="color:#8BE9FD;font-style:italic"> SwiftUIIntrospect</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ListTapDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> coordinator:Coordinator</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    List</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#FF79C6"> ..&lt;</span><span style="color:#BD93F9"> 30</span><span style="color:#F8F8F2">) { i </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">      Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">){</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(i)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">introspect</span><span style="color:#F8F8F2">(.list, </span><span style="color:#8BE9FD">on</span><span style="color:#F8F8F2">: .</span><span style="color:#8BE9FD">iOS</span><span style="color:#F8F8F2">(.v17)) { list </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">      DispatchQueue.main.async {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.coordinator </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Coordinator</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">list</span><span style="color:#F8F8F2">: list){</span></span>
<span class="line"><span style="color:#8BE9FD">          print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Long Press</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  class</span><span style="color:#8BE9FD"> Coordinator</span><span style="color:#F8F8F2">: NSObject {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> list: UICollectionView</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> action: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">list</span><span style="color:#F8F8F2">: UICollectionView,</span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">:</span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">      self</span><span style="color:#F8F8F2">.list </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> list</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">      self</span><span style="color:#F8F8F2">.action </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> action</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">      super</span><span style="color:#F8F8F2">.</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">      let</span><span style="color:#F8F8F2"> longPressGesture </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UILongPressGestureRecognizer</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">target</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">action</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">#selector</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">handleLongPress</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">gesture:</span><span style="color:#F8F8F2">)))</span></span>
<span class="line"><span style="color:#F8F8F2">      list.</span><span style="color:#8BE9FD">addGestureRecognizer</span><span style="color:#F8F8F2">(longPressGesture)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    @objc</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> handleLongPress</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">gesture</span><span style="color:#F8F8F2">: UILongPressGestureRecognizer) {</span></span>
<span class="line"><span style="color:#FF79C6">      if</span><span style="color:#F8F8F2"> gesture.state </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> .ended {</span></span>
<span class="line"><span style="color:#8BE9FD">       action</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<video src="https://cdn.fatbobman.com/swiftui-gesture-add-longpress-in-list.mp4" autoplay="true" loop="true" muted="true" playsInline="true" loading="lazy" controls="true"></video>
<h2 id="ios-18-uigesturerecognizer">iOS 18: UIGestureRecognizer</h2>
<p>在 2024 年的 WWDC 中，SwiftUI 接受了诸多更新，其中手势功能的增强颇为亮眼。苹果优化了 SwiftUI 的手势底层实现，使得原生手势能更好地与特定组件（如 List、Form、Map 等）协作。</p>
<p>如今，我们可以在 <code>List</code>、<code>Map</code> 等组件中直接使用过去可能引发冲突的手势，例如 <code>LongPressGesture</code>：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ListTapDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    List</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#FF79C6"> ..&lt;</span><span style="color:#BD93F9"> 30</span><span style="color:#F8F8F2">) { i </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">      Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(i)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">simultaneousGesture</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">LongPressGesture</span><span style="color:#F8F8F2">().onEnded { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#8BE9FD">      print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Long Press</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    })</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>此外，在 2024 年的 WWDC 上，苹果为 SwiftUI 引入了 <code>UIGestureRecognizerRepresentable</code>，其功能类似于 <code>UIViewRepresentable</code>。这一新特性允许将 UIKit 的手势转换为 SwiftUI 的手势，并直接应用于 SwiftUI 的原生视图。</p>
<p>现在，实现双指点击（Two Finger Tap）功能变得更加简单和直观：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TowFingerTapDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">      .</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.orange)</span></span>
<span class="line"><span style="color:#F8F8F2">      .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">200</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      .onTapGesture {</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">One Touch</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      }</span></span>
<span class="line"><span style="color:#F8F8F2">      .</span><span style="color:#8BE9FD">gesture</span><span style="color:#F8F8F2">(TowFingerTapGesture{</span></span>
<span class="line"><span style="color:#8BE9FD">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Tow Touches</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">      })</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TowFingerTapGesture</span><span style="color:#F8F8F2">: UIGestureRecognizerRepresentable {</span></span>
<span class="line"><span style="color:#FF79C6">  let</span><span style="color:#F8F8F2"> action: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> makeUIGestureRecognizer</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> UIGestureRecognizer {</span></span>
<span class="line"><span style="color:#6272A4">    // 创建手势识别器</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> gesture </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UITapGestureRecognizer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    gesture.numberOfTouchesRequired </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> 2</span></span>
<span class="line"><span style="color:#F8F8F2">    gesture.delegate </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> context.coordinator</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> gesture</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> makeCoordinator</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">converter</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: CoordinateSpaceConverter) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Coordinator {</span></span>
<span class="line"><span style="color:#8BE9FD">    Coordinator</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span>
<span class="line"><span style="color:#6272A4">  // 处理手势信息</span></span>
<span class="line"><span style="color:#FF79C6">  func</span><span style="color:#50FA7B"> handleUIGestureRecognizerAction</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B">    _</span><span style="color:#FFB86C;font-style:italic"> recognizer</span><span style="color:#F8F8F2">: UIGestureRecognizerType, </span><span style="color:#50FA7B">context</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: Context</span></span>
<span class="line"><span style="color:#F8F8F2">  ) {</span></span>
<span class="line"><span style="color:#FF79C6">    switch</span><span style="color:#F8F8F2"> recognizer.state {</span></span>
<span class="line"><span style="color:#FF79C6">    case</span><span style="color:#F8F8F2"> .ended</span><span style="color:#FF79C6">:</span></span>
<span class="line"><span style="color:#8BE9FD">      action</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">    default:</span></span>
<span class="line"><span style="color:#FF79C6">      break</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">  final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Coordinator</span><span style="color:#F8F8F2">: NSObject, UIGestureRecognizerDelegate {</span></span>
<span class="line"><span style="color:#6272A4">    // 让手势并行</span></span>
<span class="line"><span style="color:#FF79C6">    @objc</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> gestureRecognizer</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">      _</span><span style="color:#F8F8F2">: UIGestureRecognizer,</span></span>
<span class="line"><span style="color:#50FA7B">      shouldRecognizeSimultaneouslyWith</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: UIGestureRecognizer</span></span>
<span class="line"><span style="color:#F8F8F2">    ) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9">      true</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>由于通过 <code>UIGestureRecognizerRepresentable</code> 封装后的手势与 SwiftUI 的原生手势表现一致，因此不必特别调整其他手势与封装手势的使用顺序。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="总结">总结</h2>
<p>在 iOS 18 更新之前，SwiftUI 的手势系统虽然易于使用，但在功能上相对受限，复杂的手势逻辑通常需要借助一些技巧性的方法，结合 UIKit 手势来实现。自 iOS 18 起，苹果对原生手势的底层实现进行了优化，并引入了更为便捷的 UIKit 手势集成方式，极大地扩展了手势的可能性，使得手势能力不足不再是阻碍 SwiftUI 开发者的问题。</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2022-01-10T00:12:00.000Z",
  "datePublished": "2022-01-10T00:12:00.000Z",
  "description": "探索SwiftUI手势定制，详解预置手势、GestureState及组合手势，并展示轻扫、计时按压等自定义手势实现。iOS 18引入UIGestureRecognizerRepresentable，解决手势冲突。",
  "headline": "在 SwiftUI 下定制手势",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/swiftuigesture-zh.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/swiftuigesture/"
  },
  "url": "https://fatbobman.com/zh/posts/swiftuigesture/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <img src="/images/aifadian.svg" alt="" width="18" height="18" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  const adCacheKey = 'dynamicAdCache';

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/custom-button-style-in-swiftui/" id="relatedPosts-自定义 Button 的外观和交互行为"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">自定义 Button 的外观和交互行为</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/swipecell/" id="relatedPosts-用 SwiftUI 实现 iOS mail 程序的侧滑菜单"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">用 SwiftUI 实现 iOS mail 程序的侧滑菜单</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-056" id="relatedPosts-Weekly #56 - Pixelmator 并购背后的思考"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #56 - Pixelmator 并购背后的思考</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/how_to_judge_scrollview_is_scrolling/" id="relatedPosts-如何判断 ScrollView、List 是否正在滚动中"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">如何判断 ScrollView、List 是否正在滚动中</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/sheetkit/" id="relatedPosts-SheetKit —— SwiftUI 模态视图扩展库"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SheetKit —— SwiftUI 模态视图扩展库</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/navigationviewkit/" id="relatedPosts-用 NavigationViewKit 增强 SwiftUI 的导航视图"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">用 NavigationViewKit 增强 SwiftUI 的导航视图</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/textfield-1/" id="relatedPosts-SwiftUI TextField 进阶 —— 格式与校验"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI TextField 进阶 —— 格式与校验</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/textfield-event-focus-keyboard/" id="relatedPosts-SwiftUI TextField 进阶 —— 事件、焦点、键盘"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI TextField 进阶 —— 事件、焦点、键盘</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="在 SwiftUI 下定制手势" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#基础" class=""> 基础 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#预置手势" class=""> 预置手势 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#value" class=""> Value </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#时机" class=""> 时机 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#gesturestate" class=""> GestureState </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#组合手势的手段" class=""> 组合手势的手段 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#手势的定义形式" class=""> 手势的定义形式 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#示例一轻扫" class=""> 示例一：轻扫 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#11-目标" class=""> 1.1 目标 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#12-思路" class=""> 1.2 思路 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#13-实现" class=""> 1.3 实现 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#14-演示" class=""> 1.4 演示 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#15-说明" class=""> 1.5 说明 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#16-不足与改善方法" class=""> 1.6 不足与改善方法 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#示例二计时按压" class=""> 示例二：计时按压 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#21-目标" class=""> 2.1 目标 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#22-思路" class=""> 2.2 思路 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#23-实现" class=""> 2.3 实现 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#24-演示" class=""> 2.4 演示 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#25-说明" class=""> 2.5 说明 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#26-不足及改善方法" class=""> 2.6 不足及改善方法 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#示例三附带位置信息的点击" class=""> 示例三：附带位置信息的点击 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#31-目标" class=""> 3.1 目标 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#32-思路" class=""> 3.2 思路 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#33-实现" class=""> 3.3 实现 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#34-演示" class=""> 3.4 演示 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#35-说明" class=""> 3.5 说明 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#在-swiftui-中整合-uikit-手势" class=""> 在 SwiftUI 中整合 UIKit 手势 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#实现双指触控" class=""> 实现双指触控 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#解决特定组件手势冲突问题" class=""> 解决特定组件手势冲突问题 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#ios-18-uigesturerecognizer" class=""> iOS 18: UIGestureRecognizer </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#总结" class=""> 总结 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/xcodeplayground2/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>玩转 Xcode Playground（下）</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/xcodeplayground2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/countincoredata/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>在 Core Data 中查询和使用 count 的若干方法</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/countincoredata/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=%E5%9C%A8%20SwiftUI%20%E4%B8%8B%E5%AE%9A%E5%88%B6%E6%89%8B%E5%8A%BF&#38;url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fswiftuigesture%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=%E5%9C%A8%20SwiftUI%20%E4%B8%8B%E5%AE%9A%E5%88%B6%E6%89%8B%E5%8A%BF%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fswiftuigesture%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fswiftuigesture%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fswiftuigesture%2F&#38;title=%E5%9C%A8%20SwiftUI%20%E4%B8%8B%E5%AE%9A%E5%88%B6%E6%89%8B%E5%8A%BF%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fswiftuigesture%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90%E5%9C%A8%20SwiftUI%20%E4%B8%8B%E5%AE%9A%E5%88%B6%E6%89%8B%E5%8A%BF%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0A%E5%9C%A8%20SwiftUI%20%E4%B8%8B%E5%AE%9A%E5%88%B6%E6%89%8B%E5%8A%BF%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fswiftuigesture%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>Ask Apple 2022 中与 Core Data 有关的问答 (上) | 肘子的 Swift 记事本</title>
<meta name="description" content="Ask Apple 为开发者与苹果工程师创造了在 WWDC 之外进行直接交流的机会。本文对本次活动中与 Core Data 有关的一些问答进行了整理，并添加了一点个人见解。本文为上篇。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/core-data-of-ask-apple-2022/">
<meta property="og:title" content="Ask Apple 2022 中与 Core Data 有关的问答 (上) | 肘子的 Swift 记事本">
<meta property="og:description" content="Ask Apple 为开发者与苹果工程师创造了在 WWDC 之外进行直接交流的机会。本文对本次活动中与 Core Data 有关的一些问答进行了整理，并添加了一点个人见解。本文为上篇。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/core-data-of-ask-apple-2022/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/oc/Core-Data-of-Ask-Apple-2022.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/core-data-of-ask-apple-2022/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/core-data-of-ask-apple-2022/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.C3fvyPtB.css">
<link rel="stylesheet" href="/_astro/about.DZfzqhGN.css">
<link rel="stylesheet" href="/_astro/_slug_.BRLGXoDU.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-6 sm:pt-6 font-black w-[240px] sm:w-[300px] pb-2 sm:pb-0"> <svg fill="currentColor" class="text-heading" width="500"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/core-data-of-ask-apple-2022/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div> <script type="module" src="/_astro/LanguageButton.astro_astro_type_script_index_0_lang.CZzUjIT2.js"></script> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  // 获取按钮
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');
  // 获取图标
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  // 监听暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    setTheme();
  });

  // 保证其他的页面也能够监听到 localStorage 的变化
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      setTheme();
    }
  });

  // Use setTheme here
  // Change the icons inside the button based on previous settings
  // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else if (theme === 'light') {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.remove('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  setThemeButton();

  // 监听暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    setThemeButton();
  });

  // 保证其他的页面也能够监听到 localStorage 的变化
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      setThemeButton();
    }
  });

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  // Listen for clicks on the button themeToggleDarkIcon
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleLightIcon
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleSystemIcon
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
  });

  resetTheme();
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav> <!-- <script>
  import { Collapse } from 'flowbite';
  import type { CollapseOptions, InstanceOptions } from 'flowbite';
  const triggerEl = document.getElementById('navbar-toggle-button');
  const targetEl = document.getElementById('navbar-solid-bg');
  const options: CollapseOptions = {};

  // instance options object
  const instanceOptions: InstanceOptions = {
    id: 'navbar-solid-bg',
    override: true,
  };

  const collapse = new Collapse(targetEl, triggerEl, options, instanceOptions);
</script> --> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/Core Data/">
#Core Data </a><a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/Apple Event/">
#Apple Event </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/core-data-of-ask-apple-2022/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">Ask Apple 2022 中与 Core Data 有关的问答 (上)</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2022-10-20T04:12:00.000Z">2022 年 10 月 20 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>Ask Apple 为开发者与苹果工程师创造了在 WWDC 之外进行直接交流的机会。本文对本次活动中与 Core Data 有关的一些问答进行了整理，并添加了一点个人见解。本文为上篇。</p>
<h2 id="qa">Q&amp;A</h2>
<h3 id="是否可以在-core-data-中存储照片">是否可以在 Core Data 中存储照片</h3>
<p>Q：你好，我看到一些网站建议 Core Data 不应该用于保存照片，也许他们没注意到可以使用 “使用外部存储选项（ use external storage ）“？我正在开发一个应用程序，用户可能一周左右拍一次照片。保存到 Core Data 中或保存到目录哪种更合适？我不想保存到照片库中，因为用户可能不想让别人轻易看到这些照片。</p>
<p>A：在 Core Data 中使用外部存储是可以的。你也可以在 Core Data 中存储一个 URL ，然后自己管理的文件。如果你打算将 URL 传递给其他框架，比如媒体播放器，那么你就应该采用后一种方式。</p>
<blockquote>
<p>在 Core Data 中开启 Allows External Storage 后，<a href="https://www.sqlite.org/intern-v-extern-blob.html?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">二进制的读取效率是有保障的</a>。Core Data 会将大于一定尺寸（ 100 KB ）的文件保存在文件系统中，并且仅在 BLOB 字段中保存该文件的文件名。文件被保存在与 SQLite 数据库同级创建的一个隐藏目录（ _EXTERNAL_DATA ）下。很遗憾， Core Data 并没有提供直接返回这些文件 URL 的 API（ 或将 BLOB 转换成以某种 URL 访问的方式 ），因此，当需要将数据以 URL 的方式进行传递时，就需要先将数据写到临时目录后才能进行。因此，是否保存在 Core Data 中，取决于你的具体使用场景。对于需要同步的应用来说，如果采用在 Core Data 中保存 URL 并将数据保存到目录的方式，需要自己实现外置数据的同步。</p>
</blockquote>
<h3 id="切换-icloud-后是否会清空本地数据">切换 iCloud 后是否会清空本地数据</h3>
<p>Q：在使用 Core Data with CloudKit 的情况下，当用户注销设备上的 iCloud 账户时，NSPersistentCloudKitContainer 将收到删除本地数据的指示。这是有意为之的吗？</p>
<p>A：是的。 NSPersistentCloudKitContainer 在 iCloud 帐户和存储中的数据之间强制执行严格绑定。</p>
<blockquote>
<p>在 <a href="/zh/posts/real-time-switching-of-cloud-syncs-status/" target="_blank">实时切换 Core Data 的云同步状态</a> 一文，我介绍过一种实验方法，在某些情况下可以尝试保留这些数据。但最好还是让应用保持 Core Data 原有的设计模式。考虑到两者间的强绑定策略，同时为了进一步节省用户的备份空间，可以考虑将 Core Data 数据的 SQLite 文件的 isExcludedFromBackup（ 取消文件级的云同步 ） 属性设置为 false ，避免多次备份。</p>
</blockquote>
<h3 id="如何禁用启用网络同步">如何禁用/启用网络同步</h3>
<p>Q：对于想要禁用/启用 CloudKit 存储的用户，是否有推荐的方法让应用程序可以实现此操作。</p>
<p>A：不可以。用户可以从应用程序的设置/系统设置中修改应用的 iCloud 同步选项。你可以创建一个没有 NSPersistentCloudKitContainerOptions 描述的 NSPersistentCloudKitContainer，如此一来它将不会进行同步。但是由于 NSPersistentCloudKitContainer 强制将 iCloud 中的数据绑定到持久存储文件。没有办法告诉 NSPersistentCloudKitContainer 在帐户消失后保留本地数据（当用户在禁用该 App 的 iCloud 同步时会发生这种情况 ）。</p>
<blockquote>
<p>在使用单 Container 的情况下，开发者可以通过 UserDefaults 的方式，控制应用程序在下次冷启动时，是否启用网络同步功能（ 通过设置 cloudKitContainerOptions 与否 ）。如想实现可实时切换的同步状态，可参阅 <a href="/zh/posts/real-time-switching-of-cloud-syncs-status/" target="_blank">实时切换 Core Data 的云同步状态</a> 一文。</p>
</blockquote>
<h3 id="如何处理-container-创建失败">如何处理 Container 创建失败</h3>
<p>Q：优雅地处理 container. loadPersistentStores 闭包中的错误的方法是什么？ Apple 模板（ Xcode 提供的 Core Data 模版 ）中有一个 fatalError，并提示它不应该在生产中使用，但如果我的 Core Data Stack 没有正确实例化，我的用户无法对我的应用程序做任何事情。</p>
<p>A：通常这些错误是由于未测试的架构迁移、错误的文件保护等级、磁盘空间不足等原因导致。在这些情况下，应进入恢复步骤以使应用程序再次处于可用状态。另一种方法是向用户显示 UI 存在问题并且需要进行重置。我们的应用程序模板无法为您的应用程序制作良好的 UI，而这几乎就是在此闭包中需要做的事情。</p>
<blockquote>
<p>在 SwiftUI 中，我们通常会使用 environment 为视图树注入视图上下文，一旦 loadPersistentStores 出现错误导致 container 无法正常创建，那么调用上下文的注入将会失败，导致无法进入 UI 界面。如需要处理这种情况，就需要在主视图（ 或使用 Core Data 功能的根视图 ）对 Container 的状态进行判断（ 通常是在 loadPersistentStores 闭包中修改状态 ），转入失败提示逻辑。</p>
</blockquote>
<h3 id="共享数据出现错误">共享数据出现错误</h3>
<p>Q：我的问题是关于 Core Data with CloudKit 的。我已经成功使用 NSPersistentCloudKitContainer 实现了用户跨设备同步数据，但在共享数据方面的运气要差得多。我已经查看了两个相关的示例项目，现在可以进行到创建新共享的地步，但是任何管理现有共享的尝试（ 即添加人员等 ）似乎总是失败。我在控制台中看到了一些神秘的消息，例如“创建与 PPT 通信所需的 CFMessagePort 时出错”。如果我说尝试进行数据共享，如果 CKShare 不存在，它可以工作 - 万岁！但是，如果我第二次共享并且 CKShare 已经存在，它只会出现永远旋转的风火轮。这既出现于 UICloudSharingController，也出现于较新的 ShareLink/CKShareTransferRepresentation 版本。在示例代码中也看到了类似的问题。我的问题是 - 此种使用方式是否存在已知问题？有什么特别要记住的吗？</p>
<p>A：请使用 sysdiagnose 提交反馈报告以及受影响设备的存储文件。</p>
<p><em>不止你一个人。我们在 CKShare 和 NSPersistentCloudKitContainer 上也遇到了很多麻烦。例如，从符合 Transferable 的结构中共享 URL 实例根本不起作用。 ShareLink 只是显示一个空的弹出窗口（ 另一个开发者的吐槽 ）</em>。</p>
<blockquote>
<p>十分遗憾，苹果在为 Core Data with Cloud 添加了数据共享功能后，并没有进一步改善它的表现。目前共享数据的使用体验并不能令人满意。想了解如何共享数据以及了解当前它的限制请阅读 <a href="/zh/posts/coredatawithcloudkit-6/" target="_blank">创建与多个 iCloud 用户共享数据的应用</a> 一文。</p>
</blockquote>
<h3 id="保存音视频数据的建议方式">保存音视频数据的建议方式</h3>
<p>Q：在使用 Core Data with CloudKit 时，对于处理音频文件或图像文件存储，是否有任何推荐的方法。我知道对于较大的数据，最好将其存储在 CoreData 本身之外。</p>
<p>A：这取决于它们的大小。假如尺寸超过 100 MB，尽量考虑自己管理文件数据。开发者可以考虑将非常大的文件创建为 CKAsset ，在他们的 NSPersistentCloudKitContainer 同步对象中保存一个外键，以便他们可以查找。这种方法可以减少同步的下载数据量（ 节省设备存储容量 ）并允许按需下载。</p>
<blockquote>
<p>这是 Core Data with CloudKit 与纯 CloudKit API 相结合的一种方式。以图像举例，开发者可以考虑只在 Core Data 中保存一个小尺寸的缩率图，将大尺寸图片通过 CloudKit API 以 CKAsset 的方式保存在云端（ 在对应的 Core Data 数据中保存一个外链 ），用户在点击图片时，才会从云端将数据下载到本地，并保存在一个缓存目录中。</p>
</blockquote>
<h3 id="是否有最大同步尺寸或数量限制">是否有最大同步尺寸或数量限制</h3>
<p>Q：Core Data with CloudKit 是否最大同步尺寸限制？我在一个应用程序中尝试它，该应用程序有 30,000 多条记录，但它们无法从 Mac （ 开发状态 ）同步到 iPhone（ 开发状态 ）。</p>
<p>A：如果没有更多细节，很难确定。 NSPersistentCloudKitContainer 和 CloudKit 可以支持比某些限制（如设备存储）多两个数量级的数据。</p>
<blockquote>
<p>理论上，可以同步的数量和尺寸只上取决于用户的 iCloud 可用容量。在某些情况下，开发者需要在 macOS 上手动开启应用的 iCloud 同步选项（ 尤其是在开发阶段 ），否则无法与其他的设备进行同步。</p>
</blockquote>
<h3 id="如何重置本地数据">如何重置本地数据</h3>
<p>Q：想象一下，Core Data 正使用 NSPersistentCloudKitContainer 在所有设备上同步我的应用程序数据。假若其中一台设备出现某种故障，需要从云中的数据重置该设备的数据（ 并且有该设备的数据 ）。我的应用程序中是否有任何方法可以重置数据的本地缓存副本以假装它是新设备并让 CoreData 再次从云中获取所有数据？</p>
<p>A：使用 NSPersistentStoreCoordinator 的 destroyPersistentStore (at:type:options:) 方法，彻底销毁本地数据库。</p>
<blockquote>
<p>销毁数据库后，还需要重新在本地创建新的数据库。相较于开发者使用文件管理的方式删除 SQLite 数据，这种方法更加地安全。另外，数据库迁移也可以通过 NSPersistentStoreCoordinator 的 migratePersistentStore (_:to:options:type:) 方法来实施。</p>
</blockquote>
<h3 id="如何保存枚举类型">如何保存枚举类型</h3>
<p>Q：在 Core Data 中存储 Swift 枚举（ 有或没有关联值 ）的推荐方法是什么？</p>
<p>A：一种可能的解决方案是将枚举存储为 Transformable 以处理关联值的情况。在没有枚举值的情况下，通过 rawValue 可以将其转换为 Core Data 支持的任意属性类型之一。</p>
<blockquote>
<p>使用 Transformable 处理包含关联值的枚举有一定的局限性，1、有一定的性能损失；2、无法在 Core Data 中通过谓词对其进行查询。如果你对查询有特别的需求的话，可以将枚举类型中关联数据打散，在实体中，将所有的关联值都定义成属性，并增加一个与枚举对应的类型属性，在托管对象中定义一个枚举类型的计算属性，通过它对数据进行转换。虽然这种方式会浪费一定的存储空间，但具备转换效率高和可查询的优势。</p>
</blockquote>
<h3 id="是否可以显示同步进度并手动触发同步">是否可以显示同步进度并手动触发同步</h3>
<p>Q：使用 NSPersistentCloudKitContainer 时，是否可以确定当前同步状态或手动触发同步？我希望能够在 UI 中显示进度视图，以便首次启动应用程序的用户可以看到他们的数据正在从云中下载。</p>
<p>A：NSPersistentCloudKitContainerEvent 填补了这个角色。您可以根据需要将通知侦听器绑定到事件以更新和显示状态。无法主动触发同步。</p>
<blockquote>
<p>NSPersistentCloudKitContainer 提供了一个 eventChangedNotification 通知，该通知将在 import、export、setup 三种状态切换时会提醒我们。严格意义上，我们很难仅通过切换通知来判断当前同步的实际状态。更多内容请参阅 <a href="/zh/posts/coredatawithcloudkit-4/" target="_blank">Core Data with CloudKit（四）—— 调试、测试、迁移及其他</a> 。</p>
</blockquote>
<h3 id="是否必须添加新版本的-model">是否必须添加新版本的 Model</h3>
<p>Q：我们什么时候需要添加新的 CoreData model 版本？我看到关于轻量级迁移的相互矛盾的建议，为每个版本添加一个新版本是否更安全？</p>
<p>A：在每个版本中添加一个新的托管对象模型会更安全，但是如果您从一个版本到另一个版本的更改经过充分测试以表明适用于轻量级迁移推断，那么单个托管对象模型就足够了。</p>
<blockquote>
<p>对于已经上线的应用，最好还是采用手动添加一个新的版本的模式。除了更加安全外，也方便跟踪旧版本模型的变化。</p>
</blockquote>
<h3 id="swiftui-下如何使用-fetchedresultscontroller">SwiftUI 下如何使用 FetchedResultsController</h3>
<p>Q：是否有在 SwiftUI 应用程序中使用 Core Data 的任何实践或建议？假如广泛使用 Core Data，是否仍应该坚持使用 UIKit。例如，FetchedResultsController 是否有对应的 SwiftUI 版本？</p>
<p>A：在 SwiftUI 中使用 CoreData 没有问题。您可以通过 <a href="https://developer.apple.com/documentation/swiftui/fetchrequest?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">@FetchRequest</a>  从存储中获取检索结果。</p>
<blockquote>
<p>@FetchRequest 是个让人又爱又恨的东西。它很好用，几乎是在视图中获取数据的首选。但对于 Redux-like 框架的使用者来说，它更像一个破坏者，让大量的数据游离于应用的单一状态之外。让单一状态框架与  @FetchRequest 更好地结合目前仍是一个课题。</p>
</blockquote>
<h3 id="运行-initializecloudkitschema-方法的时机">运行 initializeCloudKitSchema 方法的时机</h3>
<p>Q：在使用 Core Data with CloudKit 时，如果我在 Core Data Stack 中编辑持久化存储（ 例如，为共享对象添加新的持久化存储 ），而不触及实体及其属性，我应该运行 initializeCloudKitSchema 吗？</p>
<p>A：只有对托管对象模型进行更改时才需要 initializeCloudKitSchema。一旦它针对 CKContainer 运行，该容器中的所有数据库都将具有相同的 Schema（ 公共/私有/共享 ）。</p>
<blockquote>
<p>initializeCloudKitSchema 通常是在开发阶段使用的一种方法，而且只需要在数据模型创建或变化后使用一次。当 CKContainer 已经创建了对应的 Schema 后，应该在你的代码中删除或注释掉该行代码。另外，initializeCloudKitSchema 还提供了一个 dryRun 选项，用于在单元测试中检查数据模型是否满足 CloudKit 的要求（ 只比对不上传 ）。</p>
</blockquote>
<h3 id="多线程的调试手段">多线程的调试手段</h3>
<p>Q：调试 Core Data 在多线程方式下的访问错误/崩溃的最佳方式是什么？我一直在使用 <code>-com.apple.CoreData.Logging.stderr 1</code> 和 <code>-com.apple.CoreData.ConcurrencyDebug 1</code> 参数来提供帮助。还有其他建议吗？</p>
<p>A：ASAN 也将有助于捕获并发问题导致的内存错误。</p>
<blockquote>
<p>参阅 <a href="/zh/posts/concurrencyofcoredata/" target="_blank">关于 Core Data 并发编程的几点提示</a> 了解更多细节。</p>
</blockquote>
<h3 id="在-app-group-中如何立即反应变化">在 App Group 中如何立即反应变化</h3>
<p>Q：当通过应用程序扩展（例如，SiriKit/AppIntents ）向存储提交更改时，保证更改立即反映在可能已经运行的主应用程序中的最佳方式是什么（ 反之亦然 ）？在应用程序和扩展程序中同时使用 NSPersistentContainer 的 viewContext 是否安全/推荐，或者应使用后台上下文的工作？在我的设置中，存储被保存到一个应用程序组目录中，以允许从应用程序和扩展程序访问，所以我认为每个进程都将利用各自的容器来访问它。</p>
<p>A：这可以使用 <a href="https://developer.apple.com/documentation/coredata/sumption_relevant_store_changes?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">本文</a> 中提到方法，通过设置你的 NSPersistentStoreDescription 远程更改选项来实现。</p>
<blockquote>
<p>持久化历史跟踪正是为类似需求准备的解决方案。参阅 <a href="/zh/posts/persistenthistorytracking/" target="_blank">在 CoreData 中使用持久化历史跟踪</a> 一文，了解更多实现细节。</p>
</blockquote>
<h3 id="避免在小组件中执行复杂任务">避免在小组件中执行复杂任务</h3>
<p>Q：我们遇到了一系列崩溃，因为我们在一个 Widget 进程和一个应用程序进程中启动了相同的 CoreData 堆栈。通常这可以正常工作，但是一旦存储需要迁移（ 我们进行轻量级迁移 ），就会出现某种竞争状况，导致应用程序或小组件进程发生崩溃。在一次崩溃之后，迁移似乎可以正常工作，并且没有发生再次崩溃。是否有一个很好的解决方案如何解决这些崩溃？我们不确定 CoreData 是否正确处理了这件事，或者我们是否需要检测迁移并解决这些崩溃问题。</p>
<p>A：不应赋予 Widget 执行轻量级/推断迁移的能力。只有应用程序应该这样做。如果 Widget 遇到需要迁移的 CoreData Store，则 Widget 应重定向以启动应用程序。实际上，小部件永远不会从操作系统获得足够的资源来完成迁移。</p>
<blockquote>
<p>小组件的运行资源有限，譬如持久化历史事务清除的操作也不应该在小组件中进行处理。</p>
</blockquote>
<h3 id="持久化历史事务的删除时机">持久化历史事务的删除时机</h3>
<p>Q：在 <a href="https://developer.apple.com/documentation/coredata/consuming_relevant_store_changes?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Consuming Relevant Store Changes</a> 的“清除历史记录”中提到：“因为持久历史跟踪事务会占用磁盘空间，所以确定一个清理策略以在不再需要它们时将其删除”。但是，没有给出明确的提示关于如何在不影响 CloudKit 正确性的情况下以安全的方式清除历史。给出的示例是删除所有超过 7 天的事务。但是，为什么是 7 天？为什么不是 14 天？非常希望一个可靠而具体的示例，说明如何安全地清除历史数据以防止磁盘空间浪费。</p>
<p>A：清除历史记录是由客户决定的。通常，应用每年或每半年清除一次历史记录。你的特定应用程序的写入速率可能需要不同的时间窗口，但是当使用 NSPersistentCloudKitContainer 清除历史记录时，可能会强制将存储文件数据全面同步到 CloudKit，因此不建议经常这样做。</p>
<blockquote>
<p>无论进行清除的时间间隔为多少，我都不建议开发者清除 CloudKit 为自动同步创建的历史事务（ 绝大多数情况下，NSPersistentCloudKitContainer 会在确保同步完成后自动进行删除 ）。在进行删除操作时，应在 NSPersistentHistoryChangeRequest 中，忽略掉由系统产生的事务，只删除应用程序或程序组产生的事务。具体内容请参阅 <a href="/zh/posts/persistenthistorytracking/" target="_blank">在 CoreData 中使用持久化历史跟踪</a> 一文。</p>
</blockquote>
<h3 id="如何为-nsdictionary-创建模型">如何为 NSDictionary 创建模型</h3>
<p>Q：我有一个 NSDictionary 值，需要存储在 Core Data 中。使用 Transformable 属性或 Binary Data 属性来存储它，哪个方案更好？ Binary Data 可以选择外部存储，而且我不相信 Transformable。当从存储获取数据时，这两个选项是否都会被加载到内存中？或者支持懒加载（ fault ）？不确定哪个更好用。</p>
<p>A：两者会有相同的内存状况。理想情况下的答案是“两者都不是好的选择” 。如果可能的话，你应该为字典建模（ 使用 Core Data 的方式，创建两个实体，通过关系来映射这个字典 ）。</p>
<blockquote>
<p>很多情况下，不应将传统的数据组织方式照搬到 Core Data 的 Model 中。尽量用适于 Core Data 架构的方式来设计数据结构。尽管可能会有一定的性能损失和容量浪费，但对总体收益会更加有利。例如上面的情况，使用关系的方式来处理有如下优势：1、支持查询；2: 在开启同步的情况下，每次修改仅需同步修改部分；3: 无需担心转换性能。</p>
</blockquote>
<h3 id="是否必须设置逆关系">是否必须设置逆关系</h3>
<p>Q：在数据模型中设置关系的逆关系（ 通常在创建关系时都会设置对应的逆关系 ）有多重要？是否有可以不设置逆关系的相关例子？</p>
<p>A：定义逆向关系使得管理你的图表更容易（ 比如，设置一个“父级”会自动为对象添加为一个“子级” ），并且还允许你委托给 Core Data 进行图表清理（ 比如，你想删除一个 “发票” 同时也删除其所有 “项目” ）。如果您不需要这些语义，则不需要逆向，但大多数情况下，双向遍历都很有用。值得注意的是，如果您想使用 CloudKit 同步，则需要明确逆向关系。我强烈建议为所有关系设置逆向关系，直到它对性能产生重大影响时再考虑删除它。</p>
<blockquote>
<p>Core Data with CloudKit 为了突破 CloudKit API 中对于关系数量（ CKRecord. Reference 不能超过 750 个 ）的限制，采用了双向关联的方式。因此，只有明确逆关系，Core Data with CloudKit 才能在云端创建正确的 Schema。</p>
</blockquote>
<h3 id="nspersistentstore-的元数据">NSPersistentStore 的元数据</h3>
<p>Q：NSPersistentStore  的元数据是否保存在磁盘上？可以用其了解设备是否执行了某种云迁移或其他活动吗？</p>
<p>A：Core Data 将元数据存储在存储文件本身中。此元数据归 Core Data 所有，不建议你更改它。如果你愿意，可以将自己的元数据存储在存储文件中，但请注意你的密钥不要与现有的 Core Data 拥有的密钥重叠。元数据受到与存储文件的其余内容相同的数据保护。</p>
<blockquote>
<p>在有一段时间（ 主要针对文档应用 ），开发者喜欢通过自定义元数据来保存一些选项以方便跨设备使用。阅读 <a href="/zh/posts/tables_and_fields_of_coredata/" target="_blank">Core Data 是如何在 SQLite 中保存数据的</a> 一文，了解更多有关 Core Data 元数据的内容。</p>
</blockquote>
<h3 id="是否有必要同步中间数据">是否有必要同步中间数据</h3>
<p>Q：当我使用 Core Data with CloudKit 时，快速保存数千个 GPS 位置的最佳方法是什么？当数据很多时，它会达到服务器极限。</p>
<blockquote>
<p>冗长的讨论。提问者开发的是一款锻炼用途的应用，他需要在使用者锻炼期间存储所有的位置（坐标、速度、路线、时间戳），以便可以绘制一条折线。但并不需要在所有的设备上保留这些 GPS 信息（ 仅需要保存对这些数据的汇总信息 ）。苹果的工程师建议他通过创建另一个 Configuration 的方式，将这些数据保存在本地存储中（ 不进行同步 ），只将汇总后的信息保存在同步存储中。阅读 <a href="/zh/posts/coredatawithcloudkit-2/" target="_blank">同步本地数据库到 iCloud 私有数据库</a> 一文，了解如何通过创建多个 Configuration 实现有选择性地同步数据。</p>
</blockquote>
<h3 id="如何加密数据库">如何加密数据库</h3>
<p>Q：如果我使用 NSPersistentStoreFileProtectionKey: FileProtectionType. complete 来加密我的数据库，当用户将手机数据备份到 iCloud 后，它会以加密格式存储吗？还是仅在设备上加密？</p>
<p>A：NSFileProtection 仅影响设备上数据的加密状态。</p>
<blockquote>
<p>从 iOS 15 开始，可以在 Model Editor 中将属性启用加密选项（ 不支持老版本的 Model 升级）。在使用 Core Data with CloudKit 时，该属性的值将在 iCloud 中以加密的形式进行保存。Core Data 目前并不支持对 SQLite 进行加密。</p>
</blockquote>
<h3 id="nsexpression-的-bug">NSExpression 的 Bug</h3>
<p>Q：我应该如何看待 NSExpression 中的 CAST 函数？这是我应该积极使用的功能吗？例如，如果我写 <code>CAST(now(), &#39;NSNumber&#39;)</code> 意图在当前时间做数学运算，我会收到 “Don’t know how to cast to NSNumber” 的错误。</p>
<p>A：这是一个很好的问题。我们建议您将其发布在开发者论坛中，Apple 工程师将在此进行整周的监控，并能够为您提供进一步的帮助。这似乎值得一个错误报告</p>
<blockquote>
<p>使用 NSExpressionDescription ，可以在 SQLite 中对记录进行一定的计算，并将计算结果通过 NSFetchRequestResult 进行返回。阅读 [在 Core Data 中查询和使用 count 的若干方法](在 Core Data 中查询和使用 count 的若干方法) 一文，查看使用案例。</p>
</blockquote>
<h3 id="合并策略-or-选择性更新">合并策略 or 选择性更新</h3>
<p>Q：当前我们的 Core Data Stack 采用了 NSMergeByPropertyStoreTrumpMergePolicy 合并策略，它本质上是替换一个已经存储在我们存储中并在从 API 中拉下时由唯一约束标识的对象。另一种方法是通过获取请求（ fetch request ）确定对象是否已经存在，如果存在，则更新现有记录，如果不存在则创建新记录。在 Apple 看来，哪种方式是处理记录创建和更新的首选方式？</p>
<p>A：每种方法都有优点和缺点。一般来说，首先获取记录（ 通过 Core Data 在存储中检查数据是否存在 ）往往非常昂贵。如果您必须这样做，则必须批量获取。在此流程中一次获取一条记录将非常缓慢。</p>
<blockquote>
<p>如果 Core Data 内置的合并策略无法满足你的需求时，创建自定义合并策略或许是不错的选择。</p>
</blockquote>
<h3 id="在多对多关系中创建谓词">在多对多关系中创建谓词</h3>
<p>Q：我的视频实体与标签具有多对多关系，并且我有一个带有一些标签 ID 的数组。我想获取在这组标签 ID 中至少有一个标签的所有视频。如何创建一个 NSPredicate 来表示这个？</p>
<p>A：或许可以尝试一下 <code>ANY tag.name IN %@</code>。</p>
<blockquote>
<p>%@ 对应的是标签数组。应该用 Core Data 的逻辑来组织数据并创建谓词，Core Data 会将谓词转换成对应的 SQL 语句。</p>
</blockquote>
<h3 id="动态修改-fetchrequest-的配置">动态修改 @FetchRequest 的配置</h3>
<p>Q：在 SwiftUI 应用程序中，如何基于 @AppStorage 值创建 @FetchRequest？用例是：当我打开 Focus 过滤器时，我将 @AppStorage 值更改为用户希望在我的应用程序中看到的标签列表。如果我可以创建一个带有与此 @AppStorage 的值相关联的谓词的 @FetchRequest，则谓词将自动更新，并更新我的视图。目前我无法做到这一点，哪种解决方法能获得类似的结果？</p>
<p>A：@FetchRequest 的谓词属性是一个 Binding，它会在更改时重绘视图。</p>
<blockquote>
<p>从 Swift 3.0 开始，FetchRequest 支持在视图中动态修改它的谓词和排序描述。例如上面的问题，可以通过在 task (id:) 中更改 request 的配置。</p>
</blockquote>
<h3 id="urirepresentation">uriRepresentation</h3>
<p>Q：我现在正在为我的应用程序实现一个 URL 方案，我想提供一个打开特定 Core Data 对象的 URL。有没有比在我的 URL 方案中使用 <code>NSManagedObject.objectID.uriRepresentation().absoluteString</code> 作为标识符更好的方法。</p>
<p>A：我想这也是我会做的。</p>
<blockquote>
<p>使用 NSPersistentStoreCoordinator 的 managedObjectID (forURIRepresentation: ) 方法，可以将 URL 转换回对应的 NSManageObjectID。阅读 <a href="/zh/posts/spotlight/" target="_blank">在 Spotlight 中展示应用中的 Core Data 数据</a> ，了解更多细节。</p>
</blockquote>
<h3 id="在同步状态下如何进行大版本迁移">在同步状态下，如何进行大版本迁移</h3>
<p>Q：嗨，在使用 Core Data 和 CloudKit 堆栈时遇到了一个关于迁移的问题。如果我们不再关心本地数据，是否可以从与 CloudKit 同步的数据模型中删除未使用的实体？在我们的例子中，我们首先从实体中删除所有数据（ 也就是将该数据迁移到新实体 ），然后从项目中删除该实体，因为我们可以确定所有用户都已升级。</p>
<p>A：是的，但是，旧版本的应用程序会做什么？从用户角度，旧版本将写入新版本从未见过的数据，而新版本将写入旧版本从未见过的数据。您将如何向您的用户解释这种差异？</p>
<blockquote>
<p>在使用 Core Data with CloudKit 时，对数据模型最好采用只增不改不减的调整原则。如果确实需要对数据模型有破坏性的修改，最好创建两个 Container（ 分别使用不同的 Model ），在使用者确保原始数据都同步到本地后，再将旧数据转换至新的 Container 之上。</p>
</blockquote>
<h3 id="是否可以为共享数据创建单独的-ckrecordzone">是否可以为共享数据创建单独的 CKRecordZone</h3>
<p>Q：我有一个基于文档的应用程序。每个文档都是一个包含唯一 Core Data 存储的包。我想使用 Core Data 的内置 CloudKit 同步 API 分别同步每个文档。如何为每个文档创建唯一的 CKRecordZone ？</p>
<p>A：当前的 NSPersistentCloudKitContainer 不支持这样的用法。</p>
<blockquote>
<p>或许可以考虑使用纯粹的 CloudKit API 来实现他的需求。</p>
</blockquote>
<h3 id="是否可以使用-unchecked-sendable-标注-nsmanagedobjectid">是否可以使用 @unchecked Sendable 标注 NSManagedObjectID</h3>
<p>Q：在可以确保 NSManagedObjectID 不是临时状态的情况下，是否可以使用 @unchecked Sendable 对其进行标注。</p>
<p>A：它应该是。请提交错误报告。</p>
<blockquote>
<p>在 Core Data 中，NSManagedObjectID 是线程安全的。通过向其他的上下文传递 ID，并通过该 ID 在不同线程的上下文中获取托管对象，这样可以确保应用不会出现崩溃。</p>
</blockquote>
<h2 id="总结">总结</h2>
<p>Ask Apple 中有关 Core Data 的问题应该不是太多，我提的几个问题都获得了解答。希望苹果今后可以经常性地举办类似的活动，大家也应该更踊跃地进行参与。</p> </div> </article> <script type="module" src="/_astro/WeeklySubscribeModal.astro_astro_type_script_index_0_lang.Cj0LOOnK.js"></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Modal backdrop with flex centering --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 items-center justify-center"> <div id="default-modal" class="hidden relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script type="module" src="/_astro/WeeklySubscribe1.astro_astro_type_script_index_0_lang.BKbVN22B.js"></script> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2022-10-20T04:12:00.000Z",
  "datePublished": "2022-10-20T04:12:00.000Z",
  "description": "Ask Apple 为开发者与苹果工程师创造了在 WWDC 之外进行直接交流的机会。本文对本次活动中与 Core Data 有关的一些问答进行了整理，并添加了一点个人见解。本文为上篇。",
  "headline": "Ask Apple 2022 中与 Core Data 有关的问答 (上)",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/oc/Core-Data-of-Ask-Apple-2022.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/core-data-of-ask-apple-2022/"
  },
  "url": "https://fatbobman.com/zh/posts/core-data-of-ask-apple-2022/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver(() => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        // const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <svg class="w-5 h-5 me-2 -ms-1" fill="none" stroke="none" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-buymecoffee"></use> </svg> <span class="text-black font-bold">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3b82f6] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <svg class="w-4 h-4 me-2 -ms-1" aria-hidden="true" stroke-width="2" stroke="none" fill="#fb923c" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-aifadian"></use> </svg> <span class="text-white font-bold">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  // 根据中英文对应不同的 adCacheKey
  const adCacheKey = 'dynamicAdCache' + (window.location.pathname.includes('/zh/') ? 'ZH' : 'EN');

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-054" id="relatedPosts-Weekly #54 - 安全、便利与隐私"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #54 - 安全、便利与隐私</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/core-data-of-ask-apple-2022-2/" id="relatedPosts-Ask Apple 2022 中与 Core Data 有关的问答 (下）"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Ask Apple 2022 中与 Core Data 有关的问答 (下）</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/swiftui-of-ask-apple-2022-1/" id="relatedPosts-Ask Apple 2022 与 SwiftUI 有关的问答（上）"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Ask Apple 2022 与 SwiftUI 有关的问答（上）</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/swiftui-of-ask-apple-2022-2/" id="relatedPosts-Ask Apple 2022 与 SwiftUI 有关的问答（下）"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Ask Apple 2022 与 SwiftUI 有关的问答（下）</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/impressions-of-wwdc23/" id="relatedPosts-WWDC 23 ，SwiftUI 5 和 SwiftData 的初印象"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">WWDC 23 ，SwiftUI 5 和 SwiftData 的初印象</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/what-i-hope-to-see-for-swiftui-at-wwdc-2023/" id="relatedPosts-WWDC 2023 我期待 SwiftUI 带来的新变化"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">WWDC 2023 我期待 SwiftUI 带来的新变化</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="Ask Apple 2022 中与 Core Data 有关的问答 (上)" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" defer></script></div>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        const response = await fetch('https://fatbobman.com/status/comment');
        const data = await response.text();
        console.log(data);
        if (data === '1') {
          var container = document.getElementById('gitalk-container');
          if (container) {
            var commentID = container.getAttribute('data-comment-id');
            var lang = container.getAttribute('data-lang');

            var gitalk = new Gitalk({
              clientID: 'fcf61195c7f73253dc8b',
              clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
              repo: 'blogComments',
              owner: 'fatbobman',
              admin: ['fatbobman'],
              id: commentID.split('/').pop().substring(0, 49),
              distractionFreeMode: true,
              createIssueManually: true,
              language: lang,
            });

            gitalk.render('gitalk-container');
          }
        }
      });
    </script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-end pb-2" id="toc-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#qa" class=""> Q&amp;A </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否可以在-core-data-中存储照片" class=""> 是否可以在 Core Data 中存储照片 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#切换-icloud-后是否会清空本地数据" class=""> 切换 iCloud 后是否会清空本地数据 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何禁用/启用网络同步" class=""> 如何禁用/启用网络同步 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何处理-container-创建失败" class=""> 如何处理 Container 创建失败 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#共享数据出现错误" class=""> 共享数据出现错误 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#保存音视频数据的建议方式" class=""> 保存音视频数据的建议方式 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否有最大同步尺寸或数量限制" class=""> 是否有最大同步尺寸或数量限制 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何重置本地数据" class=""> 如何重置本地数据 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何保存枚举类型" class=""> 如何保存枚举类型 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否可以显示同步进度并手动触发同步" class=""> 是否可以显示同步进度并手动触发同步 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否必须添加新版本的-model" class=""> 是否必须添加新版本的 Model </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#swiftui-下如何使用-fetchedresultscontroller" class=""> SwiftUI 下如何使用 FetchedResultsController </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#运行-initializecloudkitschema-方法的时机" class=""> 运行 initializeCloudKitSchema 方法的时机 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#多线程的调试手段" class=""> 多线程的调试手段 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#在-app-group-中如何立即反应变化" class=""> 在 App Group 中如何立即反应变化 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#避免在小组件中执行复杂任务" class=""> 避免在小组件中执行复杂任务 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#持久化历史事务的删除时机" class=""> 持久化历史事务的删除时机 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何为-nsdictionary-创建模型" class=""> 如何为 NSDictionary 创建模型 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否必须设置逆关系" class=""> 是否必须设置逆关系 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#nspersistentstore-的元数据" class=""> NSPersistentStore 的元数据 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否有必要同步中间数据" class=""> 是否有必要同步中间数据 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#如何加密数据库" class=""> 如何加密数据库 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#nsexpression-的-bug" class=""> NSExpression 的 Bug </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#合并策略-or-选择性更新" class=""> 合并策略 or 选择性更新 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#在多对多关系中创建谓词" class=""> 在多对多关系中创建谓词 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#动态修改-fetchrequest-的配置" class=""> 动态修改 @FetchRequest 的配置 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#urirepresentation" class=""> uriRepresentation </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#在同步状态下如何进行大版本迁移" class=""> 在同步状态下，如何进行大版本迁移 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否可以为共享数据创建单独的-ckrecordzone" class=""> 是否可以为共享数据创建单独的 CKRecordZone </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#是否可以使用-unchecked-sendable-标注-nsmanagedobjectid" class=""> 是否可以使用 @unchecked Sendable 标注 NSManagedObjectID </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#总结" class=""> 总结 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/zh/posts/the_composable_architecture/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>聊一聊可组装框架（ TCA ）</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/the_composable_architecture/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/zh/posts/core-data-of-ask-apple-2022-2/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-next"></use> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Ask Apple 2022 中与 Core Data 有关的问答 (下）</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/core-data-of-ask-apple-2022-2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=Ask%20Apple%202022%20%E4%B8%AD%E4%B8%8E%20Core%20Data%20%E6%9C%89%E5%85%B3%E7%9A%84%E9%97%AE%E7%AD%94%20(%E4%B8%8A)&url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcore-data-of-ask-apple-2022%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-twitter"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=Ask%20Apple%202022%20%E4%B8%AD%E4%B8%8E%20Core%20Data%20%E6%9C%89%E5%85%B3%E7%9A%84%E9%97%AE%E7%AD%94%20(%E4%B8%8A)%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcore-data-of-ask-apple-2022%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fcore-data-of-ask-apple-2022%252F" target="_blank" id="sidebar-share-with-facebook"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-facebook"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcore-data-of-ask-apple-2022%2F&title=Ask%20Apple%202022%20%E4%B8%AD%E4%B8%8E%20Core%20Data%20%E6%9C%89%E5%85%B3%E7%9A%84%E9%97%AE%E7%AD%94%20(%E4%B8%8A)%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-weibo"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcore-data-of-ask-apple-2022%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-linkedin"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90Ask%20Apple%202022%20%E4%B8%AD%E4%B8%8E%20Core%20Data%20%E6%9C%89%E5%85%B3%E7%9A%84%E9%97%AE%E7%AD%94%20(%E4%B8%8A)%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0AAsk%20Apple%202022%20%E4%B8%AD%E4%B8%8E%20Core%20Data%20%E6%9C%89%E5%85%B3%E7%9A%84%E9%97%AE%E7%AD%94%20(%E4%B8%8A)%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fcore-data-of-ask-apple-2022%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-email"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" id="comment-button" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-comment"></use> </svg>  </div> <script>
  const SCROLL_OFFSET = 80;
  
  document.addEventListener('DOMContentLoaded', function() {
    const commentButton = document.getElementById('comment-button');
    if (commentButton) {
      commentButton.addEventListener('click', function() {
        const gitalkContainer = document.getElementById('gitalk-container');
        if (gitalkContainer) {
          const topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: topPosition, behavior: 'smooth' });
        }
      });
    }
  });
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/_astro/iconCollection.DOsuOd6k.svg#icon-top"></use> </svg>  </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.XHrm3OJt.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script> --><!-- <script type="module" src="/js/theme.js"></script> --><!-- <link rel="modulepreload" href="/js/theme.js"> --><script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"搜索",buttonAriaLabel:"搜索"},modal:{searchBox:{resetButtonTitle:"清除搜索关键字",resetButtonAriaLabel:"清除搜索关键字",cancelButtonText:"取消",cancelButtonAriaLabel:"取消"},startScreen:{recentSearchesTitle:"最近搜索",noRecentSearchesText:"当前没有搜索历史记录",saveRecentSearchButtonTitle:"保存本次搜索",removeRecentSearchButtonTitle:"从搜索历史中移除",favoriteSearchesTitle:"收藏夹",removeFavoriteSearchButtonTitle:"从收藏夹移除"},errorScreen:{titleText:"无法获取结果",helpText:"请检查网络连接"},footer:{selectText:"选择",selectKeyAriaLabel:"选择",navigateText:"切换",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"退出",closeKeyAriaLabel:"Escape key",searchByText:"引擎支持"},noResultsScreen:{noResultsText:"无法找到对应结果",suggestedQueryText:"可以尝试搜索如下内容",reportMissingResultsText:"确认本次搜索应该返回内容？",reportMissingResultsLinkText:"请告知我们"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
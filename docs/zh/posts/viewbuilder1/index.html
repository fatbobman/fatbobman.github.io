<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>ViewBuilder 研究（上）—— 掌握 Result builders | 肘子的 Swift 记事本</title>
<meta name="description" content="深入探索SwiftUI ViewBuilder的奥秘，通过研究result builders，掌握视图构建核心技术，解决开发难题。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/viewbuilder1/">
<meta property="og:title" content="ViewBuilder 研究（上）—— 掌握 Result builders | 肘子的 Swift 记事本">
<meta property="og:description" content="深入探索SwiftUI ViewBuilder的奥秘，通过研究result builders，掌握视图构建核心技术，解决开发难题。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/viewbuilder1/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/oc/viewbuilder_1.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/viewbuilder1/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/viewbuilder1/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.KmjrvECc.css" />
<link rel="stylesheet" href="/_astro/about.3p2XOxxi.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/viewbuilder1/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/viewbuilder1/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">ViewBuilder 研究（上）—— 掌握 Result builders</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2022-04-06T00:20:00.000Z">2022 年 4 月 6 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>作为一个严重依赖 SwiftUI 的开发者，同视图打交道是最平常不过的事情了。从第一次接触 SwiftUI 的声明式编程方式开始，我便喜欢上了这种写代码的感觉。但接触地越多，碰到的问题也越多。起初，我单纯地将很多问题称之为灵异现象，认为大概率是由于 SwiftUI 的不成熟导致的。随着不断地学习和探索，发现其中有相当部分的问题还是因为自己的认知不够所导致的，完全可以改善或避免。</p>
<p>我将通过上下两篇博文，对构建 SwiftUI 视图的 ViewBuilder 进行探讨。上篇将介绍 ViewBuilder 背后的实现者 —— result builders ; 下篇将通过对 ViewBuilder 的仿制，进一步地探寻 SwiftUI 视图的秘密。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="本文希望达成的目标">本文希望达成的目标</h2>
<p>希望在阅读完两篇文章后能消除或减轻你对下列疑问的困惑：</p>
<ul>
<li>如何让自定义视图、方法支持 ViewBuilder</li>
<li>为什么复杂的 SwiftUI 视图容易在 Xcode 上卡死或出现编译超时</li>
<li>为什么会出现 “Extra arguments” 的错误提示（仅能在同一层次放置有限数量的视图）</li>
<li>为什么要谨慎使用 AnyView</li>
<li>如何避免使用 AnyView</li>
<li>为什么无论显示与否，视图都会包含所有选择分支的类型信息</li>
<li>为什么绝大多数的官方视图类型的 body 都是 Never</li>
<li>ViewModifier 同特定视图类型的 modifier 之间的区别</li>
</ul>
<h2 id="什么是-result-builders">什么是 Result builders</h2>
<h3 id="介绍">介绍</h3>
<p>result builders 允许某些函数通过一系列组件中隐式构建结果值，按照开发者设定的构建规则对组件进行排列。通过对函数语句应用构建器进行转译，result builders 提供了在 Swift 中创建新的领域特定语言（ DSL ）的能力（为了保留原始代码的动态语义，Swift 有意地限制了这些构建器的能力）。</p>
<p>与常见的使用点语法实现的类 DSL 相比，使用 result builders 创建的 DSL 使用更简单、无效内容更少、代码更容易理解（在表述具有选择、循环等逻辑内容时尤为明显），例如：</p>
<p>使用点语法（ <a href="https://github.com/JohnSundell/Plot?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Plot</a> ）：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">div</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">div</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">forEach</span><span style="color:#F8F8F2">(archiveItems.</span><span style="color:#BD93F9">keys</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">sorted</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">by</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">)) { absoluteMonth </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">group</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">ul</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">forEach</span><span style="color:#F8F8F2">(archiveItems[absoluteMonth]) { item </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">li</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                            .</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                                .</span><span style="color:#8BE9FD">href</span><span style="color:#F8F8F2">(item.path),</span></span>
<span class="line"><span style="color:#F8F8F2">                                .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(item.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                            )</span></span>
<span class="line"><span style="color:#F8F8F2">                        )</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                ),</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">if</span><span style="color:#F8F8F2">( show, </span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">), </span></span>
<span class="line"><span style="color:#8BE9FD">                  else</span><span style="color:#F8F8F2">: .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">wrold</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                 ),</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span></code></pre></div>
<p>通过 result builders 创建的构建器 ( <a href="https://github.com/BinaryBirds/swift-html?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">swift-html</a> )：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">Div {</span></span>
<span class="line"><span style="color:#F8F8F2">    Div {</span></span>
<span class="line"><span style="color:#FF79C6">        for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            Ul {</span></span>
<span class="line"><span style="color:#FF79C6">                for</span><span style="color:#F8F8F2"> item </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> archiveItems[i] {</span></span>
<span class="line"><span style="color:#F8F8F2">                    li {</span></span>
<span class="line"><span style="color:#8BE9FD">                        A</span><span style="color:#F8F8F2">(item.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                            .</span><span style="color:#8BE9FD">href</span><span style="color:#F8F8F2">(item.path)</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="历史与发展">历史与发展</h3>
<p>自 Swift 5.1 开始，result builders 便随着 SwiftUI 的推出隐藏在 Swift 语言之中（当时名为 function builder）。随着 Swift 与 SwiftUI 的不断进化，最终被正式纳入到 Swift 5.4 版本之中。目前苹果在 SwiftUI 框架中大量地使用了该功能，除了最常见的视图构建器（ViewBuilder）外，其他还包括：AccessibilityRotorContentBuilder、CommandsBuilder、LibraryContentBuilder、SceneBuilder、TableColumnBuilder、TableRowBuilder、ToolbarContentBuilder、WidgetBundleBuilder 等。另外，在最新的 Swift 提案中，已出现了 <a href="https://forums.swift.org/t/pitch-regex-builder-dsl/56007?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Regex builder DSL</a> 的身影。其他的开发者利用该功能也创建了不少的 <a href="https://github.com/carson-katri/awesome-result-builders#html?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">第三方库</a>。</p>
<h3 id="基本用法">基本用法</h3>
<h4 id="定义构建器类型">定义构建器类型</h4>
<p>一个结果构建器类型必须满足两个基本要求。</p>
<ul>
<li>
<p>它必须通过 <code>@resultBuilder</code> 进行标注，这表明它打算作为一个结果构建器类型使用，并允许它作为一个自定义属性使用。</p>
</li>
<li>
<p>它必须至少实现一个名为 <code>buildBlock</code> 的类型方法</p>
</li>
</ul>
<p>例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> StringBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> parts</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        parts.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2">{</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">⭐️</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> +</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#FF79C6"> +</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">🌈</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">}.</span><span style="color:#8BE9FD">joined</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">separator</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#E9F284"> &quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>通过上面的代码，我们便创建了一个具有最基本功能的结果构建器。使用方法如下：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@StringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> getStrings</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">喜羊羊</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">美羊羊</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">灰太狼</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// ⭐️喜羊羊🌈 ⭐️美羊羊🌈 ⭐️灰太狼🌈</span></span></code></pre></div>
<h4 id="为构建器类型提供足够的结果构建方法子集">为构建器类型提供足够的结果构建方法子集</h4>
<ul>
<li>
<p><code>buildBlock(_ components: Component...) -&gt; Component</code></p>
<p>用来构建语句块的组合结果。每个结果构建器至少要提供一个它的具体实现。</p>
</li>
<li>
<p><code>buildOptional(_ component: Component?) -&gt; Component</code></p>
<p>用于处理在特定执行中可能或不可能出现的部分结果。当一个结果构建器提供了 <code>buildOptional(_:)</code> 时，转译后的函数可以使用没有 <code>else</code> 的 <code>if</code> 语句，同时也提供了对 <code>if let</code> 的支持。</p>
</li>
<li>
<p><code>buildEither(first: Component) -&gt; Component</code> 和 <code>buildEither(second: Component) -&gt; Component</code></p>
<p>用于在选择语句的不同路径下建立部分结果。当一个结果构建器提供这两个方法的实现时，转译后的函数可以使用带有 <code>else</code> 的 <code>if</code> 语句以及 <code>switch</code> 语句。</p>
</li>
<li>
<p><code>buildArray(_ components: [Component]) -&gt; Component</code></p>
<p>用来从一个循环的所有迭代中收集的部分结果。在一个结果构建器提供了 <code>buildArray(_:)</code> 的实现后，转译后的函数可以使用 <code>for...in</code> 语句。</p>
</li>
<li>
<p><code>buildExpression(_ expression: Expression) -&gt; Component</code></p>
<p>它允许结果构建器区分 <code>表达式</code> 类型和 <code>组件</code> 类型，为语句表达式提供上下文类型信息。</p>
</li>
<li>
<p><code>buildFinalResult(_ component: Component) -&gt; FinalResult</code></p>
<p>用于对最外层的 <code>buildBlock</code> 结果的再包装。例如，让结果构建器隐藏一些它并不想对外的类型（转换成可对外的类型）。</p>
</li>
<li>
<p><code>buildLimitedAvailability(_ component: Component) -&gt; Component</code></p>
<p>用于将 <code>buildBlock</code> 在受限环境下（例如 <code>if #available</code>）产生的部分结果转化为可适合任何环境的结果，以提高 API 的兼容性。</p>
</li>
</ul>
<blockquote>
<p>结果构建器采用 ad hoc 协议，这意味着我们可以更灵活的重载上述方法。然而，在某些情况下，结果构建器的转译过程会根据结果构建器类型是否实现了某个方法来改变其行为。</p>
</blockquote>
<p>之后会通过示例对上述的方法逐一做详尽介绍。下文中，会将“结果构建器”简称为“构建器”。</p>
<h2 id="范例一attributedstringbuilder">范例一：AttributedStringBuilder</h2>
<p>本例中，我们将创建一个用于声明 AttributedString 的构建器。对 AttributedString 不太熟悉的朋友，可以阅读我的另一篇博文 <a href="/zh/posts/attributedstring/" target="_blank">AttributedString——不仅仅让文字更漂亮</a>。</p>
<blockquote>
<p>范例一的完整代码可以在 <a href="https://github.com/fatbobman/BlogCodes/tree/main/AttributedStringBuilder/AttributedStringBuilderDemo.playground?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">此处</a> 获取（ Demo 1 ）</p>
</blockquote>
<p>本例结束后，我们将可以用如下的方式来声明 AttributedString ：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">_*Hello*_</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.green)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> case</span><span style="color:#F8F8F2"> .male </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> gender {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C"> Boy!</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C"> Girl!</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.pink)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20220331202541444.png" alt="image-20220331202541444" loading="lazy" decoding="async"/>
                  </picture></p>
<h3 id="创建构建器类型">创建构建器类型</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> enum</span><span style="color:#8BE9FD;font-style:italic"> AttributedStringBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">    // 对应 block 中没有走 component 的情况</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // 对应 block 中有 n 个 component 的情况（ n 为正整数 ）</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: AttributedString</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        components.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>我们首先创建了一个名为 AttributedStringBuilder 的构建器，并为其实现了两个 <code>buildBlock</code> 方法。构建器在转译时会自动地选择对应的方法。</p>
<p>现在，可以为 block 提供任意数量的 component （  AttributedString ） ，<code>buildBlock</code> 会将其转换成指定的结果（AttributedString）。</p>
<p>在实现 <code>buildBlock</code> 方法时，components 与 block 的返回数据类型应根据实际需求定义，无需一致。</p>
<h3 id="使用构建器转译-block">使用构建器转译 Block</h3>
<p>可以采用显式的方式来调用构建器，例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span><span style="color:#6272A4"> // 明确标注</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#6272A4">// &quot;HelloWorld&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> mySecondText</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {} </span><span style="color:#6272A4">// 空 block ，将调用 buildBlock() -&gt; AttributedString</span></span>
<span class="line"><span style="color:#6272A4">// &quot;&quot;</span></span></code></pre></div>
<p>也可以采用隐式的方式调用构建器：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 在 API 端标注</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> generateText</span><span style="color:#F8F8F2">(@AttributedStringBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> content</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#8BE9FD">    Text</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">content</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 在客户端隐式调用</span></span>
<span class="line"><span style="color:#F8F8F2">VStack {</span></span>
<span class="line"><span style="color:#F8F8F2">    generateText {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C"> World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MyTest</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"><span style="color:#6272A4">    // 在构造方法中标注</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(@AttributedStringBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> content</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> content</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 隐式调用</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> attributedString </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> MyTest {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ABC</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BBC</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}.content</span></span></code></pre></div>
<p>无论以何种方式，如果在 block 的最后使用了 <code>return</code> 关键字来返回结果，则构建器将自动忽略转译过程。例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span><span style="color:#F8F8F2"> </span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// 该语句将被忽略</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#8BE9FD"> AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// 仅返回 World</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#6272A4">// &quot;World&quot;</span></span></code></pre></div>
<blockquote>
<p>为了在 block 中使用构建器不支持的语法，开发者会尝试使用 <code>return</code> 来返回结果值，应避免出现这种情况。因为这会导致开发者将失去通过构建器进行转译所带来的灵活性。</p>
</blockquote>
<p>下面的代码在使用构建器转译时和不使用构建器转译时的状态完全不同：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 构建器自动转译，block 只返回最终的合成结果，代码可正常执行</span></span>
<span class="line"><span style="color:#FF79C6">@ViewBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> blockTest</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">isEmpty</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello anonymous!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 构建器的转译行为因 return 而被忽略。 block 中的选择语句两个分支返回了两种不同的类型，无法满足必须返回同一类型的要求（some View），编译无法通过。</span></span>
<span class="line"><span style="color:#FF79C6">@ViewBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> blockTest</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">isEmpty</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD"> Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello anonymous!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD"> Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在 block 中使用如下的方式调用代码，可以在不影响构建器转译过程的情况下完成其他的工作：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span><span style="color:#F8F8F2"> </span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD"> print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">update</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// 声明语句不会影响构建器的转译</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="添加-modifier">添加 modifier</h3>
<p>在继续完善构建器其他的方法之前，我们先为 AttributedStringBuilder 添加一些类似 SwiftUI 的 ViewModifier 功能，从而像 SwiftUI 那样方便的修改 AttributedString 的样式。添加下面的代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        then {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#F8F8F2">.foregroundColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.stronglyEmphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .stronglyEmphasized</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.emphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .emphasized</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> then</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">result)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>由于 AttributedString 是值类型，因此我们需要创建一个新的拷贝，并在其上修改属性。modifier 的使用方法如下：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>虽然只编写了很少的代码，但目前已经逐渐有了点 DSL 的感觉了。</p>
<h3 id="简化表达">简化表达</h3>
<p>由于 block 只能接收特定类型的 component （ AttributedString ），因此每行代码都需要添加 AttributedString 的类型前缀，导致工作量大，同时也影响了阅读体验。通过使用 <code>buildExpression</code> 可以简化这一过程。</p>
<p>添加下面的代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(string)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>构建器会将 String 首先转换成 AttributedString，然后再将其传入到 buildBlock 中。添加上述代码后，我们直接使用 String 替换掉 AttributedString：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>不过，现在我们又面临了新问题 —— 无法在 block 中混合使用 String 和 AttributedString。这是因为，如果我们不提供自定义的 <code>buildExpression</code> 实现，构建器会通过 <code>buildBlock</code> 推断出 component 的类型是 AttributedString 。一旦我们提供了自定义的 <code>buildExpression</code> ，构建器将不再使用自动推断。解决的方法就是为 AttributedString 也创建一个 <code>buildExpression</code> :</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedString</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    attributedString</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>现在就可以在 block 中混用两者了。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>另一个问题是，我们无法直接在 String 下使用我们之前创建的 modifier 。因为之前的 modifier 是针对 AttributedString 的，点语法将只能使用针对 String 的方法。解决方式有两种：一是扩展 String ，将其转换成 AttributedString，二是为 String 添加上 modifier 转换器。我们暂时先采用第二种较繁琐的方式：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(color)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>现在，我们已经可以快速、清晰地进行声明了。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>AttributedString 提供了对本地化字符串以及部分 Markdown 语法的支持，但仅适用于通过 String. LocalizationValue 类型构造的 AttributedString ，可以通过如下的方式来解决这个问题：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> localized</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">LocalizationValue</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>将字符串转换成采用 String. LocalizationValue 构造的 AttributedString，转换后将可直接使用为 AttributedString 编写的 modifier（你也可以对 String 采用类似的方式，从而避免为 String 重复编写 modifier）。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">~**World**~</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#6272A4">         //.bold()    通过 Markdown 语法来描述粗体。当前在使用 Markdown 语法的情况下，直接对 inlinePresentationIntent 进行设置会有冲突。</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20220401090042983.png" alt="image-20220401090042983" loading="lazy" decoding="async"/>
                  </picture></p>
<h3 id="构建器转译的逻辑">构建器转译的逻辑</h3>
<p>了解构建器是如何转译的，将有助于之后的学习。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>构建器在处理上面的代码时，将会转译成下面的代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)  </span><span style="color:#6272A4">// 调用针对 String 的 buildExpression</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)) </span><span style="color:#6272A4">// 调用针对 AtributedString 的 buildExpression</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a,_b) </span><span style="color:#6272A4">// 调用支持多参数的 buildBloack</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>上下两段代码完全等价，Swift 会在幕后自动帮我们完成了这个过程。</p>
<blockquote>
<p>在学习创建构建器时，通过在构建器方法的实现内部添加打印命令，有助于更好地掌握每个方法的调用时机。</p>
</blockquote>
<h3 id="添加选择语句支持-不带-else-的-if">添加选择语句支持（ 不带 else 的 if ）</h3>
<p>result builders 在处理 <code>包含</code> 和 <code>不包含</code>  else 的选择语句时，采用了完全不同的内部处理机制。对于不包含 <code>else</code> 的 <code>if</code> 只需要实现下面的方法即可：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildOptional</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>构建器在调用该方法时，将视条件是否达成传入不同的参数。条件未达成时，传入 <code>nil</code> 。使用方法为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在添加了 <code>buildOptional</code> 的实现后，构建器也将同时支持 <code>if let</code> 语法，例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> name:</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">?</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fat</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#FF79C6"> \(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><code>buildOptional</code> 对应的转译代码为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 上面的 if 代码对应的逻辑</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vCase0: AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a, _b)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 上面的 if let 代码对应的逻辑</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vCase0:AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name {</span></span>
<span class="line"><span style="color:#F8F8F2">        vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(name)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a,_b)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>这就是为什么只需要实现 <code>buildOptional</code> 即可同时支持 <code>if</code> ( 不包含 <code>else</code> ) 和 <code>if let</code> 的原因。</p>
<h3 id="添加对多分支选择的支持">添加对多分支选择的支持</h3>
<p>对于 <code>if else</code> 以及 <code>switch</code> 语法，则需要实现 <code>buildEither(first:)</code> 和 <code>buildEither(second:)</code> 两个方法:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 对条件为真的分支调用 （左侧分支）</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">first</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// 对条件为否的分支调用 （右侧分支）</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">second</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>使用方法如下：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对应的转译代码为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerged: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerged)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在包含 <code>else</code> 语句时，构建器在转译时将产生一个二叉树，每个结果都被分配到其中的一个叶子上。对于在 <code>if else</code> 中出现的不使用 <code>else</code> 的分支部分，构建器仍将通过 <code>buildOptional</code> 来处理，例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fatbobman</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: Text {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#FF79C6"> if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> &gt;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>转译后的代码为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 转译后的代码</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerged: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // 首先使用 buildOptional 处理不包含 else 的情况</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> vCase0: AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> &gt;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(name)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#6272A4">        // 右侧分支最终汇总到 vMerged 上</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: _a)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerged)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对于 <code>switch</code> 的支持也是采用同样的方式。构建器在转译时，将递归地应用上述规则。</p>
<blockquote>
<p>或许大家会奇怪， <code>buildEither</code> 的实现如此简单，并没有太大的意义。在 result builders 提案过程中也有不少人有这个疑问。其实 Swift 的这种设计有其相当合适的应用领域。在下一篇【 复制 ViewBuilder 】中，我们将看到 ViewBuilder 是如何通过 <code>buildEither</code> 来保存所有分支的类型信息。</p>
</blockquote>
<h3 id="支持-for-in-循环">支持 for… in 循环</h3>
<p><code>for...in</code> 语句将所有迭代的结果一并收集到一个数组中，并传递给 <code>buildArray</code>。提供 <code>buildArray</code> 的实现即可让构建器支持循环语句。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 本例中，我们将所有的迭代结果直接连接起来，生成一个 AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildArray</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: [AttributedString]) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    components.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">        result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>使用方式：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> test</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#F8F8F2">count {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#FF79C6"> \(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284"> &quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对应的转译代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> test</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vArray </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [AttributedString]()</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#F8F8F2">count {</span></span>
<span class="line"><span style="color:#F8F8F2">        vArray.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> \(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildArray</span><span style="color:#F8F8F2">(vArray)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="提高版本兼容性">提高版本兼容性</h3>
<p>如果提供了 <code>buildLimitedAvailability</code> 的实现，构建器提供了对 API 可用性检查（如 <code>if #available(..)</code>）的支持。这种情况在 SwiftUI 中很常见，例如某些 View 或 modifier 仅支持较新的平台，我们需要为不支持的平台提供其他的内容。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildLimitedAvailability</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>该方法并不会独立存在，它会和 <code>buildOptional</code> 或 <code>buildEither</code> 一并使用。当 API 可用性检查满足条件后， result builders 会调用该实现。在 SwiftUI 中，为了固定类型，使用了 AnyView 对类型进行了抹除。</p>
<p>使用方法：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// 创建一个当前平台不支持的方法</span></span>
<span class="line"><span style="color:#FF79C6">@available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">,</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> futureMethod</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#8BE9FD"> #available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello macOS 13</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">futureMethod</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hi Monterey</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对应的转译逻辑为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerge: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#8BE9FD"> #available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _temp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">buildLimitedAvailability</span><span style="color:#F8F8F2">( </span><span style="color:#6272A4">// 对类型或方法进行抹除</span></span>
<span class="line"><span style="color:#F8F8F2">                AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello macOS 13</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#8BE9FD">futureMethod</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerge </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: _temp)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _temp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hi Monterey</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerge </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: _temp)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerge)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="对结果再包装">对结果再包装</h3>
<p>如果我们提供了 <code>buildFinalResult</code> 的实现，构建器将在转译的最后，对结果使用 <code>buildFinalResult</code> 再度转换，并以 <code>buildFinalResult</code> 的返回值为最终的结果。</p>
<p>绝大多数情况下，我们无需实现 <code>buildFinalResult</code>，构建器会将 <code>buildBlock</code> 的返回作为最终的结果。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildFinalResult</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#8BE9FD">    Text</span><span style="color:#F8F8F2">(component)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>为了演示，本例中我们将 AttributedString 通过 <code>buildFinalResult</code> 转换为 Text ，使用方法：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {  </span><span style="color:#6272A4">// 最终的结果类型已转译为 Text</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对应的转译逻辑：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _blockResult </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildFinalResult</span><span style="color:#F8F8F2">(_blockResult)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>至此，我们已经实现了本节开始设定的目标。不过当前的实现仍无法为我们提供创建例如 SwiftUI 各种容器的可能性，这个问题将在范例二中得以解决。</p>
<h2 id="范例二attributedtextbuilder">范例二：AttributedTextBuilder</h2>
<blockquote>
<p>范例二的完整代码可以在 <a href="https://github.com/fatbobman/BlogCodes/tree/main/AttributedStringBuilder/AttributedStringBuilderDemo.playground?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">此处</a> 获取（ Demo 2 ）</p>
</blockquote>
<h3 id="版本一的不足">版本一的不足</h3>
<ul>
<li>只能对 component（AttributedString、String）逐个添加 modifier，无法统一配置</li>
<li>无法动态布局，<code>buildBlock</code> 将所有的内容连接起来，想换行也只能通过单独添加 <code>\n</code> 来实现</li>
</ul>
<h3 id="使用协议代替类型">使用协议代替类型</h3>
<p>上述问题产生的主要原因为：上面的 <code>buildBlock</code> 的 component 是特定的 AttributedString 类型，限制了我们创建容器（其他的 component ）的能力。可以参照 SwiftUI View 的方案来解决上述不足，使用协议取代特定的类型，同时让 AttributedString 也符合该协议。</p>
<p>首先，我们将创建一个新的协议 —— AttributedText ：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> protocol</span><span style="color:#8BE9FD;font-style:italic"> AttributedText</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> content: AttributedString { </span><span style="color:#FF79C6">get</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>让 AttributedString 符合该协议：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>创建一个新的构建器 —— AttributedTextBuilder，它的最大变化就是将所有 component 的类型都改成了 AttributedText 。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> enum</span><span style="color:#8BE9FD;font-style:italic"> AttributedTextBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: AttributedText</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> components.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">.content }.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedString</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        attributedString.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(string)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildOptional</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">first</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">second</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildArray</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: [AttributedText]) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> components.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">.content }.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildLimitedAvailability</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>为 AttributedText 创建 modifier ：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedText</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> transform</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#F8F8F2"> AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> attributedString </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#F8F8F2">.content</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">attributedString)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">(attributedString)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(color)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>至此我们便拥有了类似在 SwiftUI 中创建自定义视图控件的能力。</p>
<h3 id="创建-container">创建 Container</h3>
<p>Container 类似 SwiftUI 中的 Group ，不改变布局，方便对 Container 内的元素统一设置 modifier。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Container</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#F8F8F2">        content </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(@AttributedTextBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedText</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> attributedText</span><span style="color:#F8F8F2">().content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>由于 Container 也符合 AttributedText 协议，因此将被视为 component，并且可以对其应用 modifier 。使用方法：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedTextBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> attributedText: AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">    Container {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">~World~</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.green)</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>此时执行上面的代码，你会发现，原来红色的 Hello 也变成了绿色的，这与我们预期的不一样。在 SwiftUI 中，内层的设定应优先于外层的设定。为了解决这个问题，我们需要对 AttributedString 的 modifier 做一些修改。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        container.foregroundColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container, </span><span style="color:#8BE9FD">mergePolicy</span><span style="color:#F8F8F2">: .keepCurrent)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> run.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                    var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.stronglyEmphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                    container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">                } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                    $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .stronglyEmphasized</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> run.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                    var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.emphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                    container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">                } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                    $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .emphasized</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> then</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">result)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>通过遍历 AttributedString 的 run 视图，我们实现了同一属性的内层设定优先于外层设定。</p>
<h3 id="创建-paragraph">创建 Paragraph</h3>
<p>Paragraph 会在其中内容的首尾创建换行。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Paragraph</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#F8F8F2">        content </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(@AttributedTextBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedText</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> +</span><span style="color:#8BE9FD"> attributedText</span><span style="color:#F8F8F2">().content </span><span style="color:#FF79C6">+</span><span style="color:#E9F284"> &quot;</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>通过将协议作为 component ，为构建器提供了更多的可能性。</p>
<h2 id="result-builders-的改进与不足">Result builders 的改进与不足</h2>
<h3 id="已完成的改进">已完成的改进</h3>
<p>从 Swift 5.1 开始，result builders 已经过几个版本的改进，增加了部分功能同时也解决了部分的性能问题：</p>
<ul>
<li>添加了 <code>buildOptional</code> 并取消了 <code>buildeIf</code>，在保留了对 <code>if</code> （不包含 <code>else</code> ）支持的同时，增加了对 <code>if let</code> 的支持</li>
<li>从 SwiftUI 2.0 版本开始支持了 <code>switch</code> 关键字</li>
<li>修改了 Swift 5.1 版本的 <code>buildBlock</code> 的语法转译机制。禁止了参数类型的“向后”传播。这是导致早期 SwiftUI 视图代码总出现“ expression too complex to be solved in a reasonable time ” 编译错误的首要原因</li>
</ul>
<h3 id="当前的不足">当前的不足</h3>
<ul>
<li>
<p>欠缺部分选择和控制能力，如： guard 、break 、continue</p>
</li>
<li>
<p>缺乏将命名限制在构建器上下文内能力</p>
<p>对于 DSL 来说，引入速记词是很常见的情况，当前为构建器创建 component ，只能采用创建新的数据类型（例如上文中的：Container、Paragraph ）或全局函数的形式。希望将来可以让这些命名仅限制在上下文之内，不将其引入全局范围。</p>
</li>
</ul>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="后续">后续</h2>
<p>Result builders 的基本功能非常简单，上文中，我们仅有少量的代码是有关构建器方法的。但想创建一个好用、易用的 DSL 则需要付出巨大的工作量，开发者应根据自己的实际需求来衡量使用 result builders 的得失。</p>
<p>在下篇中，我们将尝试复制一个与 ViewBuilder 基本形态一致的构建器，相信复制的过程能让你对 ViewBuilder 以及 SwiftUI 视图有更深的理解和认识。</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2022-04-06T00:20:00.000Z",
  "datePublished": "2022-04-06T00:20:00.000Z",
  "description": "深入探索SwiftUI ViewBuilder的奥秘，通过研究result builders，掌握视图构建核心技术，解决开发难题。",
  "headline": "ViewBuilder 研究（上）—— 掌握 Result builders",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/oc/viewbuilder_1.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/viewbuilder1/"
  },
  "url": "https://fatbobman.com/zh/posts/viewbuilder1/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <img src="/images/aifadian.svg" alt="" width="18" height="18" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  const adCacheKey = 'dynamicAdCache';

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/viewbuilder2/" id="relatedPosts-ViewBuilder 研究（下） —— 从模仿中学习"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">ViewBuilder 研究（下） —— 从模仿中学习</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/attributedstring/" id="relatedPosts-AttributedString —— 不仅仅让文字更漂亮"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">AttributedString —— 不仅仅让文字更漂亮</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/avoid_repeated_calculations_of_swiftui_views/" id="relatedPosts-避免 SwiftUI 视图的重复计算"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">避免 SwiftUI 视图的重复计算</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-040" id="relatedPosts-Weekly #40 - 不要让“无人驾驶”发展成“无人就业”"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #40 - 不要让“无人驾驶”发展成“无人就业”</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/async-await-store/" id="relatedPosts-用 Async-Await 重建 SwiftUI 的 Redux-like 状态容器"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">用 Async-Await 重建 SwiftUI 的 Redux-like 状态容器</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="ViewBuilder 研究（上）—— 掌握 Result builders" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#本文希望达成的目标" class=""> 本文希望达成的目标 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#什么是-result-builders" class=""> 什么是 Result builders </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#介绍" class=""> 介绍 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#历史与发展" class=""> 历史与发展 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#基本用法" class=""> 基本用法 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#范例一attributedstringbuilder" class=""> 范例一：AttributedStringBuilder </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#创建构建器类型" class=""> 创建构建器类型 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#使用构建器转译-block" class=""> 使用构建器转译 Block </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#添加-modifier" class=""> 添加 modifier </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#简化表达" class=""> 简化表达 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#构建器转译的逻辑" class=""> 构建器转译的逻辑 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#添加选择语句支持-不带-else-的-if" class=""> 添加选择语句支持（ 不带 else 的 if ） </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#添加对多分支选择的支持" class=""> 添加对多分支选择的支持 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#支持-for-in-循环" class=""> 支持 for... in 循环 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#提高版本兼容性" class=""> 提高版本兼容性 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#对结果再包装" class=""> 对结果再包装 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#范例二attributedtextbuilder" class=""> 范例二：AttributedTextBuilder </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#版本一的不足" class=""> 版本一的不足 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#使用协议代替类型" class=""> 使用协议代替类型 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#创建-container" class=""> 创建 Container </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#创建-paragraph" class=""> 创建 Paragraph </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#result-builders-的改进与不足" class=""> Result builders 的改进与不足 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#已完成的改进" class=""> 已完成的改进 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#当前的不足" class=""> 当前的不足 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#后续" class=""> 后续 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/swiftuioverlaycontainer2/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>SwiftUI Overlay Container 2 —— 可定制、高效、便捷的视图管理器</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/swiftuioverlaycontainer2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/viewbuilder2/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>ViewBuilder 研究（下） —— 从模仿中学习</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/viewbuilder2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=ViewBuilder%20%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94%20%E6%8E%8C%E6%8F%A1%20Result%20builders&#38;url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fviewbuilder1%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=ViewBuilder%20%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94%20%E6%8E%8C%E6%8F%A1%20Result%20builders%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fviewbuilder1%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fviewbuilder1%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fviewbuilder1%2F&#38;title=ViewBuilder%20%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94%20%E6%8E%8C%E6%8F%A1%20Result%20builders%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fviewbuilder1%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90ViewBuilder%20%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94%20%E6%8E%8C%E6%8F%A1%20Result%20builders%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0AViewBuilder%20%E7%A0%94%E7%A9%B6%EF%BC%88%E4%B8%8A%EF%BC%89%E2%80%94%E2%80%94%20%E6%8E%8C%E6%8F%A1%20Result%20builders%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fviewbuilder1%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
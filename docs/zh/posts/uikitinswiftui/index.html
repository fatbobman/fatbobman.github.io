<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>在 SwiftUI 中使用 UIKit 视图 | 肘子的 Swift 记事本</title>
<meta name="description" content="详解如何在SwiftUI中使用UIKit视图，通过包装UITextField展示SwiftUI风格扩展及注意事项，提升跨框架开发效率。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/uikitinswiftui/">
<meta property="og:title" content="在 SwiftUI 中使用 UIKit 视图 | 肘子的 Swift 记事本">
<meta property="og:description" content="详解如何在SwiftUI中使用UIKit视图，通过包装UITextField展示SwiftUI风格扩展及注意事项，提升跨框架开发效率。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/uikitinswiftui/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://fatbobman.com/images/blog-card.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/uikitinswiftui/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/uikitinswiftui/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.KmjrvECc.css" />
<link rel="stylesheet" href="/_astro/about.3p2XOxxi.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/uikitinswiftui/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/uikitinswiftui/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">在 SwiftUI 中使用 UIKit 视图</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2021-08-23T03:12:00.000Z">2021 年 8 月 23 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>已迈入第三个年头的 SwiftUI 相较诞生初始已经提供了更多的原生功能，但仍有大量的事情是无法直接通过原生 SwiftUI 代码来完成的。在相当长的时间中开发者仍需在 SwiftUI 中依赖 UIKit（AppKit）代码。好在，SwiftUI 为开发者提供了便捷的方式将 UIKit（AppKit）视图（或控制器）包装成 SwiftUI 视图。</p>
<p>本文将通过对 UITextField 的包装来讲解以下几点：</p>
<ul>
<li>如何在 SwiftUI 中使用 UIKit 视图</li>
<li>如何让你的 UIKit 包装视图具有 SwiftUI 风格</li>
<li>在 SwiftUI 使用 UIKit 视图需要注意的地方</li>
</ul>
<blockquote>
<p><strong>如果你已经对如何使用 <code>UIViewRepresentable</code> 有所掌握，可以直接从 <code>SwiftUI 风格化</code> 部分阅读</strong></p>
</blockquote>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="基础">基础</h2>
<p>在具体演示包装代码之前，我们先介绍一些与在 SwiftUI 中使用 UIKit 视图有关的基础知识。</p>
<blockquote>
<p>无需担心是否能立即理解下述内容，在后续的演示中会有更多的内容帮助你掌握相关知识。</p>
</blockquote>
<h3 id="生命周期">生命周期</h3>
<p>SwiftUI 同 UIKit 和 AppKit 的主要区别之一是，SwiftUI 的视图（View）是值类型，并不是对屏幕上绘制内容的具体引用。在 SwiftUI 中，开发者为视图创建描述，而并不实际渲染它们。</p>
<p>在 UIKit（或 AppKit）中，视图（或视图控制器）有明确的生命周期节点，比如 <code>vidwDidload</code>、<code>loadView</code>、<code>viewWillAppear</code>、<code>didAddSubView</code>、<code>didMoveToSuperview</code> 等方法，它们本质上充当了钩子的角色，让开发者能够通过执行一段逻辑来响应系统给定的事件。</p>
<p>SwiftUI 的视图，本身没有清晰（可适当描述）的生命周期，它们是值、是声明。SwiftUI 提供了几个修改器（modifier）来实现类似 UIKit 中钩子方法的行为。比如 <code>onAppear</code> 同 <code>viewWillAppear</code> 的表现很类似。同 UIKit 的钩子方法的位置有很大的不同，<code>onAppear</code> 和 <code>onDisappear</code> 是在当前视图的父视图上声明的。</p>
<p>将 UIKit 视图包装成 SwiftUI 的视图时，我们需要了解两者生命周期之间的不同，不要强行试图找到完全对应的方法，要从 SwiftUI 的角度来思考如何调用 UIKit 视图。</p>
<h3 id="uiviewrepresentable-协议">UIViewRepresentable 协议</h3>
<p>在 SwiftUI 中包装 UIView 非常简单，只需要创建一个遵守 <code>UIViewRepresentable</code> 协议的结构体就行了。</p>
<blockquote>
<p><code>UIViewControllerRepresentable</code> 对应 <code>UIViewController</code>，<code>NSViewRepresentable</code> 对应 <code>NSView</code>，<code>NSViewControllerRepresentable</code> 对应 <code>NSViewController</code>。内部的结构和实现逻辑都一致。</p>
</blockquote>
<p><code>UIViewrepresentable</code> 的协议并不复杂，只包含：<code>makeUIView</code>、<code>updateUIView</code>、<code>dismantleUIView</code> 和 <code>makeCoordinator</code> 四个方法。<code>makeUIView</code> 和 <code>updateUIView</code> 为必须提供实现的方法。</p>
<p><code>UIViewRepresentable</code> 本身遵守 <code>View</code> 协议，因此 SwiftUI 会将任何符合该协议的结构体都当作一般的 SwiftUI 视图来对待。不过由于 <code>UIViewRepresentable</code> 的特殊的用途，其内部的生命周期又同标准的 SwiftUI 视图有所不同。</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png" alt="UIViewRepresentableLifeCycle" loading="lazy" decoding="async"/>
                  </picture></p>
<ul>
<li>
<p>makeCoordinator</p>
<p>如果我们声明了 Coordinator（协调器）, <code>UIViewRepresentable</code> 视图会在初始化后首先创建它的实例，以便在其他的方法中调用。Coordinator 默认为 <code>Void</code>，该方法在 <code>UIViewRepresentable</code> 的生命周期中只会调用一次，因此只会创建一个协调器实例。</p>
</li>
<li>
<p>makeUIView</p>
<p>创建一个用来包装的 UIKit 视图实例。该方法在 <code>UIViewRepresentable</code> 的生命周期中只会调用一次。</p>
</li>
<li>
<p>updateUIView</p>
<p>SwiftUI 会在应用程序的状态（State）发生变化时更新受这些变化影响的界面部分。当 <code>UIViewRepresentable</code> 视图中的注入依赖发生变化时，SwiftUI 会调用 <code>updateUIView</code>。其调用时机同标准 SwiftUI 视图的 <code>body</code> 一致，最大的不同为，调用 <code>body</code> 为计算值，而调用 <code>updateview</code> 仅为通知 <code>UIViewRepresentable</code> 视图依赖有变化，至于是否需要根据这些变化来做反应，则由开发者来自行处理。</p>
<p>该方法在 <code>UIViewRepresentable</code> 的生命周期中会多次调用，直到视图被移出视图树（更准确地描述是切换到另一个不包含该视图的视图树分支）。</p>
<p><strong>在 makeUIVIew 执行后，updateUIVew 必然会执行一次</strong></p>
</li>
<li>
<p>dismantleUIView</p>
<p>在 <code>UIViewRepresentable</code> 视图被移出视图树之前，SwiftUI 会调用 <code>dismantleUIView</code>，通常在此方法中可以执行删除观察器等善后操作。<code>dismantleUIView</code> 为类型方法。</p>
</li>
<li>
<p>sizeThatFits</p>
<p>返回视图的需求尺寸（ Required Size ）。从 iOS 16 后，<code>UIViewRepresentable</code> 增加了与 Layout 协议逻辑一致的 <code>sizeThatFits</code> 方法。</p>
</li>
</ul>
<p>下面的代码将创建一个同 ProgressView 一样的转圈菊花：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MyProgrssView</span><span style="color:#F8F8F2">: UIViewRepresentable {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> makeUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> UIActivityIndicatorView {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> view </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UIActivityIndicatorView</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        view.</span><span style="color:#8BE9FD">startAnimating</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> view</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> updateUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> uiView</span><span style="color:#F8F8F2">: UIActivityIndicatorView, </span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) {}</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> Demo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">            MyProgrssView</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="黑匣子">黑匣子</h3>
<p>SwiftUI 在绘制屏幕时，会从视图树的顶端开始对视图的 <code>body</code> 求值，如果其中还包含子视图则将递归求值，直到获得最终的结果。但 SwiftUI 无法真正进行无限量的调用来绘制视图，因此它必须以某种方式缩短递归。为了结束递归，SwiftUI 包含了很多的原始类型（primitive types）。当 SwiftUI 递归到这些原始类型时，将结束递归，它将不再关心原始类型的 <code>body</code>，而让原始类型自行对其管理的区域进行处理。</p>
<p>SwiftUI 框架通过将 <code>body</code> 定义为 <code>Never</code> 来标记该 <code>View</code> 为原始类型。<code>UIViewRepresentable</code> 恰巧也为其中之一（<code>Text</code>、<code>ZStack</code>、<code>Color</code>、<code>List</code> 等也都是所谓的原始类型）。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> protocol</span><span style="color:#8BE9FD;font-style:italic"> UIViewRepresentable</span><span style="color:#F8F8F2"> : View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> Self.Body == Never</span></span></code></pre></div>
<p>事实上几乎所有的原始类型都是对 UIKit 或 AppKit 的底层包装。</p>
<p><code>UIViewRepresentable</code> 作为原始类型，SwiftUI 对其内部所知甚少（因为无需关心）。通常需要开发者在 <code>UIViewRepresentable</code> 视图的 Coordinator（协调器）中做一些的工作，从而保证两个框架（SwiftUI 同 UIKit）代码之间的沟通和联系。</p>
<h3 id="协调器">协调器</h3>
<p>苹果框架很喜欢使用协调器（Coordinator）这个名词，UIKit 开发中有协调器设计模式、Core Data 中有持久化存储协调器。在 <code>UIViewRepresentable</code> 中协调器同它们的概念完全不同，主要起到以下几个方面的作用：</p>
<ul>
<li>
<p>实现 UIKit 视图的代理</p>
<p>UIKit 组件通常依赖代理（delegate）来实现一些功能，“代理”是响应其他地方发生的事件的对象。例如，UIKit 中我们将一个代理对象附加到 <code>Text field</code> 视图上，当用户输入时，当用户按下 <code>return</code> 键时，该代理对象中对应的方法将被调用。通过将协调器声明为 UIKit 视图对应的代理对象，我们就可以在其中实现所需的代理方法。</p>
</li>
<li>
<p>同 SwiftUI 框架保持沟通</p>
<p>上文中，我们提到 <code>UIViewRepresentable</code> 作为原始类型，需要主动承担更多的同 SwiftUI 框架或其他视图之间的沟通工作。在协调器中，我们可以通过双向绑定（<code>Binding</code>），通知中心（<code>notificationCenter</code>）或其他例如 <code>Redux</code> 模式的单项数据流等方式，将 UIKit 视图内部的状态报告给 SwiftUI 框架或其他需要的模块。同样也可以通过注册观察器、订阅 Publisher 等方式获取所需的信息。</p>
</li>
<li>
<p>处理 UIKit 视图中的复杂逻辑</p>
<p>在 UIKit 开发中，通常会将业务逻辑放置在 UIViewController 中，SwiftUI 没有 Controller 这个概念，视图仅是状态的呈现。对于一些实现复杂功能的 UIKit 模组，如果完全按照 SwiftUI 的模式将其业务逻辑彻底剥离是非常困难的。因此将无法剥离的业务逻辑的实现代码放入协调器中，靠近代理方法，便于相互之间的协调和管理。</p>
</li>
</ul>
<h2 id="包装-uitextfield">包装 UITextField</h2>
<p>本节中我们将利用上面的知识实现一个具有简单功能的 <code>UITextField</code> 包装视图—— <code>TextFieldWrapper</code>。</p>
<h3 id="版本-10">版本 1.0</h3>
<p>在第一个版本中，我们要实现一个类似如下原生代码的功能：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">TextField</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">,</span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">:$name)</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20210822184949860-9629391.png" alt="image-20210822184949860" loading="lazy" decoding="async"/>
                  </picture></p>
<p>查看 <a href="https://gist.github.com/733f3c8ef4c69a1e4ed4bd81bf4750e3.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<p>我们在 <code>makeUIView</code> 中创建了 <code>UITextField</code> 的实例，并对其 placeholder 和 text 进行了设定。在右侧的预览中，我们可以看到 placeholder 可以正常显示，如果你在其中输入文字，表现的状态也同 <code>TextField</code> 完全一致。</p>
<p>通过 <code>.border</code>，我们看到 TextFieldWrapper 的视图尺寸没有符合预期，这是由于 UITextField 在不进行约束的情况下会默认占据全部可用空间。上文关于 <code>UIActivityIndicatorView</code> 的演示代码并没有出现这个情况。因此对于不同的 UIKit 组件，我们需要了解其默认设置，酌情对其进行约束设定。</p>
<p>在 <code>makeUIView</code> 中添加如下语句，此时文本输入框的尺寸就和预期一致了：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">        textfield.</span><span style="color:#8BE9FD">setContentHuggingPriority</span><span style="color:#F8F8F2">(.defaultHigh, </span><span style="color:#8BE9FD">for</span><span style="color:#F8F8F2">: .vertical)</span></span>
<span class="line"><span style="color:#F8F8F2">        textfield.</span><span style="color:#8BE9FD">setContentCompressionResistancePriority</span><span style="color:#F8F8F2">(.defaultLow, </span><span style="color:#8BE9FD">for</span><span style="color:#F8F8F2">: .horizontal)</span></span></code></pre></div>
<p>稍微调整一下 <code>Demo</code> 视图，在 <code>.padding()</code> 下添加 <code>Text(&quot;name:\(name)&quot;)</code>。如果按照 <code>TextField</code> 的正常行为，当我们在其中输入任何文本时，下方的 <code>Text</code> 中应该显示出对应的内容，不过在我们当前的代码版本中，并没有表现出预期的行为。</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20210822190605447-9630366.png" alt="image-20210822190605447" loading="lazy" decoding="async"/>
                  </picture></p>
<p>让我们再次来分析一下代码。</p>
<p>尽管我们声明了一个 <code>Binding&lt;String&gt;</code> 类型的 <code>text</code>，并且在 <code>makeUIView</code> 中将其赋值给了 <code>textfield</code>，不过 <code>UITextField</code> 并不会将我们录入的内容自动回传给 <code>Binding&lt;String&gt;</code> 的 <code>text</code>，这导致 <code>Demo</code> 视图中的 <code>name</code> 并不会因为文字录入而发生改变。</p>
<p><code>UITextfield</code> 在每次录入文字时，都会自动调用 <code>func textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -&gt; Bool</code> 的代理方法。因此我们需要创建协调器，并在协调器中实现该方法，将录入的内容传递给 <code>Demo</code> 视图中的 <code>name</code> 变量。</p>
<p>创建协调器：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> TextFieldWrapper</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    class</span><span style="color:#8BE9FD"> Coordinator</span><span style="color:#F8F8F2">:NSObject,UITextFieldDelegate{</span></span>
<span class="line"><span style="color:#FF79C6">        @Binding</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> text:</span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">        init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">text</span><span style="color:#F8F8F2">:Binding&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;){</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">._text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> text</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> textField</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> textField</span><span style="color:#F8F8F2">: UITextField, </span><span style="color:#50FA7B">shouldChangeCharactersIn</span><span style="color:#FFB86C;font-style:italic"> range</span><span style="color:#F8F8F2">: NSRange, </span><span style="color:#50FA7B">replacementString</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> textField.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> as</span><span style="color:#F8F8F2"> NSString</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> finaltext </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> text.</span><span style="color:#8BE9FD">replacingCharacters</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: range, </span><span style="color:#8BE9FD">with</span><span style="color:#F8F8F2">: string)</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                self</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> finaltext </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> String</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>我们需要在 <code>textField</code> 方法中回传数据，因此在 <code>Coordinator</code> 中同样需要使用到 <code>Binding&lt;String&gt;</code>，如此对 <code>text</code> 的操作即为对 <code>Demo</code> 视图中 <code>name</code> 的操作。</p>
<p>如果 <code>UIViewRepresentable</code> 视图中的 <code>Coordinator</code> 不为 <code>Void</code>，则必须通过 <code>makeCoordinator</code> 来创建它的实例。在 <code>TextFieldWrapper</code> 中添加如下代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> makeCoordinator</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Coordinator {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">: $text)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre></div>
<p>最后在 <code>makeUIView</code> 中添加：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">    textfield.delegate </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> context.coordinator</span></span></code></pre></div>
<p>UITextField 在发生特定事件后将在协调器中查找并调用对应的代理方法。</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20210822191834883-9631115.png" alt="image-20210822191834883" loading="lazy" decoding="async"/>
                  </picture></p>
<p>查看 <a href="https://gist.github.com/cb34b4f96525ac49193a36cd1d5fc135.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<p>至此，我们创建的 <code>UITextField</code> 包装已经同原生的 <code>TextField</code> 的表现行为一致了。</p>
<p><strong>你确定？</strong></p>
<p>再度修改一下 <code>Demo</code> 视图，将其修改为：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> Demo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            TextFieldWrapper</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">: $name)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">padding</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">            Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Random Name</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">){</span></span>
<span class="line"><span style="color:#F8F8F2">                name </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">random</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#FF79C6">...</span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>按照对原生 <code>TextField</code> 的表现预期，当我们按下 <code>Random Name</code> 按钮时，<code>Text</code> 同 <code>TextFieldWrapper</code> 中的文字都应该变成由 <code>String(Int.random(in: 0...100))</code> 产生的随机数字，但是如果你使用上述代码进行测试，<code>TextFieldWrapper</code> 中的文字并没有变化。</p>
<p>在 <code>makeUIView</code> 中，我们使用 <code>textfield.text = text</code> 获取了 <code>Demo</code> 视图中 <code>name</code> 的值，但 <code>makeUIView</code> 只会执行一次。当点击 <code>Random Name</code> 引起 <code>name</code> 变化时，SwiftUI 将会调用 <code>updateUIView</code>，而我们并没有在其中做任何的处理。只需要在 <code>updateUIVIew</code> 中添加如下代码即可：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> updateUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> uiView</span><span style="color:#F8F8F2">: UIViewType, </span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) {</span></span>
<span class="line"><span style="color:#F8F8F2">        DispatchQueue.main.async {</span></span>
<span class="line"><span style="color:#F8F8F2">            uiView.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> text</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre></div>
<blockquote>
<p><code>makeUIView</code> 方法的参数中有一个 <code>context: Context</code>，通过这个上下文，我们可以访问到 <code>Coordinator</code>（自定义协调器）、<code>transaction</code>（如何处理状态更新，动画模式）以及 <code>environment</code>（当前视图的环境值集合）。我们之后将通过实例演示其用法。该 <code>context</code> 同样可以在 <code>updateUIVIew</code> 和 <code>dismantleUIView</code> 中访问。<code>updataUIView</code> 的参数 <code>_ uiView:UIViewType</code> 为我们在 <code>makeUIVIew</code> 中创建的 UIKit 视图实例。</p>
</blockquote>
<p>查看 <a href="https://gist.github.com/69fb1ff4462192ed318048166aeb9eaf.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<p>现在，我们的 <code>TextFieldWrapper</code> 的表现已经确实同 <code>TextField</code> 一致了。</p>
<p><img src="https://cdn.fatbobman.com/textFieldWrappertest-9634034.gif" alt="textFieldWrappertest"/></p>
<h3 id="版本-20添加设定">版本 2.0——添加设定</h3>
<p>在第一个版本的基础上，我们将为 <code>TextFieldWrapper</code> 添加 <code>color</code>、<code>font</code>、<code>clearButtonMode</code>、<code>onCommit</code> 以及 <code>onEditingChanged</code> 的配置设定。</p>
<blockquote>
<p>考虑到尽量不将例程复杂化，我们使用 <code>UIColor</code>、<code>UIFont</code> 作为配置类型。将 SwiftUI 的 <code>Color</code> 和 <code>Font</code> 转换成 UIKit 版本将增加不小的代码量。</p>
</blockquote>
<p><code>color</code>、<code>font</code> 以及我们新增加的 <code>clearButtonMode</code> 并不需要双向数据流，因此无需采用 <code>Binding</code> 方式，仅需在 <code>updateView</code> 中及时响应它们的变化既可。</p>
<p><code>onCommit</code> 和 <code>onEditingChanged</code> 分别对应着 UITextField 代理的 <code>textFieldShouldReturn</code>、<code>textFieldDidBeginEditing</code> 以及 <code>textFieldDidEndEditing</code> 方法，我们需要在协调器中分别实现这些方法，并调用对应的 <code>Block</code>。</p>
<p>首先修改协调器：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> TextFieldWrapper</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    class</span><span style="color:#8BE9FD"> Coordinator</span><span style="color:#F8F8F2">: NSObject, UITextFieldDelegate {</span></span>
<span class="line"><span style="color:#FF79C6">        @Binding</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> text: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> onCommit: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> onEditingChanged: (</span><span style="color:#8BE9FD;font-style:italic">Bool</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">        init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">text</span><span style="color:#F8F8F2">: Binding&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">             onCommit</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">             onEditingChanged</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD;font-style:italic">Bool</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">._text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> text</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">.onCommit </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onCommit</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">.onEditingChanged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onEditingChanged</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> textField</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> textField</span><span style="color:#F8F8F2">: UITextField, </span><span style="color:#50FA7B">shouldChangeCharactersIn</span><span style="color:#FFB86C;font-style:italic"> range</span><span style="color:#F8F8F2">: NSRange, </span><span style="color:#50FA7B">replacementString</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> textField.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> as</span><span style="color:#F8F8F2"> NSString</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> finaltext </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> text.</span><span style="color:#8BE9FD">replacingCharacters</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: range, </span><span style="color:#8BE9FD">with</span><span style="color:#F8F8F2">: string)</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                self</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> finaltext </span><span style="color:#FF79C6">as</span><span style="color:#8BE9FD;font-style:italic"> String</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> textFieldShouldReturn</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> textField</span><span style="color:#F8F8F2">: UITextField) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Bool</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">            onCommit</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> textFieldDidBeginEditing</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> textField</span><span style="color:#F8F8F2">: UITextField) {</span></span>
<span class="line"><span style="color:#8BE9FD">            onEditingChanged</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> textFieldDidEndEditing</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> textField</span><span style="color:#F8F8F2">: UITextField, </span><span style="color:#50FA7B;font-style:italic">reason</span><span style="color:#F8F8F2">: UITextField.DidEndEditingReason) {</span></span>
<span class="line"><span style="color:#8BE9FD">            onEditingChanged</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">false</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>对 <code>TextFieldWrapper</code> 进行修改：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TextFieldWrapper</span><span style="color:#F8F8F2">: UIViewRepresentable {</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> placeholder</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         text</span><span style="color:#F8F8F2">: Binding&lt;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">&gt;,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         color</span><span style="color:#F8F8F2">: UIColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .label,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         font</span><span style="color:#F8F8F2">: UIFont </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .</span><span style="color:#8BE9FD">preferredFont</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">forTextStyle</span><span style="color:#F8F8F2">: .body),</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         clearButtonMode</span><span style="color:#F8F8F2">:UITextField.ViewMode </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .whileEditing,</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         onCommit</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> {},</span></span>
<span class="line"><span style="color:#50FA7B;font-style:italic">         onEditingChanged</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD;font-style:italic">Bool</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.placeholder </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> placeholder</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">._text </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> text</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">color</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.font </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> font</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.clearButtonMode </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> clearButtonMode</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.onCommit </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onCommit</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.onEditingChanged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onEditingChanged</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> placeholder: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    @Binding</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> text: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> color: UIColor</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> font: UIFont</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> clearButtonMode: UITextField.ViewMode</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> onCommit: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> onEditingChanged: (</span><span style="color:#8BE9FD;font-style:italic">Bool</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    typealias</span><span style="color:#8BE9FD;font-style:italic"> UIViewType</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> UITextField</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> makeUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> UIViewType {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> textfield </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> UITextField</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        textfield.</span><span style="color:#8BE9FD">setContentHuggingPriority</span><span style="color:#F8F8F2">(.defaultHigh, </span><span style="color:#8BE9FD">for</span><span style="color:#F8F8F2">: .vertical)</span></span>
<span class="line"><span style="color:#F8F8F2">        textfield.</span><span style="color:#8BE9FD">setContentCompressionResistancePriority</span><span style="color:#F8F8F2">(.defaultLow, </span><span style="color:#8BE9FD">for</span><span style="color:#F8F8F2">: .horizontal)</span></span>
<span class="line"><span style="color:#F8F8F2">        textfield.placeholder </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> placeholder</span></span>
<span class="line"><span style="color:#F8F8F2">        textfield.delegate </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> context.coordinator</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> textfield</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> updateUIView</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> uiView</span><span style="color:#F8F8F2">: UIViewType, </span><span style="color:#50FA7B;font-style:italic">context</span><span style="color:#F8F8F2">: Context) {</span></span>
<span class="line"><span style="color:#F8F8F2">        DispatchQueue.main.async {</span></span>
<span class="line"><span style="color:#F8F8F2">            uiView.</span><span style="color:#BD93F9">text</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> text</span></span>
<span class="line"><span style="color:#F8F8F2">            uiView.textColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#F8F8F2">            uiView.font </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> font</span></span>
<span class="line"><span style="color:#F8F8F2">            uiView.clearButtonMode </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> clearButtonMode</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> makeCoordinator</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Coordinator {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">: $text,</span><span style="color:#8BE9FD">onCommit</span><span style="color:#F8F8F2">: onCommit,</span><span style="color:#8BE9FD">onEditingChanged</span><span style="color:#F8F8F2">: onEditingChanged)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>修改 <code>Demo</code> 视图：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> Demo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> color: UIColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .red</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            TextFieldWrapper</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">                             text</span><span style="color:#F8F8F2">: $name,</span></span>
<span class="line"><span style="color:#8BE9FD">                             color</span><span style="color:#F8F8F2">: color,</span></span>
<span class="line"><span style="color:#8BE9FD">                             font</span><span style="color:#F8F8F2">: .</span><span style="color:#8BE9FD">preferredFont</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">forTextStyle</span><span style="color:#F8F8F2">: .title1),</span></span>
<span class="line"><span style="color:#8BE9FD">                             clearButtonMode</span><span style="color:#F8F8F2">: .whileEditing,</span></span>
<span class="line"><span style="color:#8BE9FD">                             onCommit</span><span style="color:#F8F8F2">: { </span><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">return</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) },</span></span>
<span class="line"><span style="color:#8BE9FD">                             onEditingChanged</span><span style="color:#F8F8F2">: { editing </span><span style="color:#FF79C6">in</span><span style="color:#8BE9FD"> print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">isEditing </span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">editing</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) })</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">padding</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">            Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Random Name</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">                name </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">random</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#FF79C6">...</span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#8BE9FD">            Button</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Change Color</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">                color </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color </span><span style="color:#FF79C6">==</span><span style="color:#F8F8F2"> .red </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> .label </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> .red</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> TextFieldWrapperPreview</span><span style="color:#F8F8F2">: PreviewProvider {</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> previews: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Demo</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>查看 <a href="https://gist.github.com/5604d7bee11a44c2cbdcba12cfe1eda0.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<p><img src="https://cdn.fatbobman.com/textfieldwrapperdemo2-9639150-9639151.gif" alt="textfieldwrapperdemo2"/></p>
<h2 id="swiftui-风格化">SwiftUI 风格化</h2>
<p>我们不仅实现了对字体、色彩的设定，而且增加了原生 <code>TextField</code> 没有的 <code>clearButtonMode</code> 设置。按照上述的方法，可以逐步为其添加更多的设置，让 <code>TextFieldWrapper</code> 获得更多的功能。</p>
<p><strong>代码好像有点不太对劲？！</strong></p>
<p>随着功能配置的增加，上面代码在使用中会愈发的不方便。如何实现类似原生 <code>TextFiled</code> 的链式调用呢？譬如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">        TextFieldWrapper</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">,</span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">:$name)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">clearMode</span><span style="color:#F8F8F2">(.whileEditing)</span></span>
<span class="line"><span style="color:#F8F8F2">            .onCommit{</span><span style="color:#8BE9FD">print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">commit</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)}</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">foregroundColor</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">font</span><span style="color:#F8F8F2">(.title)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">disabled</span><span style="color:#F8F8F2">(allowEdit)</span></span>
<span class="line"></span></code></pre></div>
<p>本节中，我们将重写配置代码，实现 UIKit 包装风格 SwiftUI 化。</p>
<blockquote>
<p>本节以版本 1.0 结束时的代码为基础。</p>
</blockquote>
<p>所谓的 SwfitUI 风格化，更确切地说应该是函数式编程的链式调用。将多个操作通过点号（.）链接在一起，增加可读性。作为将函数视为一等公民的 Swift，实现上述的链式调用非常方便。不过有以下几点需要注意：</p>
<ul>
<li>如何改变 View 内的的值（View 是结构）</li>
<li>如何处理返回的类型（保证调用链继续有效）</li>
<li>如何利用 SwiftUI 框架现有的数据并与之交互逻辑</li>
</ul>
<blockquote>
<p>为了更全面的演示，下面的例子，采用了不同的处理方式。在实际使用中，可根据实际需求选择适当的方案。</p>
</blockquote>
<h3 id="foregroundcolor">foregroundColor</h3>
<p>我们在 SwiftUI 中经常会用到 <code>foregroundColor</code> 来设置前景色，比如下面的代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">            VStack{</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">foregroundColor</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">foregroundColor</span><span style="color:#F8F8F2">(.blue)</span></span></code></pre></div>
<p>不知道大家是否知道上面的两个 <code>foregroundColor</code> 有什么不同。</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> Text</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> foregroundColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> foregroundColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>方法名一样，但作用的对象不同。<code>Text</code> 只有在针对本身的 <code>foregroundColor</code> 没有设置的时候，才会尝试从当前环境中获取 <code>foregroundColor</code>（针对 View）的设定。原生的 <code>TextFiled</code> 没有针对本身的 <code>foregroundColor</code>，不过我们目前也没有办法获取到 SwiftUI 针对 View 的 <code>foregroundColor</code> 设定的环境值（估计是），因此我们可以使用 <code>Text</code> 的方式，为 <code>TextFieldWrapper</code> 创建一个专属的 <code>foregroundColor</code>。</p>
<p>为 <code>TextFieldWrapper</code> 添加一个变量</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> color:UIColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .label</span></span></code></pre></div>
<p>在 <code>updateUIView</code> 中增加</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">uiView.textColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span></code></pre></div>
<p>设置配置方法：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> TextFieldWrapper</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> foregroundColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">:UIColor) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> view </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#F8F8F2">        view.</span><span style="color:#BD93F9">color</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> view</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>查看 <a href="https://gist.github.com/56f426b29a551c6490062f6daf3e342a.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<p>就这么简单。现在我们就可以使用 <code>.foreground(.red)</code> 来设置 <code>TextFieldWrapper</code> 的文字颜色了。</p>
<p>这种写法是为特定视图类型添加扩展的常用写法。有以下两个优点：</p>
<ul>
<li>使用 <code>private</code>，无需暴露配置变量</li>
<li>仍返回特定类型的视图，有利于维持链式稳定</li>
</ul>
<p>我们几乎可以使用这种方式完成全部的链式扩展。如果扩展较多时，可以采用下面的方式，进一步清晰、简化代码：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">    extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> then</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> body</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">            var</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#8BE9FD">            body</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">result)</span></span>
<span class="line"><span style="color:#FF79C6">            return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> foregroundColor</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">:UIColor) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">        then{</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">color</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre></div>
<h3 id="disabled">disabled</h3>
<p>SwiftUI 针对 View 预设了非常多的扩展，其中有相当的部分都是通过环境值 <code>EnvironmentValue</code> 来逐级传递的。通过直接响应该环境值的变化，我们可以在不编写特定 <code>TextFieldWrapper</code> 扩展的情况下，即可为其增加配置功能。</p>
<p>例如，<code>View</code> 有一个扩展 <code>.disabled</code>，通常我们会用它来控制交互控件的可操作性（<code>.disable</code> 对应的 <code>EnviromentValue</code> 为 <code>isEnabled</code>）。</p>
<p>在 <code>TextFieldWrapper</code> 中添加：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Environment</span><span style="color:#F8F8F2">(\.isEnabled) </span><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> isEnabled</span></span></code></pre></div>
<p>在 <code>updateUIView</code> 中添加：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">uiView.isEnabled </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> isEnabled</span></span></code></pre></div>
<p>只需要两条语句，<code>TextFieldWrapper</code> 便可以直接使用 <code>View</code> 的 <code>disable</code> 扩展来控制其是否可以录入数据。</p>
<p>还记得上文中介绍的 <code>context</code> 吗？我们可以直接通过 <code>context</code> 获取上下文中的环境值。因此支持原生的 <code>View</code> 扩展将一步简化。</p>
<p><strong>无需</strong>添加 <code>@Environemnt</code>，只需要在 <code>updateUIView</code> 中添加一条语句既可：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">uiView.isEnabled </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> context.environment.isEnabled</span></span></code></pre></div>
<p>查看 <a href="https://gist.github.com/e749322c1add66b2f9b8732c62463c89.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<blockquote>
<p>在写本文时，在 iOS 15 beta 下运行该代码，会出现 <code>AttributeGraph: cycle detected through attribute</code> 的警告，这个应该是 iOS 15 的 Bug，请自行忽略。</p>
</blockquote>
<p>通过环境值来设置是一种十分便捷的方式，唯一需要注意的是，它会改变链式结构的返回值。因此，在该节点后的链式方法只能是针对 <code>View</code> 设置的，像之前我们创建的 <code>foregroundColor</code> 就只能放置在这个节点之前。</p>
<h3 id="font">font</h3>
<p>我们也可以自己创建环境值来实现对 <code>TextFieldWrapper</code> 的配置。比如，SwiftUI 提供的 <code>font</code> 环境值的类型为 <code>Font</code>，本例中我们将创建一个针对 <code>UIFont</code> 的环境值设定。</p>
<p>创建环境值 <code>myFont</code>：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MyFontKey</span><span style="color:#F8F8F2">:EnvironmentKey{</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> defaultValue: UIFont</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> EnvironmentValues</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> myFont:UIFont</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">        get</span><span style="color:#F8F8F2">{</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">[MyFontKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">]}</span></span>
<span class="line"><span style="color:#FF79C6">        set</span><span style="color:#F8F8F2">{</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">[MyFontKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> newValue}</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>在 <code>updateUIVIew</code> 中添加：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">uiView.font </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> context.environment.myFont</span></span></code></pre></div>
<p><code>font</code> 方法可以有多种写法：</p>
<ul>
<li>同 <code>forgroundColor</code> 一样的对 <code>TextFieldWrapper</code> 进行扩展</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> font</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> font</span><span style="color:#F8F8F2">:UIFont) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View{</span></span>
<span class="line"><span style="color:#8BE9FD">        environment</span><span style="color:#F8F8F2">(\.myFont, font)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span></code></pre></div>
<ul>
<li>对 <code>View</code> 进行扩展</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> font</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> font</span><span style="color:#F8F8F2">:UIFont</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View{</span></span>
<span class="line"><span style="color:#8BE9FD">        environment</span><span style="color:#F8F8F2">(\.myFont, font)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>两种方式的链式节点的返回值都不再是 <code>TextFieldWrapper</code>，后面应该接针对 <code>View</code> 的扩展。</p>
<p>查看 <a href="https://gist.github.com/c9602681774540dbca929e21c99827c7.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<h3 id="oncommit">onCommit</h3>
<p>在版本 2 的代码中，我们为 <code>TextFieldWrapper</code> 添加了 <code>onCommit</code> 设置，在用户输入 <code>return</code> 时会触发该段代码。本例中，我们将为 <code>onCommit</code> 添加一个可修改版本，且不需要通过协调器构造函数传递。</p>
<p>本例中的技巧在之前都出现过，唯一需要提醒的是在 <code>updateUIView</code> 中，可以通过</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">context.coordinator.onCommit </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onCommit</span></span>
<span class="line"><span style="color:#F8F8F2">context.coordinator.onEditingChanged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> onEditingChanged</span></span></code></pre></div>
<p>改变协调器内的变量。这是一种非常有效的在 SwiftUI 和协调器之间进行沟通的手段。</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20210823091321562.png" alt="image-20210823091321562" loading="lazy" decoding="async"/>
                  </picture></p>
<p>查看 <a href="https://gist.github.com/716b08616fa6ecbd28589ac94b635706.git?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">源代码</a></p>
<h2 id="避免滥用-uikit-包装">避免滥用 UIKit 包装</h2>
<p>尽管在 SwiftUI 中使用 UIKit 或 AppKit 并不麻烦，但是当你打算包装一个 UIKit 控件时（尤其是已有 SwiftUI 官方原生解决方案），请务必三思。</p>
<p>苹果对 SwiftUI 的野心非常大，不仅为开发者带来了声明+响应式的编程体验，同时苹果对 SwiftUI 在跨设备、跨平台上（苹果生态）也做出了巨大的投入了。</p>
<p>苹果为每一个原生控件（比如 <code>TextField</code>），针对不同的平台（iOS、macOS、tvOS、watchOS）做了大量的优化。这是其他任何人都很难自己完成的。因此，在你打算为了某个特定功能重新包装一个系统控件时，请先考虑以下几点。</p>
<h3 id="官方的原生方案">官方的原生方案</h3>
<p>SwiftUI 这几年发展的很快，每个版本都增加了不少新功能，或许你需要的功能已经被添加。苹果最近两年对 SwiftUI 的文档支持提高了不少，但还没到令人满意的地步。作为 SwiftUI 的开发者，我推荐大家最好购买一份 javier 开发的 <a href="https://swiftui-lab.com/companion/?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">A Companion for SwiftUI</a>。该 app 提供了远比官方丰富、清晰的 SwiftUI API 指南。使用该 app 你会发现原来 SwiftUI 提供了如此多的功能。</p>
<h3 id="用原生方法组合解决">用原生方法组合解决</h3>
<p>在 SwiftUI 3.0 版本之前，SwiftUI 并不提供 <code>searchbar</code>，此时会出现两种路线，一种是自己包装一个 UIKit 的 <code>UISearchbar</code>，另外就是通过使用 SwiftUI 的原生方法来组合一个 <code>searchbar</code>。在多数情况下，两种方式都能取得满意的效果。不过用原生方法创建的 <code>searchbar</code> 在构图上更灵活，同时支持使用 <code>LocalizedString</code> 作为 placeholder。我个人会更倾向于使用组合的方案。</p>
<blockquote>
<p>SwiftUI 中很多数据类型官方并不提供转换到其他框架类型的方案。比如 <code>Color</code>、<code>Font</code>。不过这两个多写点代码还是可以转换的。<code>LocalizedString</code> 目前只能通过非正常的手段来转换（使用 <code>Mirror</code>）, 很难保证可以长久使用该转换方式。</p>
</blockquote>
<h3 id="introspect-for-swiftui">Introspect for SwiftUI</h3>
<p>在版本 2 代码中，我们为 <code>TextFieldWrapper</code> 添加了 <code>clearButtonMode</code> 的设置，也是我们唯一增加的目前 <code>TextField</code> 尚不支持的设定。不过，如果我们仅仅是为了添加这个功能就自己包装 <code>UITextField</code> 那就大错特错了。</p>
<p><a href="https://github.com/siteline/SwiftUI-Introspect?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Introspect</a> 通过自省的方法来尝试查找原生控件背后包装的 UIKit（或 AppKit）组件。目前官方尚未在 SwiftUI 中开放的功能多数可以通过此扩展库提供的方法来解决。</p>
<p>比如：下面的代码将为原生的 <code>TextField</code> 添加 <code>clearButtonMode</code> 设置</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">        import</span><span style="color:#8BE9FD;font-style:italic"> Introspect</span></span>
<span class="line"><span style="color:#FF79C6">        extension</span><span style="color:#8BE9FD;font-style:italic"> TextField</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">            func</span><span style="color:#50FA7B"> clearButtonMode</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> mode</span><span style="color:#F8F8F2">:UITextField.ViewMode) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View{</span></span>
<span class="line"><span style="color:#F8F8F2">                introspectTextField{ tf </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                    tf.clearButtonMode </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> mode</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">        TextField</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">name:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">,</span><span style="color:#8BE9FD">text</span><span style="color:#F8F8F2">:$name)</span></span>
<span class="line"><span style="color:#F8F8F2">           .</span><span style="color:#8BE9FD">clearButtonMode</span><span style="color:#F8F8F2">(.whileEditing)</span></span></code></pre></div>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="总结">总结</h2>
<p>SwiftUI 与 UIKit 和 AppKit 之间的互操作性为开发者提供了强大的灵活性。学会使用很容易，但想用好确实有一定的难度。在 UIKit 视图和 SwiftUI 视图之间共享可变状态和复杂的交互通常相当复杂，需要我们在这两种框架之间构建各种桥接层。</p>
<p>本文并没有涉及包装具有复杂逻辑代码的协调器同 SwiftUI 或 Redux 模式沟通交互的话题，里面包含的内容过多，或许需要通过另一篇文章来探讨。</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2021-08-23T03:12:00.000Z",
  "datePublished": "2021-08-23T03:12:00.000Z",
  "description": "详解如何在SwiftUI中使用UIKit视图，通过包装UITextField展示SwiftUI风格扩展及注意事项，提升跨框架开发效率。",
  "headline": "在 SwiftUI 中使用 UIKit 视图",
  "image": {
    "@type": "ImageObject"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/uikitinswiftui/"
  },
  "url": "https://fatbobman.com/zh/posts/uikitinswiftui/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <img src="/images/aifadian.svg" alt="" width="18" height="18" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  const adCacheKey = 'dynamicAdCache';

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/swiftuilifecycle/" id="relatedPosts-SwiftUI 视图的生命周期研究"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI 视图的生命周期研究</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/how-swiftui-preview-works/" id="relatedPosts-构建稳定的预览视图 —— SwiftUI 预览的工作原理"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">构建稳定的预览视图 —— SwiftUI 预览的工作原理</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/building-multiple-platforms-swiftui-app/" id="relatedPosts-打造可适配多平台的 SwiftUI 应用"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">打造可适配多平台的 SwiftUI 应用</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/textfield-1/" id="relatedPosts-SwiftUI TextField 进阶 —— 格式与校验"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI TextField 进阶 —— 格式与校验</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-038" id="relatedPosts-Weekly #38 - 更好还是更便宜？"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #38 - 更好还是更便宜？</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/textfield-event-focus-keyboard/" id="relatedPosts-SwiftUI TextField 进阶 —— 事件、焦点、键盘"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI TextField 进阶 —— 事件、焦点、键盘</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="在 SwiftUI 中使用 UIKit 视图" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#基础" class=""> 基础 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#生命周期" class=""> 生命周期 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#uiviewrepresentable-协议" class=""> UIViewRepresentable 协议 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#黑匣子" class=""> 黑匣子 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#协调器" class=""> 协调器 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#包装-uitextfield" class=""> 包装 UITextField </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#版本-10" class=""> 版本 1.0 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#版本-20添加设定" class=""> 版本 2.0——添加设定 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#swiftui-风格化" class=""> SwiftUI 风格化 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#foregroundcolor" class=""> foregroundColor </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#disabled" class=""> disabled </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#font" class=""> font </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#oncommit" class=""> onCommit </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#避免滥用-uikit-包装" class=""> 避免滥用 UIKit 包装 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#官方的原生方案" class=""> 官方的原生方案 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#用原生方法组合解决" class=""> 用原生方法组合解决 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#introspect-for-swiftui" class=""> Introspect for SwiftUI </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#总结" class=""> 总结 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/blogupgrade/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>博客更新记</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/blogupgrade/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/coredatainpreview/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>如何在 Xcode 下预览含有 Core Data 元素的 SwiftUI 视图</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/coredatainpreview/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20UIKit%20%E8%A7%86%E5%9B%BE&#38;url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fuikitinswiftui%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20UIKit%20%E8%A7%86%E5%9B%BE%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fuikitinswiftui%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fuikitinswiftui%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fuikitinswiftui%2F&#38;title=%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20UIKit%20%E8%A7%86%E5%9B%BE%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fuikitinswiftui%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20UIKit%20%E8%A7%86%E5%9B%BE%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0A%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20UIKit%20%E8%A7%86%E5%9B%BE%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fuikitinswiftui%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
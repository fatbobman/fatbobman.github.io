<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>掌握 Core Data 中的关系：基础 | 肘子的 Swift 记事本</title>
<meta name="description" content="深入探讨 Core Data 关系：理解单向/双向、一对一/多关系，逆关系、删除规则及懒加载特性。优化数据管理，提升应用性能。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/mastering-relationships-in-core-data-fundamentals/">
<meta property="og:title" content="掌握 Core Data 中的关系：基础 | 肘子的 Swift 记事本">
<meta property="og:description" content="深入探讨 Core Data 关系：理解单向/双向、一对一/多关系，逆关系、删除规则及懒加载特性。优化数据管理，提升应用性能。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/mastering-relationships-in-core-data-fundamentals/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/mastering-relationships-in-core-data-fundamentals-zh.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/mastering-relationships-in-core-data-fundamentals/">
<link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/mastering-relationships-in-core-data-fundamentals/"><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.D4OYV9iO.css">
<link rel="stylesheet" href="/_astro/_slug_.BRLGXoDU.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-6 sm:pt-6 font-black w-[240px] sm:w-[300px] pb-2 sm:pb-0"> <svg fill="currentColor" class="text-heading" width="500"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/mastering-relationships-in-core-data-fundamentals/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-aifadian"></use> </svg> </div> </a> </li><li> <a href="#" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-aifadian"></use> </svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> <script type="module">function a(){const t=localStorage.getItem("lang"),e=document.getElementById("EN-check"),n=document.getElementById("ZH-check");e!==null&&n!==null&&(t==="en"?(e.classList.remove("hidden"),n.classList.add("hidden")):t==="zh"&&(n.classList.remove("hidden"),e.classList.add("hidden")))}document.addEventListener("DOMContentLoaded",()=>{a()});const l=document.getElementById("set-default-lang");l?.addEventListener("click",()=>{const t=document.getElementById("lang-data");if(t!=null){const e=t.dataset.lang;e!=null&&(localStorage.setItem("lang",e),a())}});</script> </div> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_system"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-computer"></use> </svg> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_dark"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-moon"></use> </svg> <svg viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_light"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-sun"></use> </svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg class="w-5 h-5" viewBox="0 0 1024 1024" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-sun"></use> </svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-moon"></use> </svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-computer"></use> </svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  // 获取按钮
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');
  // 获取图标
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else if (theme === 'light') {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.remove('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  resetTheme();

  // 监听暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    resetTheme();
  });

  // 保证其他的页面也能够监听到 localStorage 的变化
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      resetTheme();
    }
  });


  // Listen for clicks on the button themeToggleDarkIcon
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleLightIcon
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleSystemIcon
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
  });
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header>  <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/Core-Data/">
#Core Data </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/mastering-relationships-in-core-data-fundamentals/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">掌握 Core Data 中的关系：基础</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2024-01-04T00:12:00.000Z">2024 年 1 月 4 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>在众多关于 Core Data 的讨论中，“对象图管理”无疑是一个频繁出现的核心概念。作为一个颇具盛名的对象图管理框架，Core Data 如何精确描述并有效管理不同数据实例之间的复杂关系，成为了它的关键任务。事实上，管理关系的能力不仅构成了 Core Data 的核心特征，也是其相较于其他数据持久化框架的一大显著优势。在本文中，我们将深入探讨 Core Data 中关系的基本概念，同时提供关于实现这些关系的重要指导和建议。</p>
<p>在本文中，我们将深入探讨与关系相关的基础知识。这些概念不仅在 Core Data 中至关重要，同样也适用于其后继框架——SwiftData。</p>
<blockquote>
<p>本文旨在为已具备一定 Core Data 关系知识和实践经验的读者提供进阶理解和应用的视角，并非旨在提供一个全面的教程。</p>
</blockquote>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="关系的定义">关系的定义</h2>
<p>在 Core Data 的世界里，关系是构筑实体（Entity）间相互联系的桥梁，它决定了一个实体如何对另一个实体产生影响。在大多数情况下（抽象实体除外），Core Data 中的每一个实体定义都对应着 SQLite 数据库中的一个表。因此，从底层实现的角度来看，Core Data 中的关系可以被看作是一种在不同表间建立联系和进行操作的机制。</p>
<h2 id="关系的类型">关系的类型</h2>
<p>在 Core Data 的架构中，实体间关系的描述方式多样。从实体间的引用角度出发，这些关系大致分为单向关系和双向关系。</p>
<p>单向关系存在于当一个实体（A）引用另一个实体（B），但 B 不反向引用 A 的情形。尽管在特定场景下，如 A 需要了解 B 的信息而 B 不需要知道 A 的详情时，单向关系可以满足要求，但考虑到数据的完整性和对象图的维护，双向关系往往是更优选择。</p>
<p>双向关系则是指当一个实体（A）引用另一个实体（B），同时 B 也反向引用 A 的情况。这种关系使得 Core Data 能够更有效地管理对象间的联结，并为开发者提供了从多个实体角度调用其他关联实体的更大灵活性。</p>
<p>在这种双向关系框架下，我们进一步可以将关系划分为三种主要类型：</p>
<ol>
<li>一对一（One-to-One）关系:
<ul>
<li>定义: 一个实体（A）中的单个实例与另一个实体（B）中的单个实例相关联。</li>
<li>用途: 适用于两个实体间存在独特且直接的联系时。</li>
<li>示例: 个人（Person）与其护照（Passport）的关系。</li>
</ul>
</li>
<li>一对多（One-to-Many）关系:
<ul>
<li>定义: 一个实体（A）中的单个实例与另一个实体（B）中的多个实例相关联。</li>
<li>用途: 当一个实体能与另一个实体的多个实例建立联系时。</li>
<li>示例: 用户（User）与其发布的多条帖子（Posts）。</li>
</ul>
</li>
<li>多对多（Many-to-Many）关系:
<ul>
<li>定义: 一个实体（A）中的多个实例与另一个实体（B）中的多个实例相互关联。</li>
<li>用途: 适用于两个实体间的实例可以自由组合关联的场景。</li>
<li>示例: 文章（Article）与标签（Tag）之间的关系，其中一篇文章可以拥有多个标签，同时不同的文章也可以使用相同的标签进行标记。</li>
</ul>
</li>
</ol>
<p>在 Core Data 中，构建的关系越多，对象图越丰富，也就越复杂，这对 Core Data 的对象图管理能力构成了挑战。</p>
<h2 id="逆向关系">逆向关系</h2>
<p>在 Core Data 中，当我们建立双向关系后，框架会要求我们为这些关系指定逆向关系（Inverse Relationship）。虽然苹果的官方文档明确要求必须设定逆向关系，但由于在许多情况下，即使未设置逆向关系，应用程序也能正常运行，因此一些开发者对是否真的需要设置逆向关系产生了疑问。</p>
<p>为了更好地理解在 Core Data 中使用逆向关系的必要性，我们需要深入了解逆关系的概念及其作用。尽管我们可能已经在两个实体间使用了双向关系，但如果不设置逆关系，对其中一侧实体的修改可能不会自动反映到另一侧。逆关系是一种数据模型设计概念，它在两个实体间的<strong>关系管理</strong>中起着关键作用。</p>
<p>逆关系的设置带来以下好处：</p>
<ul>
<li>
<p>数据完整性</p>
<p>这是一个常见的疑问点。虽然开发者在未设置逆关系的情况下可能从未遇到数据不一致的问题，但在某些特定情况下，不设置逆关系可能导致预期之外的结果。</p>
<p>考虑这样一个例子：假设 A 和 B 之间存在着一个 <code>One-to-One</code>、非可选的关系，且其删除规则设为 <code>Cascade</code>。同时，B 和 A 之间也是 <code>One-to-One</code>、非可选关系，但删除规则为 <code>Nullify</code>。在未设置逆关系的情况下，直接删除 B 的实例的操作是被允许的，这与预期相悖，因为根据上述设置，删除操作理应只能从 A 端发起。如果设置了逆关系，Core Data 就会从 A 的角度检查是否允许执行删除操作。由于发现 A 与 B 之间是非可选的关联，Core Data 会阻止删除操作，从而确保数据的完整性和一致性得到维护。</p>
<p>逆关系在维护数据完整性方面发挥着关键作用。当你在一个实体中更新关系时，其逆关系会自动进行更新，确保不同实体间的数据保持同步和一致。</p>
</li>
<li>
<p>查询优化</p>
<p>Core Data 根据其所掌握的信息生成 SQL 语句。逆关系的存在可以丰富这些信息，从而优化查询条件和提升查询效率。</p>
</li>
<li>
<p>高效的内存管理</p>
<p>尽管官方文档中没有直接提到逆关系对内存管理的作用，但通过理解 Core Data 中的对象和引用管理原则，我们可以推断出逆关系对内存管理的潜在益处。逆关系简化了引用管理，确保对象根据对象图的当前状态得到适当的保留或释放。</p>
</li>
</ul>
<p>因此，尽管某些开发者可能认为设定逆关系对他们本身看似无关紧要，它实际上为 Core Data 提供了重要的信息，帮助框架更有效地进行对象图管理。</p>
<blockquote>
<p>在 SwiftData 中，对于某些关系类型，即使开发者没有显式设置逆关系，SwiftData 也会自动在数据模型中补充逆关系信息。</p>
</blockquote>
<h2 id="删除规则">删除规则</h2>
<p>在 Core Data 中，删除规则（Delete Rules）起着关键作用，它们定义了在删除一个实体对象时如何处理与该对象关联的其他实体对象。选择合适的删除规则对于维护数据完整性和避免数据库中的悬空引用极为重要。Core Data 提供了四种基本的删除规则：</p>
<ol>
<li>Nullify（置空）:
<ul>
<li>应用此规则时，删除对象会导致所有相关联对象的对应关系属性被置为空。</li>
<li>这种方式相当于“解除关系”，而不是删除关联对象，仅移除双方的连接。</li>
<li>通常适用于关系中的弱侧。例如，在一个主题（Topic）和多个附件（Attachment）的关系中，删除一个附件不会导致主题被删除。</li>
</ul>
</li>
<li>Cascade（级联）:
<ul>
<li>在删除对象时，所有与之关联的对象也会被删除。</li>
<li>适用于强依赖关系，即关联对象在主对象不存在时没有存在意义。</li>
<li>例如，如前文逆关系部分所述，A 作为关系中强侧的一方，采用了 <code>Cascade</code> 规则，这意味着删除 A 也会导致所有与 A 直接相关的 B 实体被删除。</li>
</ul>
</li>
<li>Deny（拒绝）:
<ul>
<li>若关联对象仍存在，则阻止删除操作。</li>
<li>此规则用于确保不会因删除一个对象而产生悬空引用。</li>
<li>例如，家庭成员对象不能独立于家庭存在，那么在家庭中至少存在一个成员的情况下，不允许删除家庭对象。</li>
</ul>
</li>
<li>No Action（无操作）:
<ul>
<li>删除对象时，不对关联对象做任何处理。</li>
<li>可能会造成悬空引用，因此使用时需特别小心。</li>
<li>实质上，这意味着开发者需自行处理相关的删除逻辑，而非由 Core Data 自动管理。</li>
</ul>
</li>
</ol>
<p>在设计数据模型时，选择合适的删除规则至关重要，因为它直接影响数据的完整性和应用的逻辑稳定性。通常情况下，<code>Nullify</code> 和 <code>Cascade</code> 因为能够有效管理关系的生命周期而被广泛使用，而 <code>Deny</code> 和 <code>No Action</code> 则需要在特定场景下谨慎使用。</p>
<h2 id="有序关系">有序关系</h2>
<p>在 Core Data 中，<code>to-Many</code> 关系分为无序和有序两种形式。默认情况下，“对多”关系是无序的（对应 <code>NSSet</code> 类型，保证对象的唯一性，但不保证顺序）。开发者可以通过在数据模型中勾选 <code>ordered</code> 选项来将此关系设置为有序（对应 <code>NSOrderedSet</code> 类型）。</p>
<p>虽然官方文档和大多数第三方文章通常不会详细解释有序关系的底层实现，但通过分析其在 SQLite 中的数据结构，我们可以对其基本逻辑有所了解。</p>
<p>简而言之，对于有序关系的一方，Core Data 会创建一个类似索引的内部属性（字段）。例如，在 Item 和 Tag 之间存在一对多的有序关系时，Core Data 会在 Tag 对应的表中添加一个 <code>Z_FOK_ITEM</code> 字段，并按顺序给它填充数字。为了避免因位置调整而频繁地更新所有索引，Core Data 在相邻两个位置之间预留了一定的数字空间。</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20240102100725036.webp?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20240102100725036.webp?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20240102100725036.webp?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20240102100725036.webp" alt="image-20240102100725036" loading="lazy" decoding="async"/>
                  </picture></p>
<p>有序关系的主要优势在于它提供了一系列方便的预置方法，如 <code>insertIntoTags(_:at:)</code> 和 <code>replaceTags(at:with:)</code> 等。这些方法只适用于操作隐藏的索引属性。然而，在更多的情况下，开发者通常会根据自己的需求创建专门用于排序的属性和相应的顺序处理机制。</p>
<h2 id="关系与批量操作">关系与批量操作</h2>
<p>在 Core Data 中，关系的验证和操作通常是在托管对象上下文（NSManagedObjectContext）中执行的。由于批量操作绕过了上下文处理，因此这些操作往往会忽略数据模型中设置的大多数关系规则（如验证、删除规则等）。然而，在进行批量删除操作时，Core Data 仍会自动处理以下两种情况：</p>
<ul>
<li>
<p>采用 Cascade 删除规则的关系：</p>
<p>例如，假设 Item 实体有一个名为 <code>attachment</code> 的关系（无论是一对一还是一对多），且该关系在 Item 端的删除规则设置为 <code>Cascade</code>。当对 Item 实体进行批量删除操作时，Core Data 会自动删除所有与之关联的 Attachment 实体。</p>
</li>
<li>
<p>删除规则为 Nullify 且关系为可选：</p>
<p>假如 Item 实体有一个名为 <code>attachment</code> 的关系（无论是一对一还是一对多），且该关系在 Item 端的删除规则设置为 Nullify，并且关系被标记为可选（Optional）。在这种情况下，当对 Item 实体进行批量删除操作时，Core Data 会将所有相关 Attachment 实体中的关系 ID（指向 Item）设置为 NULL，但并不会删除这些 Attachment 实体。</p>
</li>
</ul>
<blockquote>
<p>想要深入了解 Core Data 中的批量操作，建议阅读 “<a href="/zh/posts/batchprocessingincoredata/" target="_blank">如何在 Core Data 中进行批量操作</a>” 这篇文章。</p>
</blockquote>
<h2 id="关系的懒加载特性及其应用">关系的懒加载特性及其应用</h2>
<p>在 Core Data 中，托管对象的按需数据填充是一个关键功能。默认情况下，从持久化存储库中检索的托管对象初始状态为“惰性”（Fault），这意味着对象数据不会立即完全加载。只有当真正需要访问该对象的特定属性时，Core Data 才会从行缓冲区或持久化存储中加载完整数据（即转为“实现”状态，Fulfilled）。为了优化性能，开发者可以通过设置 <code>NSFetchRequest</code> 的 <code>returnsObjectsAsFaults</code> 属性为 <code>false</code> 来在初次获取数据时即刻完成数据的加载，从而避免后续的二次 IO 操作。</p>
<p>这种按需加载的机制使得 Core Data 在性能效率和内存占用之间达到了良好的平衡。</p>
<p>然而，即使 <code>returnsObjectsAsFaults</code> 被设置为 <code>false</code>，Core Data 也不会自动加载与当前实例相关的其他关系数据。如果开发者希望在获取特定实体 A 的同时预先加载其相关联的实体 B，可以在 <code>NSFetchRequest</code> 的 <code>relationshipKeyPathsForPrefetching</code> 属性中指定相关关系。例如：</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> request </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> NSFetchRequest</span><span style="color:#AB5959;--shiki-dark:#F286C4">&lt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">Item</span><span style="color:#AB5959;--shiki-dark:#F286C4">&gt;</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">entityName</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Item</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">request.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">relationshipKeyPathsForPrefetching</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> [</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Tag</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">]</span></span></code></pre></div>
<p>正是由于这种懒加载特性，开发者在设计数据模型时会采取一些策略来优化性能和内存使用。例如，对于一个包含图片的 <code>Image</code> 实体，如果通常只需要显示图片的缩略图，可以将完整图片数据放在一个单独的 <code>ImageData</code> 实体中，并通过关系连接。这样，可以充分利用懒加载特性，在需要时才加载完整的图片数据，从而减少内存占用并提高应用的响应速度。</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Image</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> NSManagedObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">  @</span><span style="color:#AB5959;--shiki-dark:#F286C4">NSManaged</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> thumbnail: Data</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">  @</span><span style="color:#AB5959;--shiki-dark:#F286C4">NSManaged</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Post: Post</span><span style="color:#999999;--shiki-dark:#F286C4">?</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">  @</span><span style="color:#AB5959;--shiki-dark:#F286C4">NSManaged</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> data: ImageData</span><span style="color:#999999;--shiki-dark:#F286C4">?</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> ImageData</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> NSMangedObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">  @</span><span style="color:#AB5959;--shiki-dark:#F286C4">NSManged</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> data: Data</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h2 id="关系是如何在-sqlite-中标识的">关系是如何在 SQLite 中标识的</h2>
<p>Core Data 利用了在同一个数据库中仅需依靠 Z_ENT + Z_PK 即可定位记录的特性来实现了在不同的实体之间标注关系的工作。为了节省空间，Core Data 仅保存了每个关系记录的 Z_PK 数据，Z_ENT 则直接由数据模型从 Z_PRIMARYKEY 表中获取。</p>
<p>在数据库中，创建关系的规则如下：</p>
<ul>
<li>
<p>一对多关系：</p>
<p>在“一”的一方不会创建新字段，而在“多”的一方会为关系创建新字段，该字段保存“一”方的 Z_PK 值。字段的名称通常是“Z”加上关系名称（大写形式）。</p>
</li>
<li>
<p>一对一关系：</p>
<p>关系的两端都会添加新字段，各自保存对方数据的 Z_PK 值。</p>
</li>
<li>
<p>多对多关系：</p>
<p>在关系的两端都不添加新字段，而是创建一个新的关联表来表示这种多对多关系。该表中逐行添加关系两端数据的 Z_PK 值。</p>
<p>例如，在下图所示的情况中，Item 和 Tag 之间存在多对多关系，Core Data 为此创建了 Z_2TAGS 表来管理这两个实体之间的关系数据。</p>
</li>
</ul>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20220528162005978.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20220528162005978.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20220528162005978.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20220528162005978.png" alt="relationship" loading="lazy" decoding="async"/>
                  </picture></p>
<blockquote>
<p>想要更深入了解 Core Data 如何在 SQLite 中存储数据，请参阅文章 “<a href="/zh/posts/tables_and_fields_of_coredata/" target="_blank">Core Data 是如何在 SQLite 中保存数据的</a>” 以获取更多底层存储实现的细节。</p>
</blockquote>
<h2 id="在-core-data-with-cloudkit-中的关系设置要求">在 Core Data with CloudKit 中的关系设置要求</h2>
<p>随着 Core Data with CloudKit 的日益普及，越来越多的开发者开始在他们的应用中集成这项技术，以便为用户提供云存储和跨设备数据同步功能。在启用 Core Data with CloudKit 功能时，需要遵循一些特定的关系设置规则：</p>
<ul>
<li>关系必须设为可选（<code>Optional</code>）</li>
<li>必须定义逆向关系</li>
<li>不支持 <code>Deny</code> 的删除规则</li>
<li>不支持有序关系</li>
</ul>
<p>在设计支持 CloudKit 的 Core Data 数据模型时，遵循这些规则非常重要，因为它们直接影响到云数据的同步机制和整个应用的数据完整性。</p>
<blockquote>
<p>欲了解更多关于 Core Data with CloudKit 的细节，请参阅 “<a href="/zh/posts/coredatawithcloudkit-1/" target="_blank">Core Data with CloudKit 系列文章</a>”。</p>
</blockquote>
<h2 id="持久化存储内部的关系限制">持久化存储内部的关系限制</h2>
<p>在 Core Data 的应用中，虽然我们可以通过在模型编辑器中设置多个配置（Configurations），对应于不同的持久化存储描述（NSPersistentStoreDescription），来在不同的持久化存储中保存多种实体配置，但存在一定的限制。</p>
<p>具体而言，关系的创建只能局限于同一个持久化存储或配置内的实体之间。这意味着，关系只能在同一个 SQLite 数据库文件中的不同表间建立。这是由于 Core Data 的底层存储逻辑决定的，它依赖于相同数据库文件内的表之间的关联，以维护数据的完整性和一致性。</p>
<p>因此，当设计涉及多个持久化存储的 Core Data 应用时，需要特别注意这一点，确保所有需要相互关联的实体都位于同一个配置内。</p>
<h2 id="在什么情况下考虑使用关系">在什么情况下考虑使用关系</h2>
<p>在 Core Data 模型中合理地使用关系，对于表示实体间的联系、提高数据操作效率和保证数据完整性都至关重要。以下是在什么情况下考虑使用关系的一些建议：</p>
<ol>
<li><strong>多实体引用同一类型数据</strong>：当某种类型的数据可能被多个实体引用时，应该将其定义为一个单独的实体，并通过关系进行关联。这避免了在多个实体中重复定义相同的属性。</li>
<li><strong>实体间的业务逻辑关联</strong>：当两个或多个实体在业务逻辑上存在关联时，应通过关系来反映这种关联，例如作者与其书籍的关系。</li>
<li><strong>一对多或多对多复杂关系</strong>：在需要表达一对多或多对多的复杂关系时，关系成为模型的一个关键元素。</li>
<li><strong>数据一致性</strong>：通过设置关系的删除规则，可以在删除一个实体时自动处理相关联的数据，保持数据的一致性。</li>
<li><strong>优化查询效率</strong>：建立关系可以提高从一个实体获取关联实体数据的查询效率，并丰富查询手段。</li>
<li><strong>模型的清晰度和可维护性</strong>：关系可以明确地表示模型中的关联，提高整个数据模型的清晰度和可维护性。</li>
<li><strong>优化内存占用</strong>：对于不常用但占用资源较多的数据，可以通过关系的方式进行关联，优化内存使用。</li>
</ol>
<p>总之，在数据模型中存在业务关联、需要表示复杂关系或者要求数据完整性的情况下，应该充分利用 Core Data 的关系特性，使模型更加清晰、高效。这不仅有助于提升应用的性能和健壮性，还能简化开发和维护过程。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="接下来">接下来</h2>
<p>在这篇文章中，我们对 Core Data 中的关系概念进行了基础性的介绍和整理。在下一篇文章中，我们将通过实际的代码示例来讨论在开发过程中运用 Core Data 关系的一些技巧和经验。例如，如何在类型声明中修改关系类型，如何有效地设置和获取关系数据，以及如何在构建查询的谓词时更加巧妙地利用这些关系。这些内容旨在提供更实践的指导，帮助开发者在具体开发实践中更好地应用 Core Data 的关系管理特性。</p> </div> </article> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2024-01-04T00:12:00.000Z",
  "datePublished": "2024-01-04T00:12:00.000Z",
  "description": "深入探讨 Core Data 关系：理解单向/双向、一对一/多关系，逆关系、删除规则及懒加载特性。优化数据管理，提升应用性能。",
  "headline": "掌握 Core Data 中的关系：基础",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/mastering-relationships-in-core-data-fundamentals-zh.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/mastering-relationships-in-core-data-fundamentals/"
  },
  "url": "https://fatbobman.com/zh/posts/mastering-relationships-in-core-data-fundamentals/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed" data-subcribeTest="立刻订阅" data-placeholder="输入邮箱订阅周报" style="opacity: 0; transition: opacity 0.3s; min-height: 58px;"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script type="module" src="/_astro/WeeklySubscribe.astro_astro_type_script_index_0_lang.DQKrZn3Z.js"></script> </div> <div class="pt-6 pb-6  dark:border-gray-700" id="donate-author"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <svg class="w-5 h-5 me-2 -ms-1" fill="none" stroke="none" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-buymecoffee"></use> </svg> <span class="text-black font-bold">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3b82f6] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <svg class="w-4 h-4 me-2 -ms-1" aria-hidden="true" stroke-width="2" stroke="none" fill="#fb923c" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-aifadian"></use> </svg> <span class="text-white font-bold">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script defer>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  // 根据中英文对应不同的 adCacheKey
  const adCacheKey = 'dynamicAdCache' + (window.location.pathname.includes('/zh/') ? 'ZH' : 'EN');

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/mastering-relationships-in-core-data-practical/" id="relatedPosts-掌握 Core Data 中的关系：实战"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">掌握 Core Data 中的关系：实战</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/relationships-in-swiftdata-changes-and-considerations/" id="relatedPosts-SwiftData 中的关系：变化与注意事项"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftData 中的关系：变化与注意事项</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-047/" id="relatedPosts-Weekly #47 - 从驾照体检看社会的发展"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #47 - 从驾照体检看社会的发展</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/masteringofcoredatastack/" id="relatedPosts-掌握 Core Data Stack"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">掌握 Core Data Stack</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/derivedandtransient/" id="relatedPosts-如何在 Core Data 中使用 Derived 和 Transient 属性"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">如何在 Core Data 中使用 Derived 和 Transient 属性</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/spotlight/" id="relatedPosts-在 Spotlight 中展示应用中的 Core Data 数据"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">在 Spotlight 中展示应用中的 Core Data 数据</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/coredatawithcloudkit-2/" id="relatedPosts-Core Data with CloudKit（二） —— 同步本地数据库到 iCloud 私有数据库"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Core Data with CloudKit（二） —— 同步本地数据库到 iCloud 私有数据库</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/tables_and_fields_of_coredata/" id="relatedPosts-Core Data 是如何在 SQLite 中保存数据的"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Core Data 是如何在 SQLite 中保存数据的</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/core-data-of-ask-apple-2022/" id="relatedPosts-Ask Apple 2022 中与 Core Data 有关的问答 (上)"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Ask Apple 2022 中与 Core Data 有关的问答 (上)</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div id="gitalk-container" data-comment-id="Mastering Relationships in Core Data Fundamentals" data-lang="zh" data-repo="blogComments" data-createIssueManually="true"></div>

    <script defer>
      document.addEventListener('DOMContentLoaded', async function () {
        // 提前检查是否需要加载评论
        try {
          const response = await fetch('https://fatbobman.com/status/comment');
          const data = await response.text();
          console.log(data, "comment");

          if (data !== '1') {
            console.log('评论功能未启用，跳过监控和加载操作。');
            return; // 提前返回，跳过后续逻辑
          }
        } catch (error) {
          console.error('检查评论状态时出错：', error);
          return; // 出现错误时也跳过后续逻辑
        }

        // 如果返回值为 "1"，则启动观察器
        const observerTarget = document.getElementById('donate-author');
        if (observerTarget) {
          const observer = new IntersectionObserver(async (entries, observer) => {
            const entry = entries[0];
            if (entry.isIntersecting) {
              console.log("load comment")
              // 停止观察，避免重复触发
              observer.unobserve(observerTarget);

              // 动态加载评论区脚本
              await loadGitalk();
            }
          }, {
            root: null, // 相对于视口
            rootMargin: '20%', // 提前 20% 的位置触发
            threshold: 0.1, // 元素显示 10% 即触发
          });

          observer.observe(observerTarget);
        }

        // 动态加载 Gitalk 脚本并初始化评论区
        async function loadGitalk() {
          const container = document.getElementById('gitalk-container');
          if (container) {
            const commentID = container.getAttribute('data-comment-id');
            const lang = container.getAttribute('data-lang');
            const repo = container.getAttribute('data-repo')
            const createIssueManually = container.getAttribute('data-createIssueManually')

            console.log(repo);
            console.log(createIssueManually)

            // 动态加载 Gitalk 脚本
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
            script.defer = true;
            script.onload = () => {
              const gitalk = new Gitalk({
                clientID: 'fcf61195c7f73253dc8b',
                clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
                repo: repo,
                owner: 'fatbobman',
                admin: ['fatbobman'],
                id: commentID.split('/').pop().substring(0, 49),
                distractionFreeMode: true,
                createIssueManually: createIssueManually,
                language: lang,
              });

              gitalk.render('gitalk-container');
            };
            document.body.appendChild(script);
          }
        }
      });
    </script> <div class="hidden lg:block w-32 xl:w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="toc-content"> <div class="w-full flex justify-end pb-2" id="toc-float-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-toc"></use> </svg> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-close" class="hidden"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-toc-close"></use> </svg>  </div> </div> <div class="text-default text-xxs xl:text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#关系的定义" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 关系的定义 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#关系的类型" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 关系的类型 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#逆向关系" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 逆向关系 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#删除规则" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 删除规则 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#有序关系" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 有序关系 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#关系与批量操作" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 关系与批量操作 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#关系的懒加载特性及其应用" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 关系的懒加载特性及其应用 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#关系是如何在-sqlite-中标识的" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 关系是如何在 SQLite 中标识的 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#在-core-data-with-cloudkit-中的关系设置要求" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 在 Core Data with CloudKit 中的关系设置要求 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#持久化存储内部的关系限制" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 持久化存储内部的关系限制 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#在什么情况下考虑使用关系" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 在什么情况下考虑使用关系 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#接下来" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> 接下来 </a> </div> </li>  </ul> </div> </div> </div> <script type="module" src="/_astro/TOC.astro_astro_type_script_index_0_lang.ARhKvemZ.js"></script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/zh/posts/blog-update-chronicle-2024/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>博客更新记：用新博客迎接 2024</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/blog-update-chronicle-2024/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/zh/posts/mastering-relationships-in-core-data-practical/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-next"></use> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>掌握 Core Data 中的关系：实战</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/mastering-relationships-in-core-data-practical/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=%E6%8E%8C%E6%8F%A1%20Core%20Data%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%9F%BA%E7%A1%80&url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fmastering-relationships-in-core-data-fundamentals%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter" data-tooltip-target="tooltip-share-with-twitter" data-tooltip-placement="left"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-twitter"></use> </svg> </a>  </div> <div id="tooltip-share-with-twitter" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-32 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on X</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=%E6%8E%8C%E6%8F%A1%20Core%20Data%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%9F%BA%E7%A1%80%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fmastering-relationships-in-core-data-fundamentals%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky" data-tooltip-target="tooltip-share-with-bluesky" data-tooltip-placement="left"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-bluesky"></use> </svg> </a>  </div> <div id="tooltip-share-with-bluesky" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on BlueSky</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Fmastering-relationships-in-core-data-fundamentals%252F" target="_blank" id="sidebar-share-with-facebook" data-tooltip-target="tooltip-share-with-facebook" data-tooltip-placement="left"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-facebook"></use> </svg> </a>  </div> <div id="tooltip-share-with-facebook" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Facebook</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fmastering-relationships-in-core-data-fundamentals%2F&title=%E6%8E%8C%E6%8F%A1%20Core%20Data%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%9F%BA%E7%A1%80%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo" data-tooltip-target="tooltip-share-with-weibo" data-tooltip-placement="left"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-weibo"></use> </svg> </a>  </div> <div id="tooltip-share-with-weibo" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Weibo</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fmastering-relationships-in-core-data-fundamentals%2F" target="_blank" id="sidebar-share-with-linkedin" data-tooltip-target="tooltip-share-with-linkedin" data-tooltip-placement="left"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-linkedin"></use> </svg> </a>  </div> <div id="tooltip-share-with-linkedin" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Linkedin</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90%E6%8E%8C%E6%8F%A1%20Core%20Data%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%9F%BA%E7%A1%80%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0A%E6%8E%8C%E6%8F%A1%20Core%20Data%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%9F%BA%E7%A1%80%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fmastering-relationships-in-core-data-fundamentals%2F" target="_blank" id="sidebar-share-with-email" data-tooltip-target="tooltip-share-with-email" data-tooltip-placement="left"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-email"></use> </svg> </a>  </div> <div id="tooltip-share-with-email" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share via Email</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" id="comment-button" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-share-with-comment" data-tooltip-placement="left"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-comment"></use> </svg>  </div> <div id="tooltip-share-with-comment" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share Your Thoughts</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>
  const SCROLL_OFFSET = 80;
  
  document.addEventListener('DOMContentLoaded', function() {
    const commentButton = document.getElementById('comment-button');
    if (commentButton) {
      commentButton.addEventListener('click', function() {
        const gitalkContainer = document.getElementById('gitalk-container');
        if (gitalkContainer) {
          const topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: topPosition, behavior: 'smooth' });
        }
      });
    }
  });
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-back-to-top" data-tooltip-placement="left"> <use href="/_astro/iconCollection.BuMSwq1O.svg#icon-top"></use> </svg>  </div> <div id="tooltip-back-to-top" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-28 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Back to Top</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.DVW0R156.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div> <section> <div id="weekly-modal" data-subscribeText="立刻订阅" data-placeholder="输入邮箱订阅周报"> <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button id="popup-modal-close-button" type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> </div> <div class="flex justify-center pb-6"> <button id="weekly-modal-continue-button" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </section> <script type="module" src="/_astro/WeeklyModalLoader.astro_astro_type_script_index_0_lang.fEmR9cQ5.js"></script>  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js" async></script> <script>
  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', () => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"搜索",buttonAriaLabel:"搜索"},modal:{searchBox:{resetButtonTitle:"清除搜索关键字",resetButtonAriaLabel:"清除搜索关键字",cancelButtonText:"取消",cancelButtonAriaLabel:"取消"},startScreen:{recentSearchesTitle:"最近搜索",noRecentSearchesText:"当前没有搜索历史记录",saveRecentSearchButtonTitle:"保存本次搜索",removeRecentSearchButtonTitle:"从搜索历史中移除",favoriteSearchesTitle:"收藏夹",removeFavoriteSearchButtonTitle:"从收藏夹移除"},errorScreen:{titleText:"无法获取结果",helpText:"请检查网络连接"},footer:{selectText:"选择",selectKeyAriaLabel:"选择",navigateText:"切换",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"退出",closeKeyAriaLabel:"Escape key",searchByText:"引擎支持"},noResultsScreen:{noResultsText:"无法找到对应结果",suggestedQueryText:"可以尝试搜索如下内容",reportMissingResultsText:"确认本次搜索应该返回内容？",reportMissingResultsLinkText:"请告知我们"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <!--Magic Fix 解决在 Safari 下搜索框取消后会滚动到页面底部--> <div class="fixed"> <input type="text"> </div> </body></html>
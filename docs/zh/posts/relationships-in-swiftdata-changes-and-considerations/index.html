<!DOCTYPE html><html lang="zh"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>SwiftData 中的关系：变化与注意事项 | 肘子的 Swift 记事本</title>
<meta name="description" content="SwiftData在关系处理上引入了新变化，本文探讨了其与Core Data的差异，包括逆向关系、默认值、以及Array的性能问题，助您理解SwiftData关系。">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/zh/posts/relationships-in-swiftdata-changes-and-considerations/">
<meta property="og:title" content="SwiftData 中的关系：变化与注意事项 | 肘子的 Swift 记事本">
<meta property="og:description" content="SwiftData在关系处理上引入了新变化，本文探讨了其与Core Data的差异，包括逆向关系、默认值、以及Array的性能问题，助您理解SwiftData关系。">
<meta property="og:url" content="https://fatbobman.com/zh/posts/relationships-in-swiftdata-changes-and-considerations/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/relationships-in-swiftData-changes-and-considerations-zh.png">

<meta property="og:locale" content="zh">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/zh/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="肘子的博客"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/relationships-in-swiftdata-changes-and-considerations/"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/relationships-in-swiftdata-changes-and-considerations/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/about.ef6e_bru.css" />
<link rel="stylesheet" href="/_astro/about.Y66QztvF.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default tracking-tight bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/zh/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="zh" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> ZH </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="/en/posts/relationships-in-swiftdata-changes-and-considerations/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> 将中文设置为默认 </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/zh/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 首页 </a><a href="/zh/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> 文章 </a><a href="/zh/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 周报 </a><a href="/zh/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 小贴士 </a><a href="/zh/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> 关于 </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/tags/SwiftData/">
#SwiftData </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/posts/relationships-in-swiftdata-changes-and-considerations/" id="language-switcher-for-topic"> #English </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">SwiftData 中的关系：变化与注意事项</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">东坡肘子</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> 发表于 <time datetime="2024-01-18T00:12:00.000Z">2024 年 1 月 18 日</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 
<p>在之前的两篇文章 <a href="/zh/posts/mastering-relationships-in-core-data-fundamentals/" target="_blank">掌握 Core Data 中的关系：基础</a> 和 <a href="/zh/posts/mastering-relationships-in-core-data-practical/" target="_blank">掌握 Core Data 中的关系：实战</a> 中，我们详细探讨了 Core Data 中关系的概念和技巧。虽然这些知识在很大程度上同样适用于 Core Data 的继任者 SwiftData，但 SwiftData 在关系处理上也引入了一些显著的变化。本文将重点介绍 SwiftData 在关系方面发生的变化，以及由此带来的潜在挑战和值得注意的细节。</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="从由里至表到由表及里的变革">从“由里至表”到“由表及里”的变革</h2>
<p>在 SwiftData 的众多创新中，最引人注目的莫过于允许开发者通过纯代码直接声明数据模型。在 Core Data 中，开发者需要先在 Xcode 的数据模型编辑器里创建数据模型（对应 NSManagedObjectModel），然后才是编写或自动生成 NSManagedObject 子类代码。</p>
<p>这一过程本质上是从模型（“里”）到类型代码（“表”）的转换。开发者能在一定程度上调整类型代码，例如将 <code>Optional</code> 改为 <code>Non-Optional</code> 或将 <code>NSSet</code> 改为 <code>Set</code>，从而优化开发体验，只要这些修改不影响 Core Data 在代码与模型之间的映射。</p>
<p>SwiftData 的纯代码声明方式彻底改变了这一流程。在 SwiftData 中，类型代码和数据模型的声明是同步进行的，或者更准确地说，SwiftData 会根据开发者声明的类型代码自动生成相应的数据模型。声明方式由传统的“由里至表”转变为了“由表及里”。</p>
<p>这种变化在大多数情况下都是正面的，但对于某些具体应用场景，开发者需要调整他们之前的开发习惯和技巧。例如，在之前的文章 <a href="/zh/posts/mastering-relationships-in-core-data-practical/" target="_blank">《掌握 Core Data 中的关系：实战》</a>中提到的将数据模型声明为 <code>Optional</code> 的关系对应的代码修改为 <code>Non-Optional</code> 的技巧，在 SwiftData 中将不再适用。模型将严格遵循类型代码的声明创建：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> Date.now</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tag: Tag</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: Date) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> items: [Item] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在这段代码中，<code>var tag: Tag?</code> 表明 <code>tag</code> 关系是可选的。如果我们去掉 <code>?</code>，那么在对应的数据模型中，<code>tag</code> 关系将变为非可选。同样，<code>var items: [Item] = []</code> 指出 <code>items</code> 关系是非可选的。</p>
<h2 id="关系可以设置默认值的误区">关系可以设置默认值的误区</h2>
<p>在 Core Data 中，与其他类型的属性不同，开发者无法为关系设置默认值。这一限制在 SwiftData 中同样适用。然而，SwiftData 当前的声明方式可能会误导开发者认为可以为关系设置默认值。以以下代码为例：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .now</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tag: Tag </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: Date) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> items: [Item] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>乍一看，<code>var tag: Tag = Tag(name: &quot;hello&quot;)</code> 和 <code>var items: [Item] = []</code> 似乎都在为关系设置默认值。但实际上并非如此。</p>
<p>首先，尽管 <code>var tag: Tag = Tag(name: &quot;hello&quot;)</code> 这段代码可以编译通过，但它会在运行时产生错误，错误提示为：“Failed to find any currently loaded container for Tag”。至于 <code>var items: [Item] = []</code>，虽然不会报错，但这并不代表它在为 <code>items</code> 设置了有效的默认值。</p>
<p>在之前的文章 <a href="/zh/posts/unveiling-the-data-modeling-principles-of-swiftdata/" target="_blank">《揭秘 SwiftData 的数据建模原理》</a> 中，我们详细探讨了 SwiftData 是如何根据声明的代码创建数据模型的。无论是通过字面量赋值，还是通过构造方法赋值，这些操作都只是在创建了托管对象实例之后进行的。也就是说，在创建托管对象的过程中，并不会生成“预期”的默认值（关系对象）。</p>
<h2 id="在构造方法中创建关系数据">在构造方法中创建关系数据</h2>
<p>在过去几个月中，我接触了许多使用 SwiftData 框架编写代码的开发者。其中，特别是那些没有 Core Data 开发经验的开发者，他们常常采用类似于以下的实现方式：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tag: Tag</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: Date, </span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">        tag </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: name)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> item: Item</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>从这种普遍的实践方式可以看出，SwiftData 在改变数据模型定义模式上取得了显著的成功。由于 <code>@Model</code> 宏要求必须定义构造方法，开发者往往会按照标准的 Swift 类型定义的模式，在一个实体的构造方法中直接生成另一个实体的数据。这种方法不仅简洁、直观，而且在构造方法中创建的实体数据也无需额外地插入到 <code>ModelContext</code> 中：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> newItem </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">timestamp</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">Date</span><span style="color:#F8F8F2">(),</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">modelContext.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(newItem)</span></span></code></pre></div>
<p>这一实践反映了 SwiftData 对传统数据模型定义方式的重大简化和改进。它使得关系数据的创建更符合 Swift 语言的本质风格，同时也降低了开发者的学习曲线，尤其是对于那些初次接触数据持久化框架的开发者而言。</p>
<blockquote>
<p>在构造方法中创建的关系数据同样不属于默认值。</p>
</blockquote>
<h2 id="swiftdata-中的逆向关系设置及其困惑">SwiftData 中的逆向关系设置及其困惑</h2>
<p>在之前的文章 <a href="/zh/posts/mastering-relationships-in-core-data-fundamentals/" target="_blank">《掌握 Core Data 中的关系：基础》</a> 中，我们讨论了逆向关系的重要性。在 Core Data 中，开发者需要在 Xcode 的模型编辑器中显式地为双向关系设置逆向关系，并且若未设置，Xcode 会发出警告。而在 SwiftData 中，逆向关系的设置规则并不那么明确。在某些情况下，即使开发者未使用 <code>@Relationship(inverse:)</code> 设置逆向关系，SwiftData 也可能自动为模型添加。</p>
<p>通过我的实验，我发现 SwiftData 对逆向关系的处理规则如下：</p>
<ul>
<li><strong>One-to-One（一对一）</strong>：当两端都是 <code>Optional</code> 时，SwiftData 会自动添加逆向关系。例如：</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tag: Tag</span><span style="color:#FF79C6">?</span><span style="color:#6272A4"> // Optional</span></span>
<span class="line"><span style="color:#F8F8F2">    init(timestamp: Date) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name:</span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> item: Item？</span><span style="color:#6272A4">// Optional</span></span>
<span class="line"><span style="color:#F8F8F2">    init(name: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<ul>
<li><strong>One-to-One（一对一）</strong>：若一端不为 <code>Optional</code>，则需要开发者明确设置逆向关系（在任一侧设置即可）。例如：</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date</span></span>
<span class="line"><span style="color:#FF79C6">    @Relationship</span><span style="color:#F8F8F2">(inverse</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2">\Tag.item)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tag: Tag</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: Date, </span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> item: Item</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">,</span><span style="color:#50FA7B;font-style:italic">item</span><span style="color:#F8F8F2">:Item) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.item </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<ul>
<li><strong>One-to-Many（一对多）</strong>：两端都是 <code>Optional</code> 时 SwiftData 会自动设置逆向关系；一端不为 <code>Optional</code> 时，需要开发者明确设置逆向关系</li>
<li><strong>Many-to-Many（多对多）</strong>：两端都为或任意一段为 <code>Optional</code> 时，SwiftData 会自动设置；若两端均为 <code>Non-Optional</code>，则需要开发者明确设置。</li>
</ul>
<p>总的来说，除了 <code>Many-to-Many</code> 情况外，在 <code>One-to-One</code> 和 <code>One-to-Many</code> 关系中，只要任意一端不为 <code>Optional</code>，就需要显式设置逆向关系。</p>
<p>虽然这些规则不算过于复杂，但为了避免潜在的问题，建议开发者在声明模型时始终明确设置逆关系。</p>
<h2 id="丢失的-core-data-with-cloudkit-兼容性自动检查">丢失的 Core Data with CloudKit 兼容性自动检查</h2>
<p>当我们需要在应用中为 Core Data 开启云存储功能（即 Core Data with CloudKit）时，在创建数据模型阶段，就必须根据 Core Data with CloudKit 的要求对模型进行一些特定的调整。例如，必须设置逆向关系、不能使用 <code>Deny</code> 删除规则等。</p>
<p>在 Core Data 的环境下，即使没有为项目启用 iCloudKit 功能，只要在 Xcode 的 Configuration 中勾选 <code>Used with CloudKit</code> 选项，Xcode 就会自动检查当前数据模型是否符合 Core Data with CloudKit 的标准，并相应地给出提示。</p>
<video src="https://cdn.fatbobman.com/icloud-check-iShot_2024-01-08_19.42.06-1.mp4" autoplay="true" loop="true" muted="true" loading="lazy" playsInline="true" controls="true"></video>
<p>然而，在 SwiftData 中，开发者首先需要为项目启用 CloudKit 功能并指定 CloudKit 容器。只有在运行应用后，如果模型不符合 Core Data with CloudKit 的规范，才会收到模型错误的通知。</p>
<p>因此，对于那些已经启用或计划未来启用 Core Data with CloudKit 功能的开发者来说，应尽早在项目中设置相应的 CloudKit 选项。这样做可以避免因为模型不规范而导致未来需要进行大规模的代码更新。</p>
<blockquote>
<p>关于 Core Data with CloudKit 对模型的具体要求，可参阅文章 <a href="/zh/posts/coredatawithcloudkit-2/" target="_blank">《Core Data with CloudKit：同步本地数据库到 iCloud 私有数据库》</a>。</p>
</blockquote>
<h2 id="array-创新还是陷阱">Array 创新还是陷阱</h2>
<h3 id="使用-array-表示无序对多关系字面意义存疑">使用 Array 表示无序对多关系，字面意义存疑</h3>
<p>SwiftData 在处理多对多关系时的一大变革是要求开发者直接使用数组（Array）来声明关系。与 Core Data 不同的是，<code>@Model</code> 宏不会为对多数据操作创建独立的方法，而是允许开发者直接对数组进行操作：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: Date</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tags: [Tag] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: Date, </span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">item.tags.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(tag)</span></span></code></pre></div>
<p>对于这种变化，许多开发者的反馈是积极的。他们认为这大大提升了代码的字面清晰度，使模型声明和数据操作更加符合 Swift 语言的特性。</p>
<p>开发团队可能认为统一使用 Array 声明有序或无序的对多关系会降低 SwiftData 的学习门槛，因此没有采用 Set 来声明无序的多对关系。我个人对使用 Array 表示无序的对多关系持有保留意见，因为 Array 使代码失去了对数据元素唯一性和无特定顺序性的直观表达。因此，对开发者（尤其是初学者）来说，必须明确无序对多关系返回的顺序是不保证的（即使使用了 Array）。开发者应考虑采用在 “实战” 一文中介绍的更可控的对多关系数据获取方式。</p>
<h3 id="通过数组操作多对关系数据的效率问题">通过数组操作多对关系数据的效率问题</h3>
<p>在 Core Data 中，对于对多关系，Xcode 会自动生成一些专门的操作方法，例如 <code>addToTags(_ value: Tag)</code> 和 <code>removeFromTags(_ value: Tag)</code> 等。与使用多个特定方法相比，从形式上讲，直接使用熟悉的数组方法来操作多对关系数据似乎是一种进步。然而，在 SwiftData 的首个版本中，这种实现方式在某些场景下可能会导致严重的性能问题。</p>
<p>考虑以下代码示例：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> timestamp: </span><span style="color:#8BE9FD;font-style:italic">Int</span></span>
<span class="line"><span style="color:#FF79C6">    @Relationship</span><span style="color:#F8F8F2">(deleteRule</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> .cascade,inverse</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> \Tag.item)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tags:</span><span style="color:#8BE9FD;font-style:italic">Array</span><span style="color:#F8F8F2">&lt;Tag&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> []</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">timestamp</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.timestamp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> timestamp</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@Model</span></span>
<span class="line"><span style="color:#FF79C6">final</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> name:</span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> item:Item</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">name</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Create One Item and One Hunderd Tags</span></span>
<span class="line"><span style="color:#F8F8F2">measure {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> item </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">timestamp</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    context.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(item)</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> tag </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        item.tags.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(tag)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    try?</span><span style="color:#F8F8F2"> context.</span><span style="color:#8BE9FD">save</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在这个例子中，<code>Item</code> 和 <code>Tag</code> 之间是一对多关系。我们创建了一个 <code>Item</code> 实例和 100 个 <code>Tag</code> 实例，并通过 <code>item.tags.append(tag)</code> 建立关联。</p>
<p>与之对应的 Core Data 代码在执行相同操作时的平均耗时为 <strong>0.003 秒</strong>，而上述 SwiftData 的代码平均耗时为 <strong>0.106 秒</strong>。</p>
<p>虽然可以理解 SwiftData 作为封装层会有一些性能损耗，但超过 30 倍的时间差异仍然令人震惊。更为惊人的是，将循环增加到 1000 和 10000 时，时间差异更为显著：</p>
<p>将循环调整至 1000，700 多倍多时间差:</p>
<ul>
<li>当循环次数为 1000：
<ul>
<li>Core Data: <strong>0.012 秒</strong></li>
<li>SwiftData: <strong>9.080 秒</strong></li>
</ul>
</li>
<li>当循环次数为 10000：
<ul>
<li>Core Data: <strong>0.082 秒</strong></li>
<li>SwiftData: 抱歉，我实在是没有耐心等下去了</li>
</ul>
</li>
</ul>
<p>这种显著的性能差异表明，尽管 SwiftData 在表面上简化了多对关系的操作，但在处理大量数据时，其效率远不及 Core Data。</p>
<h3 id="问题的根源在哪里">问题的根源在哪里？</h3>
<p>通过探究 SwiftData 与 Core Data 在添加多对关系数据时的差异，我们可以找出潜在的性能问题原因。</p>
<p>两者最显著的区别在于创建关系的方法：SwiftData 使用 <code>item.tags.append(tag)</code>，而 Core Data 使用 <code>item.addToTags(tag)</code>。在 Core Data 中，通过使用专门生成的 <code>item.addToTags</code> 方法，框架可以直接识别即将被添加的关系对象。相反，SwiftData 采用标准数组操作，这意味着在执行 <code>append</code> 操作后，必须比较新的值（追加后的 <code>item.tags</code>）和旧的值（追加前的 <code>item.tags</code>）来确定新增的对象。结果是，随着数组中数据量的增加，性能会出现指数级劣化。</p>
<p>为验证这一假设，我检查了 SwiftData 的接口文件，发现开发团队仅为 Array 类型增加了以下扩展：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> protocol</span><span style="color:#8BE9FD;font-style:italic"> RelationshipCollection</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">  associatedtype</span><span style="color:#F8F8F2"> PersistentElement </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> SwiftData.PersistentModel</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> Swift</span><span style="color:#F8F8F2">.Array : SwiftData.RelationshipCollection </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> Element : SwiftData.PersistentModel {</span></span>
<span class="line"><span style="color:#FF79C6">  public</span><span style="color:#FF79C6"> typealias</span><span style="color:#8BE9FD;font-style:italic"> PersistentElement</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD;font-style:italic"> Element</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>这段代码仅表明需要使用数组来声明多对关系，并没有为数组操作（如 <code>append</code>）定制特别的处理。</p>
<p>那么，如果从 <code>One</code> 端来创建关系，效率是否会有所提高呢？我们可以调整代码测试这一点：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> context </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> sharedModelContainer.mainContext</span></span>
<span class="line"><span style="color:#F8F8F2">measure {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> item </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">timestamp</span><span style="color:#F8F8F2">:.now)</span></span>
<span class="line"><span style="color:#F8F8F2">    context.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(item)</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#BD93F9">1000</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> tag </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        tag.item </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> item</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    try?</span><span style="color:#F8F8F2"> context.</span><span style="color:#8BE9FD">save</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#8BE9FD">    print</span><span style="color:#F8F8F2">(item.tags</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> ??</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">null</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在进行 1000 次循环后，SwiftData 的平均用时为 <strong>4.350 秒</strong>，而 Core Data 仅为 <strong>0.011 秒</strong>。虽然 SwiftData 的用时有所下降，但与 Core Data 相比仍有显著差距。</p>
<p>这表明，即使从“一”端创建关系，SwiftData 似乎仍然会自动处理“多”端的 Array 数据，从而造成性能损耗。</p>
<blockquote>
<p>我还尝试了创建没有逆向关系的模型版本，发现运行时间几乎没有差异。这说明 SwiftData 在处理多对关系的 Array 数据时，并不受是否设置逆向关系的影响。</p>
</blockquote>
<h3 id="解决方案">解决方案</h3>
<p>面对 SwiftData 中多对关系数据操作的性能问题，一个可能的解决方案是减少对数组的操作次数，从而提高执行效率。</p>
<p>我们可以通过以下代码调整来尝试解决这一问题：</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> context </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> sharedModelContainer.mainContext</span></span>
<span class="line"><span style="color:#F8F8F2">measure {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> item </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Item</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">timestamp</span><span style="color:#F8F8F2">:.now)</span></span>
<span class="line"><span style="color:#F8F8F2">    context.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(item)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> tags </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [Tag]()</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#BD93F9">1000</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> tag </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> Tag</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        tags.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(tag)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    item.tags</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">contentsOf</span><span style="color:#F8F8F2">: tags)</span></span>
<span class="line"><span style="color:#FF79C6">    try?</span><span style="color:#F8F8F2"> context.</span><span style="color:#8BE9FD">save</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#8BE9FD">    print</span><span style="color:#F8F8F2">(item.tags</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> ??</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">null</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>在这种方法中，我们先将所有创建的 <code>Tag</code> 实例保存在一个临时数组中，然后一次性将这些 <code>Tag</code> 实例添加到 <code>item.tags</code> 中。</p>
<p>实验显示，在进行 1000 次循环操作后，SwiftData 的平均用时降低至 <strong>0.069570 秒</strong>，相比之前有了显著提升，效率提高了约 130 倍。然而，与 Core Data 在相同操作下的平均用时 <strong>0.012 秒</strong> 相比，SwiftData 仍然存在一定的差距。</p>
<p>这个例子表明，在处理 <code>One-to-Many</code> 或 <code>Many-to-Many</code> 类型的关系时，应尽量减少对对多关系数组的操作次数，尽可能将多次操作合并为一次性完成。</p>
<p>至于 SwiftData 的性能问题是否能够最终得到解决，还取决于未来 SwiftData 版本是否会在这方面进行专门的优化。</p>
<blockquote>
<p>你可以在<a href="https://github.com/fatbobman/BlogCodes/tree/main/ToManyPerformance?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">此处</a>获取所有的本文所有的测试代码</p>
</blockquote>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="总结">总结</h2>
<p>在本文中，我们探讨了 SwiftData 在处理数据关系方面的变化，并分析了其中可能引起的性能问题。虽然 SwiftData 仍然基于 Core Data 的底层结构，但它已经展现出了自己独特的特性和新的使用方式。这些变化意味着，之前针对 Core Data 的一些技巧和实践，在 SwiftData 中可能需要进行适当的调整和重新考量。</p>
<p>SwiftData 为开发者提供了一种更加现代和直观的方式来处理数据关系，但这也伴随着新的挑战和学习需求。开发者需要不断适应 SwiftData 的特点，灵活运用新的策略和技术，以充分利用其提供的便利并改善性能。</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">每周一，与您分享精心筛选的 Swift 与 SwiftUI 开发精华</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">继续阅读</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2024-01-18T00:12:00.000Z",
  "datePublished": "2024-01-18T00:12:00.000Z",
  "description": "SwiftData在关系处理上引入了新变化，本文探讨了其与Core Data的差异，包括逆向关系、默认值、以及Array的性能问题，助您理解SwiftData关系。",
  "headline": "SwiftData 中的关系：变化与注意事项",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/relationships-in-swiftData-changes-and-considerations-zh.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/zh/posts/relationships-in-swiftdata-changes-and-considerations/"
  },
  "url": "https://fatbobman.com/zh/posts/relationships-in-swiftdata-changes-and-considerations/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">为您每周带来有关 Swift 和 SwiftUI 的精选资讯！</div> <script>(function(){const subscribeText = "立刻订阅";
const placeholder = "输入邮箱订阅周报";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0"> <button type="button" class="text-red-500 bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://afdian.com/a/fatbobman')"> <img src="/images/aifadian.svg" alt="" width="18" height="18" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium">爱发电(微信/支付宝)</span> </button>  </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">链接已复制</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/zh";

  const adCacheKey = 'dynamicAdCache';

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">相关文章</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">相关文章</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/mastering-relationships-in-core-data-fundamentals/" id="relatedPosts-掌握 Core Data 中的关系：基础"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">掌握 Core Data 中的关系：基础</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/weekly/issue-038" id="relatedPosts-Weekly #38 - 更好还是更便宜？"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #38 - 更好还是更便宜？</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/mastering-relationships-in-core-data-practical/" id="relatedPosts-掌握 Core Data 中的关系：实战"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">掌握 Core Data 中的关系：实战</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/derivedandtransient/" id="relatedPosts-如何在 Core Data 中使用 Derived 和 Transient 属性"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">如何在 Core Data 中使用 Derived 和 Transient 属性</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/coredatawithcloudkit-4/" id="relatedPosts-Core Data with CloudKit（四）—— 调试、测试、迁移及其他"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Core Data with CloudKit（四）—— 调试、测试、迁移及其他</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/modern-core-data-respond-data-safely/" id="relatedPosts-SwiftUI 与 Core Data —— 安全地响应数据"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI 与 Core Data —— 安全地响应数据</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/unveiling-the-data-modeling-principles-of-swiftdata/" id="relatedPosts-揭秘 SwiftData 的数据建模原理"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">揭秘 SwiftData 的数据建模原理</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/zh/posts/concurret-programming-in-swiftdata/" id="relatedPosts-SwiftData 中的并发编程"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftData 中的并发编程</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="SwiftData 中的关系 变化与注意事项" data-lang="zh"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#从“由里至表”到“由表及里”的变革" class=""> 从“由里至表”到“由表及里”的变革 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#关系可以设置默认值的误区" class=""> 关系可以设置默认值的误区 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#在构造方法中创建关系数据" class=""> 在构造方法中创建关系数据 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#swiftdata-中的逆向关系设置及其困惑" class=""> SwiftData 中的逆向关系设置及其困惑 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#丢失的-core-data-with-cloudkit-兼容性自动检查" class=""> 丢失的 Core Data with CloudKit 兼容性自动检查 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#array-创新还是陷阱" class=""> Array 创新还是陷阱 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#使用-array-表示无序对多关系字面意义存疑" class=""> 使用 Array 表示无序对多关系，字面意义存疑 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#通过数组操作多对关系数据的效率问题" class=""> 通过数组操作多对关系数据的效率问题 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#问题的根源在哪里？" class=""> 问题的根源在哪里？ </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#解决方案" class=""> 解决方案 </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#总结" class=""> 总结 </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/mastering-relationships-in-core-data-practical/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>掌握 Core Data 中的关系：实战</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/mastering-relationships-in-core-data-practical/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/zh/posts/exploring-swiftui-property-wrappers-2/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>探讨 SwiftUI 中的属性包装器：@AppStorage、@SceneStorage、@FocusState、@GestureState 和 @ScaledMetric</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/zh/posts/exploring-swiftui-property-wrappers-2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=SwiftData%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%8F%98%E5%8C%96%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9&#38;url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Frelationships-in-swiftdata-changes-and-considerations%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=SwiftData%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%8F%98%E5%8C%96%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Frelationships-in-swiftdata-changes-and-considerations%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fzh%252Fposts%252Frelationships-in-swiftdata-changes-and-considerations%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Frelationships-in-swiftdata-changes-and-considerations%2F&#38;title=SwiftData%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%8F%98%E5%8C%96%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Frelationships-in-swiftdata-changes-and-considerations%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=%E6%96%87%E7%AB%A0%3A%E3%80%90SwiftData%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%8F%98%E5%8C%96%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E3%80%91&#38;body=%E5%88%86%E4%BA%AB%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%BB%99%E4%BD%A0%EF%BC%9A%0A%0ASwiftData%20%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E5%8F%98%E5%8C%96%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A%0A%E9%93%BE%E6%8E%A5%3A%20https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Frelationships-in-swiftdata-changes-and-considerations%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">网站</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">健康笔记</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/zh/posts/" class="hover:text-secondary">文章</a> <a href="/zh/tags/" class="hover:text-secondary">标签</a> <a href="/zh/collections/" class="hover:text-secondary">合集</a> <a href="/zh/snippet/" class="hover:text-secondary">小贴士</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">关注</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">周报</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a> <a href="https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3" class="hover:text-secondary" target="_blank">
即刻
</a> <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/zh/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">信息</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/zh/about/" class="hover:text-secondary">关于</a>  </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright © <span>2020-</span> 2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "zh";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="zh" data-searchtext="搜索..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>GeometryReader - Blessing or Curse? | Fatbobman&#39;s Blog</title>
<meta name="description" content="Explore GeometryReader&#39;s common problems in SwiftUI. Is it a curse or a blessing? Understand its layout, information retrieval, performance, and when to use it correctly. Includes new onGeometryChange API &amp; replications.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/geometryreader-blessing-or-curse/">
<meta property="og:title" content="GeometryReader - Blessing or Curse? | Fatbobman&#39;s Blog">
<meta property="og:description" content="Explore GeometryReader&#39;s common problems in SwiftUI. Is it a curse or a blessing? Understand its layout, information retrieval, performance, and when to use it correctly. Includes new onGeometryChange API &amp; replications.">
<meta property="og:url" content="https://fatbobman.com/en/posts/geometryreader-blessing-or-curse/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/geometryreader-blessing-or-curse-en.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="Fatbobman's Blog"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/geometryreader-blessing-or-curse/"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/geometryreader-blessing-or-curse/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/about.ef6e_bru.css" />
<link rel="stylesheet" href="/_astro/about.Y66QztvF.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default tracking-tight bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="/zh/posts/geometryreader-blessing-or-curse/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Quick Tips </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> About </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/posts/geometryreader-blessing-or-curse/" id="language-switcher-for-topic"> #中文版 </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">GeometryReader: Blessing or Curse?</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2023-11-09T00:20:00.000Z">Nov 9, 2023</time>  <span> Updated on  </span> <time datetime="2024-06-18T00:12:00.000Z"> Jun 18, 2024 </time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 

<p>GeometryReader has been present since the birth of SwiftUI, playing a crucial role in many scenarios. However, from the very beginning, some developers have held a negative attitude towards it, believing it should be avoided as much as possible. Especially after the recent updates of SwiftUI added some APIs that can replace GeometryReader, this view has further strengthened. This article will dissect the “common problems” of GeometryReader to see if it is really so unbearable, and whether those performances criticized as “not meeting expectations” are actually due to problems with the developers’ “expectations” themselves.</p>
<blockquote>
<p>June 2024 Update: Introduced the new <code>onGeometryChange</code> modifier announced at WWDC 2024 and provided a replicated version suitable for earlier SwiftUI versions.</p>
</blockquote>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="some-criticisms-of-geometryreader">Some Criticisms of GeometryReader</h2>
<p>The main criticisms developers have towards GeometryReader focus on the following two points:</p>
<ul>
<li>GeometryReader destroys the layout: This view holds that, since GeometryReader will occupy all available space, it might ruin the overall layout design.</li>
<li>GeometryReader can’t get the correct geometry information: This view holds that, in certain situations, GeometryReader may not be able to obtain precise geometry information, or the information it obtains may be unstable when the view doesn’t change visually.</li>
</ul>
<p>In addition, some people believe that:</p>
<ul>
<li>Over-reliance on GeometryReader can make the view layout rigid, losing the flexibility advantage of SwiftUI.</li>
<li>GeometryReader breaks the concept of SwiftUI’s declarative programming, requiring direct operation of the view framework, which is closer to imperative programming.</li>
<li>GeometryReader consumes a lot of resources when updating geometric information, which may cause unnecessary repetitive calculations and view reconstruction.</li>
<li>Using GeometryReader requires a lot of auxiliary code to calculate and adjust the framework, which increases the amount of coding, and reduces the readability and maintainability of the code.</li>
</ul>
<p>These criticisms are not entirely unreasonable, and a considerable part of them has been improved or resolved through the new API in the SwiftUI version update. However, the view that GeometryReader disrupts the layout and cannot obtain correct information is usually caused by the developer’s insufficient understanding and improper use of GeometryReader. Next, we will analyze and discuss these views.</p>
<blockquote>
<p>Before publishing this article, I posted a <a href="https://twitter.com/fatbobman/status/1719926573896544593?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">tweet</a> asking for everyone’s opinion on GeometryReader. Based on the responses, there seems to be a higher proportion of negative impressions towards it.</p>
</blockquote>
<blockquote>
<p>Difficult to use, try to avoid 28.8%, Very useful 9.3%, Love-hate relationship 34.7%, What is GeometryReader? 27.1%</p>
</blockquote>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231104120125753.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231104120125753.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231104120125753.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231104120125753.png" alt="image-20231104120125753.png" loading="lazy" decoding="async"/>
                  </picture></p>
<h2 id="what-is-geometryreader">What is GeometryReader?</h2>
<p>Before we delve into the negative views mentioned above, we first need to understand the function of GeometryReader and the reason for designing this API.</p>
<p>This is Apple’s official documentation for GeometryReader:</p>
<blockquote>
<p>A container view that defines its content as a function of its own size and coordinate space.</p>
</blockquote>
<p>Strictly speaking, I don’t fully agree with the above description. This is not because there are factual errors, but because this statement may lead to user misunderstanding. In fact, the name “GeometryReader” is more in line with its design goal: <strong>a geometry information reader</strong>.</p>
<p>To be precise, the main function of GeometryReader is to obtain the size, frame and other geometric information of the parent view. The phrase “defines its content” in the official document is likely to make people mistakenly think that the main function of GeometryReader is to actively influence the subview, or that the geometric information it obtains is mainly used for the subview. However, it should be seen as a tool for obtaining geometric information. Whether this information should be applied to the subview is entirely up to the developer.</p>
<p>Perhaps if it had been designed in the following way from the beginning, misunderstandings and misuse of it could have been avoided.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@State</span><span style="color:#FF79C6"> private</span><span style="color:#F8F8F2"> proxy</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2">GeometryProxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">geometryReader</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">proxy</span><span style="color:#F8F8F2">:$proxy)</span></span></code></pre></div>
<p>If we change to a View Extension-based approach, the role of geometryReader can be described as: It provides the size, frame, and other geometric information of the view it is applied to. It is an effective way for the view to get its <strong>own</strong> geometric information. This description can effectively prevent the misunderstanding that geometric information is mainly applied to subviews.</p>
<p>As for why not to adopt the Extension approach, the designer might have considered the following two factors:</p>
<ul>
<li>Passing information upward through Binding is not the primary design method of the current official SwiftUI API.</li>
<li>Passing geometric information to the upper view may cause unnecessary view updates. Passing information downward can ensure that updates only occur in the GeometryReader’s closure.</li>
</ul>
<h2 id="is-geometryreader-a-layout-container-what-is-its-layout-logic">Is GeometryReader a layout container? What is its layout logic?</h2>
<p>Yes, but its behavior is somewhat different.</p>
<p>Currently, GeometryReader exists as a layout container, with the following layout rules:</p>
<ul>
<li>It is a multi-view container, with its default stacking rules similar to ZStack</li>
<li>It returns the parent view’s proposed size as its own required size to the parent view</li>
<li>It passes the parent view’s proposed size as its own proposed size to the child view</li>
<li>It places the child view’s origin (0,0) at the origin of the GeometryReader</li>
<li>Its ideal size (Ideal Size) is (10,10)</li>
</ul>
<p>If you ignore the function to get geometric information, the layout behavior of a GeometryReader is very close to the following code.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">GeometryReader { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#8BE9FD">  Rectangle</span><span style="color:#F8F8F2">().</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">:</span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">:</span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">  Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">abc</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.white)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>It is basically equivalent to the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">ZStack</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">alignment</span><span style="color:#F8F8F2">: .topLeading) {</span></span>
<span class="line"><span style="color:#8BE9FD">    Rectangle</span><span style="color:#F8F8F2">().</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">50</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">abc</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.white)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">    idealWidth</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">10</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">    maxWidth</span><span style="color:#F8F8F2">: .</span><span style="color:#BD93F9">infinity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">    idealHeight</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">10</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">    maxHeight</span><span style="color:#F8F8F2">: .</span><span style="color:#BD93F9">infinity</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">    alignment</span><span style="color:#F8F8F2">: .topLeading</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span></code></pre></div>
<p>Simply put, GeometryReader will occupy all the space provided by the parent view, and aligns the origin of all child views with the origin of the container (i.e., placed in the upper left corner). This unconventional layout logic is one of the reasons why I do not recommend using it directly as a layout container.</p>
<blockquote>
<p>GeometryReader does not support the adjustment of alignment guides, so the above description uses the origin.</p>
</blockquote>
<p>However, this does not mean that GeometryReader cannot be used as a view container. In some cases, it may be more suitable than other containers. For example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> PathView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            Path { path </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> width </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> height </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.height</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">                path.</span><span style="color:#8BE9FD">move</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">to</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">CGPoint</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: width </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">                path.</span><span style="color:#8BE9FD">addLine</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">to</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">CGPoint</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: width, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: height))</span></span>
<span class="line"><span style="color:#F8F8F2">                path.</span><span style="color:#8BE9FD">addLine</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">to</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">CGPoint</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: height))</span></span>
<span class="line"><span style="color:#F8F8F2">                path.</span><span style="color:#8BE9FD">closeSubpath</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(.orange)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>When drawing a Path, the information provided by GeometryReader (dimensions, origin) perfectly meets our needs. Therefore, for subviews that need to fill the space and align with the origin, GeometryReader is very suitable as a layout container.</p>
<p>GeometryReader completely ignores the request size of the subview. In this respect, it treats subviews in the same way as <code>overlay</code> and <code>background</code>.</p>
<p>In the above description of the layout rules of GeometryReader, we pointed out that its ideal size is (10,10 ). Some readers may not understand its meaning. The ideal size refers to the request size returned by the subview when the parent view’s proposed size is nil (unspecified mode). If you don’t understand this setting of GeometryReader, in some scenarios, developers may feel that GeometryReader does not fill all the space as expected.</p>
<p>For example, if you execute the following code, you can only get a rectangle with a height of 10:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GeometryReaderInScrollView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        ScrollView {</span></span>
<span class="line"><span style="color:#F8F8F2">            GeometryReader { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#8BE9FD">                Rectangle</span><span style="color:#F8F8F2">().</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.orange)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231030192917562.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231030192917562.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231030192917562.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231030192917562.png" alt="https://cdn.fatbobman.com/image-20231030192917562.png" loading="lazy" decoding="async"/>
                  </picture></p>
<p>This is because ScrollView’s logic in proposing sizes to child views is different from most layout containers. In the non-scrolling direction, ScrollView provides all available sizes on that dimension to the child view. However, in the scrolling direction, the proposed size it provides to the child view is nil. Since the ideal size of the GeometryReader is (10,10), the required size it returns to ScrollView in the scroll direction is 10. At this point, the behavior of GeometryReader is consistent with Rectangle. Therefore, some developers might think that GeometryReader does not fill up all the available space as expected. But in fact, its display result is completely correct, this is the correct layout result.</p>
<p>Therefore, in this situation, we usually only use the size with definite value dimensions (explicit size mode, proposed size has values) to calculate the size of another dimension.</p>
<p>For example, if we want to display pictures in ScrollView at a ratio of 16:9 (even if the ratio of the picture itself does not conform to this):</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GeometryReaderInScrollView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        ScrollView {</span></span>
<span class="line"><span style="color:#8BE9FD">            ImageContainer</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">imageName</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">pic</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ImageContainer</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> imageName: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> width: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .zero</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">            Image</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">pic</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">resizable</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">aspectRatio</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">contentMode</span><span style="color:#F8F8F2">: .fill)</span></span>
<span class="line"><span style="color:#F8F8F2">                .onAppear {</span></span>
<span class="line"><span style="color:#F8F8F2">                    width </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: width </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 1.77</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">clipped</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231030200535483.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231030200535483.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231030200535483.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231030200535483.png" alt="https://cdn.fatbobman.com/image-20231030200535483.png" loading="lazy" decoding="async"/>
                  </picture></p>
<p>First, we use GeometryReader to get the proposed width provided by ScrollView and calculate the required height based on this width. Then, we adjust the required size height that GeometryReader submits to ScrollView through <code>frame</code>. In this way, we can get the desired display result.</p>
<p>In this demonstration, the Image perfectly meets the previous requirement of filling the space and aligning the origin, so it is completely fine to use GeometryReader as a layout container directly.</p>
<blockquote>
<p>This section includes a lot of knowledge about the size and layout of SwiftUI. If you are not very familiar with this, I suggest you continue to read the following articles: <a href="/en/posts/layout-dimensions-1/" target="_blank">SwiftUI Layout: The Mystery of Size</a>, <a href="/en/posts/layout-dimensions-1/" target="_blank">SwiftUI Layout: The Mystery of Size</a>, <a href="/en/posts/layout-alignment/" target="_blank">Alignment in SwiftUI: Everything You Need to Know</a>.</p>
</blockquote>
<h2 id="why-cant-geometryreader-get-the-correct-information">Why can’t GeometryReader get the correct information?</h2>
<p>Some developers might complain that GeometryReader cannot obtain the correct size (always returns 0,0), or returns an abnormal size (such as negative numbers), leading to layout errors.</p>
<p>For this, we first need to understand the layout principles of SwiftUI.</p>
<p>SwiftUI’s layout is a negotiation process. The parent view provides a proposed size to the child view, and the child view returns a required size. Whether the parent view places the child view based on its required size, or the child view returns a required size based on the proposed size provided by the parent view, depends entirely on the predefined rules of the parent and child views. For example, for VStack, it sends information about explicit, unspecified, maximum, and minimum proposed sizes in the vertical dimension to its child views and obtains the required sizes of the child views at different proposed sizes. VStack combines the priority of the views and the proposed size given by its parent view to provide a final proposed size to the child views during layout.</p>
<p>In some complex layout scenarios, or in certain devices or system versions, the layout may require multiple rounds of negotiation to achieve a stable result, especially when views need to rely on the geometry information provided by GeometryReader to re-determine their position and size. Therefore, this may cause GeometryReader to continuously send new geometry information to the child views until a stable result is obtained. If we still use the information retrieval method in the previous code, we won’t be able to obtain the updated information.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">.onAppear {</span></span>
<span class="line"><span style="color:#F8F8F2">    width </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Therefore, the correct way to obtain information is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width) {</span></span>
<span class="line"><span style="color:#F8F8F2">    width </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>In this way, even if the data changes, we can keep updating the data. Some developers have reported that they are unable to retrieve new information when the screen orientation changes. This is why. <code>task(id:)</code> covers both <code>onAppear</code> and <code>onChange</code> scenarios and is the most reliable way to get data.</p>
<p>Also, in some cases, GeometryReader may return negative dimensions. If these negative numbers are directly passed to <code>frame</code>, it may result in layout abnormalities (Xcode will warn developers in purple during debugging). Therefore, to further avoid this extreme situation, you can filter out the data that does not meet the requirements when passing the data.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width) {</span></span>
<span class="line"><span style="color:#F8F8F2">    width </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> max</span><span style="color:#F8F8F2">(proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width, </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Since GeometryProxy does not conform to the Equatable protocol, and in order to minimize the re-evaluation of views caused by information updates, developers should only pass the currently needed information.</p>
<p>As for how to pass the obtained geometric information (for example, the <code>@State</code> used in the above or through <code>PreferenceKey</code>), it depends on the developer’s programming habits and scene requirements.</p>
<p>Usually, we use GeometryReader + Color.clear in <code>overlay</code> or <code>background</code> to obtain and pass geometric information. This not only ensures the accuracy of information acquisition (size, position is completely consistent with the view to be obtained), but also does not cause additional visual impact.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> getWidth</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> width</span><span style="color:#F8F8F2">: Binding&lt;CGFloat&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">GetWidthModifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: width))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GetWidthModifier</span><span style="color:#F8F8F2">: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    @Binding</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> width: CGFloat</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">background</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#F8F8F2"> proxyWidth </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width</span></span>
<span class="line"><span style="color:#F8F8F2">                    Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width) {</span></span>
<span class="line"><span style="color:#F8F8F2">                            $width.wrappedValue </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> max</span><span style="color:#F8F8F2">(proxyWidth, </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Note: If you want to pass information through PreferenceKey, it’s best to do it in <code>overlay</code>. Because in some system versions, data passed from <code>background</code> cannot be obtained by <code>onPreferenceChange</code>.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GetInfoByPreferenceKey</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        ScrollView {</span></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                    GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                        Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                            .</span><span style="color:#8BE9FD">preference</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">key</span><span style="color:#F8F8F2">: MinYKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">value</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: .global).minY)</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                )</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">onPreferenceChange</span><span style="color:#F8F8F2">(MinYKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">) { value </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">            print</span><span style="color:#F8F8F2">(value)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MinYKey</span><span style="color:#F8F8F2">: PreferenceKey {</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> reduce</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">value</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">inout</span><span style="color:#F8F8F2"> CGFloat, </span><span style="color:#50FA7B;font-style:italic">nextValue</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> CGFloat) {</span></span>
<span class="line"><span style="color:#F8F8F2">        value </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> nextValue</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> defaultValue: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .zero</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>In some cases, the values obtained through GeometryReader may cause you to fall into an endless loop, resulting in unstable views and performance losses, for example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GetSize</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> width: CGFloat </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .zero</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Width = </span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">width</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">getWidth</span><span style="color:#F8F8F2">($width)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><img src="https://cdn.fatbobman.com/unstable-Text-by-GeometryReader_2023-10-30_22.16.35.2023-10-30%2022_17_21.gif" alt="https://cdn.fatbobman.com/unstable-Text-by-GeometryReader_2023-10-30_22.16.35.2023-10-30%2022_17_21.gif"/></p>
<p>Strictly speaking, the root of this problem lies in Text. Since the default font width is not fixed, it can’t form a stable dimension negotiation result. The solution is simple, it can be solved by adding <code>.monospaced()</code> or using a fixed-width font.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Width = </span><span style="color:#FF79C6">\(</span><span style="color:#F1FA8C">width</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">monospaced</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">getWidth</span><span style="color:#F8F8F2">($width)</span></span></code></pre></div>
<blockquote>
<p>The example of character jitter comes from the article <a href="https://swiftui-lab.com/state-changes/?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Safely Updating The View State</a> on SwiftUI-Lab.</p>
</blockquote>
<h2 id="performance-issues-with-geometryreader">Performance issues with GeometryReader</h2>
<p>Understanding when the GeometryReader gets geometric information can help you understand its impact on performance. As a view, GeometryReader can only pass the acquired data to the code in the closure after it has been evaluated, laid out, and rendered. This means that if we need to use the information it provides to adjust the layout, we must first complete at least one round of evaluation, layout, and rendering processes, then acquire the data, and adjust the layout based on these data. This process will cause the view to be re-evaluated and laid out multiple times.</p>
<p>Due to the lack of layout containers such as LazyGrid in early SwiftUI, developers could only implement various custom layouts through GeometryReader. When the number of views is large, this will cause serious performance issues.</p>
<p>Since SwiftUI has supplemented some previously missing layout containers, the large-scale impact of GeometryReader on performance has been alleviated. Especially after allowing custom layout containers that comply with the Layout protocol, the above problems have been basically solved. Unlike GeometryReader, layout containers that meet the layout protocol can obtain the proposed size of the parent view and the required size of all subviews at the layout stage. This can avoid a large number of view updates caused by the repeated transmission of geometric data.</p>
<p>However, this does not mean that there are no precautions when using GeometryReader. In order to further reduce the impact of GeometryReader on performance, we need to pay attention to the following two points:</p>
<ul>
<li>Only let a few views be affected by the changes in geometric information</li>
<li>Only pass the required geometric information</li>
</ul>
<p>The above two points are in line with our consistent principle of optimizing the performance of SwiftUI views, that is, controlling the scope of the impact of state changes.</p>
<h2 id="layout-in-the-swiftui-way">Layout in the SwiftUI way</h2>
<p>Due to the negative views on GeometryReader, some developers try to find other ways to avoid using it. However, have you ever thought that in many scenarios, GeometryReader is not the best solution. Instead of avoiding it, why not use a more SwiftUI way to layout.</p>
<p>GeometryReader is often used in scenarios where the ratio needs to be limited, such as making the view occupy 25% of the available space, or calculating the height based on the given aspect ratio as mentioned above. When dealing with similar requirements, we should prioritize thinking about layout solutions in a way that aligns with SwiftUI’s mindset, rather than relying on specific geometric data for calculations.</p>
<p>For example, we can use the following code to meet the requirement of limiting the aspect ratio of the image mentioned above:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ImageContainer2</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> imageName: </span><span style="color:#8BE9FD;font-style:italic">String</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">aspectRatio</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1.77</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">contentMode</span><span style="color:#F8F8F2">: .fill)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">alignment</span><span style="color:#F8F8F2">: .topLeading) {</span></span>
<span class="line"><span style="color:#8BE9FD">                Image</span><span style="color:#F8F8F2">(imageName)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">resizable</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">aspectRatio</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">contentMode</span><span style="color:#F8F8F2">: .fill)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">clipped</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GeometryReaderInScrollView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        ScrollView {</span></span>
<span class="line"><span style="color:#8BE9FD">            ImageContainer2</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">imageName</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">pic</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Create a base view that meets the aspect ratio through <code>aspectRatio</code>, and then place the <code>Image</code> in the <code>overlay</code>. In addition, because <code>overlay</code> supports setting alignment guides, it can adjust the alignment of the image more conveniently than GeometryReader.</p>
<p>In addition, GeometryReader is often used to allocate space for two views in a certain proportion. For such requirements, there are also other methods to handle it. The following code implements the allocation of 40% and 60% width (the height depends on the tallest subview):</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> FortyPercent</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Grid</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">horizontalSpacing</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">verticalSpacing</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#6272A4">            // placeholder</span></span>
<span class="line"><span style="color:#F8F8F2">            GridRow {</span></span>
<span class="line"><span style="color:#8BE9FD">                ForEach</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#FF79C6"> ..&lt;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2">) { </span><span style="color:#BD93F9">_</span><span style="color:#FF79C6"> in</span></span>
<span class="line"><span style="color:#F8F8F2">                    Color.clear.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">maxHeight</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">            GridRow {</span></span>
<span class="line"><span style="color:#8BE9FD">                Image</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">pic</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">resizable</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">aspectRatio</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">contentMode</span><span style="color:#F8F8F2">: .fit)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">gridCellColumns</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Fatbobman&#39;s Swift Weekly</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#8BE9FD">font</span><span style="color:#F8F8F2">(.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">gridCellColumns</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">3</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">padding</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231031103955150.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231031103955150.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231031103955150.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231031103955150.png" alt="https://cdn.fatbobman.com/image-20231031103955150.png" loading="lazy" decoding="async"/>
                  </picture></p>
<p>However, in terms of simply placing two views in a specific space according to a certain proportion (ignoring the size of the subviews), GeometryReader is still one of the best solutions (the overall height of the Grid solution is determined by the subviews).</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> RatioSplitHStack</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">L</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9;font-style:italic">R</span><span style="color:#F8F8F2">&gt;: View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> L: View, R: View {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> leftWidthRatio: CGFloat</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> leftContent: L</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> rightContent: R</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">leftWidthRatio</span><span style="color:#F8F8F2">: CGFloat, @</span><span style="color:#50FA7B">ViewBuilder</span><span style="color:#FFB86C;font-style:italic"> leftContent</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> L, @</span><span style="color:#50FA7B">ViewBuilder</span><span style="color:#FFB86C;font-style:italic"> rightContent</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> R) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.leftWidthRatio </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> leftWidthRatio</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.leftContent </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> leftContent</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.rightContent </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> rightContent</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#8BE9FD">            HStack</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">spacing</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">                Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2"> leftWidthRatio)</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(leftContent)</span></span>
<span class="line"><span style="color:#F8F8F2">                Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(rightContent)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> SplitHStackDemo</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        RatioSplitHStack</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">leftWidthRatio</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">0.25</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#8BE9FD">            Rectangle</span><span style="color:#F8F8F2">().</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">        } rightContent</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">                    Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                )</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">300</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">60</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231104145027741.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231104145027741.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231104145027741.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231104145027741.png" alt="https://cdn.fatbobman.com/image-20231104145027741.png" loading="lazy" decoding="async"/>
                  </picture></p>
<p>This chapter is not implying that developers should avoid using GeometryReader, but is reminding developers that SwiftUI has many other layout methods.</p>
<blockquote>
<p>Please read the articles <a href="/en/posts/layout-in-swiftui-way/" target="_blank">Layout in SwiftUI Way</a> and <a href="/en/posts/centering_the_view_in_swiftui/" target="_blank">Several Ways to Center Views in SwiftUI</a> to understand that SwiftUI has multiple layout methods for the same requirement.</p>
</blockquote>
<h2 id="appearance-and-essence-the-size-may-not-be-the-same"><strong>Appearance and Essence</strong>: The size may not be the same</h2>
<p>In SwiftUI, some modifiers are adjustments made to the view at the rendering level after layout. In the article <a href="/en/posts/layout-dimensions-2/" target="_blank">SwiftUI Layout — Cracking the Size Code</a>, we have discussed the issue of the “Appearance and Essence” of dimensions. For example, the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> SizeView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(Color.orange.gradient)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2.2</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>During layout, the required size for Rectangle is 100 x 100, but at the rendering stage, after being processed by <code>scaleEffect</code>, it will eventually present a 220 x 220 rectangle. Since <code>scaleEffect</code> is adjusted after the layout, even if you create a layout container that complies with the Layout protocol, you cannot know its rendering size. In this case, GeometryReader plays its role.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> SizeView</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">fill</span><span style="color:#F8F8F2">(Color.orange.gradient)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">width</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">printViewSize</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">2.2</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> printViewSize</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        background</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">            GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> layoutSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#BD93F9">size</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#F8F8F2"> renderSize </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> proxy.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: .global).</span><span style="color:#BD93F9">size</span></span>
<span class="line"><span style="color:#F8F8F2">                Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: layoutSize) {</span></span>
<span class="line"><span style="color:#8BE9FD">                        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Layout Size:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, layoutSize)</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">id</span><span style="color:#F8F8F2">: renderSize) {</span></span>
<span class="line"><span style="color:#8BE9FD">                        print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Render Size:</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, renderSize)</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// OUTPUT：</span></span>
<span class="line"><span style="color:#F8F8F2">Layout Size</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">100.0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">100.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">Render Size</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">220.0</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">220.0</span><span style="color:#F8F8F2">)</span></span></code></pre></div>
<p>The <code>size</code> property of <code>GeometryProxy</code> returns the layout size of the view, whereas the <code>frame.size</code> returns the rendered size of the view.</p>
<h2 id="visualeffect-you-can-obtain-geometric-information-without-using-geometryreader">visualEffect: You can obtain geometric information without using GeometryReader</h2>
<p>Considering that developers often need to get GeometryProxy of local views, and it’s too cumbersome to continuously encapsulate GeometryReader, therefore, in WWDC 2023, Apple added a new modifier to SwiftUI: <a href="https://developer.apple.com/documentation/swiftui/visualeffect?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">visualEffect</a>.</p>
<p><code>visualEffect</code> allows developers to directly use the GeometryProxy of the view in the closure without disrupting the current layout (without changing its ancestors and descendants) and apply some specific modifier to the view.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">    ContentRow</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        .visualEffect { content, geometryProxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            content.</span><span style="color:#8BE9FD">offset</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: geometryProxy.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: .global).origin.y)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><code>visualEffect</code> only allows modifiers that comply with the VisualEffect protocol to be used within the closure, ensuring safety and effect. Simply put, SwiftUI makes modifiers that only act on the “appearance” (rendering level) comply with the VisualEffect protocol and prohibits the use of all modifiers that can affect the layout (for example: frame, padding, etc.) in closures.</p>
<p>We can create a rough imitation version of <code>visualEffect</code> (without limiting the types of modifiers that can be used) with the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> myVisualEffect</span><span style="color:#F8F8F2">(@ViewBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> effect</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#FF79C6"> @Sendable</span><span style="color:#F8F8F2"> (AnyView, GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">MyVisualEffect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">effect</span><span style="color:#F8F8F2">: effect))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> MyVisualEffect</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">Output</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">View</span><span style="color:#F8F8F2">&gt;: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> effect: (AnyView, GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Output</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">effect</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (AnyView, GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Output) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.effect </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> effect</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">GeometryProxyWrapper</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">hidden</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlayPreferenceValue</span><span style="color:#F8F8F2">(ProxyKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">) { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> proxy {</span></span>
<span class="line"><span style="color:#8BE9FD">                    effect</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AnyView</span><span style="color:#F8F8F2">(content), proxy)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> GeometryProxyWrapper</span><span style="color:#F8F8F2">: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                    Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">preference</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">key</span><span style="color:#F8F8F2">: ProxyKey.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">value</span><span style="color:#F8F8F2">: proxy)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> ProxyKey</span><span style="color:#F8F8F2">: PreferenceKey {</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> defaultValue: GeometryProxy</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> reduce</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">value</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">inout</span><span style="color:#F8F8F2"> GeometryProxy</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">nextValue</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> GeometryProxy</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">        value </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> nextValue</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Compare with <code>visualEffect</code>:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> EffectTest</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        HStack {</span></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">font</span><span style="color:#F8F8F2">(.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.gray)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">font</span><span style="color:#F8F8F2">(.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                .visualEffect { content, proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                    content</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">offset</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.height </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0.5</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.gray)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD">            Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">font</span><span style="color:#F8F8F2">(.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                .myVisualEffect { content, proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                    content</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">offset</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">x</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.width </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">y</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.height </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 2.0</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">scaleEffect</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0.5</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">border</span><span style="color:#F8F8F2">(.gray)</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20231031145420378.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20231031145420378.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20231031145420378.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20231031145420378.png" alt="https://cdn.fatbobman.com/image-20231031145420378.png" loading="lazy" decoding="async"/>
                  </picture></p>
<h2 id="new-api-ongeometrychange">New API: onGeometryChange</h2>
<p>In the previous text, we discussed the design approach of the <code>GeometryReader</code> API and made the following suggestion:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">geometryReader</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">proxy</span><span style="color:#F8F8F2">: $proxy)</span></span></code></pre></div>
<p>Clearly, Apple has recognized the limitations of the method combining <code>GeometryReader</code> with closures, and thus introduced a new modifier, <code>onGeometryChange</code>, starting from Xcode 16.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">tvOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">watchOS</span><span style="color:#BD93F9"> 9.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">nonisolated </span><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> onGeometryChange</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B">for</span><span style="color:#FFB86C;font-style:italic"> type</span><span style="color:#F8F8F2">: T.</span><span style="color:#FF79C6">Type</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">of</span><span style="color:#FFB86C;font-style:italic"> transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (_ newValue: T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> T : Equatable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 18.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 15.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">tvOS</span><span style="color:#BD93F9"> 18.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">watchOS</span><span style="color:#BD93F9"> 10.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">nonisolated </span><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> onGeometryChange</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B">for</span><span style="color:#FFB86C;font-style:italic"> type</span><span style="color:#F8F8F2">: T.</span><span style="color:#FF79C6">Type</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">of</span><span style="color:#FFB86C;font-style:italic"> transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (_ oldValue: T, _ newValue: T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> T : Equatable</span></span></code></pre></div>
<p>This modifier uses a transformation closure (transform) to convert set information into the required data type, and then passes the converted values to the operation logic (action).</p>
<p>This design does not involve direct manipulation of the view content, making its design intent more clear: it is a mechanism similar to <code>onChange</code>, activated when the geometric information of the view changes.</p>
<blockquote>
<p>In Xcode 16.0 beta (16A5171c), the version that provides both new and old values is only applicable to iOS 18+, while the version that provides only new values is backward compatible to iOS 16.</p>
</blockquote>
<p>The following code example ensures that the height of the red rectangle at the bottom of the orange rectangle is always one third of its height:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> Demo1</span><span style="color:#F8F8F2">: View {</span></span>
<span class="line"><span style="color:#FF79C6">  @State</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> height: CGFloat</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">  var</span><span style="color:#F8F8F2"> body: </span><span style="color:#FF79C6">some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">    VStack {</span></span>
<span class="line"><span style="color:#8BE9FD">      Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">foregroundStyle</span><span style="color:#F8F8F2">(.orange)</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">300</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">onGeometryChange</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">for</span><span style="color:#F8F8F2">: CGFloat.</span><span style="color:#FF79C6">self</span><span style="color:#F8F8F2">) { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">          proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">.height </span><span style="color:#FF79C6">/</span><span style="color:#BD93F9"> 3</span><span style="color:#6272A4"> // transform</span></span>
<span class="line"><span style="color:#F8F8F2">        } action</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">          self</span><span style="color:#F8F8F2">.height </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#6272A4"> // do logic</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">alignment</span><span style="color:#F8F8F2">: .bottom) {</span></span>
<span class="line"><span style="color:#8BE9FD">          Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">foregroundColor</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">height</span><span style="color:#F8F8F2">: height)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<blockquote>
<p>The introduction of <code>onGeometryChange</code> does not mean that <code>GeometryReader</code> has lost its relevance. When it is necessary to draw a Shape within a specific space, the convenience of <code>GeometryReader</code> remains irreplaceable (ideally, it would be best to rename <code>GeometryReader</code>).</p>
</blockquote>
<p>Like <code>visualEffect</code>, we can also implement a replicated version of <code>onGeometryChange</code>, thus benefiting applications still running on older versions of SwiftUI.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> View</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    @MainActor</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> myOnGeometryChange</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B">for</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: T.</span><span style="color:#FF79C6">Type</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">of</span><span style="color:#FFB86C;font-style:italic"> transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (_ oldValue: T, _ newValue: T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> T: Equatable {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">MyOnGeometryChange</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">transform</span><span style="color:#F8F8F2">: transform, </span><span style="color:#8BE9FD">action1</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">nil</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">action2</span><span style="color:#F8F8F2">: action))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    @MainActor</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> myOnGeometryChange</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#50FA7B">for</span><span style="color:#FFB86C;font-style:italic"> _</span><span style="color:#F8F8F2">: T.</span><span style="color:#FF79C6">Type</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">of</span><span style="color:#FFB86C;font-style:italic"> transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (_ newValue: T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View </span><span style="color:#FF79C6">where</span><span style="color:#F8F8F2"> T: Equatable {</span></span>
<span class="line"><span style="color:#8BE9FD">        modifier</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">MyOnGeometryChange</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">transform</span><span style="color:#F8F8F2">: transform, </span><span style="color:#8BE9FD">action1</span><span style="color:#F8F8F2">: action, </span><span style="color:#8BE9FD">action2</span><span style="color:#F8F8F2">: </span><span style="color:#BD93F9">nil</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@MainActor</span></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MyOnGeometryChange</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9;font-style:italic">T</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Equatable</span><span style="color:#F8F8F2">&gt;: ViewModifier {</span></span>
<span class="line"><span style="color:#FF79C6">    @State</span><span style="color:#FF79C6"> private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> storage: ValueStorage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action1</span><span style="color:#F8F8F2">: ((T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">action2</span><span style="color:#F8F8F2">: ((T, T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">        storage </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> ValueStorage</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">transform</span><span style="color:#F8F8F2">: transform, </span><span style="color:#8BE9FD">action1</span><span style="color:#F8F8F2">: action1, </span><span style="color:#8BE9FD">action2</span><span style="color:#F8F8F2">: action2)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> body</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">content</span><span style="color:#F8F8F2">: Content) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#F8F8F2">        content</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">background</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                GeometryReader { proxy </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                    Color.clear</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">task</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">                            id</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">EquatableProxy</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD">                                size</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#BD93F9">size</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD">                                safeAreaInsets</span><span style="color:#F8F8F2">: proxy.safeAreaInsets,</span></span>
<span class="line"><span style="color:#8BE9FD">                                frame</span><span style="color:#F8F8F2">: proxy.</span><span style="color:#8BE9FD">frame</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">in</span><span style="color:#F8F8F2">: .global)</span></span>
<span class="line"><span style="color:#F8F8F2">                            )</span></span>
<span class="line"><span style="color:#F8F8F2">                        ) {</span></span>
<span class="line"><span style="color:#F8F8F2">                            storage.</span><span style="color:#8BE9FD">setValue</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">proxy</span><span style="color:#F8F8F2">: proxy)</span></span>
<span class="line"><span style="color:#F8F8F2">                        }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    struct</span><span style="color:#8BE9FD;font-style:italic"> EquatableProxy</span><span style="color:#F8F8F2">: Equatable {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> size: CGSize</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> safeAreaInsets: EdgeInsets</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> frame: CGRect</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    private</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> ValueStorage</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> oldValue: T</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        private</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> newValue: T</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> transform: (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T</span></span>
<span class="line"><span style="color:#FF79C6">        private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> action1: ((T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        private</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> action2: ((T, T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">transform</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">@escaping</span><span style="color:#F8F8F2"> (GeometryProxy) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> T, </span><span style="color:#50FA7B;font-style:italic">action1</span><span style="color:#F8F8F2">: ((T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B;font-style:italic">action2</span><span style="color:#F8F8F2">: ((T, T) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">.transform </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> transform</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">.action1 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> action1</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            self</span><span style="color:#F8F8F2">.action2 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> action2</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">        func</span><span style="color:#50FA7B"> setValue</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">proxy</span><span style="color:#F8F8F2">: GeometryProxy) {</span></span>
<span class="line"><span style="color:#FF79C6">            let</span><span style="color:#F8F8F2"> value </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> transform</span><span style="color:#F8F8F2">(proxy)</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> oldValue </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> nil</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">                oldValue </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">                newValue </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">                oldValue </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> newValue</span></span>
<span class="line"><span style="color:#F8F8F2">                newValue </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> value</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> action1, </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> newValue </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> newValue {</span></span>
<span class="line"><span style="color:#8BE9FD">                action1</span><span style="color:#F8F8F2">(newValue)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> action2, </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> oldValue, </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> newValue {</span></span>
<span class="line"><span style="color:#8BE9FD">                action2</span><span style="color:#F8F8F2">(oldValue, newValue)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="summary">Summary</h2>
<p>With the continuous improvement of SwiftUI features, the direct use of GeometryReader may become less and less. However, without a doubt, GeometryReader is still an important tool in SwiftUI. Developers need to correctly apply it to the appropriate scene.</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">Every Monday, sharing handpicked Swift and SwiftUI development highlights with you.</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">Continue Reading</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2023-11-09T00:20:00.000Z",
  "datePublished": "2023-11-09T00:20:00.000Z",
  "description": "Explore GeometryReader's common problems in SwiftUI. Is it a curse or a blessing? Understand its layout, information retrieval, performance, and when to use it correctly. Includes new onGeometryChange API & replications.",
  "headline": "GeometryReader: Blessing or Curse?",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/geometryreader-blessing-or-curse-en.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/geometryreader-blessing-or-curse/"
  },
  "url": "https://fatbobman.com/en/posts/geometryreader-blessing-or-curse/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">Get weekly handpicked updates on Swift and SwiftUI!</div> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0">  <button type="button" class="bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700  me-2 mb-2" onclick="window.open('https://www.paypal.com/paypalme/fatbobman')"> <!-- <svg class="w-4 h-4 me-2 -ms-1" width="337" height="63">
    <use href="/images/paypal.svg#main"></use>
  </svg> --> <img src="/images/paypal.svg" alt="" width="24" height="24" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium hover:text-yellow-100">Donate via Paypal</span> </button> </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/en";

  fetch(url)
    .then(response => response.text())
    .then(html => {
      // 获取所有的广告位元素
      const adSlots = document.querySelectorAll('.dynamic-ad-container');
      // 将广告内容填充到每一个广告位中
      adSlots.forEach(slot => {
        slot.innerHTML = html;
      });
    })
    .catch(error => console.error('Error loading the ad:', error));
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">Related Posts</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">Related Posts</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/mastring-geometrygroup/" id="relatedPosts-SwiftUI geometryGroup() Guide: From Theory to Practice"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI geometryGroup() Guide: From Theory to Practice</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/layout-in-swiftui-way/" id="relatedPosts-Layout in SwiftUI Way"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Layout in SwiftUI Way</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/layout-alignment/" id="relatedPosts-Alignment in SwiftUI: Everything You Need to Know"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Alignment in SwiftUI: Everything You Need to Know</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/mastering-viewthatfits/" id="relatedPosts-Mastering ViewThatFits"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Mastering ViewThatFits</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/weekly/issue-063" id="relatedPosts-Weekly #63 - Breakthroughs in Xenotransplantation of Kidneys"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #63 - Breakthroughs in Xenotransplantation of Kidneys</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/how_to_judge_scrollview_is_scrolling/" id="relatedPosts-How to Determine if ScrollView, List is Currently Scrolling in SwiftUI"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">How to Determine if ScrollView, List is Currently Scrolling in SwiftUI</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="GeometryReader ：好东西还是坏东西？" data-lang="en"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#some-criticisms-of-geometryreader" class=""> Some Criticisms of GeometryReader </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#what-is-geometryreader?" class=""> What is GeometryReader? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#is-geometryreader-a-layout-container?-what-is-its-layout-logic?" class=""> Is GeometryReader a layout container? What is its layout logic? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#why-can't-geometryreader-get-the-correct-information?" class=""> Why can&#39;t GeometryReader get the correct information? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#performance-issues-with-geometryreader" class=""> Performance issues with GeometryReader </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#layout-in-the-swiftui-way" class=""> Layout in the SwiftUI way </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#appearance-and-essence-the-size-may-not-be-the-same" class=""> Appearance and Essence: The size may not be the same </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#visualeffect-you-can-obtain-geometric-information-without-using-geometryreader" class=""> visualEffect: You can obtain geometric information without using GeometryReader </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#new-api-ongeometrychange" class=""> New API: onGeometryChange </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#summary" class=""> Summary </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    console.log(sidebarOffsetTop, window.scrollY, initialTop - stickyPoint);
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/en/posts/persistent-history-tracking-in-swiftdata/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>How to Observe Data Changes in SwiftData using Persistent History Tracking</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/persistent-history-tracking-in-swiftdata/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/en/posts/mastering-viewthatfits/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>Mastering ViewThatFits</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/mastering-viewthatfits/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=GeometryReader%3A%20Blessing%20or%20Curse%3F&#38;url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fgeometryreader-blessing-or-curse%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=GeometryReader%3A%20Blessing%20or%20Curse%3F%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fgeometryreader-blessing-or-curse%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Fgeometryreader-blessing-or-curse%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fgeometryreader-blessing-or-curse%2F&#38;title=GeometryReader%3A%20Blessing%20or%20Curse%3F%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fgeometryreader-blessing-or-curse%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=Article%3A%E3%80%90GeometryReader%3A%20Blessing%20or%20Curse%3F%E3%80%91&#38;body=Here's%20an%20article%20you%20may%20find%20interesting%3A%0A%0AGeometryReader%3A%20Blessing%20or%20Curse%3F%0A%0ALink%3A%20https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fgeometryreader-blessing-or-curse%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Website</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">Health Notes</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Follow</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">Newsletter</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a>  <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Info</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/about/" class="hover:text-secondary">About</a> <a href="/en/sponsorship/" class="hover:text-secondary"> Sponsor </a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright ©  2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "en";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
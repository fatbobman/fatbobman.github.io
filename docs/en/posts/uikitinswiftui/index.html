<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>Using UIKit Views in SwiftUI</title>
<meta name="description" content="Learn how to use UIKit views in SwiftUI, style them, and understand key considerations when wrapping a UITextField. Master UIViewRepresentable for seamless integration.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/uikitinswiftui/">
<meta property="og:title" content="Using UIKit Views in SwiftUI">
<meta property="og:description" content="Learn how to use UIKit views in SwiftUI, style them, and understand key considerations when wrapping a UITextField. Master UIViewRepresentable for seamless integration.">
<meta property="og:url" content="https://fatbobman.com/en/posts/uikitinswiftui/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://fatbobman.com/images/blog-card.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><!-- 其他路径的 hreflang -->
  <link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/uikitinswiftui/">
  <link rel="alternate" hreflang="zh-CN" href="https://fatbobman.com/zh/posts/uikitinswiftui/">
  <link rel="alternate" hreflang="x-default" href="https://fatbobman.com/en/posts/uikitinswiftui/"><script type="text/partytown" src="https://analytics.ahrefs.com/analytics.js" data-key="KF0NNRpbcfyJPzijzZEiOw"></script><script data-partytown-skip="true">
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.async = true; // Add async attribute
        hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script><script type="text/partytown">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@id": "#author"
  },
  "dateModified": "2021-08-23T03:12:00.000Z",
  "datePublished": "2021-08-23T03:12:00.000Z",
  "description": "Learn how to use UIKit views in SwiftUI, style them, and understand key considerations when wrapping a UITextField. Master UIViewRepresentable for seamless integration.",
  "headline": "Using UIKit Views in SwiftUI",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/uikitinswiftui/"
  },
  "url": "https://fatbobman.com/en/posts/uikitinswiftui/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  },
  "articleSection": [
    "SwiftUI"
  ],
  "inLanguage": "en"
}</script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "Person",
  "@id": "#author",
  "name": "东坡肘子 (徐杨)",
  "alternateName": "Fatbobman (Xu Yang)",
  "jobTitle": "Apple Developer",
  "description": "苹果生态开发者，专注 Swift 和 SwiftUI 开发。Fatbobman's Blog 作者。",
  "url": "https://fatbobman.com",
  "image": {
    "@type": "ImageObject",
    "url": "https://cdn.fatbobman.com/FatWithBoys.png"
  },
  "sameAs": [
    "https://github.com/fatbobman",
    "https://x.com/fatbobman",
    "https://www.linkedin.com/in/fatbobman/",
    "https://bsky.app/profile/fatbobman.com",
    "https://mastodon.social/@fatbobman",
    "https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3",
    "https://fatbobman.com/zh/about/",
    "https://fatbobman.com/en/about/"
  ],
  "worksFor": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script><link rel="stylesheet" href="/_astro/about.4LkOSyze.css">
<link rel="stylesheet" href="/_astro/_slug_.C4bWZTUX.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);background-color:#ffffffe6}.dark .sticky[data-astro-cid-4wsjtibl]{background-color:#171717e6}.sticky[data-astro-cid-4wsjtibl] .sticky-logo[data-astro-cid-4wsjtibl]{width:2rem;opacity:1;margin-right:.75rem}
</style><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push","gtag"])})(window,'partytown','forward');/* Partytown 0.11.2 - MIT QwikDev */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,l,d,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(d=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(l=setTimeout(v,(null==s?void 0:s.fallbackTimeout)||1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.11.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<d.length;n++)(o=r.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(l)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <!-- 
    修改点 1: px-4 sm:px-6
    给大标题区域增加左右边距，防止在屏幕变窄时贴边。
  --> <div class="max-w-5xl mx-auto px-4 sm:px-6 pt-6 pb-4 sm:pb-6" data-astro-cid-4wsjtibl> <div id="blogTitle" class="w-full"> <!-- 
    修改点 1: class="group block w-full"
    让链接容器变成块级元素并占满整行，确保内部内容可以基于整个页面宽度居中
  --> <a href="/en/" class="group block w-full"> <!-- 
      修改点 2: justify-center
      确保 Flex 容器的内容在水平方向上绝对居中
    --> <div class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-5 mx-auto pt-6 sm:pt-8 pb-2 sm:pb-0"> <!-- 吉祥物图标 --> <img src="/_astro/fat-blog-slug-icon.Cw1pK0wd.webp" class="w-20 h-20 sm:w-14 sm:h-14 rounded-full shadow-sm transition-transform duration-300 group-hover:rotate-12 group-hover:scale-105" alt="Fatbobman Logo"> <!-- SVG 文字容器 --> <div class="font-black w-[240px] sm:w-[300px] text-heading transition-opacity duration-300 group-hover:opacity-80 mt-2 sm:mt-0 sm:-mb-1"> <svg fill="currentColor" width="100%" viewBox="0 0 500 100"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </div> </a> </div> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <!-- 
      修改点 2: px-4 sm:px-6 py-3
      1. 删除了原来的 p-2 sm:p-0
      2. 增加了统一的 px-4 sm:px-6，让 Sticky 导航栏左右两端留有空白，不再紧贴屏幕边缘。
      3. 增加了 py-3，让导航栏高度稍微高一点点，看起来更从容。
    --> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto px-4 sm:px-6 py-3" data-astro-cid-4wsjtibl> <div class="flex items-center space-x-2" data-astro-cid-4wsjtibl> <!-- Sticky Logo --> <a href="/" class="sticky-logo overflow-hidden transition-all duration-500 w-0 opacity-0 flex items-center justify-center" aria-label="Fatbobman Blog" data-astro-cid-4wsjtibl> <!-- 这里使用修改后的小尺寸 Logo (h-6 或 h-7) --> <img src="/_astro/fat-blog-slug-icon.Cw1pK0wd.webp" class="h-6 w-6 rounded-full" alt="Logo" data-astro-cid-4wsjtibl> </a> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" aria-label="Change Language" class="group p-2 w-10 h-10 text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <!-- 替换文字为 SVG 图标 --> <!-- 
    这里使用 w-5 h-5 (20px) 配合 stroke-width="2" 
    以匹配 SearchButton 和 ThemeSwitcher 的视觉分量
  --> <svg class="w-5 h-5 fill-none stroke-current" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <!-- 一个简单的地球图标 --> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-language"></use> </svg> <!-- 可选：如果非要保留文字，可以把文字做小一点放在图标旁边，或者只在 Hover 时显示 --> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <button type="button" onclick="
            try {
                if ('#' !== '#') {
                    window.location.href = '#';
                }
            } catch (e) {
                console.log('Navigation failed:', e);
            }
        " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-language"></use> </svg> </div> </button> </li><li> <button type="button" onclick="
              try {
                  if ('/zh/posts/uikitinswiftui/' !== '#') {
                      window.location.href = '/zh/posts/uikitinswiftui/';
                  }
              } catch (e) {
                  console.log('Navigation failed:', e);
              }
          " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-check"></use> </svg> </div> </button> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> <script type="module">function a(){const t=localStorage.getItem("lang"),e=document.getElementById("EN-check"),n=document.getElementById("ZH-check");e!==null&&n!==null&&(t==="en"?(e.classList.remove("hidden"),n.classList.add("hidden")):t==="zh"&&(n.classList.remove("hidden"),e.classList.add("hidden")))}document.addEventListener("DOMContentLoaded",()=>{a()});const l=document.getElementById("set-default-lang");l?.addEventListener("click",()=>{const t=document.getElementById("lang-data");if(t!=null){const e=t.dataset.lang;e!=null&&(localStorage.setItem("lang",e),a())}});</script> </div> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" aria-label="Theme Switcher" class="group p-2 w-10 h-10 text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <!-- 
    已更新为统一的 24px 线性图标 
    注意：移除了 fill-current，改为 fill="none" stroke="currentColor"
  --> <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" fill="none" class="w-5 h-5 hidden" id="theme_icon_system"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-computer"></use> </svg> <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" fill="none" class="w-5 h-5 hidden" id="theme_icon_dark"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-moon"></use> </svg> <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" fill="none" class="w-5 h-5 hidden" id="theme_icon_light"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-sun"></use> </svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex w-full px-4 py-2 text-sm align-text-center hover:text-secondary" id="theme_button_light"> <svg class="w-5 h-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-sun"></use> </svg> <span class="ml-2">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex w-full px-4 py-2 text-sm align-text-center hover:text-secondary" id="theme_button_dark"> <svg class="w-5 h-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-moon"></use> </svg> <span class="ml-2">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex w-full px-4 py-2 text-sm align-text-center hover:text-secondary" id="theme_button_system"> <svg class="w-5 h-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-computer"></use> </svg> <span class="ml-2">System</span> </button> </li> </ul> </div> <script>
  // 获取按钮
  var themeDropdownButton = document.getElementById('theme-dropdown-button'); // 新增：获取主开关按钮
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');

  // 获取图标
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    // 先隐藏所有，再显示对应的
    themeToggleDarkIcon.classList.add('hidden');
    themeToggleLightIcon.classList.add('hidden');
    themeToggleSystemIcon.classList.add('hidden');

    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
    } else if (theme === 'light') {
      themeToggleLightIcon.classList.remove('hidden');
    } else {
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  // 初始化
  resetTheme();

  // 监听系统暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    resetTheme();
  });

  // 监听 Storage 变化 (多标签页同步)
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      resetTheme();
    }
  });

  // --- 核心修复：点击选项后，同时关闭下拉菜单 ---

  // Dark 模式
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
    themeDropdownButton.click(); // 模拟点击主按钮以关闭菜单
  });

  // Light 模式
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
    themeDropdownButton.click(); // 模拟点击主按钮以关闭菜单
  });

  // System 模式
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
    themeDropdownButton.click(); // 模拟点击主按钮以关闭菜单
  });
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center cursor-pointer"> <svg class="w-5 h-5 fill-none stroke-current" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-search"></use> </svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent " aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Tips </a><a href="/en/sponsorship/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Sponsorship </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> About </a> </ul> </nav> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header>  <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto">   <!-- 
  调整 1: 减小垂直间距 
  pt-16 -> pt-12, pb-10 -> pb-8 
--><header class="mx-auto max-w-3xl text-center pt-12 pb-8 px-4 sm:px-6">  <div class="flex flex-wrap justify-center items-center gap-2.5 mb-6">  <a href="/zh/posts/uikitinswiftui/" id="language-switcher-for-topic" class="
          inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border transition-all
          /* Light: 白底黑字 */
          bg-white text-gray-600 border-gray-200 hover:bg-gray-900 hover:text-white hover:border-gray-900
          /* Dark: 调整为半透明蓝底 (Tinted Blue)，看起来更清透，不发灰 */
          dark:bg-blue-500/10 dark:text-blue-300 dark:border-blue-500/20 dark:hover:bg-blue-500/20 dark:hover:text-blue-200
        "> <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg> 阅读中文版 </a>  <a href="/en/tags/SwiftUI/" class="
          inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold transition-colors
          bg-red-50 text-red-600 hover:bg-red-100
          dark:bg-blue-500/10 dark:text-blue-400 dark:hover:bg-blue-500/20
        ">
#SwiftUI </a> </div>  <h1 class="
      text-2xl sm:text-3xl md:text-4xl font-extrabold text-heading leading-tight mb-6
      tracking-tight
    "> Using UIKit Views in SwiftUI </h1>  <div class="flex flex-wrap justify-center items-center text-sm text-muted font-medium gap-x-4 gap-y-2 "> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="flex items-center hover:text-primary transition-colors group"> <span class="border-b border-transparent group-hover:border-primary transition-colors"> Fatbobman </span> </a> <span class="text-gray-300 dark:text-slate-700" aria-hidden="true">&bull;</span> <time datetime="2021-08-23T03:12:00.000Z"> Aug 23, 2021 </time>  </div> </header> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full "> <div> 

<p>As SwiftUI enters its third year, it offers more native functionalities than at its inception, but there are still many tasks that cannot be accomplished with native SwiftUI code alone. For a considerable time, developers will need to rely on UIKit (or AppKit) code within SwiftUI. Fortunately, SwiftUI provides a convenient way for developers to wrap UIKit (or AppKit) views (or controllers) into SwiftUI views.</p>
<p>This article explains the following points through the wrapping of <code>UITextField</code>:</p>
<ul>
<li>How to use UIKit views in SwiftUI</li>
<li>How to give your UIKit wrapper views a SwiftUI style</li>
<li>Considerations when using UIKit views in SwiftUI</li>
</ul>
<blockquote>
<p><strong>If you’re already familiar with using <code>UIViewRepresentable</code>, you can start reading from the <code>Styling in SwiftUI</code> section.</strong></p>
</blockquote>
<aside aria-label="advertisement" role="complementary"><div class="dynamic-ad-inline"></div></aside>
<h2 id="basics">Basics</h2>
<p>Before demonstrating the wrapping code, let’s introduce some basics related to using UIKit views in SwiftUI.</p>
<blockquote>
<p>Don’t worry if you don’t understand the following content immediately, more details in the subsequent demonstration will help you grasp the necessary knowledge.</p>
</blockquote>
<h3 id="lifecycle">Lifecycle</h3>
<p>One of the main differences between SwiftUI and UIKit (or AppKit) is that SwiftUI views are value types and not references to the actual rendered content on the screen. In SwiftUI, developers create descriptions of views without actually rendering them.</p>
<p>In UIKit (or AppKit), views (or view controllers) have clear lifecycle milestones, like <code>viewDidload</code>, <code>loadView</code>, <code>viewWillAppear</code>, <code>didAddSubView</code>, <code>didMoveToSuperview</code>, etc., acting as hooks for developers to execute logic in response to system events.</p>
<p>SwiftUI views, being value types and declarations, lack a clear lifecycle. SwiftUI provides several modifiers (like <code>onAppear</code>, similar to UIKit’s <code>viewWillAppear</code>) to mimic the behavior of UIKit’s hook methods. Unlike UIKit, <code>onAppear</code> and <code>onDisappear</code> are declared on the parent view of the current view.</p>
<p>When wrapping a UIKit view into a SwiftUI view, it’s important to understand the differences in their lifecycles and approach the integration from a SwiftUI perspective, rather than trying to find direct method correspondences.</p>
<h3 id="uiviewrepresentable-protocol">UIViewRepresentable Protocol</h3>
<p>Wrapping a UIView in SwiftUI is straightforward: create a struct that conforms to the <code>UIViewRepresentable</code> protocol.</p>
<blockquote>
<p><code>UIViewControllerRepresentable</code> corresponds to <code>UIViewController</code>, <code>NSViewRepresentable</code> to <code>NSView</code>, and <code>NSViewControllerRepresentable</code> to <code>NSViewController</code>. The internal structure and logic are consistent across these.</p>
</blockquote>
<p>The <code>UIViewRepresentable</code> protocol is simple, including only four methods: <code>makeUIView</code>, <code>updateUIView</code>, <code>dismantleUIView</code>, and <code>makeCoordinator</code>. <code>makeUIView</code> and <code>updateUIView</code> are mandatory to implement.</p>
<p><code>UIViewRepresentable</code> itself conforms to the <code>View</code> protocol, so any struct that adheres to it is treated as a standard SwiftUI view. However, due to its special purpose, the lifecycle of a <code>UIViewRepresentable</code> differs from a standard SwiftUI view.</p>
<p><picture>
  <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/500"/>
  <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/768"/>
  <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png?imageView2/0/w/1024"/>
  <img src="https://cdn.fatbobman.com/UIViewRepresentableLifeCycle-9614888.png" alt="UIViewRepresentableLifeCycle" loading="lazy" decoding="async"/>
</picture></p>
<ul>
<li>
<p>makeCoordinator</p>
<p>If a Coordinator is declared, <code>UIViewRepresentable</code> will first create its instance after initialization, to be used in other methods. Coordinator defaults to <code>Void</code>. This method is called only once in the lifecycle, creating only one coordinator instance.</p>
</li>
<li>
<p>makeUIView</p>
<p>Creates an instance of the UIKit view to be wrapped. This method is called only once in the lifecycle.</p>
</li>
<li>
<p>updateUIView</p>
<p>SwiftUI updates the interface parts affected by changes in the application’s state. When injected dependencies in <code>UIViewRepresentable</code> change, SwiftUI calls <code>updateUIView</code>. Its timing is consistent with the standard SwiftUI view’s <code>body</code>, but while <code>body</code> computes values, <code>updateUIView</code> just notifies the <code>UIViewRepresentable</code> of dependency changes, leaving it to the developer to respond accordingly.</p>
<p>This method is called multiple times in the lifecycle until the view is removed from the view tree (or switched to another branch not containing the view).</p>
<p><strong>After <code>makeUIView</code> is executed, <code>updateUIView</code> will always be executed once.</strong></p>
</li>
<li>
<p>dismantleUIView</p>
<p>Before the <code>UIViewRepresentable</code> view is removed from the view tree, SwiftUI calls <code>dismantleUIView</code>, often used for cleanup actions like removing observers. <code>dismantleUIView</code> is a type method.</p>
</li>
<li>
<p>sizeThatFits</p>
<p>Returns the required size of the view. Starting with iOS 16, UIViewRepresentable has incorporated a sizeThatFits method consistent with the logic of the Layout protocol.</p>
</li>
</ul>
<p>The following code creates a spinner like <code>ProgressView</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MyProgrssView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> UIViewRepresentable </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> makeUIView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">context</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Context</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> UIActivityIndicatorView </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> view </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> UIActivityIndicatorView</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        view.</span><span style="color:#998418;--shiki-dark:#97E1F1">startAnimating</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        return</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> view</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> updateUIView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> uiView</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIActivityIndicatorView, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">context</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Context</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {}</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Demo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        MyProgrssView</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<h3 id="the-black-box">The Black Box</h3>
<p>In SwiftUI, when drawing on the screen, the system starts evaluating the <code>body</code> of views from the top of the view tree, recursively evaluating any child views until the final result is obtained. However, SwiftUI cannot perform an infinite number of calls to render views, so it must find a way to shorten the recursion. To end recursion, SwiftUI includes several primitive types. When recursion reaches these primitive types, recursion ends, and SwiftUI no longer cares about their <code>body</code>, allowing them to manage their assigned areas.</p>
<p>SwiftUI marks a <code>View</code> as a primitive type by defining its <code>body</code> as <code>Never</code>. <code>UIViewRepresentable</code> is one such primitive type (others include <code>Text</code>, <code>ZStack</code>, <code>Color</code>, <code>List</code>, etc.).</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> protocol</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> UIViewRepresentable</span><span style="color:#999999;--shiki-dark:#F6F6F4"> :</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#1E754F;--shiki-dark:#F286C4">where</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.Body </span><span style="color:#AB5959;--shiki-dark:#F286C4">==</span><span style="color:#A65E2B;--shiki-dark:#BF9EEE"> Never</span></span></code></pre>
<p>In fact, almost all primitive types are wrappers around underlying UIKit or AppKit components.</p>
<p>As a primitive type, SwiftUI knows little about the internals of <code>UIViewRepresentable</code> (as it doesn’t need to). Developers typically need to work in the Coordinator of the <code>UIViewRepresentable</code> view to ensure communication and connection between the two frameworks (SwiftUI and UIKit).</p>
<h3 id="coordinator">Coordinator</h3>
<p>Apple frameworks often use the term “Coordinator”, like in UIKit’s coordinator design pattern or Core Data’s persistent store coordinator. However, in <code>UIViewRepresentable</code>, the concept of a Coordinator is entirely different, serving mainly the following purposes:</p>
<ul>
<li>
<p>Implementing UIKit view delegates</p>
<p>UIKit components often rely on delegates for functionality. A delegate is an object that responds to events occurring elsewhere. For example, in UIKit, a delegate object attached to a text field view is called when a user types or presses the return key. By declaring the coordinator as the delegate for a UIKit view, delegate methods can be implemented within it.</p>
</li>
<li>
<p>Communicating with the SwiftUI framework</p>
<p>As mentioned, <code>UIViewRepresentable</code>, being a primitive type, takes on more communication with the SwiftUI framework or other views. In the coordinator, communication with SwiftUI or other modules can be managed through two-way bindings (<code>Binding</code>), notification centers, or unidirectional data flows like Redux.</p>
</li>
<li>
<p>Handling complex logic within UIKit views</p>
<p>In UIKit development, business logic is often placed in the UIViewController. Since SwiftUI lacks the concept of a Controller, and views are merely state presentations, it can be challenging to completely strip complex functionalities from UIKit components according to SwiftUI’s pattern. Thus, complex business logic that can’t be separated is placed in the coordinator, close to delegate methods, for better coordination and management.</p>
</li>
</ul>
<h2 id="wrapping-uitextfield">Wrapping UITextField</h2>
<p>In this section, we will use the above knowledge to implement a <code>TextFieldWrapper</code> with basic functionality.</p>
<h3 id="version-10">Version 1.0</h3>
<p>In the first version, we aim to replicate the functionality similar to the following native code:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">name:</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span></code></pre>
<p><picture>
  <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/500"/>
  <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/768"/>
  <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822184949860-9629391.png?imageView2/0/w/1024"/>
  <img src="https://cdn.fatbobman.com/image-20210822184949860-9629391.png" alt="image-20210822184949860" loading="lazy" decoding="async"/>
</picture></p>
<p><a href="https://gist.github.com/733f3c8ef4c69a1e4ed4bd81bf4750e3.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<p>In <code>makeUIView</code>, we create an instance of <code>UITextField</code> and set its placeholder and text. In the preview, we can see the placeholder displayed normally. If you type text into it, it behaves just like <code>TextField</code>.</p>
<p>Using <code>.border</code>, we notice that the size of TextFieldWrapper does not meet expectations. This is because UITextField, without constraints, will occupy all available space by default. This issue did not occur in the previous demonstration with <code>UIActivityIndicatorView</code>. Therefore, for different UIKit components, we need to understand their default settings and constrain them as necessary.</p>
<p>Adding the following statement to <code>makeUIView</code> aligns the text field’s size with our expectations:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        textfield.</span><span style="color:#998418;--shiki-dark:#97E1F1">setContentHuggingPriority</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">defaultHigh</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">for</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">vertical</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        textfield.</span><span style="color:#998418;--shiki-dark:#97E1F1">setContentCompressionResistancePriority</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">defaultLow</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">for</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">horizontal</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span></code></pre>
<p>Let’s adjust the <code>Demo</code> view by adding <code>Text(&quot;name:\(name)&quot;)</code> under <code>.padding()</code>. Normally, as with <code>TextField</code>, any text entered should be displayed in the <code>Text</code> below, but this is not the case with our current code version.</p>
<p><picture>
  <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/500"/>
  <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/768"/>
  <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822190605447-9630366.png?imageView2/0/w/1024"/>
  <img src="https://cdn.fatbobman.com/image-20210822190605447-9630366.png" alt="image-20210822190605447" loading="lazy" decoding="async"/>
</picture></p>
<p>Let’s analyze the code again.</p>
<p>Even though we declared a <code>Binding&lt;String&gt;</code> type <code>text</code> and assigned it to <code>textfield</code> in <code>makeUIView</code>, <code>UITextField</code> does not automatically pass the entered content back to <code>Binding&lt;String&gt;</code> <code>text</code>. This means that the <code>name</code> in the <code>Demo</code> view does not change with text entry.</p>
<p><code>UITextField</code> calls the delegate method <code>func textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -&gt; Bool</code> with each text entry</p>
<p>. Therefore, we need to create a coordinator and implement this method in the coordinator to pass the entered content to the <code>name</code> variable in the <code>Demo</code> view.</p>
<p>Creating the coordinator:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Coordinator</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">NSObject</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">UITextFieldDelegate</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">        @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Binding</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">text</span><span style="color:#393A34;--shiki-dark:#F6F6F4">:Binding</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;){</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">            self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">_text</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        func</span><span style="color:#59873A;--shiki-dark:#62E884"> textField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> textField</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UITextField, </span><span style="color:#59873A;--shiki-dark:#62E884">shouldChangeCharactersIn</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> range</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: NSRange, </span><span style="color:#59873A;--shiki-dark:#62E884">replacementString</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> string</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Bool</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            if</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> textField.</span><span style="color:#998418;--shiki-dark:#BF9EEE">text</span><span style="color:#AB5959;--shiki-dark:#F286C4"> as</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> NSString</span><span style="color:#AB5959;--shiki-dark:#F286C4">?</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">                let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> finaltext </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text.</span><span style="color:#998418;--shiki-dark:#97E1F1">replacingCharacters</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">in</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> range, </span><span style="color:#998418;--shiki-dark:#97E1F1">with</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> string</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">                self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">text</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> finaltext </span><span style="color:#AB5959;--shiki-dark:#F286C4">as</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> String</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            return</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> true</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>We need to pass data back in the <code>textField</code> method, so <code>Binding&lt;String&gt;</code> is also used in the <code>Coordinator</code>, making operations on <code>text</code> equivalent to operations on <code>name</code> in the <code>Demo</code> view.</p>
<p>If the <code>Coordinator</code> in a <code>UIViewRepresentable</code> view is not <code>Void</code>, it must be instantiated with <code>makeCoordinator</code>. Add the following code to <code>TextFieldWrapper</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> makeCoordinator</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Coordinator </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#AB5959;--shiki-dark:#F286C4">init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> $text</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span></code></pre>
<p>Finally, in <code>makeUIView</code>, add:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    textfield.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">delegate</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> context.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">coordinator</span></span></code></pre>
<p>UITextField will look for and call the corresponding delegate methods in the coordinator after certain events occur.</p>
<p><picture>
  <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/500"/>
  <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/768"/>
  <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210822191834883-9631115.png?imageView2/0/w/1024"/>
  <img src="https://cdn.fatbobman.com/image-20210822191834883-9631115.png" alt="image-20210822191834883" loading="lazy" decoding="async"/>
</picture></p>
<p><a href="https://gist.github.com/cb34b4f96525ac49193a36cd1d5fc135.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<p>At this point, our <code>UITextField</code> wrapper behaves like the native <code>TextField</code>.</p>
<p><strong>Are you sure?</strong></p>
<p>Let’s modify the <code>Demo</code> view again:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Demo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        VStack</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">name:</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> $name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">border</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">blue</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">padding</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">name:</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">name</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            Button</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Random Name</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">){</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                name </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> String</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">random</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">in</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span><span style="color:#AB5959;--shiki-dark:#F286C4">...</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">100</span><span style="color:#999999;--shiki-dark:#F6F6F4">))</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>As expected with the native <code>TextField</code>, when we press the <code>Random Name</code> button, both <code>Text</code> and the text in <code>TextFieldWrapper</code> should change to a random number generated by <code>String(Int.random(in: 0...100))</code>. However, if you test with the above code, the text in <code>TextFieldWrapper</code> does not change.</p>
<p>In <code>makeUIView</code>, we used <code>textfield.text = text</code> to get the value of <code>name</code> from the <code>Demo</code> view, but <code>makeUIView</code> is only executed once. When <code>Random Name</code> is clicked causing <code>name</code> to change, SwiftUI will call <code>updateUIView</code>, which we have not handled. Adding the following code to <code>updateUIView</code> will resolve this:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> updateUIView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> uiView</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIViewType, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">context</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Context</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        DispatchQueue.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">async</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            uiView.</span><span style="color:#998418;--shiki-dark:#BF9EEE">text</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span></code></pre>
<blockquote>
<p>The <code>makeUIView</code> method’s <code>context: Context</code> parameter allows access to the <code>Coordinator</code> (custom coordinator), <code>transaction</code> (how to handle state updates, animation mode), and <code>environment</code> (collection of environment values for the current view). We will demonstrate its use later. This <code>context</code> is also accessible in <code>updateUIView</code> and <code>dismantleUIView</code>. The parameter <code>_ uiView:UIViewType</code> in <code>updateUIView</code> is the UIKit view instance created in <code>makeUIView</code>.</p>
</blockquote>
<p><a href="https://gist.github.com/69fb1ff4462192ed318048166aeb9eaf.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<p>Now, our <code>TextFieldWrapper</code> indeed behaves just like <code>TextField</code>.</p>
<p><img src="https://cdn.fatbobman.com/textFieldWrappertest-9634034.gif" alt="textFieldWrappertest"/></p>
<h3 id="version-20---adding-settings">Version 2.0 - Adding Settings</h3>
<p>Building on the first version, we’ll add configurations like <code>color</code>, <code>font</code>, <code>clearButtonMode</code>, <code>onCommit</code>, and <code>onEditingChanged</code> to <code>TextFieldWrapper</code>.</p>
<blockquote>
<p>To avoid complicating the example, we’ll use <code>UIColor</code> and <code>UIFont</code> as configuration types. Converting SwiftUI’s <code>Color</code> and <code>Font</code> to their UIKit versions would significantly increase the code size.</p>
</blockquote>
<p><code>color</code>, <code>font</code>, and the newly added <code>clearButtonMode</code> do not require two-way data flow, so we don’t need to use <code>Binding</code> for them. We just need to respond to their changes in <code>updateView</code>.</p>
<p><code>onCommit</code> and <code>onEditingChanged</code> correspond to the UITextField delegate methods <code>textFieldShouldReturn</code>, <code>textFieldDidBeginEditing</code>, and <code>textFieldDidEndEditing</code>. We need to implement these methods in the coordinator and call the corresponding blocks.</p>
<p>First, modify the coordinator:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Coordinator</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> NSObject</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">UITextFieldDelegate </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">        @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Binding</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onCommit: </span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onEditingChanged: </span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Bool</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">text</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Binding</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">             onCommit</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">escaping</span><span style="color:#999999;--shiki-dark:#F6F6F4"> ()</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">             onEditingChanged</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">escaping</span><span style="color:#999999;--shiki-dark:#F6F6F4"> (</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Bool</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">            self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">_text</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> text</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">            self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">onCommit</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onCommit</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">            self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">onEditingChanged</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onEditingChanged</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // Delegate methods...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>Modify <code>TextFieldWrapper</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> UIViewRepresentable </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">    // Initializer and properties...</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    </span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    typealias</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> UIViewType</span><span style="color:#999999;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> UITextField</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> makeUIView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">context</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Context</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> UIViewType </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // Create and configure UITextField...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> updateUIView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> uiView</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIViewType, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">context</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Context</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // Update properties...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> makeCoordinator</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Coordinator </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#AB5959;--shiki-dark:#F286C4">init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> $text, </span><span style="color:#998418;--shiki-dark:#97E1F1">onCommit</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onCommit, </span><span style="color:#998418;--shiki-dark:#97E1F1">onEditingChanged</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onEditingChanged</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>Modify the <code>Demo</code> view:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Demo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> color: UIColor </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">red</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // VStack with TextFieldWrapper and other views...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p><a href="https://gist.github.com/5604d7bee11a44c2cbdcba12cfe1eda0.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<p><img src="https://cdn.fatbobman.com/textfieldwrapperdemo2-9639150-9639151.gif" alt="textfieldwrapperdemo2"/></p>
<h2 id="swiftui-styling">SwiftUI Styling</h2>
<p>We not only implemented settings for font and color but also added a <code>clearButtonMode</code> setting not present in the native <code>TextField</code>. Using the above method, we can gradually add more settings to <code>TextFieldWrapper</code> to enhance its functionality.</p>
<p><strong>But there seems to be something off with the code!</strong></p>
<p>As we add more configurations, the code becomes more cumbersome to use. How can we implement chainable calls like the native <code>TextField</code>, for example:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">name:</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> $name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">clearMode</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">whileEditing</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">onCommit</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">commit</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">red</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">title</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">disabled</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">allowEdit</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span></code></pre>
<p>In this section, we will rewrite the configuration code to style the UIKit wrapper in SwiftUI.</p>
<blockquote>
<p>We start with the code from the end of version 1.0.</p>
</blockquote>
<p>The so-called SwiftUI style, more precisely, refers to functional programming’s chainable calls. Operations are linked together with dots (.), enhancing readability. As Swift treats functions as first-class citizens, implementing the above chainable calls is quite straightforward. However, there are a few points to consider:</p>
<ul>
<li>How to change values within the View (as View is a structure)</li>
<li>How to handle the returned type (to ensure the call chain remains effective)</li>
<li>How to utilize and interact with existing data in the SwiftUI framework</li>
</ul>
<blockquote>
<p>The following examples use different approaches for demonstration. In actual use, choose the appropriate solution based on the specific needs.</p>
</blockquote>
<h3 id="foregroundcolor">foregroundColor</h3>
<p>In SwiftUI, we often use <code>foregroundColor</code> to set the foreground color. For instance:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">VStack</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">hello world</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">red</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">blue</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span></code></pre>
<p>There’s a difference between the two <code>foregroundColor</code> uses above.</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Text</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func</span><span style="color:#59873A;--shiki-dark:#62E884"> foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> color</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Color</span><span style="color:#999999;--shiki-dark:#F286C4">?</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Text</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func</span><span style="color:#59873A;--shiki-dark:#62E884"> foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> color</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: Color</span><span style="color:#999999;--shiki-dark:#F286C4">?</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#1E754F;--shiki-dark:#F286C4"> some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>The method name is the same, but the target objects differ. <code>Text</code> only looks for a <code>foregroundColor</code> setting in the current environment when it doesn’t have its own setting. The native <code>TextField</code> doesn’t have its <code>foregroundColor</code>, and we can’t access the SwiftUI view’s <code>foregroundColor</code> environment value (presumably). So, we can create</p>
<p>a dedicated <code>foregroundColor</code> for <code>TextFieldWrapper</code>.</p>
<p>Add a variable to <code>TextFieldWrapper</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> color: UIColor </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">label</span></span></code></pre>
<p>Add in <code>updateUIView</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">uiView.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">textColor</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> color</span></span></code></pre>
<p>Set the configuration method:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> TextFieldWrapper</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> color</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> view </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        view.</span><span style="color:#998418;--shiki-dark:#BF9EEE">color</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> color</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        return</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> view</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p><a href="https://gist.github.com/56f426b29a551c6490062f6daf3e342a.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<p>It’s that simple. Now we can use <code>.foreground(.red)</code> to set the text color of <code>TextFieldWrapper</code>.</p>
<p>This method is a common way to add extensions for specific view types. It has two advantages:</p>
<ul>
<li>Use of <code>private</code> keeps configuration variables unexposed.</li>
<li>It returns a specific type of view, maintaining the stability of the chain.</li>
</ul>
<p>We can use this approach for almost all chainable extensions. For a clearer and simpler code with many extensions, use the following approach:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> then</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> body</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#AB5959;--shiki-dark:#F286C4">inout</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> result </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        body</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#AB5959;--shiki-dark:#F286C4">&amp;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">result</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        return</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> result</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> foregroundColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> color</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIColor</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        then</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">            $0</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">color</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> color</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<h3 id="disabled">disabled</h3>
<p>SwiftUI has many extensions for <code>View</code>, many of which are passed down through <code>EnvironmentValue</code>. By directly responding to changes in these environment values, we can add configuration functionalities to <code>TextFieldWrapper</code> without writing specific extensions.</p>
<p>For example, <code>View</code> has a <code>.disabled</code> extension, commonly used to control the operability of interactive components (the corresponding <code>EnvironmentValue</code> for <code>.disable</code> is <code>isEnabled</code>).</p>
<p>Add to <code>TextFieldWrapper</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">isEnabled</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> isEnabled</span></span></code></pre>
<p>Add in <code>updateUIView</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">uiView.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">isEnabled</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> isEnabled</span></span></code></pre>
<p>Just two statements, and <code>TextFieldWrapper</code> can directly use <code>View</code>’s <code>disable</code> extension to control its data entry capability.</p>
<p>Remember the <code>context</code> mentioned earlier? We can directly access environment values from the context. Thus, supporting native <code>View</code> extensions becomes even simpler.</p>
<p><strong>No need</strong> to add <code>@Environment</code>, just add in <code>updateUIView</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">uiView.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">isEnabled</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> context.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">environment</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">isEnabled</span></span></code></pre>
<p><a href="https://gist.github.com/e749322c1add66b2f9b8732c62463c89.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<blockquote>
<p>When writing this article, running this code under iOS 15 beta showed a warning <code>AttributeGraph: cycle detected through attribute</code>. This is likely an iOS 15 bug, so please ignore it.</p>
</blockquote>
<p>Using environment values for settings is a very convenient approach. The only thing to note is that it changes the return value of the chainable structure. Therefore, any chainable methods following this node should be extensions for <code>View</code>, like the <code>foregroundColor</code> we created earlier, which can only be placed before this node.</p>
<h3 id="font">font</h3>
<p>We can also create our environment values for configuring <code>TextFieldWrapper</code>. For example, SwiftUI provides a <code>font</code> environment value of type <code>Font</code>. In this case, we’ll create an environment value setting for <code>UIFont</code>.</p>
<p>Create the environment value <code>myFont</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MyFontKey</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentKey </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    static</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> defaultValue: UIFont</span><span style="color:#999999;--shiki-dark:#F286C4">?</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentValues</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> myFont: UIFont</span><span style="color:#999999;--shiki-dark:#F286C4">?</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        get</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">MyFontKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        set</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">MyFontKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> newValue </span><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>Add in <code>updateUIView</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">uiView.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">font</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> context.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">environment</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">myFont</span></span></code></pre>
<p>There are multiple ways to implement the <code>font</code> method:</p>
<ul>
<li>Extend <code>TextFieldWrapper</code> similar to <code>foregroundColor</code></li>
</ul>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> font</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIFont</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#1E754F;--shiki-dark:#F286C4"> some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">myFont</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, font</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span></code></pre>
<ul>
<li>Extend <code>View</code></li>
</ul>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> font</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: UIFont</span><span style="color:#999999;--shiki-dark:#F286C4">?</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#1E754F;--shiki-dark:#F286C4"> some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">myFont</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, font</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre>
<p>Both methods change the return value of the chainable node to something other than <code>TextFieldWrapper</code>, so subsequent methods in the chain should be extensions for <code>View</code>.</p>
<p><a href="https://gist.github.com/c9602681774540dbca929e21c99827c7.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<h3 id="oncommit">onCommit</h3>
<p>In version 2 of the code, we added the <code>onCommit</code> feature to <code>TextFieldWrapper</code>, which triggers when the user presses <code>return</code>. In this example, we introduce a modifiable version of <code>onCommit</code> that does not require passing through the coordinator’s constructor.</p>
<p>A key technique here, as seen in previous examples, is the ability to change variables within the coordinator directly in <code>updateUIView</code>. This can be done as follows:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">context.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">coordinator</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">onCommit</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onCommit</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">context.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">coordinator</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">onEditingChanged</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> onEditingChanged</span></span></code></pre>
<p>This method is an effective way to facilitate communication between SwiftUI and the coordinator.</p>
<p><picture>
  <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/500"/>
  <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/768"/>
  <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20210823091321562.png?imageView2/0/w/1024"/>
  <img src="https://cdn.fatbobman.com/image-20210823091321562.png" alt="Coordinator Example" loading="lazy" decoding="async"/>
</picture></p>
<p><a href="https://gist.github.com/716b08616fa6ecbd28589ac94b635706.git?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">View Source Code</a></p>
<h2 id="avoiding-overuse-of-uikit-wrapping">Avoiding Overuse of UIKit Wrapping</h2>
<p>While using UIKit or AppKit within SwiftUI is not difficult, careful consideration is needed when deciding to wrap a UIKit control (especially when there’s an existing native SwiftUI solution).</p>
<p>Apple has big ambitions for SwiftUI, not only bringing a declarative and reactive programming experience to developers but also investing heavily in cross-device and cross-platform support within the Apple ecosystem.</p>
<p>Apple has optimized each native control, like <code>TextField</code>, for different platforms (iOS, macOS, tvOS, watchOS) – a task difficult for others to replicate. Therefore, before wrapping a system control for a specific feature, consider the following points:</p>
<h3 id="official-native-solutions">Official Native Solutions</h3>
<p>SwiftUI has developed rapidly in recent years, with each version introducing new features. The documentation support for SwiftUI has improved significantly in the last two years, though it’s not yet satisfactory. For developers, I recommend purchasing “A Companion for SwiftUI” by Javier. This app provides a more comprehensive and clear guide to SwiftUI APIs than the official documentation. It reveals many functionalities provided by SwiftUI.</p>
<h3 id="native-combinations-for-solutions">Native Combinations for Solutions</h3>
<p>Before SwiftUI 3.0, there was no <code>searchbar</code>. Two approaches were possible: wrapping a UIKit <code>UISearchBar</code> or combining native SwiftUI methods to create a <code>searchbar</code>. Both approaches could yield satisfactory results. However, the native method offers more flexibility in composition and supports using <code>LocalizedString</code> as a placeholder. I personally prefer the combination approach.</p>
<blockquote>
<p>Note: SwiftUI does not officially offer conversions for many data types to other framework types, such as <code>Color</code> and <code>Font</code>, though these can still be converted with some extra coding. <code>LocalizedString</code> can only be converted through non-standard means (using <code>Mirror</code>), which might not be reliable long-term.</p>
</blockquote>
<h3 id="introspect-for-swiftui">Introspect for SwiftUI</h3>
<p>In version 2, we added <code>clearButtonMode</code> to <code>TextFieldWrapper</code>, a feature not yet supported by native <code>TextField</code>. However, wrapping <code>UITextField</code> just for this feature would be a mistake.</p>
<p><a href="https://github.com/siteline/SwiftUI-Introspect?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">Introspect</a> uses introspection to find UIKit (or AppKit) components behind native controls. Many features not yet exposed in SwiftUI can be implemented using this extension library.</p>
<p>For example, the following code adds <code>clearButtonMode</code> to the native <code>TextField</code>:</p>
<div class="code-header flex justify-between items-center h-9 px-4 text-xs font-medium font-sans rounded-t-lg bg-gray-100 text-gray-600 border-t border-l border-r border-gray-200 dark:bg-[#1e293b] dark:text-slate-400 dark:border-t dark:border-l dark:border-r dark:border-slate-700/50">
  <span class="select-none">Swift</span>
  <button class="copy-button group relative flex items-center justify-center py-1 px-2 rounded transition-colors duration-200 text-gray-400 hover:text-red-600 dark:hover:text-blue-400" aria-label="Copy code" onclick="window.copyCode(this, event)">
    <div class="code-copy-icon" style="opacity:1;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </div>
    <div class="code-success-icon absolute inset-0 flex items-center justify-center text-green-600 dark:text-green-400" style="opacity:0;transition:opacity 0.2s">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
  </button>
</div>
<pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        import</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Introspect</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">            func</span><span style="color:#59873A;--shiki-dark:#62E884"> clearButtonMode</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> mode</span><span style="color:#393A34;--shiki-dark:#F6F6F4">:UITextField.ViewMode</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#1E754F;--shiki-dark:#F286C4"> some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                introspectTextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> tf </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                    tf.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">clearButtonMode</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> mode</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">name:</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">           .</span><span style="color:#998418;--shiki-dark:#97E1F1">clearButtonMode</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">whileEditing</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>The interoperability between SwiftUI and UIKit/AppKit offers developers great flexibility. While it’s easy to learn, mastering it can be challenging. Sharing mutable states and complex interactions between UIKit views and SwiftUI views is often complicated, requiring various bridging layers between the two frameworks.</p>
<p>This article does not delve into wrapping coordinators with complex logic or communicating interactions between SwiftUI and Redux. The topic is too broad and may need another article for exploration.</p> </div> </article> <aside aria-label="advertisement" role="complementary" id="card-advertisement"><div class="dynamic-ad-card"></div></aside> <!-- 标签容器：居中 --><div class="flex flex-wrap justify-center items-center gap-2 mb-10"> <span class="text-xs font-medium text-gray-400 uppercase tracking-widest mr-2">Tags</span> <a href="/en/tags/SwiftUI/" class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-normal"> <span class="opacity-50">#</span>SwiftUI </a> </div> <section class="py-10" id="related-posts"><!-- Section 标题：与正文区分，增加层次感 --><div class="flex items-center gap-2 mb-6 justify-center text-gray-400 dark:text-gray-500"><span class="h-px w-8 bg-gray-200 dark:bg-gray-700"></span><span class="text-xs font-bold uppercase tracking-widest">Recommended Reading</span><span class="h-px w-8 bg-gray-200 dark:bg-gray-700"></span></div><!-- 网格布局：2列 (移动端 1列太长，直接 2列更紧凑) --><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><a href="/en/posts/swiftuilifecycle/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- 装饰：左上角的小点或图标，增加精致感 --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- 标题 --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Lifecycle of SwiftUI Views</span><!-- 箭头图标：Hover 时平移出现 --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/how-swiftui-preview-works/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- 装饰：左上角的小点或图标，增加精致感 --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- 标题 --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Building Stable Preview Views: How SwiftUI Previews Work</span><!-- 箭头图标：Hover 时平移出现 --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/building-multiple-platforms-swiftui-app/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- 装饰：左上角的小点或图标，增加精致感 --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- 标题 --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Building Cross-Platform SwiftUI Apps</span><!-- 箭头图标：Hover 时平移出现 --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/textfield-1/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- 装饰：左上角的小点或图标，增加精致感 --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- 标题 --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Advanced SwiftUI TextField: Formatting and Validation</span><!-- 箭头图标：Hover 时平移出现 --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a></div></section> <!-- <BuymeacoffeeInPost lang={lang} /> --> <!-- <WeeklySubscribe lang={lang} bottom={0} top={8} anchor='related-posts'/> --> <!-- <Author lang={lang} /> --> <!-- 整合底座容器 --><div class="mt-16 mb-28 bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700/60 rounded-2xl p-6 sm:p-8"> <div class="flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-12"> <!-- 左侧：订阅区域 --> <!-- 适配逻辑：移动端/平板居中(text-center)，桌面端居左(lg:text-left) --> <div class="flex-1 w-full text-center lg:text-left flex flex-col items-center lg:items-start"> <h3 class="font-bold text-xl text-gray-900 dark:text-gray-100 mb-2"> Subscribe to Fatbobman </h3> <p class="text-sm text-gray-500 dark:text-gray-400 mb-6 max-w-md"> Weekly Swift &amp; SwiftUI highlights. Join developers. </p> <!-- 订阅按钮：使用锚点链接触发 Modal --> <a href="#subscript" id="subscribe-bottom-btn" class="
          bg-black dark:bg-white text-white dark:text-black
          font-bold text-sm px-8 py-3 rounded-xl
          hover:opacity-80 hover:scale-105 active:scale-95
          transition-all duration-200 shadow-sm
          w-full sm:w-auto inline-block text-center
        "> Subscribe Now </a> </div> <!-- 右侧：功能按钮组 --> <!-- 适配逻辑：移动端堆叠(grid-cols-1)，平板以上并排(sm:grid-cols-2) --> <!-- w-full lg:w-auto 保证移动端撑满，桌面端紧凑 --> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full lg:w-auto min-w-[320px]"> <!-- 咖啡按钮 --> <a href="https://www.buymeacoffee.com/fatbobman" target="_blank" rel="noopener" class="group flex items-center justify-center lg:justify-start gap-3 px-5 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl shadow-sm hover:shadow-md hover:border-orange-200 dark:hover:border-orange-900 transition-all"> <span class="text-2xl group-hover:scale-110 transition-transform">☕️</span> <div class="text-left"> <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Support</div> <div class="text-sm font-bold text-gray-800 dark:text-gray-100">Buy me a Coffee</div> </div> </a> <!-- Discord 按钮 --> <a href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" rel="noopener" class="group flex items-center justify-center lg:justify-start gap-3 px-5 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl shadow-sm hover:shadow-md hover:border-blue-200 dark:hover:border-blue-900 transition-all"> <span class="text-2xl group-hover:scale-110 transition-transform">💬</span> <div class="text-left"> <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">CONNECT</div> <div class="text-sm font-bold text-gray-800 dark:text-gray-100">Follow on X</div> </div> </a> </div> </div> </div> <script>(function(){const lang = "en";

  // Track newsletter subscription button click via GTM dataLayer
  document.addEventListener('DOMContentLoaded', () => {
    const subscribeBtn = document.getElementById('subscribe-bottom-btn');
    if (!subscribeBtn) return;

    subscribeBtn.addEventListener('click', () => {
      // Initialize dataLayer if not exists
      window.dataLayer = window.dataLayer || [];

      // Push event to dataLayer for GTM
      window.dataLayer.push({
        event: 'subscribe_click',
        content_type: 'newsletter_subscribe',
        click_location: 'bottom',
        lang: lang
      });

      console.log('[Subscribe Tracking] Bottom subscribe button clicked (dataLayer)');
    }, { capture: true });  // 使用捕获阶段，确保在其他监听器之前执行
  });
})();</script> <!-- 
  提示框容器 (Toast Container)
  z-index: 确保在最上层
--><div id="copy-alert" class="hidden fixed bottom-10 right-5 z-50"> <div id="alert-1" class="
      flex items-center px-6 py-3 rounded-full shadow-lg border backdrop-blur-md
      transition-all duration-300 transform
      
      /* === Light Mode (Red Theme) === */
      /* 白底 + 红色文字 + 红色边框，阴影带红 */
      bg-white/95 text-red-600 border-red-100 shadow-red-500/10
      
      /* === Dark Mode (Blue Theme) === */
      /* 深蓝底 + 蓝色文字 + 蓝色边框，阴影带蓝 */
      dark:bg-slate-800/90 dark:text-blue-400 dark:border-blue-500/30 dark:shadow-blue-500/20
    " role="alert"> <!-- 图标 (可选，增加精致感) --> <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path> <polyline points="22 4 12 14.01 9 11.01"></polyline> </svg> <div class="text-sm font-bold tracking-wide">Link copied</div> </div> </div> <style>
  /* 保持原有的图标定位逻辑 */
  .copy-icon {
    position: absolute;
    left: -30px; 
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    transition: opacity 0.3s ease;
    pointer-events: all;
    /* 给图标加一点颜色过渡 */
    color: #9ca3af; /* gray-400 */
  }
  
  /* Hover 时图标变色 (JS里添加了 hover:text-secondary 类，这里作为兜底) */
  .copy-icon:hover {
    color: var(--aw-color-primary); /* 使用 CSS 变量响应主题 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  /* 提示框动画 */
  #copy-alert {
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* 弹性动画 */
    transform: translateY(100px);
    opacity: 0;
  }
  
  #copy-alert.show {
    transform: translateY(0);
    opacity: 1;
  }
</style> <script>(function(){const lang = "en";

  const isTouchDevice = () => {
    if (typeof window === 'undefined') return false;
    return (
      'ontouchstart' in window ||
      (navigator && navigator.maxTouchPoints > 0) ||
      window.matchMedia('(pointer: coarse)').matches
    );
  };

  // 使用 defer 或 load 事件确保 DOM 就绪
  document.addEventListener('DOMContentLoaded', () => {
    if (isTouchDevice()) {
      // 触摸设备不启用复制功能，避免与点击行为冲突
      return;
    }

    let hideTimeout;
    const alertDiv = document.getElementById('copy-alert');

    // 绑定标题图标
    document.querySelectorAll('article h2, article h3, article h4, article h5').forEach((header) => {
      // 创建图标容器
      const copyIcon = document.createElement('span');
      // 使用更简洁的 Link 图标 SVG
      copyIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>`;
      copyIcon.className = 'copy-icon';
      copyIcon.style.opacity = '0';
      
      header.insertBefore(copyIcon, header.firstChild);

      // 悬停显示逻辑
      header.addEventListener('mouseover', () => copyIcon.style.opacity = '1');
      header.addEventListener('mouseout', () => copyIcon.style.opacity = '0');

      // 点击复制逻辑
      copyIcon.addEventListener('click', () => {
        const url = window.location.href.split('#')[0] + '#' + header.id;
        
        navigator.clipboard.writeText(url).then(() => {
          if (alertDiv) {
            // 显示动画
            alertDiv.classList.remove('hidden');
            // 强制重绘以触发 transition
            void alertDiv.offsetWidth; 
            alertDiv.classList.add('show');

            // 清除旧定时器
            if (hideTimeout) clearTimeout(hideTimeout);

            // 3秒后隐藏
            hideTimeout = setTimeout(() => {
              alertDiv.classList.remove('show');
              // 等待动画结束后再 hidden
              setTimeout(() => {
                alertDiv.classList.add('hidden');
              }, 500);
            }, 3000);
          }
        });
      });
    });
  });
})();</script> <script>
  window.copyCode = function(button, event) {
    if (event) event.preventDefault();

    // header 是按钮的父级 div.code-header
    const header = button.closest('.code-header');
    if (!header) return;

    // 代码块是 header 的下一个兄弟元素 (pre 或包含 pre 的元素)
    let nextEl = header.nextElementSibling;
    if (!nextEl) return;

    // 找到 pre 元素（可能是直接的 pre，或者在 figure/div 内）
    const pre = nextEl.tagName === 'PRE' ? nextEl : nextEl.querySelector('pre');
    const codeEl = pre?.querySelector('code') ?? pre;
    if (!codeEl) return;

    const code = codeEl.textContent ?? '';

    // 图标切换：直接操作 style.opacity 更可靠
    function showSuccessFeedback() {
      const copyIcon = button.querySelector('.code-copy-icon');
      const successIcon = button.querySelector('.code-success-icon');

      if (copyIcon && successIcon) {
        // 隐藏复制图标，显示成功图标
        copyIcon.style.opacity = '0';
        successIcon.style.opacity = '1';

        // 2秒后恢复
        setTimeout(() => {
          copyIcon.style.opacity = '1';
          successIcon.style.opacity = '0';
        }, 2000);
      }
    }

    const handleFailure = (err) => {
      console.error('Copy Failed', err);
      fallbackCopyTextToClipboard(code);
    };

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(code).then(showSuccessFeedback).catch(handleFailure);
    } else {
      fallbackCopyTextToClipboard(code);
    }

    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        const successful = document.execCommand('copy');
        if (successful) {
          showSuccessFeedback();
        } else {
          console.error('Fallback Copy Failed: execCommand returned false');
        }
      } catch (err) {
        console.error('Fallback Copy Failed', err);
      }
      document.body.removeChild(textArea);
    }
  }
</script> <script>(function(){const baseUrl = "https://fatbobman.com/ads/";
const langSuffix = "en";
const utmTerm = "en/uikitinswiftui";

  // ========================================
  // Configuration & Constants
  // ========================================

  const CACHE_DURATION = 20 * 60 * 1000; // 20 minutes
  const STALE_THRESHOLD = 24 * 60 * 60 * 1000; // 24 hours - when to force UI refresh

  // 读取 URL 参数用于测试和预览
  const urlParams = new URLSearchParams(window.location.search);
  const adIdParam = urlParams.get('adid') || urlParams.get('adId');
  const sponsorIdParam = urlParams.get('sponsorId');
  const scheduleIdParam = urlParams.get('scheduleId');
  const forceUpdateParam = urlParams.get('adForceUpdate') === 'true';

  const isPreviewMode = !!(adIdParam || sponsorIdParam || scheduleIdParam);
  const effectiveCacheDuration = isPreviewMode ? 60 * 1000 : CACHE_DURATION;

  // Store current ad metadata for click tracking
  const currentAdMetadata = {
    version1: null,  // .dynamic-ad-card metadata
    version2: null   // .dynamic-ad-inline metadata
  };

  // ========================================
  // Cache Management Functions
  // ========================================

  /**
   * Load ad from cache with SWR metadata
   * @param {string} cacheKey - Cache key
   * @returns {Object|null} - Cached ad data with metadata or null
   */
  function loadFromCache(cacheKey) {
    try {
      const cachedData = localStorage.getItem(cacheKey);
      if (!cachedData) return null;

      const cached = JSON.parse(cachedData);

      // Backward compatibility: handle old cache format
      if (cached.content && !cached.metadata) {
        console.log(`[AdsLoader SWR] Old cache format detected for ${cacheKey}, will update`);
        return null; // Force refresh to get new format
      }

      return cached;
    } catch (e) {
      console.warn(`[AdsLoader SWR] Failed to parse cached ad: ${cacheKey}`, e);
      localStorage.removeItem(cacheKey);
      return null;
    }
  }

  /**
   * Save ad to cache with metadata
   * @param {string} cacheKey - Cache key
   * @param {string} content - Ad HTML content
   * @param {Object} metadata - Ad metadata from response headers
   */
  function saveToCache(cacheKey, content, metadata) {
    try {
      const cacheData = {
        content: content,
        metadata: {
          ...metadata,
          fetchedAt: Date.now()
        }
      };

      localStorage.setItem(cacheKey, JSON.stringify(cacheData));
      const cacheMinutes = Math.round(effectiveCacheDuration / 60000);
      console.log(`[AdsLoader SWR] Saved to cache: ${cacheKey} (${cacheMinutes} min)`, metadata);
    } catch (e) {
      console.warn(`[AdsLoader SWR] Failed to save cache: ${cacheKey}`, e);
    }
  }

  /**
   * Extract metadata from response headers
   * @param {Response} response - Fetch response object
   * @returns {Object} - Metadata object
   */
  function extractMetadata(response) {
    return {
      sponsorId: response.headers.get('X-Sponsor-Id') || 'unknown',
      adId: response.headers.get('X-Ad-Id') || 'unknown',
      version: parseInt(response.headers.get('X-Ad-Version') || '1'),
      lang: response.headers.get('X-Ad-Lang') || langSuffix,
      lastUpdated: response.headers.get('Last-Modified') || new Date().toISOString(),
      forceUpdate: response.headers.get('X-Force-Update') === 'true',
      campaign: response.headers.get('X-UTM-Campaign') || null // Optional UTM campaign
    };
  }

  // ========================================
  // Smart Refresh Logic
  // ========================================

  /**
   * Check if two timestamps are on the same UTC calendar day
   * @param {number} timestamp1 - First timestamp (milliseconds)
   * @param {number} timestamp2 - Second timestamp (milliseconds)
   * @returns {boolean} - True if same UTC day
   */
  function isSameUTCDay(timestamp1, timestamp2) {
    const d1 = new Date(timestamp1);
    const d2 = new Date(timestamp2);
    return d1.getUTCFullYear() === d2.getUTCFullYear() &&
           d1.getUTCMonth() === d2.getUTCMonth() &&
           d1.getUTCDate() === d2.getUTCDate();
  }

  /**
   * Decide if UI should be refreshed based on cache age and ad changes
   * @param {Object|null} cached - Cached ad data with metadata
   * @param {Object} newMetadata - New ad metadata from server
   * @returns {boolean} - True if UI should be refreshed
   */
  function shouldRefreshUI(cached, newMetadata) {
    // Rule 1: No cache -> always render (first load)
    if (!cached || !cached.metadata) {
      console.log('[AdsLoader SWR] No cache, will render immediately');
      return true;
    }

    // Rule 2: Force update parameter -> always refresh
    if (forceUpdateParam || newMetadata.forceUpdate) {
      console.log('[AdsLoader SWR] Force update detected, will refresh UI');
      return true;
    }

    const cachedMeta = cached.metadata;
    const cacheAge = Date.now() - cachedMeta.fetchedAt;

    // Rule 3: Sponsor changed -> always refresh (different advertiser)
    if (cachedMeta.sponsorId !== newMetadata.sponsorId) {
      console.log(`[AdsLoader SWR] Sponsor changed: ${cachedMeta.sponsorId} → ${newMetadata.sponsorId}, will refresh UI`);
      return true;
    }

    // Rule 4: UTC date changed -> always refresh (ad schedule switches by calendar day)
    if (!isSameUTCDay(cachedMeta.fetchedAt, Date.now())) {
      const cachedDate = new Date(cachedMeta.fetchedAt).toISOString().split('T')[0];
      const currentDate = new Date().toISOString().split('T')[0];
      console.log(`[AdsLoader SWR] UTC date changed: ${cachedDate} → ${currentDate}, will refresh UI`);
      return true;
    }

    // Rule 5: Cache older than 24 hours -> always refresh
    if (cacheAge > STALE_THRESHOLD) {
      console.log(`[AdsLoader SWR] Cache very old (${Math.round(cacheAge / 3600000)}h), will refresh UI`);
      return true;
    }

    // Rule 6: Ad ID changed (same sponsor, different version) -> refresh if old, else silent update
    if (cachedMeta.adId !== newMetadata.adId) {
      console.log(`[AdsLoader SWR] Ad changed but cache fresh (${Math.round(cacheAge / 60000)}min), will update silently`);
      return false; // Silent update
    }

    // Rule 7: Default - silent update
    console.log(`[AdsLoader SWR] Cache fresh (${Math.round(cacheAge / 60000)}min old), will update silently`);
    return false;
  }

  // ========================================
  // UTM Parameters Injection
  // ========================================

  /**
   * Inject UTM parameters to all links in ad HTML
   * Only applies to non-default ads (sponsored ads)
   * @param {string} html - Ad HTML content
   * @param {Object} metadata - Ad metadata (sponsorId, campaign, version, etc.)
   * @returns {string} - Modified HTML with UTM parameters
   */
  function injectUTMParameters(html, metadata) {
    // Skip UTM injection for default ads
    if (metadata.sponsorId === 'default') {
      return html;
    }

    // Create temporary container to parse HTML
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;

    // Find all links
    const links = tempDiv.querySelectorAll('a[href]');

    if (links.length === 0) {
      return html; // No links found, return original HTML
    }

    // Build UTM parameters
    const utmParams = {
      utm_source: 'fatbobman',
      utm_medium: 'blog',
      utm_content: metadata.version === 2 ? 'post-header' : 'post-footer'
    };

    // Add campaign if available
    if (metadata.campaign) {
      utmParams.utm_campaign = metadata.campaign;
    }

    // Add term if available
    if (utmTerm) {
      utmParams.utm_term = utmTerm;
    }

    // Inject UTM parameters to each link
    links.forEach(link => {
      try {
        const url = new URL(link.href);

        // Add each UTM parameter
        Object.entries(utmParams).forEach(([key, value]) => {
          url.searchParams.set(key, value);
        });

        link.href = url.toString();
      } catch (e) {
        // Invalid URL, skip
        console.warn('[AdsLoader SWR] Skipping invalid URL:', link.href, e);
      }
    });

    console.log('[AdsLoader SWR] Injected UTM parameters:', utmParams, `(${links.length} link(s))`);
    return tempDiv.innerHTML;
  }

  // ========================================
  // GA4 Click Tracking
  // ========================================

  /**
   * Track ad click in Google Analytics 4 via GTM dataLayer
   * @param {string} destinationUrl - Click destination URL
   * @param {Object} metadata - Ad metadata
   */
  function trackAdClick(destinationUrl, metadata) {
    // Initialize dataLayer if not exists (works with both regular GTM and Partytown)
    window.dataLayer = window.dataLayer || [];

    // Build event data based on ad type
    const eventData = {
      event: 'ad_click',
      destination_url: destinationUrl
    };

    if (metadata.sponsorId === 'default') {
      // Default ad: simple tracking with position only
      eventData.content_type = 'default_ad';
      eventData.ad_position = metadata.version === 2 ? 'post-header' : 'post-footer';
    } else {
      // Sponsored ad: detailed tracking
      eventData.content_type = 'sponsored_ad';
      eventData.ad_position = metadata.version === 2 ? 'post-header' : 'post-footer';
      eventData.sponsor_id = metadata.sponsorId;
      eventData.ad_id = metadata.adId;
      eventData.ad_version = metadata.version;
      eventData.ad_lang = metadata.lang;
    }

    // Push event to dataLayer for GTM
    window.dataLayer.push(eventData);
    console.log('[AdsLoader SWR] Ad click tracked (dataLayer):', eventData);
  }

  /**
   * Attach click tracking to ad links (reads metadata dynamically from currentAdMetadata)
   * @param {string} containerSelector - Container selector
   * @param {string} version - 'version1' or 'version2' key in currentAdMetadata
   */
  function attachClickTracking(containerSelector, version) {
    const containers = document.querySelectorAll(containerSelector);
    if (containers.length === 0) return;

    containers.forEach(container => {
      // Use event delegation to handle dynamically loaded ads
      container.addEventListener('click', (event) => {
        // Find the clicked link (or parent link)
        const link = event.target.closest('a[href]');
        if (!link) return;

        // Get current metadata dynamically (always up-to-date)
        const metadata = currentAdMetadata[version];
        if (!metadata) {
          console.warn(`[AdsLoader SWR] No metadata available for ${version}, skipping tracking`);
          return;
        }

        // Track the click
        trackAdClick(link.href, metadata);
      }, { capture: false, passive: true });
    });

    console.log(`[AdsLoader SWR] Click tracking attached to ${containers.length} container(s): ${containerSelector}`);
  }

  // ========================================
  // Ad Loading & Rendering
  // ========================================

  /**
   * Render ad to containers
   * @param {string} html - Ad HTML content
   * @param {string} containerSelector - Container selector
   * @param {Object} metadata - Ad metadata for tracking
   * @param {string} reason - Reason for rendering (for logging)
   */
  function renderAd(html, containerSelector, metadata, reason = 'unknown') {
    const containers = document.querySelectorAll(containerSelector);
    if (containers.length === 0) {
      console.warn(`[AdsLoader SWR] No containers found: ${containerSelector}`);
      return;
    }

    containers.forEach(container => {
      container.innerHTML = html;
    });

    // Store metadata for this version
    if (containerSelector === '.dynamic-ad-card') {
      currentAdMetadata.version1 = metadata;
    } else if (containerSelector === '.dynamic-ad-inline') {
      currentAdMetadata.version2 = metadata;
    }

    console.log(`[AdsLoader SWR] Rendered ad to ${containers.length} container(s): ${containerSelector} (${reason})`);
  }

  /**
   * Fetch ad from server
   * @param {number} version - Ad version (1 or 2)
   * @param {string} cacheKey - Cache key
   * @param {string} containerSelector - Container selector
   * @param {Object|null} cached - Cached ad data (if any)
   */
  async function fetchAd(version, cacheKey, containerSelector, cached) {
    // Build URL with parameters
    const params = new URLSearchParams({
      lang: langSuffix,
      version: version.toString()
    });

    // Add test/preview parameters
    if (adIdParam) params.append('adId', adIdParam);
    if (sponsorIdParam) params.append('sponsorId', sponsorIdParam);
    if (scheduleIdParam) params.append('scheduleId', scheduleIdParam);
    if (forceUpdateParam) params.append('adForceUpdate', 'true');

    const url = `${baseUrl}?${params.toString()}`;
    const previewTag = isPreviewMode ? ' [PREVIEW MODE]' : '';
    console.log(`[AdsLoader SWR] Fetching ad: ${url}${previewTag}`);

    try {
      const response = await fetch(url, {
        headers: { 'Accept': 'text/html' },
        cache: 'no-cache'
      });

      // Validate HTTP status
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      // Validate required metadata headers
      const sponsorId = response.headers.get('X-Sponsor-Id');
      const adId = response.headers.get('X-Ad-Id');

      if (!sponsorId || !adId || sponsorId === 'null' || adId === 'null') {
        console.warn('[AdsLoader SWR] Invalid response: missing or null metadata headers');
        throw new Error('Invalid ad response: missing metadata headers');
      }

      const content = await response.text();
      const metadata = extractMetadata(response);

      // Inject UTM parameters for sponsored ads
      const processedContent = injectUTMParameters(content, metadata);

      console.log('[AdsLoader SWR] Server response metadata:', metadata);

      // Decide if UI should be refreshed
      const shouldRefresh = shouldRefreshUI(cached, metadata);

      // Always update cache (with UTM-enhanced content)
      saveToCache(cacheKey, processedContent, metadata);

      // Conditionally refresh UI (with UTM-enhanced content)
      if (shouldRefresh) {
        renderAd(processedContent, containerSelector, metadata, shouldRefresh === true && !cached ? 'initial load' : 'smart refresh');
      } else {
        console.log(`[AdsLoader SWR] UI kept as-is, updated cache for next visit`);
      }

    } catch (error) {
      console.error(`[AdsLoader SWR] Error loading ad (version ${version}):`, error);

      // Smart fallback strategy based on cached ad type
      if (cached && cached.metadata) {
        if (cached.metadata.sponsorId === 'default') {
          // Default ad: keep displaying cached content (own content, safe to show when stale)
          console.log('[AdsLoader SWR] Fetch failed, keeping default ad cache');
          // UI already shows cached content, no action needed
        } else {
          // Sponsored ad: clear display (avoid showing expired paid ads)
          console.log('[AdsLoader SWR] Fetch failed, clearing sponsored ad to avoid showing stale content');
          const emptyMetadata = { sponsorId: 'error', version: version };
          renderAd('', containerSelector, emptyMetadata, 'error-clear');
        }
      } else {
        // No cache: leave blank
        console.log('[AdsLoader SWR] Fetch failed with no cache, leaving blank');
      }
    }
  }

  /**
   * Load ad with SWR strategy
   * @param {number} version - Ad version
   * @param {string} cacheKey - Cache key
   * @param {string} containerSelector - Container selector
   */
  function loadAd(version, cacheKey, containerSelector) {
    // Check if containers exist
    const containers = document.querySelectorAll(containerSelector);
    if (containers.length === 0) {
      console.log(`[AdsLoader SWR] No containers found for ${containerSelector}, skipping version ${version}`);
      return;
    }

    // Step 1: Load from cache if available
    const cached = loadFromCache(cacheKey);
    if (cached && cached.content) {
      console.log(`[AdsLoader SWR] Displaying cached ad: ${cacheKey}`, cached.metadata);
      // Inject UTM parameters to cached content (in case it's from old cache without UTM)
      const processedCachedContent = injectUTMParameters(cached.content, cached.metadata);
      renderAd(processedCachedContent, containerSelector, cached.metadata, 'from cache');
    } else {
      console.log(`[AdsLoader SWR] No cache available for ${cacheKey}, will show blank until loaded`);
    }

    // Step 2: Fetch from server in background
    fetchAd(version, cacheKey, containerSelector, cached);
  }

  // ========================================
  // Initialization
  // ========================================

  function initAds() {
    console.log('[AdsLoader SWR] Initializing ad loading with Stale-While-Revalidate strategy...');
    console.log(`[AdsLoader SWR] Config: cacheDuration=${effectiveCacheDuration/60000}min, staleThreshold=${STALE_THRESHOLD/3600000}h`);

    if (isPreviewMode) {
      const params = [];
      if (adIdParam) params.push(`adId=${adIdParam}`);
      if (sponsorIdParam) params.push(`sponsorId=${sponsorIdParam}`);
      if (scheduleIdParam) params.push(`scheduleId=${scheduleIdParam}`);
      console.log(`[AdsLoader SWR] 🔍 PREVIEW MODE: ${params.join(', ')}`);
    }

    if (forceUpdateParam) {
      console.log('[AdsLoader SWR] 🔄 FORCE UPDATE MODE: UI will always refresh');
    }

    // Generate cache keys (include test params to avoid conflicts)
    const cacheKeySuffix = langSuffix + (adIdParam || sponsorIdParam || scheduleIdParam || '');
    const cacheKeyCard = 'dynamicAdCardSWR-' + cacheKeySuffix;
    const cacheKeyInline = 'dynamicAdInlineSWR-' + cacheKeySuffix;

    // Load both ad versions
    loadAd(1, cacheKeyCard, '.dynamic-ad-card');
    loadAd(2, cacheKeyInline, '.dynamic-ad-inline');

    // Attach click tracking event listeners (after ads are loaded)
    // These will dynamically read metadata from currentAdMetadata
    attachClickTracking('.dynamic-ad-card', 'version1');
    attachClickTracking('.dynamic-ad-inline', 'version2');
  }

  // Start loading when page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAds);
  } else {
    initAds();
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div id="gitalk-container" data-comment-id="在 SwiftUI 中使用 UIKit 视图" data-lang="en" data-repo="blogComments" data-createIssueManually="true" data-anchor="card-advertisement" class="pb-16"></div>

    <script defer>
      document.addEventListener('DOMContentLoaded', async function () {
      const container = document.getElementById('gitalk-container');
      let anchor = '';
      if (container) {
        anchor = container.getAttribute('data-anchor') || '';
      }
        // 提前检查是否需要加载评论
        try {
          const response = await fetch('https://fatbobman.com/status/comment');
          const data = await response.text();
          console.log(data, "comment");

          if (data !== '1') {
            console.log('评论功能未启用，跳过监控和加载操作。');
            return; // 提前返回，跳过后续逻辑
          }
        } catch (error) {
          console.error('检查评论状态时出错：', error);
          return; // 出现错误时也跳过后续逻辑
        }

        // 如果返回值为 "1"，则启动观察器
        const observerTarget = document.getElementById(anchor);
        if (observerTarget) {
          const observer = new IntersectionObserver(async (entries, observer) => {
            const entry = entries[0];
            if (entry.isIntersecting) {
              console.log("load comment")
              // 停止观察，避免重复触发
              observer.unobserve(observerTarget);

              // 动态加载评论区脚本
              await loadGitalk();
            }
          }, {
            root: null, // 相对于视口
            rootMargin: '20%', // 提前 20% 的位置触发
            threshold: 0.1, // 元素显示 10% 即触发
          });

          observer.observe(observerTarget);
        }

        // 动态加载 Gitalk 脚本并初始化评论区
        async function loadGitalk() {
          const container = document.getElementById('gitalk-container');
          if (container) {
            const commentID = container.getAttribute('data-comment-id');
            const lang = container.getAttribute('data-lang');
            const repo = container.getAttribute('data-repo')
            const createIssueManually = container.getAttribute('data-createIssueManually')

            console.log(repo);
            console.log(createIssueManually)

            // 动态加载 Gitalk 脚本
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
            script.defer = true;
            script.onload = () => {
              const gitalk = new Gitalk({
                clientID: 'fcf61195c7f73253dc8b',
                clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
                repo: repo,
                owner: 'fatbobman',
                admin: ['fatbobman'],
                id: commentID.split('/').pop().substring(0, 49),
                distractionFreeMode: true,
                createIssueManually: createIssueManually,
                language: lang,
              });

              gitalk.render('gitalk-container');
            };
            document.body.appendChild(script);
          }
        }
      });
    </script> <!-- 
  左侧悬浮容器 
  建议：这里 top: 0px 配合内部 padding 应该能和右侧对齐。
  如果右侧 Sidebar 顶部有 padding，这里也保持一致。
--><div class="hidden lg:block w-32 xl:w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="toc-content"> <!-- 按钮容器 --> <!-- id="toc-float-button" 供 JS 定位使用 --> <!-- 建议：pb-2 可以微调，确保和右侧间距感一致 --> <div class="w-full flex justify-end pb-2" id="toc-float-button"> <div id="toc-button" class="
    group relative flex items-center justify-center w-9 h-9 rounded-full 
    transition-all duration-300 cursor-pointer
    
    /* === 默认状态 (Ghost) === */
    bg-transparent ring-0
    text-gray-500 dark:text-gray-400

    /* === Hover 状态 (悬浮反馈) === */
    hover:scale-110 hover:-translate-y-0.5
    hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-100
    dark:hover:bg-blue-500/10 dark:hover:text-blue-400 dark:hover:ring-blue-500/20

    /* === Active 状态 (展开时常驻高亮) === */
    [&.active]:bg-red-50 [&.active]:text-red-600 [&.active]:ring-1 [&.active]:ring-red-100
    dark:[&.active]:bg-blue-500/10 dark:[&.active]:text-blue-400 dark:[&.active]:ring-blue-500/20
  " aria-label="Toggle Table of Contents"> <!-- 
    单一图标
    group-[.active]:rotate-90 -> 当父容器有 active 类时，图标旋转 90 度
  --> <svg class="w-5 h-5 transition-transform duration-300 group-[.active]:rotate-90" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-toc"></use> </svg> </div> </div> <!-- 列表内容 --> <div class="text-default text-xxs xl:text-xs hidden max-h-[70vh] overflow-y-auto" id="toc-list" data-source-type="article" aria-live="polite" style="scroll-behavior: smooth;"></div> </div> </div> <script type="module" src="/_astro/TOC.astro_astro_type_script_index_0_lang.B1ErLf9O.js"></script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <!-- <PreviousPost lang={lang} post = {post} source = {source}/> --> <!-- <NextPost lang={lang} post = {post} source = {source} /> --> <!-- <DictButton lang={lang} post = {post}/> --> <!-- <ShareWithBlueSky lang={lang} post = {post} source = {source}/> --> <!-- <ShareWithFacebook lang={lang} post = {post} source = {source}/> --> <!-- { lang === Lang.ZH &&
    <ShareWithWeibo lang={lang} post = {post} source = {source}/>
    } --> <!-- <ShareWithLinkedin lang={lang} post = {post} source = {source}/> --> <a href="#subscript" id="sidebar-subscribe-btn" class="
    group relative flex items-center justify-center w-9 h-9 rounded-full 
    transition-all duration-500
    hover:scale-110 hover:-translate-y-0.5
    
    /* === 默认状态：无背景圆，无阴影，根据模式显示文字颜色 === */
  text-gray-500 dark:text-gray-400
    
    /* === 闪烁或 hover 时显示背景圆和阴影 === */
    /* Light Mode (Red Theme) */
    hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-100 hover:shadow-sm
    hover:hover:bg-red-100 hover:hover:text-red-700
    
    /* Dark Mode (Blue Theme) */
    dark:hover:bg-blue-500/10 dark:hover:text-blue-400 dark:hover:ring-blue-500/20
    dark:hover:hover:bg-blue-500/20 dark:hover:hover:text-blue-300
    
    /* === 闪烁状态（通过 data-blinking 属性控制）=== */
    data-[blinking=true]:bg-red-50 data-[blinking=true]:text-red-600 data-[blinking=true]:ring-1 data-[blinking=true]:ring-red-100 data-[blinking=true]:shadow-sm
    dark:data-[blinking=true]:bg-blue-500/10 dark:data-[blinking=true]:text-blue-400 dark:data-[blinking=true]:ring-blue-500/20
  " aria-label="Subscribe to Newsletter" data-tooltip-target="tooltip-sidebar-subscribe" data-tooltip-placement="left" data-blinking="false"> <svg class="w-6 h-6 transition-transform duration-300 group-hover:rotate-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-email"></use> </svg>  <span id="ping-dot" class="absolute top-0 right-0 -mt-0.5 -mr-0.5 flex h-2.5 w-2.5 hidden"> <span id="ping-animation" class="absolute inline-flex h-full w-full rounded-full opacity-75 bg-red-400 dark:bg-blue-400"></span> <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500 dark:bg-blue-500"></span> </span> </a> <!-- Tooltip (保持不变，深色背景通用) --> <div id="tooltip-sidebar-subscribe" role="tooltip" class="absolute z-50 invisible inline-block px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700 transition-opacity duration-300 whitespace-nowrap"> Subscribe to Newsletter <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const lang = "en";

  document.addEventListener('DOMContentLoaded', () => {
    const subscribeBtn = document.getElementById('sidebar-subscribe-btn');
    if (subscribeBtn) {
      subscribeBtn.addEventListener('click', () => {
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
          event: 'subscribe_click',
          content_type: 'newsletter_subscribe',
          click_location: 'sidebar_floating',
          lang: lang
        });
      });
    }

    // 控制呼吸点的间歇闪烁
    const pingDot = document.getElementById('ping-dot');
    const pingAnimation = document.getElementById('ping-animation');
    
    if (pingDot && pingAnimation && subscribeBtn) {
      // 生成 10-20 秒之间的随机时间（毫秒）
      const getRandomDelay = () => Math.random() * 10000 + 10000; // 10000-20000ms
      
      const startBlinking = () => {
        // 显示呼吸点并开始闪烁，同时显示背景圆
        pingDot.classList.remove('hidden');
        pingAnimation.classList.add('animate-ping');
        subscribeBtn.setAttribute('data-blinking', 'true');
        
        // 闪烁 10-20 秒后停止
        const blinkDuration = getRandomDelay();
        setTimeout(() => {
          // 停止闪烁并隐藏，同时隐藏背景圆
          pingAnimation.classList.remove('animate-ping');
          pingDot.classList.add('hidden');
          subscribeBtn.setAttribute('data-blinking', 'false');
          
          // 等待 10-20 秒后再次开始
          const pauseDuration = getRandomDelay();
          setTimeout(startBlinking, pauseDuration);
        }, blinkDuration);
      };
      
      // 初始等待 10-20 秒后开始第一次闪烁
      const initialDelay = getRandomDelay();
      setTimeout(startBlinking, initialDelay);
    }
  });
})();</script> <!-- 
  容器样式：
  1. w-9 h-9: 与订阅按钮尺寸保持一致，确保垂直对齐
  2. text-gray-400: 默认灰色，降低视觉权重
  3. hover:text-black / dark:hover:text-white: 悬浮时变为 X 的品牌色
  4. hover:bg-gray-100: 悬浮时增加淡淡的背景，增加点击区域感
--><a href="https://x.com/intent/tweet?text=Using%20UIKit%20Views%20in%20SwiftUI&url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fuikitinswiftui%2F&hashtags=ios,swiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter" class="
    group relative flex items-center justify-center w-9 h-9 rounded-full 
    transition-all duration-300 
    hover:scale-110 hover:-translate-y-0.5
    
    /* === 默认状态 (隐形背景) === */
    bg-transparent ring-0
    text-gray-500 dark:text-gray-400
    
    /* === Light Mode Hover (Red Theme) === */
    hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-100
    
    /* === Dark Mode Hover (Blue Theme) === */
    dark:hover:bg-blue-500/10 dark:hover:text-blue-400 dark:hover:ring-blue-500/20
  " data-tooltip-target="tooltip-share-with-twitter" data-tooltip-placement="left" aria-label="Share on X"> <svg class="w-6 h-6 transition-transform duration-300 group-hover:rotate-12" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-twitter"></use> </svg> </a> <!-- Tooltip: 样式与订阅按钮保持一致 --> <div id="tooltip-share-with-twitter" role="tooltip" class="absolute z-50 invisible inline-block px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700 transition-opacity duration-300 whitespace-nowrap"> <div>Share on X</div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <!-- 
  容器修改：
  1. 移除 opacity-80: 保持颜色纯净，轨道的 gray-200/700 已经足够低调。
  2. bg-gray-200 dark:bg-gray-700: 保持中性轨道色。
--><div class="relative w-[2px] h-32 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden my-4" aria-hidden="true"> <div id="sidebar-reading-progress" class="
        absolute top-0 left-0 w-full transition-all duration-100 ease-out
        
        /* === Light Mode (Red Theme) === */
        /* 使用深红色，呼应品牌色 #c72f1c */
        bg-red-600
        
        /* === Dark Mode (Blue Theme) === */
        /* 使用亮蓝色，呼应暗黑主色 #60a5fa */
        dark:bg-blue-400
      " style="height: 0%"></div> </div> <script>
  function initProgressBar() {
    const progressBar = document.getElementById('sidebar-reading-progress');
    // 请确保你的文章容器 ID 确实是 'article-area'，否则进度条不会动
    const article = document.getElementById('article-area'); 

    if (!progressBar || !article) return;

    function updateProgress() {
      const articleRect = article.getBoundingClientRect();
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      // 进度计算
      let progress = (scrollTop - articleTop + 150) / (articleHeight - windowHeight + 150);

      progress = Math.min(Math.max(progress, 0), 1);

      progressBar.style.height = `${progress * 100}%`;
    }

    // 优化：使用 passive: true 提高滚动性能
    window.addEventListener('scroll', () => requestAnimationFrame(updateProgress), { passive: true });
    window.addEventListener('resize', updateProgress);
    updateProgress(); 
  }

  // 这里的判断逻辑可以保留
  if (window.innerWidth >= 768) {
    initProgressBar();
    document.addEventListener('astro:page-load', initProgressBar);
  }
</script> <!-- 
  容器样式：
  1. w-9 h-9: 保持尺寸统一
  2. text-gray-400: 默认低调
  3. hover:text-blue-600: 悬浮时变为品牌色 (区别于 X 的黑色)
  4. hover:bg-blue-50: 悬浮时增加淡淡的蓝色背景
--><button id="sidebar-comment-btn" type="button" class="
  group relative flex items-center justify-center w-9 h-9 rounded-full 
  transition-all duration-300 
  hover:scale-110 hover:-translate-y-0.5
  
  /* === 默认状态 (隐形背景) === */
  bg-transparent ring-0
  text-gray-500 dark:text-gray-400
  
  /* === Light Mode Hover (Red Theme) === */
  hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-100
  
  /* === Dark Mode Hover (Blue Theme) === */
  dark:hover:bg-blue-500/10 dark:hover:text-blue-400 dark:hover:ring-blue-500/20
  " aria-label="Comment" data-tooltip-target="tooltip-sidebar-comment" data-tooltip-placement="left"> <svg class="w-6 h-6 transition-transform duration-300 group-hover:rotate-12" " fill="currentColor" stroke="currentColor" stroke-width="5" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-comment"></use> </svg> </button> <!-- Tooltip --> <div id="tooltip-sidebar-comment" role="tooltip" class="absolute z-50 invisible inline-block px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700 transition-opacity duration-300 whitespace-nowrap"> <div>Share Your Thoughts</div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>
  // 保持原有逻辑，但做了防御性编程
  // 使用 IIFE 或 block scope 避免变量污染全局
  {
    const SCROLL_OFFSET = 80;

    // 逻辑：找到评论区并平滑滚动
    const handleCommentScroll = () => {
      // 优先尝试 gitalk，也可以扩展支持 giscus 或其他评论系统
      const commentContainer = document.getElementById('gitalk-container') || document.getElementById('giscus'); 
      
      if (commentContainer) {
        const topPosition = commentContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
        window.scrollTo({ top: topPosition, behavior: 'smooth' });
      } else {
        // 如果找不到评论区容器（比如还没加载），尝试直接滚到底部
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }
    };

    // 绑定事件
    // Astro View Transitions 兼容：如果用了 ViewTransitions，需要监听 'astro:page-load'
    // 这里使用基础的 DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('sidebar-comment-btn');
      if (btn) {
        btn.addEventListener('click', handleCommentScroll);
      }
    });
  }
</script> <!-- 
  容器样式：
  1. w-9 h-9, rounded-full: 尺寸统一
  2. opacity-0 invisible: 默认隐藏，由 JS 控制显隐
  3. hover:text-blue-600: 悬浮高亮
--><button id="sidebar-top-btn" type="button" class="
  group relative flex items-center justify-center w-9 h-9 rounded-full 
  transition-all duration-300 
  hover:scale-110 hover:-translate-y-0.5
  
  /* === 默认状态 (隐形背景) === */
  bg-transparent ring-0
  text-gray-500 dark:text-gray-400
  
  /* === Light Mode Hover (Red Theme) === */
  hover:bg-red-50 hover:text-red-600 hover:ring-1 hover:ring-red-100
  
  /* === Dark Mode Hover (Blue Theme) === */
  dark:hover:bg-blue-500/10 dark:hover:text-blue-400 dark:hover:ring-blue-500/20
  " aria-label="Back to Top" data-tooltip-target="tooltip-back-to-top" data-tooltip-placement="left"> <svg class="w-6 h-6" fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.Ch_vtVZw.svg#icon-top"></use> </svg> </button> <!-- Tooltip --> <div id="tooltip-back-to-top" role="tooltip" class="absolute z-50 invisible inline-block px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700 transition-opacity duration-300 whitespace-nowrap"> <div>Back to Top</div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>
  document.addEventListener('DOMContentLoaded', () => {
    const topBtn = document.getElementById('sidebar-top-btn');
    const SHOW_THRESHOLD = 400; // 滚动超过 400px 后显示

    if (topBtn) {
      // 1. 点击事件
      topBtn.addEventListener('click', () => {
        const header = document.getElementById('wholeHeader');
        if (header) {
          const target = header.offsetTop + header.offsetHeight;
          window.scrollTo({ top: target, behavior: 'smooth' });
        } else {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });

      // 2. 滚动监听
      const handleScroll = () => {
        if (window.scrollY > SHOW_THRESHOLD) {
          // 显示
          topBtn.classList.remove('opacity-0', 'invisible', 'translate-y-4');
          topBtn.classList.add('opacity-100', 'visible', 'translate-y-0');
        } else {
          // 隐藏 (加一点下沉效果 translate-y-4，显得是从下面冒出来的)
          topBtn.classList.remove('opacity-100', 'visible', 'translate-y-0');
          topBtn.classList.add('opacity-0', 'invisible', 'translate-y-4');
        }
      };

      // 性能优化：使用 RAF 进行节流
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      });
      
      // 初始化执行一次，防止刷新页面后停留在中间但按钮没出来
      handleScroll();
    }
  });
</script> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.kcu16vqK.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block border-t border-gray-100 dark:border-slate-800 mt-20" id="page-footer"> <div class="mx-auto w-full max-w-5xl px-6 py-12 md:py-16"> <div class="grid grid-cols-1 md:grid-cols-12 gap-8 lg:gap-12">  <div class="md:col-span-4 lg:col-span-5 space-y-4"> <div class="flex items-center space-x-2">  <span class="text-xl font-black tracking-tight text-heading">
Fatbobman's <span class="text-primary">Blog</span> </span> </div> <p class="text-sm text-muted leading-relaxed max-w-xs"> Exploring the infinite possibilities of Swift and Apple development ecosystem. </p> </div>  <div class="md:col-span-8 lg:col-span-7 grid grid-cols-2 sm:grid-cols-3 gap-8">  <div> <h3 class="text-sm font-bold text-heading uppercase tracking-wider mb-4 "> Explore </h3> <ul class="space-y-3 text-sm text-muted"> <li><a href="/en/snippet/" class="hover:text-primary transition-colors">Quick Tips</a></li> <li><a href="/en/posts/" class="hover:text-primary transition-colors">Posts</a></li> <li><a href="/en/tags/" class="hover:text-primary transition-colors">Tags</a></li> <li><a href="/en/collections/" class="hover:text-primary transition-colors">Collections</a></li> </ul> </div>  <div> <h3 class="text-sm font-bold text-heading uppercase tracking-wider mb-4 "> Subscribe </h3> <ul class="space-y-3 text-sm text-muted"> <li><a href="https://weekly.fatbobman.com/welcome" class="hover:text-primary transition-colors" target="_blank">Newsletter</a></li> <li><a href="/rss.xml" class="hover:text-primary transition-colors" target="_blank">RSS</a></li> </ul> </div>  <div> <h3 class="text-sm font-bold text-heading uppercase tracking-wider mb-4 "> Connect &amp; Support </h3> <ul class="space-y-3 text-sm text-muted"> <li><a href="/en/sponsorship/" class="hover:text-primary transition-colors" rel="sponsored">Promote on Blog</a></li> <li><a href="/en/about/#contact" class="hover:text-primary transition-colors">Contact Me</a></li> <li> <a href="https://www.buymeacoffee.com/fatbobman" class="hover:text-primary transition-colors group flex items-center" target="_blank"> <span>Buy Me a Coffee</span> <span class="ml-1 group-hover:scale-110 transition-transform inline-block">☕️</span> </a> </li> </ul> </div> </div> </div>  <div class="mt-12 pt-8 border-t border-gray-100 dark:border-slate-800 flex flex-col md:flex-row justify-between items-center text-xs text-muted/60 gap-4"> <div class="text-center md:text-left"> <span>&copy; 2026 Fatbobman Digital Limited. All Rights Reserved.</span> </div> <div class="flex items-center gap-4">  <div class="opacity-70 hover:opacity-100 transition-opacity"> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <button type="button" onclick="
        try {
          window.open('https://beian.miit.gov.cn/#/Integrated/index', '_blank');
        } catch (e) {
          console.log('Failed to open ICP link:', e);
        }
      " class="text-xxs hover:underline text-muted tracking-wide" aria-label="ICP Registration Information">
辽ICP备20006550号-1
</button> </div> </div> </div> </div> </div> </footer> </footer> </div> <section> <div id="weekly-modal" data-subscribeText="Join Now" data-placeholder="Subscribe with your email" data-embed-url="https://weekly.fatbobman.com/embed" data-iframe-class="mx-auto sm:w-[320px] md:w-[480px] sm:h-[200px] md:h-[320px] dark:opacity-80 dark:rounded-lg dark:shadow-2xl dark:border-gray-600" data-iframe-style="border:0px solid #EEE; background:white; width: 100%; max-width: 480px;"> <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"> <!-- Modal content --> <div class="relative bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg shadow-2xl border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button id="popup-modal-close-button" type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4 md:w-[480px] sm:w-80 mx-auto"> <div class="sm:hidden md:block text-base text-center font-bold text-gray-900 dark:text-blue-100 pt-4 pb-2 ">Weekly Swift &amp; SwiftUI Highlights - Every Monday</div> <div id="weekly-modal-embed" class="flex flex-col items-center justify-center gap-4" data-iframe-loaded="false"> <div class="relative flex items-center justify-center"> <div class="w-8 h-8 border-2 border-gray-200 dark:border-gray-700 border-t-secondary rounded-full animate-spin" aria-hidden="true"></div> </div> <div class="text-sm text-gray-400 dark:text-gray-500 text-center" data-weekly-loader data-error-text="Failed to load subscription form. Please retry later." aria-live="polite"> Preparing subscription form... </div> </div> </div> </div> </div> </div> </section> <script type="module" src="/_astro/WeeklyModalLoader.astro_astro_type_script_index_0_lang.DMZWLG_2.js"></script>  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js" async></script> <script>
  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', () => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };

  if (typeof window !== 'undefined') {
    const videos = Array.from(document.querySelectorAll('video.lazy-video[data-autoplay="lazy"]'));

    const disableTooltipsOnTouch = () => {
      const isTouch =
        'ontouchstart' in window ||
        (navigator && navigator.maxTouchPoints > 0) ||
        (window.matchMedia && window.matchMedia('(pointer: coarse)').matches);
      if (!isTouch) {
        return;
      }
      const triggers = document.querySelectorAll('[data-tooltip-target]');
      triggers.forEach((trigger) => {
        const tooltipId = trigger.getAttribute('data-tooltip-target');
        trigger.removeAttribute('data-tooltip-target');
        trigger.removeAttribute('data-tooltip-placement');
        if (tooltipId) {
          const tooltipEl = document.getElementById(tooltipId);
          if (tooltipEl && tooltipEl.parentNode) {
            tooltipEl.parentNode.removeChild(tooltipEl);
          }
        }
      });
    };

    document.addEventListener('DOMContentLoaded', disableTooltipsOnTouch);

    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const video = entry.target;

            if (entry.isIntersecting) {
              // 进入视窗 -> 尝试播放（浏览器会根据策略决定是否允许）
              video.play().catch(() => {
                // 某些情况下（浏览器策略）可能会失败，静默即可
              });
            } else {
              // 离开视窗 -> 暂停，节省 CPU & 带宽
              video.pause();
            }
          });
        },
        {
          threshold: 0.1, // 至少有 10% 出现在视窗里时触发
        }
      );

      videos.forEach((video) => observer.observe(video));

      // 清理逻辑：页面卸载时取消所有观察
      window.addEventListener('beforeunload', () => {
        videos.forEach((video) => observer.unobserve(video));
        observer.disconnect();
      });

      // 处理 bfcache 情况
      window.addEventListener('pageshow', (event) => {
        // 如果是从 bfcache 恢复，重新初始化
        if (event.persisted) {
          const newVideos = Array.from(document.querySelectorAll('video.lazy-video[data-autoplay="lazy"]'));
          newVideos.forEach((video) => {
            if (!videos.includes(video)) {
              observer.observe(video);
            }
          });
        }
      });
    } else {
      // 老浏览器的降级策略：什么都不做，用户手动播放
    }
  }
</script> <script>(function(){const lang = "en";
const searchText = "Search...";
const runSearchModuleUrl = "/_astro/runsearch.Cf7wkMmH.js";

  document.addEventListener('DOMContentLoaded', () => {
    const button = document.getElementById('docsearch');
    if (!button) {
      return;
    }

    let docsearchScriptPromise = null;
    let initialized = false;

    const loadDocsearchLibrary = () => {
      if (typeof window !== 'undefined' && typeof window.docsearch === 'function') {
        return Promise.resolve();
      }
      if (!docsearchScriptPromise) {
        docsearchScriptPromise = new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.3';
          script.defer = true;
          script.onload = () => resolve();
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }
      return docsearchScriptPromise;
    };

    const handleFirstClick = async (event) => {
      event.preventDefault();
      event.stopPropagation();

      try {
        // Load DocSearch library
        await loadDocsearchLibrary();

        // Import and execute search module
        const module = await import(runSearchModuleUrl);

        // openSearch will call initSearch internally, so we don't need to call both
        await module.openSearch(lang, searchText);

        // Remove the first-click listener after successful initialization
        button.removeEventListener('click', handleFirstClick, true);
        initialized = true;
      } catch (error) {
        console.error('Failed to initialize DocSearch:', error);
      }
    };

    button.addEventListener('click', handleFirstClick, true);
  });
})();</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <!--Magic Fix 解决在 Safari 下搜索框取消后会滚动到页面底部--> <div class="fixed"> <input type="text"> </div> </body></html>
<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>Understanding SwiftUI&#39;s View Update Mechanism - Starting from a TimelineView Update Issue</title>
<meta name="description" content="Explore SwiftUI&#39;s view update mechanism with a TimelineView issue. Learn about view types, declarations, and instances for efficient UI updates.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/">
<meta property="og:title" content="Understanding SwiftUI&#39;s View Update Mechanism - Starting from a TimelineView Update Issue">
<meta property="og:description" content="Explore SwiftUI&#39;s view update mechanism with a TimelineView issue. Learn about view types, declarations, and instances for efficient UI updates.">
<meta property="og:url" content="https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://og.fatbobman.com/card/understanding-swiftui-view-update-mechanism-en.webp">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><!-- ÂÖ∂‰ªñË∑ØÂæÑÁöÑ hreflang -->
  <link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/">
  <link rel="alternate" hreflang="zh-CN" href="https://fatbobman.com/zh/posts/understanding-swiftui-view-update-mechanism/">
  <link rel="alternate" hreflang="x-default" href="https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/"><script type="text/partytown" src="https://analytics.ahrefs.com/analytics.js" data-key="KF0NNRpbcfyJPzijzZEiOw"></script> <script data-partytown-skip="true">
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.async = true; // Add async attribute
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> <!-- Google Tag Manager --><script type="text/partytown">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@id": "#author"
  },
  "dateModified": "2024-11-13T00:12:00.000Z",
  "datePublished": "2024-11-13T00:12:00.000Z",
  "description": "Explore SwiftUI's view update mechanism with a TimelineView issue. Learn about view types, declarations, and instances for efficient UI updates.",
  "headline": "Understanding SwiftUI's View Update Mechanism - Starting from a TimelineView Update Issue",
  "image": {
    "@type": "ImageObject",
    "url": "https://og.fatbobman.com/card/understanding-swiftui-view-update-mechanism-en.webp"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/"
  },
  "url": "https://fatbobman.com/en/posts/understanding-swiftui-view-update-mechanism/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  },
  "articleSection": [
    "SwiftUI"
  ],
  "inLanguage": "en"
}</script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "Person",
  "@id": "#author",
  "name": "‰∏úÂù°ËÇòÂ≠ê (ÂæêÊù®)",
  "alternateName": "Fatbobman (Xu Yang)",
  "jobTitle": "Apple Developer",
  "description": "ËãπÊûúÁîüÊÄÅÂºÄÂèëËÄÖÔºå‰∏ìÊ≥® Swift Âíå SwiftUI ÂºÄÂèë„ÄÇFatbobman's Blog ‰ΩúËÄÖ„ÄÇ",
  "url": "https://fatbobman.com",
  "image": {
    "@type": "ImageObject",
    "url": "https://cdn.fatbobman.com/FatWithBoys.png"
  },
  "sameAs": [
    "https://github.com/fatbobman",
    "https://x.com/fatbobman",
    "https://www.linkedin.com/in/fatbobman/",
    "https://bsky.app/profile/fatbobman.com",
    "https://mastodon.social/@fatbobman",
    "https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3",
    "https://fatbobman.com/zh/about/",
    "https://fatbobman.com/en/about/"
  ],
  "worksFor": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script><link rel="stylesheet" href="/_astro/about.SoD2cByX.css">
<link rel="stylesheet" href="/_astro/_slug_.BRLGXoDU.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[])})(window,'partytown','forward');/* Partytown 0.11.2 - MIT QwikDev */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,l,d,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(d=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(l=setTimeout(v,(null==s?void 0:s.fallbackTimeout)||1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.11.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<d.length;n++)(o=r.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(l)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-6 sm:pt-6 font-black w-[240px] sm:w-[300px] pb-2 sm:pb-0"> <svg fill="currentColor" class="text-heading" width="500"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <button type="button" onclick="
            try {
                if ('#' !== '#') {
                    window.location.href = '#';
                }
            } catch (e) {
                console.log('Navigation failed:', e);
            }
        " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-aifadian"></use> </svg> </div> </button> </li><li> <button type="button" onclick="
              try {
                  if ('/zh/posts/understanding-swiftui-view-update-mechanism/' !== '#') {
                      window.location.href = '/zh/posts/understanding-swiftui-view-update-mechanism/';
                  }
              } catch (e) {
                  console.log('Navigation failed:', e);
              }
          " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
‰∏≠Êñá
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-aifadian"></use> </svg> </div> </button> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> <script type="module">function a(){const t=localStorage.getItem("lang"),e=document.getElementById("EN-check"),n=document.getElementById("ZH-check");e!==null&&n!==null&&(t==="en"?(e.classList.remove("hidden"),n.classList.add("hidden")):t==="zh"&&(n.classList.remove("hidden"),e.classList.add("hidden")))}document.addEventListener("DOMContentLoaded",()=>{a()});const l=document.getElementById("set-default-lang");l?.addEventListener("click",()=>{const t=document.getElementById("lang-data");if(t!=null){const e=t.dataset.lang;e!=null&&(localStorage.setItem("lang",e),a())}});</script> </div> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_system"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-computer"></use> </svg> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_dark"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-moon"></use> </svg> <svg viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_light"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-sun"></use> </svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center" id="theme_button_light"> <svg class="w-5 h-5" viewBox="0 0 1024 1024" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-sun"></use> </svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center " id="theme_button_dark"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-moon"></use> </svg> <span class="ml-2">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center " id="theme_button_system"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-computer"></use> </svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  // Ëé∑ÂèñÊåâÈíÆ
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');
  // Ëé∑ÂèñÂõæÊ†á
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else if (theme === 'light') {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.remove('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  resetTheme();

  // ÁõëÂê¨ÊöóÈªëÊ®°ÂºèÁöÑÂèòÂåñ
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    resetTheme();
  });

  // ‰øùËØÅÂÖ∂‰ªñÁöÑÈ°µÈù¢‰πüËÉΩÂ§üÁõëÂê¨Âà∞ localStorage ÁöÑÂèòÂåñ
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      resetTheme();
    }
  });


  // Listen for clicks on the button themeToggleDarkIcon
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleLightIcon
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleSystemIcon
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
  });
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent " aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Tips </a><a href="/en/sponsorship/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Sponsorship </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> About </a> </ul> </nav> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header>  <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10 " style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-normal" href="/en/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-wide" href="/zh/posts/understanding-swiftui-view-update-mechanism/" id="language-switcher-for-topic"> #‰∏≠ÊñáÁâà </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading ">Understanding SwiftUI&#39;s View Update Mechanism: Starting from a TimelineView Update Issue</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2024-11-13T00:12:00.000Z">Nov 13, 2024</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full "> <div> 
<p>In SwiftUI, the automatic view update mechanism allows us to easily build responsive user interfaces. However, sometimes views may not update as we expect. This article explores SwiftUI‚Äôs view update mechanism through a seemingly simple but representative <code>TimelineView</code> update issue.</p>
<aside aria-label="advertisement" role="complementary"><div class="dynamic-ad-inline"></div></aside>
<h2 id="the-problem">The Problem</h2>
<p>I recently received an email from a reader seeking help with an intriguing issue: when using SwiftUI‚Äôs <code>TimelineView</code>, two side-by-side emojis exhibited different behaviors.</p>
<p>The problematic code is roughly as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> emojis </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> [</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòÄ</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üò¨</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòÑ</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üôÇ</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòó</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">ü§ì</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòè</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòï</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòü</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòé</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòú</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">üòç</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">ü§™</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EmojiDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        TimelineView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">periodic</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">from</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">now</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">by</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0.2</span><span style="color:#999999;--shiki-dark:#F6F6F4">))</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> timeline </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            HStack</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">spacing</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 120</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">                let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> randomEmoji </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> emojis.</span><span style="color:#998418;--shiki-dark:#97E1F1">randomElement</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ??</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">randomEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                    .</span><span style="color:#998418;--shiki-dark:#97E1F1">font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">largeTitle</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                    .</span><span style="color:#998418;--shiki-dark:#97E1F1">scaleEffect</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">4.0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                RightEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> RightEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // let id: Int = .random(in: 0 ... 100_000) // Uncommenting this line makes the emoji update</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> randomEmoji </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> emojis.</span><span style="color:#998418;--shiki-dark:#97E1F1">randomElement</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ??</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">randomEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">largeTitle</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">scaleEffect</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">4.0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<video src="https://cdn.fatbobman.com/iShot_2024-11-08_08.32.09-1.mp4" muted="true" playsInline preload="none" loop data-autoplay="lazy" class="lazy-video"></video>
<p>This code exhibits a strange phenomenon: the emoji on the left continuously updates over time (randomly switching within the emoji array), while the emoji on the right (encapsulated in the <code>RightEmoji</code> view) remains static. Interestingly, if we add an apparently unrelated random variable in <code>RightEmoji</code> (even if we don‚Äôt use it), the right emoji starts updating normally.</p>
<p>Although I‚Äôve mentioned the principles behind similar issues in previous articles, I notice that readers still feel confused. Given that such questions are quite common in the community, I find it necessary to delve into this typical case to explore SwiftUI‚Äôs response and update mechanisms and understand what exactly causes this phenomenon.</p>
<h2 id="analyzing-view-concepts-in-swiftui">Analyzing View Concepts in SwiftUI</h2>
<p>Before deeply understanding SwiftUI‚Äôs update mechanism, we need to clarify three core concepts: view types, view declarations, and view type instances. These concepts may seem simple but are crucial to understanding how SwiftUI works.</p>
<h3 id="view-types">View Types</h3>
<p>When discussing ‚Äúviews‚Äù in SwiftUI, we usually refer to <strong>a type that conforms to the <code>View</code> protocol</strong>. The most common way is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> DemoView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hello World</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>While structs are the most commonly used, SwiftUI doesn‚Äôt limit us to structs. Any <strong>value type</strong> can become a view type, such as enums:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">enum</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnumView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    case</span><span style="color:#B07D48;--shiki-dark:#F6F6F4"> hello</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">self</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Interestingly, view types don‚Äôt necessarily have to primarily describe the UI. We can make any type gain the ability to become a view type through extensions:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Student</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> age: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> height: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Double</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> weight: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Double</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    func</span><span style="color:#59873A;--shiki-dark:#62E884"> sayHello</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hello, I&#39;m </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">name</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> bmi: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Double</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        weight </span><span style="color:#AB5959;--shiki-dark:#F286C4">/</span><span style="color:#999999;--shiki-dark:#F6F6F4"> (</span><span style="color:#393A34;--shiki-dark:#F6F6F4">height </span><span style="color:#AB5959;--shiki-dark:#F286C4">*</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> height</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Student</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hello, I&#39;m </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">name</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B56959;--shiki-dark:#E7EE98">, </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">age</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B56959;--shiki-dark:#E7EE98"> years old</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h3 id="view-declarations">View Declarations</h3>
<p>View declarations are code snippets where developers describe the presentation of the interface. Although most commonly done in the <code>body</code> property of a view type, SwiftUI provides various flexible declaration methods:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Global function</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">func</span><span style="color:#59873A;--shiki-dark:#62E884"> hello</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#1E754F;--shiki-dark:#F286C4"> some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hello World</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Global variable</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> world </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">World</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Type property</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">MainActor</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">enum</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MyViews</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    static</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> redRectangle: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Rectangle</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">foregroundStyle</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">red</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Enum</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">enum</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MyEnumView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    case</span><span style="color:#B07D48;--shiki-dark:#F6F6F4"> hello</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    case</span><span style="color:#B07D48;--shiki-dark:#F6F6F4"> world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">rawValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> CombineView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        VStack</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            hello</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            world</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            MyViews.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">redRectangle</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            MyEnumView.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">hello</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>It‚Äôs important to note that a view declaration is not a fixed pixel-level description but an abstract expression. SwiftUI determines the final rendering based on multiple factors (such as state, layout space, color mode, hardware specifications, etc.). <strong>For SwiftUI, a view declaration is essentially a value</strong> obtained by parsing the declaration code.</p>
<h3 id="view-type-instances">View Type Instances</h3>
<p>To obtain the value of a view declaration, SwiftUI needs to create instances of view types. The process is roughly as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// SwiftUI internal workflow illustration</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> demoViewInstance </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> DemoView</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // Create view type instance</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">saveInstanceValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">demoViewInstance</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">      // Save instance value</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> demoViewValue </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> demoViewInstance.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">body</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Get view declaration value</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">saveViewValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">demoViewValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">             // Save view declaration value</span></span></code></pre></div>
<p>SwiftUI saves two key values:</p>
<ul>
<li>The value of the view type instance</li>
<li>The value of the view declaration</li>
</ul>
<p>Some readers may wonder why we need to save the value of the view type instance. This is because, when there is no explicit signal to recompute, SwiftUI needs to decide whether to recompute the view declaration value by comparing changes in the view instance values. This mechanism is one of the cores of SwiftUI‚Äôs view update process, which we will discuss in detail later.</p>
<h2 id="response-and-re-evaluation-of-view-declaration-values">Response and Re-evaluation of View Declaration Values</h2>
<h3 id="swiftuis-response-mechanism">SwiftUI‚Äôs Response Mechanism</h3>
<p>Besides being a declarative framework, SwiftUI is also a reactive framework that automatically responds to events and invokes corresponding logic. The most common event types are user interactions and system events.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> OnTapDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Evaluating View Declaration Value</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Count: </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">count</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Tap Me</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            .</span><span style="color:#998418;--shiki-dark:#97E1F1">onTapGesture</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">hello world</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>In the code above, we demonstrate how SwiftUI responds to user tap events:</p>
<ul>
<li>Developers use the <code>onTapGesture</code> method to inject response code through the SwiftUI framework.</li>
<li>When the user taps ‚ÄúTap Me,‚Äù this code is called, and ‚Äúhello world‚Äù is printed to the console.</li>
</ul>
<video src="https://cdn.fatbobman.com/iShot_2024-11-08_10.25.02-1.mp4" muted="true" playsInline preload="none" loop data-autoplay="lazy" class="lazy-video"></video>
<p>However, after running the code, we find that apart from the initial load (when SwiftUI calls the <code>body</code> property of <code>OnTapDemo</code> to get the view declaration value), the <code>body</code> is not called again, no matter how many times we tap. This is because, in the <code>onTapGesture</code> closure, we did not perform operations recognized by SwiftUI that would affect the result of the view declaration value.</p>
<p>The following code injects response code to a timer <code>Publisher</code> through <code>onReceive</code>. Similar to the code above, although ‚Äúhello‚Äù is continuously printed to the console, it does not cause the view declaration value to be recalculated.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> OnReceiveDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> timer </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Timer.</span><span style="color:#998418;--shiki-dark:#97E1F1">publish</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">every</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">on</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">in</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">common</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">autoconnect</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Evaluating View Declaration Value</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hello</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            .</span><span style="color:#998418;--shiki-dark:#97E1F1">onReceive</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">timer</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#1E754F;--shiki-dark:#F286C4"> in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">hello</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>This means that <strong>adding response logic in the view code does not necessarily cause the view declaration value to change, nor does it necessarily cause SwiftUI to re-evaluate (compute) the view declaration value</strong>.</p>
<h3 id="conditions-for-re-evaluation-of-view-declaration-values">Conditions for Re-evaluation of View Declaration Values</h3>
<p>Apart from computing the view declaration value when the view is first loaded into the view tree, SwiftUI only re-evaluates the view declaration value under specific conditions to avoid unnecessary overhead. These conditions include:</p>
<ul>
<li>Explicit evaluation requests triggered by property wrappers provided by SwiftUI (e.g., <code>@State</code>, <code>@StateObject</code>, <code>@Environment</code>, etc.).</li>
<li>Changes in the value of the view type instance.</li>
</ul>
<p>Regardless of the condition, the starting point must be in response to some event. In other words, <strong>an event must occur before re-evaluation can be triggered</strong>.</p>
<p>Let‚Äôs adjust the <code>OnTapDemo</code> code by modifying the value of <code>count</code> in <code>onTapGesture</code>:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> OnTapDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Evaluating View Declaration Value</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Count: </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">count</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Tap Me</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            .</span><span style="color:#998418;--shiki-dark:#97E1F1">onTapGesture</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                count </span><span style="color:#AB5959;--shiki-dark:#F286C4">+=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<video src="https://cdn.fatbobman.com/iShot_2024-11-08_10.40.37-1.mp4" muted="true" playsInline preload="none" loop data-autoplay="lazy" class="lazy-video"></video>
<p>Now, when a tap event occurs, since <code>count</code> (based on <code>@State</code>) has changed, it meets the conditions for SwiftUI to re-evaluate the view declaration value. We can see that the <code>body</code> of the view is called again, and the Count displayed on the screen changes.</p>
<p>In SwiftUI, computing the view declaration value is a recursive process. It starts from the current view and traverses down the view tree in order unless a branch explicitly indicates that it does not need to continue computing downwards.</p>
<p>For example, in <code>OnTapDemo</code>, when re-evaluating its declaration value, <code>print(&quot;Evaluating View Declaration Value&quot;)</code> will inevitably execute, but this does not mean that all child views will have their declaration values re-computed.</p>
<p>SwiftUI will recreate instances of each child view and compare them with the previously saved instance values. Whether changes occur between the two determines whether to continue computing the view declaration value along this child view.</p>
<p><code>Text(&quot;Count: \(count)&quot;)</code>, because the value of <code>count</code> has changed (passed through the constructor parameter), causes its instance value to change. Therefore, this child view will inevitably be re-computed, and we can see the displayed value of Count has changed.</p>
<p>On the other hand, <code>Text(&quot;Tap Me&quot;)</code>, since the instance values are consistent before and after, SwiftUI will not re-compute the view declaration value of this child view.</p>
<p>To better demonstrate this process, we can observe by constructing child views and adding more output statements:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> OnTapDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Evaluating View Declaration Value</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Count: </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">count</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Tap Me</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            .</span><span style="color:#998418;--shiki-dark:#97E1F1">onTapGesture</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                count </span><span style="color:#AB5959;--shiki-dark:#F286C4">+=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        SubView1</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        SubView2</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">count</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView1</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    init</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">SubView1 init</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">SubView1 body update</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">No changes</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView2</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">count</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">SubView2 init</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">subview2 body update</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Count Changes: </span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">count</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<video src="https://cdn.fatbobman.com/iShot_2024-11-08_10.57.41-1.mp4" muted="true" playsInline preload="none" loop data-autoplay="lazy" class="lazy-video"></video>
<p>By observing the console output of this code, we can clearly see how SwiftUI evaluates whether to re-compute the declaration value of child views:</p>
<ul>
<li>When a tap event occurs, the <code>count</code> in <code>OnTapDemo</code> changes, causing SwiftUI to re-evaluate its view declaration value.</li>
<li>During the evaluation process, when processing <code>SubView1</code>, a new instance of the <code>SubView1</code> view type is recreated and compared (console outputs ‚ÄúSubView1 init‚Äù).</li>
<li>SwiftUI finds that the new instance value of <code>SubView1</code> is consistent with the previously saved instance value, so it does not continue to re-evaluate the view declaration value of <code>SubView1</code>, stopping its processing (ending recursion in this branch).</li>
<li>When processing <code>SubView2</code>, a new instance is also recreated (console outputs ‚ÄúSubView2 init‚Äù).</li>
<li>Since the constructor parameter <code>count</code> of <code>SubView2</code> has changed, causing the new instance value to be inconsistent with the previously saved instance value, SwiftUI will re-evaluate the view declaration value of <code>SubView2</code> (console outputs ‚ÄúSubView2 body update‚Äù) and replace the original instance value with the new instance value for future comparisons.</li>
<li>SwiftUI will continue processing recursively in <code>SubView2</code> according to the above rules.</li>
</ul>
<p>Through this code, developers should understand why <strong>SwiftUI, after responding to an event, needs to reconstruct view instances in the branch, regardless of whether the view has changed</strong>.</p>
<blockquote>
<p>For performance considerations, SwiftUI uses methods similar to <code>memcmp</code> to compare differences between two instance values in default scenarios.</p>
</blockquote>
<h2 id="ending-recursion-and-the-starting-point-of-updates">Ending Recursion and the Starting Point of Updates</h2>
<p>Some readers might wonder: If SwiftUI, when comparing downward from an update starting point, finds that the view instance values of its child views haven‚Äôt changed and thus ends the recursive operation, does that mean its grandchild views won‚Äôt be updated‚Äîeven if the state they depend on has changed during this update cycle?</p>
<p>Obviously not. In a SwiftUI update cycle, multiple states might change, or multiple views might directly depend on the changed state. SwiftUI collectively considers these views that need their view declaration values re-evaluated and treats each one as a starting point for an update operation.</p>
<p>Simply put, in a multi-layer view structure like <code>A -&gt; B -&gt; C -&gt; D</code>, if views <code>A</code> and <code>C</code> need to update due to state changes, while the view instance values of <code>B</code> and <code>D</code> haven‚Äôt changed, SwiftUI will separately use <code>A</code> and <code>C</code> as starting points for the current update computation, performing recursive operations independently.</p>
<h2 id="returning-to-our-problem">Returning to Our Problem</h2>
<p>Now, let‚Äôs revisit the <code>TimelineView</code> code provided:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EmojiDemo</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        TimelineView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">periodic</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">from</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">now</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">by</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0.2</span><span style="color:#999999;--shiki-dark:#F6F6F4">))</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> timeline </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            HStack</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">spacing</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 120</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">                let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> randomEmoji </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> emojis.</span><span style="color:#998418;--shiki-dark:#97E1F1">randomElement</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ??</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">randomEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                    .</span><span style="color:#998418;--shiki-dark:#97E1F1">font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">largeTitle</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                    .</span><span style="color:#998418;--shiki-dark:#97E1F1">scaleEffect</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">4.0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                RightEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> RightEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">        // let id: Int = .random(in: 0 ... 100_000) // Uncommenting this line makes the emoji update</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> randomEmoji </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> emojis.</span><span style="color:#998418;--shiki-dark:#97E1F1">randomElement</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ??</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">randomEmoji</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">font</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">largeTitle</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">scaleEffect</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">4.0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p><code>TimelineView</code> is a view container provided by SwiftUI that generates a series of events based on a preset time sequence and automatically responds to these events in the closure.</p>
<ul>
<li>When an event occurs, the code <code>let randomEmoji = emojis.randomElement() ?? &quot;&quot;</code> in the <code>TimelineView</code> closure is called.</li>
<li>Since the value of <code>randomEmoji</code> changes, the new instance value of <code>Text(randomEmoji)</code> used to display the left emoji also changes accordingly. SwiftUI re-evaluates the view declaration value of this <code>Text</code>, so we see the left emoji changing.</li>
<li>For the <code>RightEmoji</code> view, since its instance value does not change, SwiftUI does not re-evaluate its view declaration value, and the right emoji does not change.</li>
</ul>
<p>When we add a random variable in <code>RightEmoji</code>, the new instance value changes. Even if this random variable is not actually used, SwiftUI will still re-evaluate the view declaration value of <code>RightEmoji</code>. At this point, the right emoji will also change with the occurrence of time events.</p>
<h2 id="what-we-learned">What We Learned</h2>
<p>By exploring the view concepts and response update mechanisms in SwiftUI, developers should grasp the following key points:</p>
<ul>
<li><strong>Response code does not necessarily cause the view declaration value to be re-computed</strong>: Adding response logic in view code does not mean that the view declaration value will be re-evaluated as a result.</li>
<li><strong>Re-computation of the view declaration value requires event triggering</strong>: SwiftUI only re-evaluates the view declaration value under specific conditions (such as state changes). This process must be triggered by some event.</li>
<li><strong>Handle the construction process of view types carefully</strong>: Avoid performing time-consuming or complex operations in the constructor of view types. Because regardless of whether the view declaration value needs to be re-computed, SwiftUI may create instances of the view type multiple times.</li>
<li><strong>Optimize the computation process of the view declaration value</strong>: The computation of the view declaration value is a recursive process. By appropriate optimization, such as reducing unnecessary nested computations, you can effectively reduce computational overhead.</li>
<li><strong>Rationally split the view structure</strong>: Encapsulating the view declaration in a separate view type allows SwiftUI to better identify which views do not need to be re-computed, thereby improving the efficiency of view updates.</li>
</ul>
<p>Familiarity with these internal working mechanisms of SwiftUI will help developers write higher-performance and more robust SwiftUI applications. Interested readers can refer to related articles at the bottom to further understand the implementation details and optimization techniques of SwiftUI.</p> </div> </article> <aside aria-label="advertisement" role="complementary" id="card-advertisement"><div class="dynamic-ad-card"></div></aside> <!-- Ê†áÁ≠æÂÆπÂô®ÔºöÂ±Ö‰∏≠ --><div class="flex flex-wrap justify-center items-center gap-2 mb-10"> <span class="text-xs font-medium text-gray-400 uppercase tracking-widest mr-2">Tags</span> <a href="/en/tags/SwiftUI/" class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-normal"> <span class="opacity-50">#</span>SwiftUI </a> </div> <section class="py-10" id="related-posts"><!-- Section Ê†áÈ¢òÔºö‰∏éÊ≠£ÊñáÂå∫ÂàÜÔºåÂ¢ûÂä†Â±ÇÊ¨°ÊÑü --><div class="flex items-center gap-2 mb-6 justify-center text-gray-400 dark:text-gray-500"><span class="h-px w-8 bg-gray-200 dark:bg-gray-700"></span><span class="text-xs font-bold uppercase tracking-widest">Recommended Reading</span><span class="h-px w-8 bg-gray-200 dark:bg-gray-700"></span></div><!-- ÁΩëÊ†ºÂ∏ÉÂ±ÄÔºö2Âàó (ÁßªÂä®Á´Ø 1ÂàóÂ§™ÈïøÔºåÁõ¥Êé• 2ÂàóÊõ¥Á¥ßÂáë) --><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><a href="/en/posts/stateobject_and_observedobject/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- Ë£ÖÈ•∞ÔºöÂ∑¶‰∏äËßíÁöÑÂ∞èÁÇπÊàñÂõæÊ†áÔºåÂ¢ûÂä†Á≤æËá¥ÊÑü --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- Ê†áÈ¢ò --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">SwiftUI‚Äôs StateObject and ObservedObject: The Key Differences</span><!-- ÁÆ≠Â§¥ÂõæÊ†áÔºöHover Êó∂Âπ≥ÁßªÂá∫Áé∞ --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/bug-code-by-state-inject/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- Ë£ÖÈ•∞ÔºöÂ∑¶‰∏äËßíÁöÑÂ∞èÁÇπÊàñÂõæÊ†áÔºåÂ¢ûÂä†Á≤æËá¥ÊÑü --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- Ê†áÈ¢ò --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Cracking the Code: The Mysterious @State Injection Mechanism</span><!-- ÁÆ≠Â§¥ÂõæÊ†áÔºöHover Êó∂Âπ≥ÁßªÂá∫Áé∞ --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/tips-and-considerations-for-using-lazy-containers-in-swiftui/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- Ë£ÖÈ•∞ÔºöÂ∑¶‰∏äËßíÁöÑÂ∞èÁÇπÊàñÂõæÊ†áÔºåÂ¢ûÂä†Á≤æËá¥ÊÑü --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- Ê†áÈ¢ò --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Tips and Considerations for Using Lazy Containers in SwiftUI</span><!-- ÁÆ≠Â§¥ÂõæÊ†áÔºöHover Êó∂Âπ≥ÁßªÂá∫Áé∞ --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a><a href="/en/posts/exploring-key-property-wrappers-in-swiftui/" class="
                group relative flex flex-col justify-center px-5 py-4 h-full
                bg-white dark:bg-gray-900/50 
                border border-gray-200 dark:border-gray-700/60 rounded-xl
                hover:border-orange-400/50 dark:hover:border-blue-500/50
                hover:shadow-[0_2px_8px_-2px_rgba(0,0,0,0.05)] dark:hover:shadow-none
                transition-all duration-300
              "><!-- Ë£ÖÈ•∞ÔºöÂ∑¶‰∏äËßíÁöÑÂ∞èÁÇπÊàñÂõæÊ†áÔºåÂ¢ûÂä†Á≤æËá¥ÊÑü --><div class="absolute top-4 left-3 w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600 group-hover:bg-orange-500 dark:group-hover:bg-blue-500 transition-colors"></div><div class="flex items-start justify-between gap-3 pl-2"><!-- Ê†áÈ¢ò --><span class="text-[15px] leading-relaxed font-medium text-gray-700 dark:text-gray-200 group-hover:text-black dark:group-hover:text-white transition-colors ">Exploring Key Property Wrappers in SwiftUI: @State, @Binding, @StateObject, @ObservedObject, @EnvironmentObject, and @Environment</span><!-- ÁÆ≠Â§¥ÂõæÊ†áÔºöHover Êó∂Âπ≥ÁßªÂá∫Áé∞ --><svg class="w-4 h-4 text-gray-400 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></div></a></div></section> <!-- <BuymeacoffeeInPost lang={lang} /> --> <!-- <WeeklySubscribe lang={lang} bottom={0} top={8} anchor='related-posts'/> --> <!-- <Author lang={lang} /> --> <!-- Êï¥ÂêàÂ∫ïÂ∫ßÂÆπÂô® --><div class="mt-16 mb-28 bg-gray-50 dark:bg-gray-800/50 border border-gray-100 dark:border-gray-700/60 rounded-2xl p-6 sm:p-8"> <div class="flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-12"> <!-- Â∑¶‰æßÔºöËÆ¢ÈòÖÂå∫Âüü --> <!-- ÈÄÇÈÖçÈÄªËæëÔºöÁßªÂä®Á´Ø/Âπ≥ÊùøÂ±Ö‰∏≠(text-center)ÔºåÊ°åÈù¢Á´ØÂ±ÖÂ∑¶(lg:text-left) --> <div class="flex-1 w-full text-center lg:text-left flex flex-col items-center lg:items-start"> <h3 class="font-bold text-xl text-gray-900 dark:text-gray-100 mb-2"> Subscribe to Fatbobman </h3> <p class="text-sm text-gray-500 dark:text-gray-400 mb-6 max-w-md"> Weekly Swift &amp; SwiftUI highlights. Join developers. </p> <!-- ËÆ¢ÈòÖÊåâÈíÆÔºö‰ΩøÁî®ÈîöÁÇπÈìæÊé•Ëß¶Âèë Modal --> <a href="#subscript" class="
          bg-black dark:bg-white text-white dark:text-black 
          font-bold text-sm px-8 py-3 rounded-xl 
          hover:opacity-80 hover:scale-105 active:scale-95
          transition-all duration-200 shadow-sm
          w-full sm:w-auto inline-block text-center
        "> Subscribe Now </a> </div> <!-- Âè≥‰æßÔºöÂäüËÉΩÊåâÈíÆÁªÑ --> <!-- ÈÄÇÈÖçÈÄªËæëÔºöÁßªÂä®Á´ØÂ†ÜÂè†(grid-cols-1)ÔºåÂπ≥Êùø‰ª•‰∏äÂπ∂Êéí(sm:grid-cols-2) --> <!-- w-full lg:w-auto ‰øùËØÅÁßªÂä®Á´ØÊíëÊª°ÔºåÊ°åÈù¢Á´ØÁ¥ßÂáë --> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full lg:w-auto min-w-[320px]"> <!-- ÂíñÂï°ÊåâÈíÆ --> <a href="https://www.buymeacoffee.com/fatbobman" target="_blank" rel="noopener" class="group flex items-center justify-center lg:justify-start gap-3 px-5 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl shadow-sm hover:shadow-md hover:border-orange-200 dark:hover:border-orange-900 transition-all"> <span class="text-2xl group-hover:scale-110 transition-transform">‚òïÔ∏è</span> <div class="text-left"> <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Support</div> <div class="text-sm font-bold text-gray-800 dark:text-gray-100">Buy me a Coffee</div> </div> </a> <!-- Discord ÊåâÈíÆ --> <a href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" rel="noopener" class="group flex items-center justify-center lg:justify-start gap-3 px-5 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl shadow-sm hover:shadow-md hover:border-blue-200 dark:hover:border-blue-900 transition-all"> <span class="text-2xl group-hover:scale-110 transition-transform">üí¨</span> <div class="text-left"> <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">CONNECT</div> <div class="text-sm font-bold text-gray-800 dark:text-gray-100">Follow on X</div> </div> </a> </div> </div> </div> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* Ê†πÊçÆÊÇ®ÁöÑÂ∏ÉÂ±ÄË∞ÉÊï¥‰ΩçÁΩÆ */
    top: 50%; /* Â∞ÜÂõæÊ†áÂÆö‰ΩçÂà∞Ê†áÈ¢òÁöÑ‰∏≠Èó¥È´òÂ∫¶ */
    transform: translateY(-50%); /* ÂûÇÁõ¥Â±Ö‰∏≠ÂØπÈΩêÂõæÊ†á */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* ÂßãÁªàÂìçÂ∫îÈº†Ê†á‰∫ã‰ª∂ */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* ÂàùÂßãÂú®ËßÜÁ™ó‰∏ãÊñπ */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* ËøõÂÖ•Âä®Áîª */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* Ê∂àÂ§±Âä®Áîª */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script defer>
  var hideTimeout; // Áî®‰∫é‰øùÂ≠òËá™Âä®ÈöêËóèÂÆöÊó∂Âô®ÁöÑÂºïÁî®
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // ‰ΩøÁî®ÊÇ®ÈÄâÊã©ÁöÑÂõæÊ†á
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // ÈªòËÆ§ÈÄèÊòé
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // Á°Æ‰øùÊèêÁ§∫Ê°ÜÊòØÂèØËßÅÁöÑ
                alertDiv.style.display = 'block'; // ÊòæÁ§∫ÊèêÁ§∫Ê°Ü
                clearTimeout(hideTimeout); // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                alertDiv.style.animation = 'none'; // ÂÖàÊ∏ÖÈô§‰πãÂâçÁöÑÂä®Áîª
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // Â∫îÁî®Êñ∞Âä®Áîª
                }, 10);

                // ËÆæÁΩÆËá™Âä®ÈöêËóèÂÆöÊó∂Âô®
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // Â∫îÁî®Ê∂àÂ§±Âä®Áîª
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script data-partytown-skip>
window.copyCode = function (button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // Ëé∑Âèñ‰ª£Á†ÅÂÜÖÂÆπ

  function showCopiedFeedback() {
    // ÊòæÁ§∫ "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';
    // 3ÁßíÂêéÊÅ¢Â§ç
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  }

  // Modern Clipboard API
  if (navigator.clipboard) {
    navigator.clipboard.writeText(codeBlock).then(showCopiedFeedback).catch(err => {
      console.error('Async: Could not copy text: ', err);
    });
  } else {
    // Fallback for older browsers or insecure contexts
    const textArea = document.createElement("textarea");
    textArea.value = codeBlock;
    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";

    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();

    try {
      if (document.execCommand('copy')) {
        showCopiedFeedback();
      }
    } catch (err) {
      console.error('Fallback: Oops, unable to copy', err);
    }
    document.body.removeChild(textArea);
  }
}
</script> <script>(function(){const baseUrl = "https://fatbobman.com/ads/";
const langSuffix = "en";
const utmTerm = "en/understanding-swiftui-view-update-mechanism";

  // ========================================
  // Configuration & Constants
  // ========================================

  const CACHE_DURATION = 20 * 60 * 1000; // 20 minutes
  const STALE_THRESHOLD = 24 * 60 * 60 * 1000; // 24 hours - when to force UI refresh

  // ËØªÂèñ URL ÂèÇÊï∞Áî®‰∫éÊµãËØïÂíåÈ¢ÑËßà
  const urlParams = new URLSearchParams(window.location.search);
  const adIdParam = urlParams.get('adid') || urlParams.get('adId');
  const sponsorIdParam = urlParams.get('sponsorId');
  const scheduleIdParam = urlParams.get('scheduleId');
  const forceUpdateParam = urlParams.get('adForceUpdate') === 'true';

  const isPreviewMode = !!(adIdParam || sponsorIdParam || scheduleIdParam);
  const effectiveCacheDuration = isPreviewMode ? 60 * 1000 : CACHE_DURATION;

  // ========================================
  // Cache Management Functions
  // ========================================

  /**
   * Load ad from cache with SWR metadata
   * @param {string} cacheKey - Cache key
   * @returns {Object|null} - Cached ad data with metadata or null
   */
  function loadFromCache(cacheKey) {
    try {
      const cachedData = localStorage.getItem(cacheKey);
      if (!cachedData) return null;

      const cached = JSON.parse(cachedData);

      // Backward compatibility: handle old cache format
      if (cached.content && !cached.metadata) {
        console.log(`[AdsLoader SWR] Old cache format detected for ${cacheKey}, will update`);
        return null; // Force refresh to get new format
      }

      return cached;
    } catch (e) {
      console.warn(`[AdsLoader SWR] Failed to parse cached ad: ${cacheKey}`, e);
      localStorage.removeItem(cacheKey);
      return null;
    }
  }

  /**
   * Save ad to cache with metadata
   * @param {string} cacheKey - Cache key
   * @param {string} content - Ad HTML content
   * @param {Object} metadata - Ad metadata from response headers
   */
  function saveToCache(cacheKey, content, metadata) {
    try {
      const cacheData = {
        content: content,
        metadata: {
          ...metadata,
          fetchedAt: Date.now()
        }
      };

      localStorage.setItem(cacheKey, JSON.stringify(cacheData));
      const cacheMinutes = Math.round(effectiveCacheDuration / 60000);
      console.log(`[AdsLoader SWR] Saved to cache: ${cacheKey} (${cacheMinutes} min)`, metadata);
    } catch (e) {
      console.warn(`[AdsLoader SWR] Failed to save cache: ${cacheKey}`, e);
    }
  }

  /**
   * Extract metadata from response headers
   * @param {Response} response - Fetch response object
   * @returns {Object} - Metadata object
   */
  function extractMetadata(response) {
    return {
      sponsorId: response.headers.get('X-Sponsor-Id') || 'unknown',
      adId: response.headers.get('X-Ad-Id') || 'unknown',
      version: parseInt(response.headers.get('X-Ad-Version') || '1'),
      lang: response.headers.get('X-Ad-Lang') || langSuffix,
      lastUpdated: response.headers.get('Last-Modified') || new Date().toISOString(),
      forceUpdate: response.headers.get('X-Force-Update') === 'true',
      campaign: response.headers.get('X-UTM-Campaign') || null // Optional UTM campaign
    };
  }

  // ========================================
  // Smart Refresh Logic
  // ========================================

  /**
   * Check if two timestamps are on the same UTC calendar day
   * @param {number} timestamp1 - First timestamp (milliseconds)
   * @param {number} timestamp2 - Second timestamp (milliseconds)
   * @returns {boolean} - True if same UTC day
   */
  function isSameUTCDay(timestamp1, timestamp2) {
    const d1 = new Date(timestamp1);
    const d2 = new Date(timestamp2);
    return d1.getUTCFullYear() === d2.getUTCFullYear() &&
           d1.getUTCMonth() === d2.getUTCMonth() &&
           d1.getUTCDate() === d2.getUTCDate();
  }

  /**
   * Decide if UI should be refreshed based on cache age and ad changes
   * @param {Object|null} cached - Cached ad data with metadata
   * @param {Object} newMetadata - New ad metadata from server
   * @returns {boolean} - True if UI should be refreshed
   */
  function shouldRefreshUI(cached, newMetadata) {
    // Rule 1: No cache -> always render (first load)
    if (!cached || !cached.metadata) {
      console.log('[AdsLoader SWR] No cache, will render immediately');
      return true;
    }

    // Rule 2: Force update parameter -> always refresh
    if (forceUpdateParam || newMetadata.forceUpdate) {
      console.log('[AdsLoader SWR] Force update detected, will refresh UI');
      return true;
    }

    const cachedMeta = cached.metadata;
    const cacheAge = Date.now() - cachedMeta.fetchedAt;

    // Rule 3: Sponsor changed -> always refresh (different advertiser)
    if (cachedMeta.sponsorId !== newMetadata.sponsorId) {
      console.log(`[AdsLoader SWR] Sponsor changed: ${cachedMeta.sponsorId} ‚Üí ${newMetadata.sponsorId}, will refresh UI`);
      return true;
    }

    // Rule 4: UTC date changed -> always refresh (ad schedule switches by calendar day)
    if (!isSameUTCDay(cachedMeta.fetchedAt, Date.now())) {
      const cachedDate = new Date(cachedMeta.fetchedAt).toISOString().split('T')[0];
      const currentDate = new Date().toISOString().split('T')[0];
      console.log(`[AdsLoader SWR] UTC date changed: ${cachedDate} ‚Üí ${currentDate}, will refresh UI`);
      return true;
    }

    // Rule 5: Cache older than 24 hours -> always refresh
    if (cacheAge > STALE_THRESHOLD) {
      console.log(`[AdsLoader SWR] Cache very old (${Math.round(cacheAge / 3600000)}h), will refresh UI`);
      return true;
    }

    // Rule 6: Ad ID changed (same sponsor, different version) -> refresh if old, else silent update
    if (cachedMeta.adId !== newMetadata.adId) {
      console.log(`[AdsLoader SWR] Ad changed but cache fresh (${Math.round(cacheAge / 60000)}min), will update silently`);
      return false; // Silent update
    }

    // Rule 7: Default - silent update
    console.log(`[AdsLoader SWR] Cache fresh (${Math.round(cacheAge / 60000)}min old), will update silently`);
    return false;
  }

  // ========================================
  // UTM Parameters Injection
  // ========================================

  /**
   * Inject UTM parameters to all links in ad HTML
   * Only applies to non-default ads (sponsored ads)
   * @param {string} html - Ad HTML content
   * @param {Object} metadata - Ad metadata (sponsorId, campaign, version, etc.)
   * @returns {string} - Modified HTML with UTM parameters
   */
  function injectUTMParameters(html, metadata) {
    // Skip UTM injection for default ads
    if (metadata.sponsorId === 'default') {
      return html;
    }

    // Create temporary container to parse HTML
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = html;

    // Find all links
    const links = tempDiv.querySelectorAll('a[href]');

    if (links.length === 0) {
      return html; // No links found, return original HTML
    }

    // Build UTM parameters
    const utmParams = {
      utm_source: 'fatbobman',
      utm_medium: 'blog',
      utm_content: metadata.version === 2 ? 'post-header' : 'post-footer'
    };

    // Add campaign if available
    if (metadata.campaign) {
      utmParams.utm_campaign = metadata.campaign;
    }

    // Add term if available
    if (utmTerm) {
      utmParams.utm_term = utmTerm;
    }

    // Inject UTM parameters to each link
    links.forEach(link => {
      try {
        const url = new URL(link.href);

        // Add each UTM parameter
        Object.entries(utmParams).forEach(([key, value]) => {
          url.searchParams.set(key, value);
        });

        link.href = url.toString();
      } catch (e) {
        // Invalid URL, skip
        console.warn('[AdsLoader SWR] Skipping invalid URL:', link.href, e);
      }
    });

    console.log('[AdsLoader SWR] Injected UTM parameters:', utmParams, `(${links.length} link(s))`);
    return tempDiv.innerHTML;
  }

  // ========================================
  // Ad Loading & Rendering
  // ========================================

  /**
   * Render ad to containers
   * @param {string} html - Ad HTML content
   * @param {string} containerSelector - Container selector
   * @param {string} reason - Reason for rendering (for logging)
   */
  function renderAd(html, containerSelector, reason = 'unknown') {
    const containers = document.querySelectorAll(containerSelector);
    if (containers.length === 0) {
      console.warn(`[AdsLoader SWR] No containers found: ${containerSelector}`);
      return;
    }

    containers.forEach(container => {
      container.innerHTML = html;
    });

    console.log(`[AdsLoader SWR] Rendered ad to ${containers.length} container(s): ${containerSelector} (${reason})`);
  }

  /**
   * Fetch ad from server
   * @param {number} version - Ad version (1 or 2)
   * @param {string} cacheKey - Cache key
   * @param {string} containerSelector - Container selector
   * @param {Object|null} cached - Cached ad data (if any)
   */
  async function fetchAd(version, cacheKey, containerSelector, cached) {
    // Build URL with parameters
    const params = new URLSearchParams({
      lang: langSuffix,
      version: version.toString()
    });

    // Add test/preview parameters
    if (adIdParam) params.append('adId', adIdParam);
    if (sponsorIdParam) params.append('sponsorId', sponsorIdParam);
    if (scheduleIdParam) params.append('scheduleId', scheduleIdParam);
    if (forceUpdateParam) params.append('adForceUpdate', 'true');

    const url = `${baseUrl}?${params.toString()}`;
    const previewTag = isPreviewMode ? ' [PREVIEW MODE]' : '';
    console.log(`[AdsLoader SWR] Fetching ad: ${url}${previewTag}`);

    try {
      const response = await fetch(url, {
        headers: { 'Accept': 'text/html' },
        cache: 'no-cache'
      });

      // Validate HTTP status
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      // Validate required metadata headers
      const sponsorId = response.headers.get('X-Sponsor-Id');
      const adId = response.headers.get('X-Ad-Id');

      if (!sponsorId || !adId || sponsorId === 'null' || adId === 'null') {
        console.warn('[AdsLoader SWR] Invalid response: missing or null metadata headers');
        throw new Error('Invalid ad response: missing metadata headers');
      }

      const content = await response.text();
      const metadata = extractMetadata(response);

      // Inject UTM parameters for sponsored ads
      const processedContent = injectUTMParameters(content, metadata);

      console.log('[AdsLoader SWR] Server response metadata:', metadata);

      // Decide if UI should be refreshed
      const shouldRefresh = shouldRefreshUI(cached, metadata);

      // Always update cache (with UTM-enhanced content)
      saveToCache(cacheKey, processedContent, metadata);

      // Conditionally refresh UI (with UTM-enhanced content)
      if (shouldRefresh) {
        renderAd(processedContent, containerSelector, shouldRefresh === true && !cached ? 'initial load' : 'smart refresh');
      } else {
        console.log(`[AdsLoader SWR] UI kept as-is, updated cache for next visit`);
      }

    } catch (error) {
      console.error(`[AdsLoader SWR] Error loading ad (version ${version}):`, error);

      // Smart fallback strategy based on cached ad type
      if (cached && cached.metadata) {
        if (cached.metadata.sponsorId === 'default') {
          // Default ad: keep displaying cached content (own content, safe to show when stale)
          console.log('[AdsLoader SWR] Fetch failed, keeping default ad cache');
          // UI already shows cached content, no action needed
        } else {
          // Sponsored ad: clear display (avoid showing expired paid ads)
          console.log('[AdsLoader SWR] Fetch failed, clearing sponsored ad to avoid showing stale content');
          renderAd('', containerSelector, 'error-clear');
        }
      } else {
        // No cache: leave blank
        console.log('[AdsLoader SWR] Fetch failed with no cache, leaving blank');
      }
    }
  }

  /**
   * Load ad with SWR strategy
   * @param {number} version - Ad version
   * @param {string} cacheKey - Cache key
   * @param {string} containerSelector - Container selector
   */
  function loadAd(version, cacheKey, containerSelector) {
    // Check if containers exist
    const containers = document.querySelectorAll(containerSelector);
    if (containers.length === 0) {
      console.log(`[AdsLoader SWR] No containers found for ${containerSelector}, skipping version ${version}`);
      return;
    }

    // Step 1: Load from cache if available
    const cached = loadFromCache(cacheKey);
    if (cached && cached.content) {
      console.log(`[AdsLoader SWR] Displaying cached ad: ${cacheKey}`, cached.metadata);
      // Inject UTM parameters to cached content (in case it's from old cache without UTM)
      const processedCachedContent = injectUTMParameters(cached.content, cached.metadata);
      renderAd(processedCachedContent, containerSelector, 'from cache');
    } else {
      console.log(`[AdsLoader SWR] No cache available for ${cacheKey}, will show blank until loaded`);
    }

    // Step 2: Fetch from server in background
    fetchAd(version, cacheKey, containerSelector, cached);
  }

  // ========================================
  // Initialization
  // ========================================

  function initAds() {
    console.log('[AdsLoader SWR] Initializing ad loading with Stale-While-Revalidate strategy...');
    console.log(`[AdsLoader SWR] Config: cacheDuration=${effectiveCacheDuration/60000}min, staleThreshold=${STALE_THRESHOLD/3600000}h`);

    if (isPreviewMode) {
      const params = [];
      if (adIdParam) params.push(`adId=${adIdParam}`);
      if (sponsorIdParam) params.push(`sponsorId=${sponsorIdParam}`);
      if (scheduleIdParam) params.push(`scheduleId=${scheduleIdParam}`);
      console.log(`[AdsLoader SWR] üîç PREVIEW MODE: ${params.join(', ')}`);
    }

    if (forceUpdateParam) {
      console.log('[AdsLoader SWR] üîÑ FORCE UPDATE MODE: UI will always refresh');
    }

    // Generate cache keys (include test params to avoid conflicts)
    const cacheKeySuffix = langSuffix + (adIdParam || sponsorIdParam || scheduleIdParam || '');
    const cacheKeyCard = 'dynamicAdCardSWR-' + cacheKeySuffix;
    const cacheKeyInline = 'dynamicAdInlineSWR-' + cacheKeySuffix;

    // Load both ad versions
    loadAd(1, cacheKeyCard, '.dynamic-ad-card');
    loadAd(2, cacheKeyInline, '.dynamic-ad-inline');
  }

  // Start loading when page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAds);
  } else {
    initAds();
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div id="gitalk-container" data-comment-id="ÁêÜËß£ SwiftUI ÁöÑËßÜÂõæÂà∑Êñ∞Êú∫Âà∂" data-lang="en" data-repo="blogComments" data-createIssueManually="true" data-anchor="card-advertisement" class="pb-16"></div>

    <script defer>
      document.addEventListener('DOMContentLoaded', async function () {
      const container = document.getElementById('gitalk-container');
      let anchor = '';
      if (container) {
        anchor = container.getAttribute('data-anchor') || '';
      }
        // ÊèêÂâçÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÂä†ËΩΩËØÑËÆ∫
        try {
          const response = await fetch('https://fatbobman.com/status/comment');
          const data = await response.text();
          console.log(data, "comment");

          if (data !== '1') {
            console.log('ËØÑËÆ∫ÂäüËÉΩÊú™ÂêØÁî®ÔºåË∑≥ËøáÁõëÊéßÂíåÂä†ËΩΩÊìç‰Ωú„ÄÇ');
            return; // ÊèêÂâçËøîÂõûÔºåË∑≥ËøáÂêéÁª≠ÈÄªËæë
          }
        } catch (error) {
          console.error('Ê£ÄÊü•ËØÑËÆ∫Áä∂ÊÄÅÊó∂Âá∫ÈîôÔºö', error);
          return; // Âá∫Áé∞ÈîôËØØÊó∂‰πüË∑≥ËøáÂêéÁª≠ÈÄªËæë
        }

        // Â¶ÇÊûúËøîÂõûÂÄº‰∏∫ "1"ÔºåÂàôÂêØÂä®ËßÇÂØüÂô®
        const observerTarget = document.getElementById(anchor);
        if (observerTarget) {
          const observer = new IntersectionObserver(async (entries, observer) => {
            const entry = entries[0];
            if (entry.isIntersecting) {
              console.log("load comment")
              // ÂÅúÊ≠¢ËßÇÂØüÔºåÈÅøÂÖçÈáçÂ§çËß¶Âèë
              observer.unobserve(observerTarget);

              // Âä®ÊÄÅÂä†ËΩΩËØÑËÆ∫Âå∫ËÑöÊú¨
              await loadGitalk();
            }
          }, {
            root: null, // Áõ∏ÂØπ‰∫éËßÜÂè£
            rootMargin: '20%', // ÊèêÂâç 20% ÁöÑ‰ΩçÁΩÆËß¶Âèë
            threshold: 0.1, // ÂÖÉÁ¥†ÊòæÁ§∫ 10% Âç≥Ëß¶Âèë
          });

          observer.observe(observerTarget);
        }

        // Âä®ÊÄÅÂä†ËΩΩ Gitalk ËÑöÊú¨Âπ∂ÂàùÂßãÂåñËØÑËÆ∫Âå∫
        async function loadGitalk() {
          const container = document.getElementById('gitalk-container');
          if (container) {
            const commentID = container.getAttribute('data-comment-id');
            const lang = container.getAttribute('data-lang');
            const repo = container.getAttribute('data-repo')
            const createIssueManually = container.getAttribute('data-createIssueManually')

            console.log(repo);
            console.log(createIssueManually)

            // Âä®ÊÄÅÂä†ËΩΩ Gitalk ËÑöÊú¨
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
            script.defer = true;
            script.onload = () => {
              const gitalk = new Gitalk({
                clientID: 'fcf61195c7f73253dc8b',
                clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
                repo: repo,
                owner: 'fatbobman',
                admin: ['fatbobman'],
                id: commentID.split('/').pop().substring(0, 49),
                distractionFreeMode: true,
                createIssueManually: createIssueManually,
                language: lang,
              });

              gitalk.render('gitalk-container');
            };
            document.body.appendChild(script);
          }
        }
      });
    </script> <div class="hidden lg:block w-32 xl:w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="toc-content"> <div class="w-full flex justify-end pb-2" id="toc-float-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-toc"></use> </svg> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-close" class="hidden"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-toc-close"></use> </svg>  </div> </div> <div class="text-default text-xxs xl:text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#the-problem" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> The Problem </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#analyzing-view-concepts-in-swiftui" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Analyzing View Concepts in SwiftUI </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#view-types" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> View Types </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#view-declarations" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> View Declarations </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#view-type-instances" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> View Type Instances </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#response-and-re-evaluation-of-view-declaration-values" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Response and Re-evaluation of View Declaration Values </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#swiftuis-response-mechanism" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> SwiftUI&#39;s Response Mechanism </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#conditions-for-re-evaluation-of-view-declaration-values" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> Conditions for Re-evaluation of View Declaration Values </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#ending-recursion-and-the-starting-point-of-updates" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Ending Recursion and the Starting Point of Updates </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#returning-to-our-problem" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Returning to Our Problem </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#what-we-learned" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;‚ñ™&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> What We Learned </a> </div> </li>  </ul> </div> </div> </div> <script type="module" src="/_astro/TOC.astro_astro_type_script_index_0_lang.ARhKvemZ.js"></script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        if ('/en/posts/mastering-data-tracking-and-notifications-in-core-data-and-swiftdata/' !== '#') {
          window.location.href = '/en/posts/mastering-data-tracking-and-notifications-in-core-data-and-swiftdata/';
        }
      } catch (e) {
        console.log('Navigation failed:', e);
      }
    " data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class="cursor-pointer" aria-label="Next post"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-previous"></use> </svg> </button>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Mastering Data Tracking and Notifications in Core Data and SwiftData</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">‚å• + ‚Üê</div> </div> </div> <script>(function(){const url = "/en/posts/mastering-data-tracking-and-notifications-in-core-data-and-swiftdata/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        if ('/en/posts/using-transactions-instead-of-save-in-swiftdata-and-core-data/' !== '#') {
          window.location.href = '/en/posts/using-transactions-instead-of-save-in-swiftdata-and-core-data/';
        }
      } catch (e) {
        console.log('Navigation failed:', e);
      }
    " data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class="cursor-pointer" aria-label="Previous post"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-next"></use> </svg> </button>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Using Transactions Instead of Save in SwiftData and Core Data</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">‚å• + ‚Üí</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/using-transactions-instead-of-save-in-swiftdata-and-core-data/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=Understanding%20SwiftUI's%20View%20Update%20Mechanism%3A%20Starting%20from%20a%20TimelineView%20Update%20Issue&url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Funderstanding-swiftui-view-update-mechanism%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter" data-tooltip-target="tooltip-share-with-twitter" data-tooltip-placement="left"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-twitter"></use> </svg> </a>  </div> <div id="tooltip-share-with-twitter" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-32 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on X</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        window.open('https://bsky.app/intent/compose?text=Understanding%20SwiftUI's%20View%20Update%20Mechanism%3A%20Starting%20from%20a%20TimelineView%20Update%20Issue%0A by %40fatbobman.com %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Funderstanding-swiftui-view-update-mechanism%2F%0A #ios #swift', '_blank');
      } catch (e) {
        console.log('Failed to open BlueSky share');
      }
    " id="sidebar-share-with-bluesky" data-tooltip-target="tooltip-share-with-bluesky" data-tooltip-placement="left" class="cursor-pointer" aria-label="Share on BlueSky"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-bluesky"></use> </svg> </button>  </div> <div id="tooltip-share-with-bluesky" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on BlueSky</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Funderstanding-swiftui-view-update-mechanism%252F" target="_blank" id="sidebar-share-with-facebook" data-tooltip-target="tooltip-share-with-facebook" data-tooltip-placement="left"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-facebook"></use> </svg> </a>  </div> <div id="tooltip-share-with-facebook" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Facebook</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div>  <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Funderstanding-swiftui-view-update-mechanism%2F" target="_blank" id="sidebar-share-with-linkedin" data-tooltip-target="tooltip-share-with-linkedin" data-tooltip-placement="left"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-linkedin"></use> </svg> </a>  </div> <div id="tooltip-share-with-linkedin" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Linkedin</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="#subscript" id="sidebar-share-with-subscribe" data-tooltip-target="tooltip-share-with-email" data-tooltip-placement="left"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-email"></use> </svg> </a>  </div> <div id="tooltip-share-with-email" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Subscribe to Newsletter</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" id="comment-button" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-share-with-comment" data-tooltip-placement="left"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-comment"></use> </svg>  </div> <div id="tooltip-share-with-comment" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share Your Thoughts</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>
  const SCROLL_OFFSET = 80;
  
  document.addEventListener('DOMContentLoaded', function() {
    const commentButton = document.getElementById('comment-button');
    if (commentButton) {
      commentButton.addEventListener('click', function() {
        const gitalkContainer = document.getElementById('gitalk-container');
        if (gitalkContainer) {
          const topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: topPosition, behavior: 'smooth' });
        }
      });
    }
  });
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-back-to-top" data-tooltip-placement="left"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-top"></use> </svg>  </div> <div id="tooltip-back-to-top" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-28 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Back to Top</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.DVW0R156.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block "> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Explore</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Subscribe</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com/welcome" class="hover:text-secondary" target="_blank">Newsletter</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Connect &amp; Support</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/sponsorship/" class="hover:text-secondary" rel="sponsored"> Promote on Blog </a> <a href="/en/about/#contact" class="hover:text-secondary">Contact Me</a> <a href="https://www.buymeacoffee.com/fatbobman" class="hover:text-secondary" target="_blank">Buy Me a Coffee ‚òïÔ∏è</a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs tracking-normal">Copyright ¬©  2025
Fatbobman Digital Limited. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <button type="button" onclick="
        try {
          window.open('https://beian.miit.gov.cn/#/Integrated/index', '_blank');
        } catch (e) {
          console.log('Failed to open ICP link:', e);
        }
      " class="text-xxs hover:underline text-muted tracking-wide" aria-label="ICP Registration Information">
ËæΩICPÂ§á20006550Âè∑-1
</button> </div> </div> </div> </div> </footer> </footer> </div> <section> <div id="weekly-modal" data-subscribeText="Join Now" data-placeholder="Subscribe with your email"> <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"> <!-- Modal content --> <div class="relative bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg shadow-2xl border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button id="popup-modal-close-button" type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4 md:w-[480px] sm:w-80 mx-auto"> <div class="sm:hidden md:block text-base text-center font-bold text-gray-900 dark:text-blue-100 pt-4 pb-2 ">Weekly Swift &amp; SwiftUI Highlights - Every Monday</div> <iframe class="mx-auto sm:w-[320px] md:w-[480px] sm:h-[200px] md:h-[320px] dark:opacity-80 dark:rounded-lg dark:shadow-2xl dark:border-gray-600" src="https://weekly.fatbobman.com/embed" style="border:0px solid #EEE; background:white; width: 100%; max-width: 480px;"></iframe> </div> </div> </div> </div> </section> <script type="module" src="/_astro/WeeklyModalLoader.astro_astro_type_script_index_0_lang.Ce3o6Yt-.js"></script>  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js" async></script> <script>
  // ‰∏∫ÊØè‰∏™ÈúÄË¶ÅÊ∏ÖÈô§ focus Áä∂ÊÄÅÁöÑÊåâÈíÆÈÉΩÊ∑ªÂä†‰∏Ä‰∏™ clear-focus Á±ª, ‰∏ãÈù¢ÁöÑ‰ª£Á†ÅÂ∞ÜÂú®ÁÇπÂáªÂêéËá™Âä®ÁßªÈô§ focus Áä∂ÊÄÅ
  document.addEventListener('DOMContentLoaded', () => {
    // Ëé∑ÂèñÊâÄÊúâÂÖ∑Êúâ 'clear-focus' Á±ªÁöÑÊåâÈíÆ
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };

  if (typeof window !== 'undefined') {
    const videos = Array.from(document.querySelectorAll('video.lazy-video[data-autoplay="lazy"]'));

    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const video = entry.target;

            if (entry.isIntersecting) {
              // ËøõÂÖ•ËßÜÁ™ó -> Â∞ùËØïÊí≠ÊîæÔºàÊµèËßàÂô®‰ºöÊ†πÊçÆÁ≠ñÁï•ÂÜ≥ÂÆöÊòØÂê¶ÂÖÅËÆ∏Ôºâ
              video.play().catch(() => {
                // Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºàÊµèËßàÂô®Á≠ñÁï•ÔºâÂèØËÉΩ‰ºöÂ§±Ë¥•ÔºåÈùôÈªòÂç≥ÂèØ
              });
            } else {
              // Á¶ªÂºÄËßÜÁ™ó -> ÊöÇÂÅúÔºåËäÇÁúÅ CPU & Â∏¶ÂÆΩ
              video.pause();
            }
          });
        },
        {
          threshold: 0.1, // Ëá≥Â∞ëÊúâ 10% Âá∫Áé∞Âú®ËßÜÁ™óÈáåÊó∂Ëß¶Âèë
        }
      );

      videos.forEach((video) => observer.observe(video));

      // Ê∏ÖÁêÜÈÄªËæëÔºöÈ°µÈù¢Âç∏ËΩΩÊó∂ÂèñÊ∂àÊâÄÊúâËßÇÂØü
      window.addEventListener('beforeunload', () => {
        videos.forEach((video) => observer.unobserve(video));
        observer.disconnect();
      });

      // Â§ÑÁêÜ bfcache ÊÉÖÂÜµ
      window.addEventListener('pageshow', (event) => {
        // Â¶ÇÊûúÊòØ‰ªé bfcache ÊÅ¢Â§çÔºåÈáçÊñ∞ÂàùÂßãÂåñ
        if (event.persisted) {
          const newVideos = Array.from(document.querySelectorAll('video.lazy-video[data-autoplay="lazy"]'));
          newVideos.forEach((video) => {
            if (!videos.includes(video)) {
              observer.observe(video);
            }
          });
        }
      });
    } else {
      // ËÄÅÊµèËßàÂô®ÁöÑÈôçÁ∫ßÁ≠ñÁï•Ôºö‰ªÄ‰πàÈÉΩ‰∏çÂÅöÔºåÁî®Êà∑ÊâãÂä®Êí≠Êîæ
    }
  }
</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"ÊêúÁ¥¢",buttonAriaLabel:"ÊêúÁ¥¢"},modal:{searchBox:{resetButtonTitle:"Ê∏ÖÈô§ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó",resetButtonAriaLabel:"Ê∏ÖÈô§ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó",cancelButtonText:"ÂèñÊ∂à",cancelButtonAriaLabel:"ÂèñÊ∂à"},startScreen:{recentSearchesTitle:"ÊúÄËøëÊêúÁ¥¢",noRecentSearchesText:"ÂΩìÂâçÊ≤°ÊúâÊêúÁ¥¢ÂéÜÂè≤ËÆ∞ÂΩï",saveRecentSearchButtonTitle:"‰øùÂ≠òÊú¨Ê¨°ÊêúÁ¥¢",removeRecentSearchButtonTitle:"‰ªéÊêúÁ¥¢ÂéÜÂè≤‰∏≠ÁßªÈô§",favoriteSearchesTitle:"Êî∂ËóèÂ§π",removeFavoriteSearchButtonTitle:"‰ªéÊî∂ËóèÂ§πÁßªÈô§"},errorScreen:{titleText:"Êó†Ê≥ïËé∑ÂèñÁªìÊûú",helpText:"ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•"},footer:{selectText:"ÈÄâÊã©",selectKeyAriaLabel:"ÈÄâÊã©",navigateText:"ÂàáÊç¢",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"ÈÄÄÂá∫",closeKeyAriaLabel:"Escape key",searchByText:"ÂºïÊìéÊîØÊåÅ"},noResultsScreen:{noResultsText:"Êó†Ê≥ïÊâæÂà∞ÂØπÂ∫îÁªìÊûú",suggestedQueryText:"ÂèØ‰ª•Â∞ùËØïÊêúÁ¥¢Â¶Ç‰∏ãÂÜÖÂÆπ",reportMissingResultsText:"Á°ÆËÆ§Êú¨Ê¨°ÊêúÁ¥¢Â∫îËØ•ËøîÂõûÂÜÖÂÆπÔºü",reportMissingResultsLinkText:"ËØ∑ÂëäÁü•Êàë‰ª¨"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <!--Magic Fix Ëß£ÂÜ≥Âú® Safari ‰∏ãÊêúÁ¥¢Ê°ÜÂèñÊ∂àÂêé‰ºöÊªöÂä®Âà∞È°µÈù¢Â∫ïÈÉ®--> <div class="fixed"> <input type="text"> </div> </body></html>
<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.4YWPtmqG.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.W1M1HUWf.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.JZf4E4CU.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.RNVrzb6f.png"><link rel="stylesheet" href="/style/global-new.css"><title>ViewBuilder Research - Mastering Result Builders | Fatbobman&#39;s Blog</title>
<meta name="description" content="Explore Swift result builders: custom containers, modifiers, compatibility, and limitations. Master ViewBuilder for SwiftUI view creation. Includes code examples.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/viewbuilder1/">
<meta property="og:title" content="ViewBuilder Research - Mastering Result Builders | Fatbobman&#39;s Blog">
<meta property="og:description" content="Explore Swift result builders: custom containers, modifiers, compatibility, and limitations. Master ViewBuilder for SwiftUI view creation. Includes code examples.">
<meta property="og:url" content="https://fatbobman.com/en/posts/viewbuilder1/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://fatbobman.com/images/blog-card.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="Fatbobman's Blog"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/viewbuilder1/"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/viewbuilder1/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.KmjrvECc.css" />
<link rel="stylesheet" href="/_astro/about.3p2XOxxi.css" />
<link rel="stylesheet" href="/_astro/_slug_.KE54EPLE.css" />
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style><script type="module" src="/_astro/hoisted.i0Vwr4b0.js"></script></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href="" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="/zh/posts/viewbuilder1/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> </div>  <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <link rel="stylesheet" href="/style/docsearch.css"><div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"></div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Quick Tips </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> About </a> </ul> </nav>  </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/posts/viewbuilder1/" id="language-switcher-for-topic"> #中文版 </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">ViewBuilder Research: Mastering Result Builders</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2022-04-06T00:20:00.000Z">Apr 6, 2022</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 

<p>As a developer heavily reliant on SwiftUI, interacting with views is a routine part of my work. Ever since I was introduced to the declarative programming approach of SwiftUI, I have loved the feeling of writing code in this way. However, the more I worked with it, the more problems I encountered. Initially, I attributed many of these issues to supernatural phenomena, thinking that they were probably due to SwiftUI’s immaturity. But as I continued to learn and explore, I discovered that a considerable portion of these problems were due to my own insufficient understanding, and could be improved or avoided altogether.</p>
<p>In this two-part blog series, I will explore ViewBuilder, the tool for building SwiftUI views. The first part will introduce the implementer of ViewBuilder - result builders; the second part will further explore the secrets of SwiftUI views through the imitation of ViewBuilder.</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="goals-of-this-article">Goals of this article</h2>
<p>After reading both articles, I hope to eliminate or alleviate your confusion about the following questions:</p>
<ul>
<li>How to make custom views and methods support ViewBuilder</li>
<li>Why complex SwiftUI views are prone to freezing or experiencing compile timeouts in Xcode</li>
<li>Why “Extra arguments” error messages appear (only a limited number of views can be placed on the same level)</li>
<li>Why caution should be exercised when using AnyView</li>
<li>How to avoid using AnyView</li>
<li>Why views still contain information about all choice branches regardless of whether they are displayed or not</li>
<li>Why the body of the vast majority of official view types is Never</li>
<li>The difference between ViewModifier and modifier specific to a particular type of view</li>
</ul>
<h2 id="what-are-result-builders">What are Result Builders</h2>
<h3 id="introduction">Introduction</h3>
<p>Result builders allow certain functions to implicitly build result values through a series of components, arranging them according to the developer’s specified construction rules. By applying builder translations to function statements, result builders provide the ability to create new domain-specific languages (DSLs) in Swift (with intentional limitations on these builders to preserve the dynamic semantics of the original code).</p>
<p>Compared to commonly used class-based DSLs implemented using point syntax, DSLs created using result builders are simpler, have less redundancy, and are easier to understand (especially when expressing logic with choices, loops, etc.), for example:</p>
<p>Using point syntax (<a href="https://github.com/JohnSundell/Plot?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Plot</a>):</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">div</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">div</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">forEach</span><span style="color:#F8F8F2">(archiveItems.</span><span style="color:#BD93F9">keys</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">sorted</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">by</span><span style="color:#F8F8F2">: </span><span style="color:#FF79C6">&gt;</span><span style="color:#F8F8F2">)) { absoluteMonth </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">group</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">ul</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#8BE9FD">forEach</span><span style="color:#F8F8F2">(archiveItems[absoluteMonth]) { item </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">                        .</span><span style="color:#8BE9FD">li</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                            .</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                                .</span><span style="color:#8BE9FD">href</span><span style="color:#F8F8F2">(item.path),</span></span>
<span class="line"><span style="color:#F8F8F2">                                .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(item.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                            )</span></span>
<span class="line"><span style="color:#F8F8F2">                        )</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                ),</span></span>
<span class="line"><span style="color:#F8F8F2">                .</span><span style="color:#8BE9FD">if</span><span style="color:#F8F8F2">( show,</span></span>
<span class="line"><span style="color:#F8F8F2">                    .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">),</span></span>
<span class="line"><span style="color:#8BE9FD">                  else</span><span style="color:#F8F8F2">: .</span><span style="color:#BD93F9">text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">wrold</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">                 ),</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    )</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span></code></pre></div>
<p>Builders created using result builders (<a href="https://github.com/BinaryBirds/swift-html?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">swift-html</a>):</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">Div {</span></span>
<span class="line"><span style="color:#F8F8F2">    Div {</span></span>
<span class="line"><span style="color:#FF79C6">        for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#BD93F9">100</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            Ul {</span></span>
<span class="line"><span style="color:#FF79C6">                for</span><span style="color:#F8F8F2"> item </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> archiveItems[i] {</span></span>
<span class="line"><span style="color:#F8F8F2">                    li {</span></span>
<span class="line"><span style="color:#8BE9FD">                        A</span><span style="color:#F8F8F2">(item.title)</span></span>
<span class="line"><span style="color:#F8F8F2">                            .</span><span style="color:#8BE9FD">href</span><span style="color:#F8F8F2">(item.path)</span></span>
<span class="line"><span style="color:#F8F8F2">                    }</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">                Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="history-and-development">History and Development</h3>
<p>Since Swift 5.1, result builders have been hidden within the Swift language with the release of SwiftUI (then named function builder). With the continuous evolution of Swift and SwiftUI, it was eventually officially included in Swift 5.4. Currently, Apple uses this feature heavily in the SwiftUI framework, including not only the most common view builder (ViewBuilder), but also: AccessibilityRotorContentBuilder, CommandsBuilder, LibraryContentBuilder, SceneBuilder, TableColumnBuilder, TableRowBuilder, ToolbarContentBuilder, and WidgetBundleBuilder, among others. Additionally, in the latest Swift proposal, the <a href="https://forums.swift.org/t/pitch-regex-builder-dsl/56007?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Regex builder DSL</a> has also appeared. Other developers have also created many <a href="https://github.com/carson-katri/awesome-result-builders#html?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">third-party libraries</a> using this feature.</p>
<h3 id="basic-usage">Basic Usage</h3>
<h3 id="defining-builder-types">Defining Builder Types</h3>
<p>A result builder type must satisfy two basic requirements.</p>
<ul>
<li>It must be annotated with <code>@resultBuilder</code>, indicating that it is intended to be used as a result builder type and allowing it to be used as a custom attribute.</li>
<li>It must implement at least one type method named <code>buildBlock</code>.</li>
</ul>
<p>For example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> StringBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> parts</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        parts.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2">{</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">⭐️</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> +</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#FF79C6"> +</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">🌈</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">}.</span><span style="color:#8BE9FD">joined</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">separator</span><span style="color:#F8F8F2">: </span><span style="color:#E9F284">&quot;</span><span style="color:#E9F284"> &quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Through the code above, we have created a result builder with the most basic functionality. The usage method is as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@StringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> getStrings</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">喜羊羊</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">美羊羊</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">灰太狼</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// ⭐️喜羊羊🌈 ⭐️美羊羊🌈 ⭐️灰太狼🌈</span></span></code></pre></div>
<h3 id="provide-sufficient-subsets-of-result-building-methods-for-builder-types">Provide sufficient subsets of result building methods for builder types</h3>
<ul>
<li>
<p><code>buildBlock(_ components: Component...) -&gt; Component</code></p>
<p>Used to build the combined result of a statement block. Each result builder must provide at least one concrete implementation.</p>
</li>
<li>
<p><code>buildOptional(_ component: Component?) -&gt; Component</code></p>
<p>Used to handle partial results that may or may not occur in a specific execution. When a result builder provides <code>buildOptional(_:)</code>, the translated function can use <code>if</code> statements without <code>else</code>, and also provides support for <code>if let</code>.</p>
</li>
<li>
<p><code>buildEither(first: Component) -&gt; Component</code> and <code>buildEither(second: Component) -&gt; Component</code></p>
<p>Used to establish partial results under different paths of a selection statement. When a result builder provides implementations of these two methods, the translated function can use <code>if</code> statements with <code>else</code>, as well as <code>switch</code> statements.</p>
</li>
<li>
<p><code>buildArray(_ components: [Component]) -&gt; Component</code></p>
<p>Used to collect partial results from all iterations of a loop. When a result builder provides an implementation of <code>buildArray(_:)</code>, the translated function can use <code>for...in</code> statements.</p>
</li>
<li>
<p><code>buildExpression(_ expression: Expression) -&gt; Component</code></p>
<p>Allows the result builder to distinguish between <code>Expression</code> types and <code>Component</code> types, providing contextual type information for statement expressions.</p>
</li>
<li>
<p><code>buildFinalResult(_ component: Component) -&gt; FinalResult</code></p>
<p>Used to wrap the final result of <code>buildBlock</code> at the outermost level. For example, the result builder can hide some types that it does not want to expose to the outside world (by converting them into types that can be exposed).</p>
</li>
<li>
<p><code>buildLimitedAvailability(_ component: Component) -&gt; Component</code></p>
<p>Used to convert the partial results generated by <code>buildBlock</code> in a limited environment (such as <code>if #available</code>) into results that are suitable for any environment, to improve API compatibility.</p>
</li>
</ul>
<blockquote>
<p>Result builders adopt ad hoc protocols, which means that we can overload the above methods more flexibly. However, in some cases, the translation process of result builders may change their behavior depending on whether the result builder type implements a certain method.</p>
</blockquote>
<p>In the following examples, each of the above methods will be explained in detail. In the following text, “result builder” will be referred to as “builder”.</p>
<h2 id="example-1-attributedstringbuilder">Example 1: AttributedStringBuilder</h2>
<p>In this example, we will create a builder for declaring AttributedString. For friends who are not familiar with AttributedString, you can read my other blog post <a href="/en/posts/attributedstring/" target="_blank">AttributedString: Making Text More Beautiful Than Ever</a>.</p>
<blockquote>
<p>The complete code for Example 1 can be found here (<a href="https://github.com/fatbobman/BlogCodes/tree/main/AttributedStringBuilder/AttributedStringBuilderDemo.playground?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Demo1</a>).</p>
</blockquote>
<p>After this example, we will be able to declare AttributedString in the following way:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">_*Hello*_</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.green)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> case</span><span style="color:#F8F8F2"> .male </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> gender {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C"> Boy!</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C"> Girl!</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.pink)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20220331202541444.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20220331202541444.png" alt="https://cdn.fatbobman.com/image-20220331202541444.png" loading="lazy" decoding="async"/>
                  </picture></p>
<h3 id="creating-builder-types">Creating Builder Types</h3>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> enum</span><span style="color:#8BE9FD;font-style:italic"> AttributedStringBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">    // Corresponding to the case where no component is used in the block</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Corresponding to the case where n components (n is a positive integer) are used in the block</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: AttributedString</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        components.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>First, we create a builder named AttributedStringBuilder and implement two <code>buildBlock</code> methods for it. The builder will automatically select the corresponding method during translation.</p>
<p>Now, any number of components (AttributedString) can be provided for the block, and <code>buildBlock</code> will convert them into the specified result (AttributedString).</p>
<p>When implementing the <code>buildBlock</code> method, the components and the return data type of the block should be defined according to actual requirements, and need not be consistent.</p>
<h3 id="translating-block-with-builder">Translating Block with Builder</h3>
<p>The builder can be called explicitly, for example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span><span style="color:#6272A4"> // Marked explicitly</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#6272A4">// &quot;HelloWorld&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> mySecondText</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {} </span><span style="color:#6272A4">// Empty block will call `buildBlock() -&gt; AttributedString`</span></span>
<span class="line"><span style="color:#6272A4">// &quot;&quot;</span></span>
<span class="line"></span></code></pre></div>
<p>The builder can also be called implicitly:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Marked on the API side</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> generateText</span><span style="color:#F8F8F2">(@AttributedStringBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> content</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#8BE9FD">    Text</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">content</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Implicitly called on the client side</span></span>
<span class="line"><span style="color:#F8F8F2">VStack {</span></span>
<span class="line"><span style="color:#F8F8F2">    generateText {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C"> World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">struct</span><span style="color:#8BE9FD;font-style:italic"> MyTest</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"><span style="color:#6272A4">    // Marked in the constructor</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(@AttributedStringBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> content</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> content</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Implicitly called</span></span>
<span class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> attributedString </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> MyTest {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ABC</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">BBC</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}.content</span></span>
<span class="line"></span></code></pre></div>
<p>Regardless of the method used, if the <code>return</code> keyword is used at the end of the block to return the result, the builder will automatically ignore the translation process. For example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// This statement will be ignored</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#8BE9FD"> AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// Only &quot;World&quot; will be returned</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#6272A4">// &quot;World&quot;</span></span></code></pre></div>
<blockquote>
<p>To use syntax not supported by the builder in the block, developers may try to use return to return a result value. This should be avoided because developers will lose the flexibility of using the builder to translate.</p>
</blockquote>
<p>The following code has completely different states when translated with the builder and when not translated with the builder:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Builder automatically translates and the block only returns the final synthesized result. The code can be executed normally.</span></span>
<span class="line"><span style="color:#FF79C6">@ViewBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> blockTest</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">isEmpty</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello anonymous!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#FF79C6">\\</span><span style="color:#F1FA8C">(name)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// The builder&#39;s translation behavior is ignored due to the `return` keyword. The two branches of the selection statement in the block return two different types, which does not meet the requirement of returning the same type (`some View`). Compilation fails.</span></span>
<span class="line"><span style="color:#FF79C6">@ViewBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> blockTest</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#FF79C6"> some</span><span style="color:#F8F8F2"> View {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">isEmpty</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD"> Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello anonymous!</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#8BE9FD"> Rectangle</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">overlay</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Text</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#FF79C6">\\</span><span style="color:#F1FA8C">(name)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>To perform other tasks without affecting the builder’s translation process, call the code in the block in the following way:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#8BE9FD"> print</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">update</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">) </span><span style="color:#6272A4">// Declaration statements will not affect the builder&#39;s translation.</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="adding-modifiers">Adding modifiers</h3>
<p>Before continuing to improve other methods of the builder, let’s add some ViewModifier-like functionality to AttributedStringBuilder so that we can easily modify the style of the AttributedString similar to SwiftUI. Add the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        then {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#F8F8F2">.foregroundColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.stronglyEmphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .stronglyEmphasized</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.emphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">            } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .emphasized</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> then</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">result)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Since AttributedString is a value type, we need to create a new copy and modify its properties. The usage of modifier is as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Although I have only written a small amount of code, I am beginning to feel the sense of DSL.</p>
<h3 id="simplified-expression">Simplified expression</h3>
<p>Because the block can only receive a specific type of component (AttributedString), the prefix of AttributedString type needs to be added to each line of code, which leads to a large workload and also affects the reading experience. This process can be simplified by using <code>buildExpression</code>.</p>
<p>Add the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(string)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>After adding the above code, we directly replace AttributedString with String, which will be first converted to AttributedString by the builder, and then passed to buildBlock.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>However, now we are facing a new issue - unable to mix String and AttributedString in a block. This is because, if we don’t provide a custom implementation of <code>buildExpression</code>, the builder will infer the type of the component as AttributedString. Once we provide a custom implementation of <code>buildExpression</code>, the builder will no longer use automatic inference. The solution is to also create a <code>buildExpression</code> for AttributedString:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedString</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    attributedString</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Now you can mix and use both in a block.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Another issue is that we cannot directly use the modifiers we created earlier under String because the previous modifiers were specified for AttributedString. The dot syntax can only be used for methods that are specific to String. There are two solutions to this problem: first, extend String to convert it to AttributedString, and second, add a modifier converter to String. For now, we will use the more cumbersome second option:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(color)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Now, we can make declarations quickly and clearly.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>AttributedString provides support for localized strings and some Markdown syntax, but only for AttributedString constructed through the String.LocalizationValue type. You can solve this problem by following these steps:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> localized</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">LocalizationValue</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">self</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Convert the string to an AttributedString constructed using String.LocalizationValue, which can be directly used with modifiers written for AttributedString (you can also use a similar approach for strings to avoid repeating modifiers).</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">~**World**~</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.blue)</span></span>
<span class="line"><span style="color:#6272A4">         //.bold()    Use Markdown syntax to describe bold text. When using Markdown syntax, setting inlinePresentationIntent directly will cause conflicts.</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20220401090042983.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20220401090042983.png" alt="https://cdn.fatbobman.com/image-20220401090042983.png" loading="lazy" decoding="async"/>
                  </picture></p>
<h3 id="logic-of-builder-translation">Logic of Builder Translation</h3>
<p>Understanding how builders are translated will help with future learning.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#8BE9FD">    AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">         .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>When the builder processes the above code, it will be translated into the following code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)  </span><span style="color:#6272A4">// Calls buildExpression for String</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)) </span><span style="color:#6272A4">// Calls buildExpression for AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a,_b) </span><span style="color:#6272A4">// Calls buildBlock with multiple parameters</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>The two blocks of code above are completely equivalent, and Swift automatically handles this process behind the scenes.</p>
<blockquote>
<p>When learning to create builders, it is helpful to add print commands within the builder method’s implementation to better understand the timing of each method call.</p>
</blockquote>
<h3 id="add-support-for-if-statements-without-else">Add support for if statements without else</h3>
<p>When processing if statements with and without else, result builders use completely different internal mechanisms. To support if statements without else, only the following method needs to be implemented:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildOptional</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>When the builder calls this method, it passes different parameters depending on whether the condition is met. If the condition is not met, <code>nil</code> is passed. The usage method is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>After adding the implementation of <code>buildOptional</code>, the builder will also support the <code>if let</code> syntax, for example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> name:</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">?</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fat</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#FF79C6"> \(</span><span style="color:#F1FA8C">name</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>The translation code corresponding to <code>buildOptional</code> is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Logic corresponding to the if statement above</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vCase0: AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">==</span><span style="color:#BD93F9"> true</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a, _b)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Logic corresponding to the if let statement above</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vCase0:AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> name {</span></span>
<span class="line"><span style="color:#F8F8F2">        vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(name)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _b </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a,_b)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>This is why implementing <code>buildOptional</code> is enough to support both <code>if</code> (without <code>else</code>) and <code>if let</code> statements.</p>
<h3 id="adding-support-for-multi-branch-selection">Adding support for multi-branch selection</h3>
<p>For <code>if else</code> and <code>switch</code> syntax, you need to implement two methods: <code>buildEither(first:)</code> and <code>buildEither(second:)</code>:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Called for the branch where the condition is true (left branch)</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">first</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Called for the branch where the condition is false (right branch)</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">second</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>Usage is as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>The corresponding translated code is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerged: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">World</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerged)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>When an <code>else</code> statement is present, the builder will produce a binary tree during translation, with each result assigned to one of its leaves. For the non-<code>else</code> part of a branch in an <code>if else</code>, the builder will still handle it using <code>buildOptional</code>, for example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> show </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9"> true</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">fatbobman</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: Text {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#FF79C6"> if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> &gt;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">        name</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Translated text goes here</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Translated code</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> myFirstText: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerged: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> show {</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">        // First handle the case where else is not present using buildOptional</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> vCase0: AttributedString</span><span style="color:#FF79C6">?</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#F8F8F2"> name.</span><span style="color:#BD93F9">count</span><span style="color:#FF79C6"> &gt;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            vCase0 </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(name)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildOptional</span><span style="color:#F8F8F2">(vCase0)</span></span>
<span class="line"><span style="color:#6272A4">        // Sum up the right branch to vMerged</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerged </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: _a)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerged)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>Support for <code>switch</code> is also done using the same approach. The builder applies the above rules recursively during translation.</p>
<blockquote>
<p>You may wonder why the implementation of buildEither is so simple and has little significance. Many people had this question during the result builders proposal process. In fact, Swift’s design has its quite appropriate application area. In the next article <a href="/en/posts/viewbuilder2/" target="_blank">ViewBuilder Research: Creating a ViewBuilder imitation</a>, we will see how ViewBuilder saves the type information of all branches through buildEither.</p>
</blockquote>
<h3 id="support-forin-loop">Support for…in loop</h3>
<p>The <code>for...in</code> statement collects all the results of the iterations into an array and passes them to <code>buildArray</code>. Providing an implementation for <code>buildArray</code> enables the builder to support loop statements.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// In this example, we simply concatenate all the iteration results to generate an AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildArray</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: [AttributedString]) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    components.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">        result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>Usage:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> test</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#F8F8F2">count {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#FF79C6"> \\</span><span style="color:#F1FA8C">(i) </span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>Translated code:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">func</span><span style="color:#50FA7B"> test</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B;font-style:italic">count</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">Int</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> vArray </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [AttributedString]()</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9"> 0</span><span style="color:#FF79C6">..&lt;</span><span style="color:#F8F8F2">count {</span></span>
<span class="line"><span style="color:#F8F8F2">        vArray.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> \(</span><span style="color:#F1FA8C">i</span><span style="color:#FF79C6">)</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildArray</span><span style="color:#F8F8F2">(vArray)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="improving-version-compatibility">Improving Version Compatibility</h3>
<p>If the implementation of <code>buildLimitedAvailability</code> is provided, the builder provides support for API availability checks (such as <code>if #available(..)</code>). This is common in SwiftUI, for example, where certain Views or modifiers are only supported on newer platforms and we need to provide alternative content for unsupported platforms.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildLimitedAvailability</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">    component</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>This method does not exist independently and is used together with buildOptional or buildEither. When the API availability check meets the conditions, the result builders will call this implementation. In SwiftUI, AnyView is used to erase types for type stability.</p>
<p>Usage:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#6272A4">// Create a method that is not supported on the current platform</span></span>
<span class="line"><span style="color:#FF79C6">@available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">,</span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> futureMethod</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#8BE9FD"> #available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello macOS 13</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">futureMethod</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hi Monterey</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre></div>
<p>The corresponding translation logic is:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> vMerge: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#8BE9FD"> #available</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">macOS</span><span style="color:#BD93F9"> 13.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">iOS</span><span style="color:#BD93F9"> 16.0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _temp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">buildLimitedAvailability</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F8F8F2">                AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello macOS 13</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">).</span><span style="color:#8BE9FD">futureMethod</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">            )</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerge </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">first</span><span style="color:#F8F8F2">: _temp)</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> _temp </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hi Monterey</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">        vMerge </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">second</span><span style="color:#F8F8F2">: _temp)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(vMerge)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<h3 id="wrapping-up-the-result">Wrapping up the Result</h3>
<p>If we provide an implementation of <code>buildFinalResult</code>, the builder will use it to transform the result again at the end of the translation process, and the final result will be the return value of <code>buildFinalResult</code>.</p>
<p>In most cases, we don’t need to implement <code>buildFinalResult</code>, and the builder will use the return value of <code>buildBlock</code> as the final result.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildFinalResult</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> Text {</span></span>
<span class="line"><span style="color:#8BE9FD">    Text</span><span style="color:#F8F8F2">(component)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>For demonstration purposes, in this example we will convert AttributedString to Text using the <code>buildFinalResult</code> method. Usage:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedStringBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {  </span><span style="color:#6272A4">// The final result type has been translated to Text</span></span>
<span class="line"><span style="color:#E9F284">    &quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> text: Text {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _a </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Hello world</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> _blockResult </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildBlock</span><span style="color:#F8F8F2">(_a)</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> AttributedStringBuilder.</span><span style="color:#8BE9FD">buildFinalResult</span><span style="color:#F8F8F2">(_blockResult)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>So far, we have achieved the goal set at the beginning of this section. However, the current implementation still cannot provide us with the possibility of creating various containers, such as SwiftUI, which will be solved in Example 2.</p>
<h2 id="example-2-attributedtextbuilder">Example 2: AttributedTextBuilder</h2>
<blockquote>
<p>The complete code for Example 2 can be obtained here (<a href="https://github.com/fatbobman/BlogCodes/tree/main/AttributedStringBuilder/AttributedStringBuilderDemo.playground?&#38;utm_source=Fatbobman%20Blog&#38;utm_medium=web&#38;utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Demo2</a>).</p>
</blockquote>
<h3 id="insufficiencies-of-version-1">Insufficiencies of Version 1</h3>
<ul>
<li>Can only add modifiers to components (AttributedString, String) one by one, cannot be configured uniformly</li>
<li>Cannot be dynamically laid out, <code>buildBlock</code> connects all content together, and line breaks can only be achieved by adding <code>\\n</code> separately</li>
</ul>
<h3 id="using-protocols-instead-of-types">Using Protocols Instead of Types</h3>
<p>The main reason for the above problems is that the component in the <code>buildBlock</code> above is a specific AttributedString type, which limits our ability to create containers (other components). To solve the above shortcomings, we can refer to the solution of SwiftUI View, use protocols instead of specific types, and make AttributedString also conform to the protocol.</p>
<p>First, we will create a new protocol - AttributedText:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> protocol</span><span style="color:#8BE9FD;font-style:italic"> AttributedText</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    var</span><span style="color:#F8F8F2"> content: AttributedString { </span><span style="color:#FF79C6">get</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#FF79C6">    init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Make AttributedString compliant with the protocol:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#FF79C6"> =</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Creating a new builder - AttributedTextBuilder, the biggest change is to change the type of all components to AttributedText.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@resultBuilder</span></span>
<span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> enum</span><span style="color:#8BE9FD;font-style:italic"> AttributedTextBuilder</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildBlock</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: AttributedText</span><span style="color:#FF79C6">...</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> components.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">.content }.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedString</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        attributedString.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildExpression</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> string</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#8BE9FD">        AttributedString</span><span style="color:#F8F8F2">(string)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildOptional</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">??</span><span style="color:#F8F8F2"> .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">first</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildEither</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">second</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        component.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildArray</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> components</span><span style="color:#F8F8F2">: [AttributedText]) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> components.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> { </span><span style="color:#BD93F9;font-style:italic">$0</span><span style="color:#F8F8F2">.content }.</span><span style="color:#8BE9FD">reduce</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">into</span><span style="color:#F8F8F2">: </span><span style="color:#8BE9FD">AttributedString</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)) { result, next </span><span style="color:#FF79C6">in</span></span>
<span class="line"><span style="color:#F8F8F2">            result.</span><span style="color:#8BE9FD">append</span><span style="color:#F8F8F2">(next)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result.content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> static</span><span style="color:#FF79C6"> func</span><span style="color:#50FA7B"> buildLimitedAvailability</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> component</span><span style="color:#F8F8F2">: AttributedText) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#FF79C6">init</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>Creating a modifier for AttributedText:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedText</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> transform</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#F8F8F2"> AttributedString) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> attributedString </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span><span style="color:#F8F8F2">.content</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">attributedString)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">(attributedString)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(color)</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">        transform {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">            $0</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>With this, we now have the ability to create custom view controls similar to those in SwiftUI.</p>
<h3 id="creating-a-container">Creating a Container</h3>
<p>A Container is similar to a Group in SwiftUI, it does not change the layout and makes it easy to apply modifiers uniformly to the elements inside the Container.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Container</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#F8F8F2">        content </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(@AttributedTextBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedText</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> attributedText</span><span style="color:#F8F8F2">().content</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>As the Container also conforms to the AttributedText protocol, it will be treated as a component and can have modifiers applied to it. To use:</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">@AttributedTextBuilder</span></span>
<span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> attributedText: AttributedText {</span></span>
<span class="line"><span style="color:#F8F8F2">    Container {</span></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">Hello </span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.red)</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">bold</span><span style="color:#F8F8F2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E9F284">        &quot;</span><span style="color:#F1FA8C">~World~</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">            .</span><span style="color:#8BE9FD">localized</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#BD93F9">color</span><span style="color:#F8F8F2">(.green)</span></span>
<span class="line"><span style="color:#F8F8F2">    .</span><span style="color:#8BE9FD">italic</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>When you execute the code above at this point, you will find that the previously red “Hello” has also turned green, which is not what we expected. In SwiftUI, the inner settings take precedence over the outer settings. To solve this problem, we need to make some modifications to the modifier of AttributedString.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> extension</span><span style="color:#8BE9FD;font-style:italic"> AttributedString</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> color</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> color</span><span style="color:#F8F8F2">: Color) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">        container.foregroundColor </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> color</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container, </span><span style="color:#8BE9FD">mergePolicy</span><span style="color:#F8F8F2">: .keepCurrent)</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> bold</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> run.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                    var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.stronglyEmphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                    container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">                } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                    $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .stronglyEmphasized</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> italic</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedString {</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> then {</span></span>
<span class="line"><span style="color:#FF79C6">            for</span><span style="color:#F8F8F2"> run </span><span style="color:#FF79C6">in</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">.runs {</span></span>
<span class="line"><span style="color:#FF79C6">                if</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> run.inlinePresentationIntent {</span></span>
<span class="line"><span style="color:#FF79C6">                    var</span><span style="color:#F8F8F2"> container </span><span style="color:#FF79C6">=</span><span style="color:#8BE9FD"> AttributeContainer</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#F8F8F2">                    inlinePresentationIntent.</span><span style="color:#8BE9FD">insert</span><span style="color:#F8F8F2">(.emphasized)</span></span>
<span class="line"><span style="color:#F8F8F2">                    container.inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> inlinePresentationIntent</span></span>
<span class="line"><span style="color:#FF79C6">                    let</span><span style="color:#BD93F9"> _</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9;font-style:italic"> $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].</span><span style="color:#8BE9FD">mergeAttributes</span><span style="color:#F8F8F2">(container)</span></span>
<span class="line"><span style="color:#F8F8F2">                } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">                    $0</span><span style="color:#F8F8F2">[run.</span><span style="color:#BD93F9">range</span><span style="color:#F8F8F2">].inlinePresentationIntent </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> .emphasized</span></span>
<span class="line"><span style="color:#F8F8F2">                }</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    func</span><span style="color:#50FA7B"> then</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> perform</span><span style="color:#F8F8F2">: (</span><span style="color:#FF79C6">inout</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#8BE9FD;font-style:italic"> Void</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#BD93F9;font-style:italic"> Self</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> result </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9;font-style:italic"> self</span></span>
<span class="line"><span style="color:#8BE9FD">        perform</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">result)</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> result</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>By traversing the run views of AttributedString, we have implemented the rule that inner attribute settings take precedence over outer attribute settings.</p>
<h3 id="creating-paragraph">Creating Paragraph</h3>
<p>A Paragraph creates line breaks at the beginning and end of its content.</p>
<div>
        <div class="flex justify-between items-center h-8 font-medium bg-[#96744d] dark:bg-[#002565] text-gray-200 text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-white sm:hover:font-bold">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            Copy code
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> struct</span><span style="color:#8BE9FD;font-style:italic"> Paragraph</span><span style="color:#F8F8F2">: AttributedText {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> var</span><span style="color:#F8F8F2"> content: AttributedString</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributed</span><span style="color:#F8F8F2">: AttributedString) {</span></span>
<span class="line"><span style="color:#F8F8F2">        content </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> attributed</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> init</span><span style="color:#F8F8F2">(@AttributedTextBuilder </span><span style="color:#50FA7B">_</span><span style="color:#FFB86C;font-style:italic"> attributedText</span><span style="color:#F8F8F2">: () </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> AttributedText) {</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic">        self</span><span style="color:#F8F8F2">.content </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">&quot;</span><span style="color:#FF79C6"> +</span><span style="color:#8BE9FD"> attributedText</span><span style="color:#F8F8F2">().content </span><span style="color:#FF79C6">+</span><span style="color:#E9F284"> &quot;</span><span style="color:#FF79C6">\n</span><span style="color:#E9F284">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre></div>
<p>By treating protocols as components, more possibilities are provided for builders.</p>
<h2 id="improvements-and-shortcomings-of-result-builders">Improvements and shortcomings of result builders</h2>
<h3 id="completed-improvements">Completed Improvements</h3>
<p>Starting from Swift 5.1, result builders have undergone several versions of improvements, adding some features and also solving some performance issues:</p>
<ul>
<li>Added <code>buildOptional</code> and removed <code>buildIf</code>, retaining support for <code>if</code> (excluding <code>else</code>) while adding support for <code>if let</code></li>
<li>Starting from SwiftUI 2.0, the <code>switch</code> keyword is now supported</li>
<li>Modified the syntax translation mechanism for <code>buildBlock</code> in Swift 5.1, prohibiting backward propagation of parameter types. This was the primary reason why early SwiftUI view code often resulted in compilation errors such as “expression too complex to be solved in a reasonable time”.</li>
</ul>
<h3 id="current-limitations">Current Limitations</h3>
<ul>
<li>
<p>Lack of partial selection and control capabilities, such as: guard, break, continue.</p>
</li>
<li>
<p>Lack of the ability to limit naming within the builder context.</p>
<p>For DSL, it is common to introduce shorthand words. Currently, when creating a component for the builder, only new data types (such as Container, Paragraph) or global functions can be used. It is hoped that in the future, these names can be limited only within the context and not introduced into the global scope.</p>
</li>
</ul>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="follow-up">Follow-up</h2>
<p>The basic functionality of Result Builders is very simple. In the previous section, we only had a few lines of code related to builder methods. However, creating a useful and easy-to-use DSL requires a huge amount of work, and developers should weigh the pros and cons of using Result Builders based on their actual needs.</p>
<p>In the next section, we will try to replicate a builder that is consistent with the basic form of ViewBuilder, and we believe that the replication process can give you a deeper understanding of ViewBuilder and SwiftUI views.</p> </div> </article> <script src="/js/modalsubscribecontroller.js" defer></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Main modal --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"> <div id="default-modal" tabindex="-1" aria-hidden="true" class="hidden w-full h-full justify-center items-center"> <div class="relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">Every Monday, sharing handpicked Swift and SwiftUI development highlights with you.</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">Continue Reading</button> </div> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2022-04-06T00:20:00.000Z",
  "datePublished": "2022-04-06T00:20:00.000Z",
  "description": "Explore Swift result builders: custom containers, modifiers, compatibility, and limitations. Master ViewBuilder for SwiftUI view creation. Includes code examples.",
  "headline": "ViewBuilder Research: Mastering Result Builders",
  "image": {
    "@type": "ImageObject"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/viewbuilder1/"
  },
  "url": "https://fatbobman.com/en/posts/viewbuilder1/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">Get weekly handpicked updates on Swift and SwiftUI!</div> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-medium">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0">  <button type="button" class="bg-[#3270e1] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700  me-2 mb-2" onclick="window.open('https://www.paypal.com/paypalme/fatbobman')"> <!-- <svg class="w-4 h-4 me-2 -ms-1" width="337" height="63">
    <use href="/images/paypal.svg#main"></use>
  </svg> --> <img src="/images/paypal.svg" alt="" width="24" height="24" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-medium hover:text-yellow-100">Donate via Paypal</span> </button> </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/en";

  const adCacheKey = 'dynamicAdCache';

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script>  <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">Related Posts</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">Related Posts</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/weekly/issue-063" id="relatedPosts-Weekly #63 - Breakthroughs in Xenotransplantation of Kidneys"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #63 - Breakthroughs in Xenotransplantation of Kidneys</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/viewbuilder2/" id="relatedPosts-ViewBuilder Research: Creating a ViewBuilder Imitation"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">ViewBuilder Research: Creating a ViewBuilder Imitation</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/attributedstring/" id="relatedPosts-AttributedString: Making Text More Beautiful Than Ever"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">AttributedString: Making Text More Beautiful Than Ever</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/avoid_repeated_calculations_of_swiftui_views/" id="relatedPosts-How to Avoid Repeating SwiftUI View Updates"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">How to Avoid Repeating SwiftUI View Updates</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/async-await-store/" id="relatedPosts-Rebuilding SwiftUI's Redux-like State Container with Async-Await"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Rebuilding SwiftUI&#39;s Redux-like State Container with Async-Await</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="ViewBuilder 研究（上）—— 掌握 Result builders" data-lang="en"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script></div><script>
  document.addEventListener('DOMContentLoaded', async function () {
    console.log('fetching comment is enable');
    const response = await fetch('https://fatbobman.com/status/comment');
    const data = await response.text();
    console.log(data);
    if (data === '1') {
      var container = document.getElementById('gitalk-container');
      if (container) {
        var commentID = container.getAttribute('data-comment-id');
        var lang = container.getAttribute('data-lang');

        var gitalk = new Gitalk({
          clientID: 'fcf61195c7f73253dc8b',
          clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
          repo: 'blogComments',
          owner: 'fatbobman',
          admin: ['fatbobman'],
          id: commentID.split('/').pop().substring(0, 49),
          distractionFreeMode: true,
          createIssueManually: true,
          language: lang,
        });

        gitalk.render('gitalk-container');
      }
    }
  });
</script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-start pb-2" id="toc-button"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#goals-of-this-article" class=""> Goals of this article </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#what-are-result-builders" class=""> What are Result Builders </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#introduction" class=""> Introduction </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#history-and-development" class=""> History and Development </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#basic-usage" class=""> Basic Usage </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#defining-builder-types" class=""> Defining Builder Types </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#provide-sufficient-subsets-of-result-building-methods-for-builder-types" class=""> Provide sufficient subsets of result building methods for builder types </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#example-1-attributedstringbuilder" class=""> Example 1: AttributedStringBuilder </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#creating-builder-types" class=""> Creating Builder Types </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#translating-block-with-builder" class=""> Translating Block with Builder </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#adding-modifiers" class=""> Adding modifiers </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#simplified-expression" class=""> Simplified expression </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#logic-of-builder-translation" class=""> Logic of Builder Translation </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#add-support-for-if-statements-without-else" class=""> Add support for if statements without else </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#adding-support-for-multi-branch-selection" class=""> Adding support for multi-branch selection </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#support-for…in-loop" class=""> Support for…in loop </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#improving-version-compatibility" class=""> Improving Version Compatibility </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#wrapping-up-the-result" class=""> Wrapping up the Result </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#example-2-attributedtextbuilder" class=""> Example 2: AttributedTextBuilder </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#insufficiencies-of-version-1" class=""> Insufficiencies of Version 1 </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#using-protocols-instead-of-types" class=""> Using Protocols Instead of Types </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#creating-a-container" class=""> Creating a Container </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#creating-paragraph" class=""> Creating Paragraph </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#improvements-and-shortcomings-of-result-builders" class=""> Improvements and shortcomings of result builders </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#completed-improvements" class=""> Completed Improvements </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#current-limitations" class=""> Current Limitations </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#follow-up" class=""> Follow-up </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="flex flex-col space-y-4 text-muted items-center justify-center"> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/en/posts/swiftuioverlaycontainer2/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <!-- <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M9.586 4l-6.586 6.586a2 2 0 0 0 0 2.828l6.586 6.586a2 2 0 0 0 2.18 .434l.145 -.068a2 2 0 0 0 1.089 -1.78v-2.586h7a2 2 0 0 0 2 -2v-4l-.005 -.15a2 2 0 0 0 -1.995 -1.85l-7 -.001v-2.585a2 2 0 0 0 -3.414 -1.414z"
        stroke-width="0"
        fill="currentColor"
      ></path> --> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>SwiftUI Overlay Container 2: Customizable, Efficient, and Convenient View Manager</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/swiftuioverlaycontainer2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="/en/posts/viewbuilder2/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90">  <div>ViewBuilder Research: Creating a ViewBuilder Imitation</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div>  <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/viewbuilder2/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=ViewBuilder%20Research%3A%20Mastering%20Result%20Builders&#38;url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fviewbuilder1%2F&#38;hashtags=ios%2Cswiftlang&#38;via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=ViewBuilder%20Research%3A%20Mastering%20Result%20Builders%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fviewbuilder1%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" class="text-default hover:text-secondary" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.7" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Fviewbuilder1%252F" target="_blank" id="sidebar-share-with-facebook"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div> <div class="hidden opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fviewbuilder1%2F&#38;title=ViewBuilder%20Research%3A%20Mastering%20Result%20Builders%0A%20%23ios%20%23swift%0A%20by%20%40fatbobman%0A" target="_blank" id="sidebar-share-with-weibo"> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path
        d="M457.3 543c-68.1-17.7-145 16.2-174.6 76.2-30.1 61.2-1 129.1 67.8 151.3 71.2 23 155.2-12.2 184.4-78.3 28.7-64.6-7.2-131-77.6-149.2z m-52 156.2c-13.8 22.1-43.5 31.7-65.8 21.6-22-10-28.5-35.7-14.6-57.2 13.7-21.4 42.3-31 64.4-21.7 22.4 9.5 29.6 35 16 57.3z m45.5-58.5c-5 8.6-16.1 12.7-24.7 9.1-8.5-3.5-11.2-13.1-6.4-21.5 5-8.4 15.6-12.4 24.1-9.1 8.7 3.2 11.8 12.9 7 21.5zM785.3 443.5c15 4.8 31-3.4 35.9-18.3 11.8-36.6 4.4-78.4-23.2-109-27.6-30.6-68.4-42.3-106-34.3-15.4 3.3-25.2 18.4-21.9 33.8 3.3 15.3 18.4 25.2 33.8 21.8 18.4-3.9 38.3 1.8 51.9 16.7 13.5 15 17.2 35.4 11.3 53.3-4.9 15.1 3.2 31.1 18.2 36z"
      ></path><path
        d="M885.1 237.5c-56.7-62.9-140.4-86.9-217.7-70.5-17.9 3.8-29.3 21.4-25.4 39.3 3.8 17.9 21.4 29.3 39.3 25.5 55-11.7 114.4 5.4 154.8 50.1 40.3 44.7 51.2 105.7 34 159.1-5.6 17.4 3.9 36 21.3 41.7 17.4 5.6 36-3.9 41.6-21.2v-0.1c24.1-75.4 8.9-161.1-47.9-223.9zM729 499c-12.2-3.6-20.5-6.1-14.1-22.1 13.8-34.7 15.2-64.7 0.3-86-28-40.1-104.8-37.9-192.8-1.1 0 0-27.6 12.1-20.6-9.8 13.5-43.5 11.5-79.9-9.6-101-47.7-47.8-174.6 1.8-283.5 110.6C127.3 471.1 80 557.5 80 632.2 80 775.1 263.2 862 442.5 862c235 0 391.3-136.5 391.3-245 0-65.5-55.2-102.6-104.8-118zM443 810.8c-143 14.1-266.5-50.5-275.8-144.5-9.3-93.9 99.2-181.5 242.2-195.6 143-14.2 266.5 50.5 275.8 144.4C694.4 709 586 796.6 443 810.8z"
      ></path> --> <use href="/images/iconCollection.svg#icon-weibo"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fviewbuilder1%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <a href="mailto:?subject=Article%3A%E3%80%90ViewBuilder%20Research%3A%20Mastering%20Result%20Builders%E3%80%91&#38;body=Here's%20an%20article%20you%20may%20find%20interesting%3A%0A%0AViewBuilder%20Research%3A%20Mastering%20Result%20Builders%0A%0ALink%3A%20https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fviewbuilder1%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="4" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class=" opacity-50 hover:opacity-100 text-heading hover:text-secondary" style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div>  </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Website</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">Health Notes</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Follow</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">Newsletter</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a>  <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Info</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/about/" class="hover:text-secondary">About</a> <a href="/en/sponsorship/" class="hover:text-secondary"> Sponsor </a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright ©  2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js" defer></script> <script>(function(){const currentLang = "en";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script src="/js/runsearch.js"></script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
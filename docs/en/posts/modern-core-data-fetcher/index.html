<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>SwiftUI and Core Data - Data Fetching</title>
<meta name="description" content="Learn how to efficiently fetch Core Data in SwiftUI with a custom FetchRequest using mock data for testing and previewing. Enhance your data handling strategies now!">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/modern-core-data-fetcher/">
<meta property="og:title" content="SwiftUI and Core Data - Data Fetching">
<meta property="og:description" content="Learn how to efficiently fetch Core Data in SwiftUI with a custom FetchRequest using mock data for testing and previewing. Enhance your data handling strategies now!">
<meta property="og:url" content="https://fatbobman.com/en/posts/modern-core-data-fetcher/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://fatbobman.com/images/blog-card.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/modern-core-data-fetcher/">
<link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/modern-core-data-fetcher/"><script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.async = true; // Add async attribute
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> <!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@id": "#author"
  },
  "dateModified": "2022-12-06T00:20:00.000Z",
  "datePublished": "2022-12-06T00:20:00.000Z",
  "description": "Learn how to efficiently fetch Core Data in SwiftUI with a custom FetchRequest using mock data for testing and previewing. Enhance your data handling strategies now!",
  "headline": "SwiftUI and Core Data - Data Fetching",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/modern-core-data-fetcher/"
  },
  "url": "https://fatbobman.com/en/posts/modern-core-data-fetcher/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  },
  "articleSection": [
    "Core Data",
    "SwiftUI"
  ],
  "inLanguage": "en"
}</script><script type='application/ld+json'>{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "东坡肘子(徐杨)",
  "alternateName": "Fatbobman(Xu Yang)",
  "jobTitle": [
    {
      "@value": "苹果生态开发者",
      "inLanguage": "zh-Hans"
    },
    {
      "@value": "Apple Developer",
      "inLanguage": "en"
    }
  ],
  "description": [
    {
      "@value": "苹果生态开发者，专注 Swift 和 SwiftUI 开发。肘子的 Swift 记事本作者。",
      "inLanguage": "zh-Hans"
    },
    {
      "@value": "Apple Developer, focus on Swift and SwiftUI development. Author of Fatbobman's Blog.",
      "inLanguage": "en"
    }
  ],
  "url": "https://fatbobman.com",
  "image": {
    "@type": "ImageObject",
    "url": "https://cdn.fatbobman.com/FatWithBoys.png"
  },
  "sameAs": [
    "https://github.com/fatbobman",
    "https://x.com/fatbobman",
    "https://www.linkedin.com/in/fatbobman/",
    "https://bsky.app/profile/fatbobman.com",
    "https://mastodon.social/@fatbobman",
    "https://web.okjike.com/u/e32947ef-7751-4363-9456-b340eef2efd3",
    "https://fatbobman.com/zh/about/",
    "https://fatbobman.com/en/about/"
  ],
  "worksFor": {
    "@type": "Organization",
    "name": [
      {
        "@value": "肘子的 Swift 笔记",
        "inLanguage": "zh-Hans"
      },
      {
        "@value": "Fatbobman's Blog",
        "inLanguage": "en"
      }
    ],
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  },
  "@id": "#author"
}</script><link rel="stylesheet" href="/_astro/about.DBYriKQ-.css">
<link rel="stylesheet" href="/_astro/_slug_.BRLGXoDU.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-6 sm:pt-6 font-black w-[240px] sm:w-[300px] pb-2 sm:pb-0"> <svg fill="currentColor" class="text-heading" width="500"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <button type="button" onclick="
            try {
                if ('#' !== '#') {
                    window.location.href = '#';
                }
            } catch (e) {
                console.log('Navigation failed:', e);
            }
        " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-aifadian"></use> </svg> </div> </button> </li><li> <button type="button" onclick="
              try {
                  if ('/zh/posts/modern-core-data-fetcher/' !== '#') {
                      window.location.href = '/zh/posts/modern-core-data-fetcher/';
                  }
              } catch (e) {
                  console.log('Navigation failed:', e);
              }
          " class="w-full text-left px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-aifadian"></use> </svg> </div> </button> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> <script type="module">function a(){const t=localStorage.getItem("lang"),e=document.getElementById("EN-check"),n=document.getElementById("ZH-check");e!==null&&n!==null&&(t==="en"?(e.classList.remove("hidden"),n.classList.add("hidden")):t==="zh"&&(n.classList.remove("hidden"),e.classList.add("hidden")))}document.addEventListener("DOMContentLoaded",()=>{a()});const l=document.getElementById("set-default-lang");l?.addEventListener("click",()=>{const t=document.getElementById("lang-data");if(t!=null){const e=t.dataset.lang;e!=null&&(localStorage.setItem("lang",e),a())}});</script> </div> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_system"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-computer"></use> </svg> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_dark"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-moon"></use> </svg> <svg viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_light"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-sun"></use> </svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center" id="theme_button_light"> <svg class="w-5 h-5" viewBox="0 0 1024 1024" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-sun"></use> </svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center " id="theme_button_dark"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-moon"></use> </svg> <span class="ml-2">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white text-default"> <button class="flex px-4 py-2 text-sm align-text-center " id="theme_button_system"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-computer"></use> </svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  // 获取按钮
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');
  // 获取图标
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else if (theme === 'light') {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.remove('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  resetTheme();

  // 监听暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    resetTheme();
  });

  // 保证其他的页面也能够监听到 localStorage 的变化
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      resetTheme();
    }
  });


  // Listen for clicks on the button themeToggleDarkIcon
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleLightIcon
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleSystemIcon
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
  });
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent " aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Tips </a><a href="/en/sponsorship/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> Sponsorship </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent "> About </a> </ul> </nav> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header>  <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10 " style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-normal" href="/en/tags/Core-Data/">
#Core Data </a><a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-normal" href="/en/tags/SwiftUI/">
#SwiftUI </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary tracking-wide" href="/zh/posts/modern-core-data-fetcher/" id="language-switcher-for-topic"> #中文版 </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading ">SwiftUI and Core Data: Data Fetching</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2022-12-06T00:20:00.000Z">Dec 6, 2022</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full "> <div> 

<p>In this article, we will explore ways to fetch Core Data data in bulk within SwiftUI views, and attempt to create a FetchRequest that can use mock data. As this article will involve many techniques and methods introduced in <a href="/en/posts/modern-core-data-data-definition/" target="_blank">previous articles</a>, it is best to read them together.</p>
<h2 id="creating-a-fetchrequest-that-can-use-mock-data">Creating a FetchRequest that can use Mock data</h2>
<h3 id="is-fetchrequest-breaking-the-unidirectional-data-flow">Is FetchRequest breaking the unidirectional data flow?</h3>
<p>For every developer who uses Core Data in SwiftUI, @FetchRequest is an unavoidable topic. FetchRequest greatly simplifies the difficulty of getting Core Data data in the view. With @ObservedObject (the managed object conforms to the ObservableObject protocol), developers can implement real-time response to data changes in the view with just a few lines of code.</p>
<p>However, for developers who adopt the unidirectional data flow approach, @FetchRequest is like the Sword of Damocles hanging over their heads, always worrying them. Class Redux framework usually recommends that developers compose the entire app’s state into a single structural instance (State, conforming to Equatable protocol), and the view responds to changes in the state by observing them (some frameworks support slice-like observation to improve performance). However, @FetchRequest splits a large part of the state composition in the app into multiple views from the independent structural instance. In recent years, many developers have tried to find replacement solutions that are more in line with the spirit of Redux, but the effects are not well understood.</p>
<p>I have also made many attempts, but ultimately found that FetchRequest still seems to be the best solution in current SwiftUI. Let me briefly introduce my exploration process (using TCA framework as an example):</p>
<ul>
<li>Get and manage value data in Reducer</li>
</ul>
<p>In the task (or onAppear) function, start a long-term Effect by sending an Action to create an NSFetchedResultsController to fetch the data set with a specified predicate from Core Data. In the NSFetchedResultsControllerDelegate implementation, convert the managed objects to the corresponding value types and pass them to the Reducer.</p>
<p>Use the IdentifiedArray type in State to store the data set for splitting the Reducer with .forEach.</p>
<p>The above approach is indeed a way that fully conforms to the spirit of Redux, but as we give up the lazy-loading feature of Core Data when converting managed objects to value types, it will lead to serious performance and memory usage issues once the data volume is large. Therefore, it is only suitable for scenarios where the data set is small.</p>
<ul>
<li>Getting and managing AnyConvertibleValueObservableObject in Reducer</li>
</ul>
<p>Similar to the above method, but omitting the process of converting to value types, wrapping the managed object as AnyConvertibleValueObservableObject, and directly saving the reference type in State. However, considering that TCA will move Reducer out of the main thread later, from a thread-safe perspective, this plan was eventually abandoned.</p>
<blockquote>
<p>Since we ultimately need to use AnyConvertibleValueObservableObject (managed objects) in the view, the data acquisition process must be performed in the context of the main thread (the context of data binding is ViewContext). Once Reducer is moved out of the main thread, it means that AnyConvertibleValueObservableObject will be saved in a non-threaded State instance. Although in practice, holding a managed object in a thread other than the one that created the managed object will not cause a crash as long as the non-thread-safe properties of the managed object are not accessed, out of caution, I finally gave up this approach.</p>
</blockquote>
<ul>
<li>Get and manage WrappedID in Reducer</li>
</ul>
<p>Similar to the method above, only save the thread-safe WrappedID (the wrapped NSManagedObjectID) in the State. In the view, use WrappedID to obtain the corresponding AnyConvertibleValueObservableObject or value type. Although it may increase the code in the view, this method is almost perfect from both the data flow processing and thread-safe perspectives.</p>
<p>However, the reason I gave up on all of the above attempts in the end was due to performance issues.</p>
<ul>
<li>Any changes to Core Data will result in a change in the app’s single State. Although TCA has splitting mechanisms, as the complexity and amount of data in the application increases, the performance issues caused by comparing State will become more serious.</li>
<li>The operation of creating NSFetchedResultsController and obtaining the initial batch of data is initiated from onAppear. Due to TCA’s Action handling mechanism, there is a perceivable delay in the initial display of data (far less effective than obtaining data through FetchRequest in the view).</li>
<li>Due to TCA’s Reducer being unable to automatically bind with the view’s lifecycle, the perceivable delay mentioned above will occur every time onAppear is triggered.</li>
</ul>
<p>Finally, I decided to let go of my worries and still use the @FetchRequest-like approach to retrieve data in the view. By creating a new FetchRequest that can use mock data, I achieved the goal of being testable, previewable, and modular as mentioned in the article “<a href="/en/posts/modern-core-data-problem/" target="_blank">SwiftUI and Core Data: The Challenges</a>”.</p>
<h3 id="nsfetchedresultscontroller">NSFetchedResultsController</h3>
<p>NSFetchedResultsController retrieves a specific data set from Core Data through NSFetchRequest and sends the data set to instances that conform to the NSFetchedResultsControllerDelegate protocol to implement methods for displaying data on the screen.</p>
<p>Simply put, NSFetchedResultsController automatically updates the data set in memory in response to NSManagedObjectContextObjectsDidChange and NSManagedObjectContextDidMergeChangesObjectIDs notifications after the initial data set is obtained (performFetch) based on notification content (insert, delete, update, etc.). To improve the efficiency of UITableView (UICollectionView) updates, NSFetchedResultsController decomposes changes in data into specific actions (NSFetchRequestResultType) to allow developers to quickly adjust the display content of UITableView (without refreshing all data).</p>
<p>Unfortunately, the optimizations based on NSFetchRequestResultType prepared by NSFetchedResultsController for UITableView do not work in SwiftUI. In SwiftUI, ForEach automatically handles view additions, deletions, and other operations based on data identifiers (Identifier). Therefore, when using NSFetchedResultsController in SwiftUI, only the <code>controllerDidChangeContent(_ controller:)</code> method in the NSFetchedResultsControllerDelegate needs to be implemented.</p>
<h3 id="custom-types-that-conform-to-dynamicproperty-protocol">Custom Types that Conform to DynamicProperty Protocol</h3>
<p>In SwiftUI, common types that can serve as a source of truth conform to the DynamicProperty protocol. The DynamicProperty protocol provides access to the SwiftUI-managed data pool for data. With the help of the private <code>_makeProperty</code> method, data can request space in the SwiftUI data pool for storage and retrieval. This serves two purposes:</p>
<ul>
<li>Changes in the data will trigger updates in the views that are bound to it.</li>
<li>Since the underlying data is not stored in the view, SwiftUI can create new view description instances at any time during the view’s lifetime without worrying about data loss.</li>
</ul>
<p>Although Apple has not disclosed the details of the <code>_makeProperty</code> method, developers cannot request data storage addresses from SwiftUI on their own. However, similar effects can be achieved by using types that conform to the DynamicProperty protocol, such as <code>State</code>, in custom types that also conform to the DynamicProperty protocol.</p>
<p>When creating a custom DynamicProperty type, it is important to keep the following in mind:</p>
<ul>
<li>Environment values or objects can be used in custom types</li>
</ul>
<p>Once a view is loaded, all types that conform to the DynamicProperty protocol in the view will have the ability to access environment data. However, attempting to access environment data before the view is loaded or without providing environment values (such as forgetting to inject an environment object or not providing the correct view context) will result in a crash.</p>
<ul>
<li>Custom types will also be recreated when SwiftUI recreates the view description instance during the view’s lifespan</li>
</ul>
<p>During the view’s lifespan, if SwiftUI recreates the view description instance, then it will recreate all properties regardless of whether they conform to DynamicProperty or not. This means that persistent data (consistent with the view’s lifespan) must be saved in the DynamicProperty type provided by the system.</p>
<ul>
<li>The update method will only be called after the view has been loaded by SwiftUI</li>
</ul>
<p>The only method exposed by the DynamicProperty protocol is update. SwiftUI will call this method when the view is first loaded and when data that can trigger a view update changes in a type that conforms to DynamicProperty. Since instances of the type may be repeatedly created during the view’s lifespan, data preparation (such as fetching NSFetchedResultsController data for the first time, creating subscription relationships) and update work should be performed in this method.</p>
<ul>
<li>Data that triggers a view update cannot be synchronously changed in the update method</li>
</ul>
<p>As with updating the Source of truth in SwiftUI views, in a view update cycle, the Source of truth cannot be updated again. This means that even though we can only change data in the update method, we must find a way to stagger this update cycle.</p>
<h3 id="usage-of-mockablefetchrequest">Usage of MockableFetchRequest</h3>
<p>MockableFetchRequest provides the ability to dynamically retrieve data similar to FetchRequest, but with the following characteristics:</p>
<ul>
<li>MockableFetchRequest returns data of type AnyConvertibleValueObservableObject.</li>
</ul>
<p>The NSFetchedResultsController in MockableFetchRequest directly converts data to AnyConvertibleValueObservableObject type. This allows for the various benefits introduced in the previous section to be directly enjoyed in the view. In addition, when declaring MockableFetchRequest in the view, the use of specific managed object types can be avoided, which is conducive to modular development.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">MockableFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\ObjectsDataSource.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">groups</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> groups </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Code is not polluted by specific managed object types</span></span>
<span class="line"></span></code></pre></div>
<ul>
<li>Switch data sources through environment values.</li>
</ul>
<p>In the previous section, we provided a preview capability without a managed environment for a view containing a single AnyConvertibleValueObservableObject object by creating data that conforms to the TestableConvertibleValueObservableObject protocol. MockableFetchRequest provides the ability to preview a set of data without a managed environment for a view that retrieves a data set.</p>
<p>First, we need to create a type that conforms to the ObjectsDataSourceProtocol protocol and specifies the data source by making the property of FetchDataSource type.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Included in MockableFetchRequest code</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> enum</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> FetchDataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Equatable</span><span style="color:#1E754F;--shiki-dark:#F286C4"> where</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Value</span><span style="color:#AB5959;--shiki-dark:#F286C4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> BaseValueProtocol</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    case</span><span style="color:#B07D48;--shiki-dark:#F6F6F4"> fetchRequest</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // retrieves data through NSFetchedResultsController in MockableFetchRequest</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    case</span><span style="color:#B07D48;--shiki-dark:#F6F6F4"> mockObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // uses provided Mock data</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentValues</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource: </span><span style="color:#1E754F;--shiki-dark:#F286C4">any</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> ObjectsDataSourceProtocol </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        get</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">ObjectsDataSourceKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        set</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">ObjectsDataSourceKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> newValue </span><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Code that developers need to customize</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObjectsDataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObjectsDataSourceProtocol </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> groups: FetchDataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">TodoGroup</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObjectsDataSourceKey</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentKey </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> static</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> defaultValue: </span><span style="color:#1E754F;--shiki-dark:#F286C4">any</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> ObjectsDataSourceProtocol </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> ObjectsDataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">groups</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#998418;--shiki-dark:#97E1F1">mockObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#AB5959;--shiki-dark:#F286C4">init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">[</span><span style="color:#998418;--shiki-dark:#97E1F1">MockGroup</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">sample1</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">eraseToAny</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#393A34;--shiki-dark:#F6F6F4">]</span><span style="color:#999999;--shiki-dark:#F6F6F4">)))</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Sets the default data source to be from Mock data</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span></code></pre></div>
<p>Real-time modifications can be made to the data during preview (see the <a href="https://github.com/fatbobman/Todo/blob/main/Todo-PureSwiftUI/Todo-PureSwiftUI/GroupListContianer.swift?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">GroupListContainer code</a> in Todo for more details).</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20221203183414864.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20221203183414864.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20221203183414864.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20221203183414864.png" alt="https://cdn.fatbobman.com/image-20221203183414864.png" loading="lazy" decoding="async"/>
                  </picture></p>
<p>When the application is running in a hosted environment, simply provide the correct view context and modify the property values in dataSource to fetchRequest.</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/image-20221203185621897.png?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/image-20221203185621897.png?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/image-20221203185621897.png?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/image-20221203185621897.png" alt="https://cdn.fatbobman.com/image-20221203185621897.png" loading="lazy" decoding="async"/>
                  </picture></p>
<ul>
<li>Allow not providing NSFetchRequest in the constructor.</li>
</ul>
<p>When using @FetchRequest in a view, we have to set NSFetchRequest (or NSPredicate) when declaring the FetchRequest variable. As a result, when extracting the view to a separate Package, we still need to import the library containing the specific Core Data managed object definitions, making it impossible to achieve complete decoupling. In MockableFetchRequest, there is no need to provide NSFetchRequest when declaring, and the required NSFetchRequest can be dynamically provided for MockableFetchRequest when the view is loaded (<a href="https://github.com/fatbobman/Todo/blob/main/ViewLibrary/Sources/ViewLibrary/GroupList.swift?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">detailed demo code</a>).</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> GroupListView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">MockableFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\ObjectsDataSource.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">groups</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> groups</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">getTodoGroupRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> getTodoGroupRequest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        List</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                ForEach</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">groups</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> group </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                    GroupCell</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                        groupObject</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> group,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                        deletedGroupButtonTapped</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> deletedGroupButtonTapped,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                        updateGroupButtonTapped</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> updateGroupButtonTapped,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                        groupCellTapped</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> groupCellTapped</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">                    )</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">task</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            guard</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> request </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#1E754F;--shiki-dark:#F286C4"> await</span><span style="color:#998418;--shiki-dark:#97E1F1"> getTodoGroupRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#1E754F;--shiki-dark:#F286C4"> else</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#1E754F;--shiki-dark:#F286C4"> return</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Dynamically obtain the required Request through the environment method when the view is loaded</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            $groups </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> request </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Dynamically set MockableFetchRequest</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">navigationTitle</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Todo Groups</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span></code></pre></div>
<ul>
<li>Avoid updating data sets with operations that do not cause ID changes.</li>
</ul>
<p>MockableFetchRequest does not update the dataset even if the attribute values of the data change, as long as the ID sequence or quantity of the dataset remains unchanged. Because AnyConvertibleValueObservableObject itself conforms to the ObservableObject protocol, even if MockableFetchRequest does not update the dataset, the view will still respond to changes in the properties of AnyConvertibleValueObservableObject. This reduces the frequency of changes in the ForEach dataset, improving the efficiency of SwiftUI views.</p>
<ul>
<li>Provides a lighter Publisher to monitor data changes</li>
</ul>
<p>The original FetchRequest provides a Publisher (through the projection value) that responds to each dataset change. However, this Publisher responds too frequently and even if only one data attribute in the dataset changes, it will issue all the data in the dataset. MockableFetchRequest simplifies this by issuing an empty notification <code>(AnyPublisher&lt;Void, Never&gt;)</code> only when the dataset changes.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> GroupListView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">MockableFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\ObjectsDataSource.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">groups</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> groups</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    public</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        List</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">           ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#998418;--shiki-dark:#97E1F1">onReceive</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">_groups.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">publisher</span><span style="color:#999999;--shiki-dark:#F6F6F4">){</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#1E754F;--shiki-dark:#F286C4"> in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">data changed</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">       }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<blockquote>
<p>To achieve the same effect as @FetchRequest, only the permission of the sender property needs to be raised.</p>
</blockquote>
<p>The following image is a preview demonstration created entirely with mock data:</p>
<p><img src="https://cdn.fatbobman.com/mockableFetchRequest_demo_2022-12-04_11.12.46.2022-12-04%2011_14_21.gif" alt="https://cdn.fatbobman.com/mockableFetchRequest_demo_2022-12-04_11.12.46.2022-12-04%2011_14_21.gif"/></p>
<h3 id="explanation-of-mockablefetchrequest-code">Explanation of MockableFetchRequest Code</h3>
<p>This section only explains part of the code, <a href="https://github.com/fatbobman/Todo/blob/main/Core/Sources/Core/ModernCoreData/MockableFetchRequest.swift?utm_source=Fatbobman%20Blog&utm_medium=web" rel="noreferrer noopener">please see here for the complete code</a>.</p>
<ul>
<li>How to avoid data updates overlapping with update cycles</li>
</ul>
<p>In MockableFetchRequest, we manage two different data sources through a publisher of type <code>PassthroughSubject&lt;[AnyConvertibleValueObservableObject&lt;Value&gt;], Never&gt;</code>. By using the delay operator, we can achieve staggered data updates. If necessary, we can also use Tasks to asynchronously update the data.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">cancellable.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> sender</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    .</span><span style="color:#998418;--shiki-dark:#97E1F1">delay</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">for</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#998418;--shiki-dark:#97E1F1">nanoseconds</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">1</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">scheduler</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> RunLoop.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // delay for 1 nanosecond is enough</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    .</span><span style="color:#998418;--shiki-dark:#97E1F1">removeDuplicates</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ==</span><span style="color:#998418;--shiki-dark:#97E1F1"> EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$1</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    .</span><span style="color:#998418;--shiki-dark:#97E1F1">receive</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">on</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> DispatchQueue.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    .</span><span style="color:#998418;--shiki-dark:#97E1F1">sink</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        updateWrappedValue.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span></code></pre></div>
<ul>
<li>Wrap the data that needs to be modified with a reference type to avoid unnecessary updates to the view.</li>
</ul>
<p>By creating a reference type with wrapping purposes to hold the data that needs to be modified (holding the reference in @State), the following goals can be achieved: 1. Ensure that the data’s lifecycle is consistent with the view’s lifespan; 2. Allow the data to be modified; 3. Changing the data will not trigger view updates.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">  extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MockableFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">      // Wrapper type</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">      final</span><span style="color:#AB5959;--shiki-dark:#F286C4"> class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> MutableHolder</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">T</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">          var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> value: T</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">          @</span><span style="color:#AB5959;--shiki-dark:#F286C4">inlinable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">          init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> value</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: T</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">              self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> value</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">          }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">  public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> MockableFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">Root</span><span style="color:#999999;--shiki-dark:#F6F6F4">,</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> DynamicProperty </span><span style="color:#1E754F;--shiki-dark:#F286C4">where</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Value</span><span style="color:#AB5959;--shiki-dark:#F286C4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> BaseValueProtocol</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, Root</span><span style="color:#AB5959;--shiki-dark:#F286C4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObjectsDataSourceProtocol</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">      @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> fetcher </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> MutableHolder</span><span style="color:#AB5959;--shiki-dark:#F286C4">&lt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">ConvertibleValueObservableObjectFetcher</span><span style="color:#AB5959;--shiki-dark:#F286C4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Value</span><span style="color:#AB5959;--shiki-dark:#F286C4">&gt;?&gt;</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#1E754F;--shiki-dark:#BF9EEE">nil</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">      func</span><span style="color:#59873A;--shiki-dark:#62E884"> update</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">          ...</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">          // fetcher is persistent, modifying fetcher.value will not trigger view updates</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">          if</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource </span><span style="color:#AB5959;--shiki-dark:#F286C4">as?</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Root, </span><span style="color:#1E754F;--shiki-dark:#F286C4">case</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .fetchRequest </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> objectKeyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, fetcher.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ==</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> nil</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">              fetcher.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#AB5959;--shiki-dark:#F286C4">init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">sender</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> sender</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">              if</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> fetchRequest </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                  updateFetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">fetchRequest</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">              }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">          }</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">          ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">  }</span></span>
<span class="line"></span></code></pre></div>
<ul>
<li>How to compare two <code>[AnyConvertibleValueObservableObject&lt;Value&gt;]</code> for equality?</li>
</ul>
<p>Due to Swift’s inability to directly compare data containing associated types, an intermediate type EquatableObjects is created and made to conform to the Equatable protocol to facilitate comparison of two <code>[AnyConvertibleValueObservableObject&lt;Value&gt;]</code> data, avoiding unnecessary view refreshes.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">  public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Equatable</span><span style="color:#1E754F;--shiki-dark:#F286C4"> where</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Value</span><span style="color:#AB5959;--shiki-dark:#F286C4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> BaseValueProtocol</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">      public</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> values: </span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">AnyConvertibleValueObservableObject</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">      public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> static</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func==</span><span style="color:#999999;--shiki-dark:#F6F6F4"> (</span><span style="color:#998418;--shiki-dark:#97E1F1">lhs</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">rhs</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> Self</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Bool</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">          guard</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lhs.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ==</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> rhs.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#1E754F;--shiki-dark:#F286C4"> else</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#1E754F;--shiki-dark:#F286C4"> return</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> false</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">          for</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> index </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lhs.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">indices</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">              if</span><span style="color:#AB5959;--shiki-dark:#F286C4"> !</span><span style="color:#393A34;--shiki-dark:#F6F6F4">lhs.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">index</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#393A34;--shiki-dark:#F6F6F4">._object.</span><span style="color:#998418;--shiki-dark:#97E1F1">isEquatable</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">other</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> rhs.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">index</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">_object</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#1E754F;--shiki-dark:#F286C4"> return</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> false</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">          }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">          return</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> true</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">      public</span><span style="color:#AB5959;--shiki-dark:#F286C4"> init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;--shiki-dark:#62E884">_</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> values</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">AnyConvertibleValueObservableObject</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Value</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;])</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">          self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> values</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">  // in MockableFetchRequest</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">  if</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource </span><span style="color:#AB5959;--shiki-dark:#F286C4">as?</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Root, </span><span style="color:#1E754F;--shiki-dark:#F286C4">case</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#998418;--shiki-dark:#97E1F1">mockObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> objects</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> dataSource</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> objectKeyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">     objects </span><span style="color:#AB5959;--shiki-dark:#F286C4">!=</span><span style="color:#998418;--shiki-dark:#97E1F1"> EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">_values.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">wrappedValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">  // remove duplicates</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">  {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      sender.</span><span style="color:#998418;--shiki-dark:#97E1F1">send</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">objects.</span><span style="color:#998418;--shiki-dark:#BF9EEE">values</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">  cancellable.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> sender</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      .</span><span style="color:#998418;--shiki-dark:#97E1F1">delay</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">for</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#998418;--shiki-dark:#97E1F1">nanoseconds</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#2F798A;--shiki-dark:#BF9EEE">1</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">scheduler</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> RunLoop.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      .</span><span style="color:#998418;--shiki-dark:#97E1F1">removeDuplicates</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">          EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> ==</span><span style="color:#998418;--shiki-dark:#97E1F1"> EquatableObjects</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$1</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // remove duplicates</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      .</span><span style="color:#998418;--shiki-dark:#97E1F1">receive</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">on</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> DispatchQueue.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      .</span><span style="color:#998418;--shiki-dark:#97E1F1">sink</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">          updateWrappedValue.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">$0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">      }</span></span>
<span class="line"></span></code></pre></div>
<ul>
<li>Solving the problem of not being able to introduce self in closures by manipulating underlying data</li>
</ul>
<p>Using the underlying data in the subscription closure can bypass the problem of not being able to introduce self in the struct.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> values </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> _values  </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Corresponding to the type State, which is the underlying data of the values property of MockableFetchRequest</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstUpdate </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstUpdate</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> animation </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> animation</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">updateWrappedValue.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> data </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> animation </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> animation</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    if</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstUpdate.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        animation </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> nil</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        firstUpdate.</span><span style="color:#998418;--shiki-dark:#BF9EEE">value</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#1E754F;--shiki-dark:#BF9EEE"> false</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    withAnimation</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">animation</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        values.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">wrappedValue</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> data </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Operate on the underlying data</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h3 id="sectionedfetchrequest">SectionedFetchRequest</h3>
<p>I haven’t made any changes to the SectionedFetchRequest method for retrieving data for the time being. The main reason is that I haven’t figured out how to organize the returned data.</p>
<p>Currently, SectionedFetchRequest has serious performance issues when dealing with large amounts of data. This is because once multiple ForEach are present in SwiftUI’s lazy container, the optimization ability of the lazy container for child views will be lost. Any changes in the data will result in the lazy container updating all child views instead of only updating the visible ones.</p>
<p>The data type returned by SectionedFetchRequest is SectionedFetchResults, which can be viewed as an ordered dictionary with SectionIdentifier as the key. Reading its data will inevitably use multiple ForEach in the lazy container, causing performance issues.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">SectionedFetchRequest&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, Quake</span><span style="color:#AB5959;--shiki-dark:#F286C4">&gt;</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    sectionIdentifier</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> \.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">day</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    sortDescriptors</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> [</span><span style="color:#998418;--shiki-dark:#97E1F1">SortDescriptor</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">time</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">order</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">reverse</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#393A34;--shiki-dark:#F6F6F4">]</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> quakes: SectionedFetchResults</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, Quake</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">List</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    ForEach</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">quakes</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> section </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Section</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">header</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#998418;--shiki-dark:#97E1F1"> Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">section.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">id</span><span style="color:#999999;--shiki-dark:#F6F6F4">))</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            ForEach</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">section</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> quake </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                QuakeRow</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">quake</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> quake</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>I currently have two ideas:</p>
<ul>
<li>Return all data as an array (with sectionIdentifier as the primary sorting condition) and provide the starting offset (or ID) for each section in the returned array, as well as the amount of data in each section.</li>
<li>Return all data as an array (with sectionIdentifier as the primary sorting condition) and insert specific AnyConvertibleValueObservableObject data at the beginning and end of each section (since WrappedID exists, we can easily create mock data).</li>
</ul>
<p>In either case, developers must give up using the native Section feature of SwiftUI and, in a lazy container, handle segmenting the data display based on the provided additional data.</p>
<blockquote>
<p>Core Data itself does not have the ability to directly retrieve grouped records from SQLite. The current implementation is to retrieve all data with sectionIdentifier as the primary sorting condition. Then, group sectionIdentifier by propertyToGroupBy to obtain the amount of data for each group (count). Calculate the offset of each section using the returned statistics.</p>
</blockquote>
<h2 id="summary-and-introduction-to-the-next-article">Summary and Introduction to the Next Article</h2>
<p>In this article, we have created a FetchRequest that supports mock data and briefly discussed things to keep in mind when customizing a type that conforms to the DynamicProperty protocol.</p>
<p>In the next article, we will explore how to safely respond to data in SwiftUI, how to avoid unexpected data loss that can lead to abnormal behavior and application crashes.</p> </div> <blockquote class="{text-base italic font-medium text-heading tracking-wide }"> <svg class="w-6 h-6 text-gray-400 dark:text-gray-600 mb-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 14"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-quote"></use> </svg> <p>If this article helped you, feel free to <a href="https://www.buymeacoffee.com/fatbobman">buy me a coffee</a> ☕️ .
        For sponsorship inquiries, please check out the <a href="/en/sponsorship/">details here</a>.
</p></blockquote> </article> <section class="pt-10 pb-10" id="related-posts"><div class="grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3 md:gap-4" id="more-tips"><a class="group rounded-md py-3 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 
            hover:bg-gray-200 dark:hover:bg-gray-700 active:bg-gray-300 dark:active:bg-gray-600 flex items-stretch gap-2
            " href="/en/posts/modern-core-data-data-definition/" id="relatedPosts-SwiftUI and Core Data: Data Definition"><span class="font-medium text-sm text-heading  group-hover:dark:text-white group-hover:text-black">SwiftUI and Core Data: Data Definition</span></a><a class="group rounded-md py-3 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 
            hover:bg-gray-200 dark:hover:bg-gray-700 active:bg-gray-300 dark:active:bg-gray-600 flex items-stretch gap-2
            " href="/en/posts/modern-core-data-problem/" id="relatedPosts-SwiftUI and Core Data: The Challenges"><span class="font-medium text-sm text-heading  group-hover:dark:text-white group-hover:text-black">SwiftUI and Core Data: The Challenges</span></a><a class="group rounded-md py-3 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 
            hover:bg-gray-200 dark:hover:bg-gray-700 active:bg-gray-300 dark:active:bg-gray-600 flex items-stretch gap-2
            " href="/en/posts/modern-core-data-respond-data-safely/" id="relatedPosts-SwiftUI and Core Data: Safely Responding to Data"><span class="font-medium text-sm text-heading  group-hover:dark:text-white group-hover:text-black">SwiftUI and Core Data: Safely Responding to Data</span></a><a class="group rounded-md py-3 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 
            hover:bg-gray-200 dark:hover:bg-gray-700 active:bg-gray-300 dark:active:bg-gray-600 flex items-stretch gap-2
            " href="/en/posts/real-time-switching-of-cloud-syncs-status/" id="relatedPosts-Switching Core Data Cloud Sync Status in Real-Time"><span class="font-medium text-sm text-heading  group-hover:dark:text-white group-hover:text-black">Switching Core Data Cloud Sync Status in Real-Time</span></a><a class="group rounded-md py-3 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 
            hover:bg-gray-200 dark:hover:bg-gray-700 active:bg-gray-300 dark:active:bg-gray-600 flex items-stretch gap-2
            hidden lg:flex" href="/en/posts/coredatawithcloudkit-2/" id="relatedPosts-Core Data with CloudKit: Syncing Local Database to iCloud Private Database"><span class="font-medium text-sm text-heading  group-hover:dark:text-white group-hover:text-black">Core Data with CloudKit: Syncing Local Database to iCloud Private Database</span></a></div></section> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed" data-subscribeText="Subscribe" data-placeholder="Enter email" data-anchor="related-posts" style="opacity: 0; transition: opacity 0.3s;"></div> <iframe class="sm:w-80 w-[480px] mx-auto dark:opacity-80 dark:rounded-lg dark:shadow-2xl dark:border-gray-600" src="https://weekly.fatbobman.com/embed" height="320" style="border:1px solid #EEE; background:white; width: 100%; max-width: 480px;"></iframe> <div class="text-xs font-medium text-heading p-4 ">Weekly Swift &amp; SwiftUI highlights!</div> </div> <!-- <Author lang={lang} /> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script defer>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/en";

  // 根据中英文对应不同的 adCacheKey
  const adCacheKey = 'dynamicAdCache' + (window.location.pathname.includes('/zh/') ? 'ZH' : 'EN');

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          // const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 解析 max-age
          const cc = response.headers.get('Cache-Control') || '';
          const maxAge = parseInt((cc.match(/(?:^|,)\s*max-age=(\d+)/)?.[1] ?? '0'), 10);

          // 读取 CDN Age 与服务端时间
          const age = parseInt(response.headers.get('Age') || '0', 10);
          // const serverDate = response.headers.get('Date');

          // 计算剩余 TTL（优先用 Age 抵扣）
          const ttlLeftMs = Math.max(0, (maxAge - age) * 1000);

          // 失效时间：以当前本地时间加剩余 TTL（若要完全按服务端时间，可用 serverDate 做基线）
          const expiresAt = Date.now() + ttlLeftMs;

          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div id="gitalk-container" data-comment-id="SwiftUI 与 Core Data —— 数据获取" data-lang="en" data-repo="blogComments" data-createIssueManually="true" data-anchor="related-posts" class="pb-16"></div>

    <script defer>
      document.addEventListener('DOMContentLoaded', async function () {
      const container = document.getElementById('custom-substack-embed');
      let anchor = '';
      if (container) {
        anchor = container.getAttribute('data-anchor') || '';
      }
        // 提前检查是否需要加载评论
        try {
          const response = await fetch('https://fatbobman.com/status/comment');
          const data = await response.text();
          console.log(data, "comment");

          if (data !== '1') {
            console.log('评论功能未启用，跳过监控和加载操作。');
            return; // 提前返回，跳过后续逻辑
          }
        } catch (error) {
          console.error('检查评论状态时出错：', error);
          return; // 出现错误时也跳过后续逻辑
        }

        // 如果返回值为 "1"，则启动观察器
        const observerTarget = document.getElementById(anchor);
        if (observerTarget) {
          const observer = new IntersectionObserver(async (entries, observer) => {
            const entry = entries[0];
            if (entry.isIntersecting) {
              console.log("load comment")
              // 停止观察，避免重复触发
              observer.unobserve(observerTarget);

              // 动态加载评论区脚本
              await loadGitalk();
            }
          }, {
            root: null, // 相对于视口
            rootMargin: '20%', // 提前 20% 的位置触发
            threshold: 0.1, // 元素显示 10% 即触发
          });

          observer.observe(observerTarget);
        }

        // 动态加载 Gitalk 脚本并初始化评论区
        async function loadGitalk() {
          const container = document.getElementById('gitalk-container');
          if (container) {
            const commentID = container.getAttribute('data-comment-id');
            const lang = container.getAttribute('data-lang');
            const repo = container.getAttribute('data-repo')
            const createIssueManually = container.getAttribute('data-createIssueManually')

            console.log(repo);
            console.log(createIssueManually)

            // 动态加载 Gitalk 脚本
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js';
            script.defer = true;
            script.onload = () => {
              const gitalk = new Gitalk({
                clientID: 'fcf61195c7f73253dc8b',
                clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
                repo: repo,
                owner: 'fatbobman',
                admin: ['fatbobman'],
                id: commentID.split('/').pop().substring(0, 49),
                distractionFreeMode: true,
                createIssueManually: createIssueManually,
                language: lang,
              });

              gitalk.render('gitalk-container');
            };
            document.body.appendChild(script);
          }
        }
      });
    </script> <div class="hidden lg:block w-32 xl:w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="toc-content"> <div class="w-full flex justify-end pb-2" id="toc-float-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-toc"></use> </svg> <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-close" class="hidden"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-toc-close"></use> </svg>  </div> </div> <div class="text-default text-xxs xl:text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#creating-a-fetchrequest-that-can-use-mock-data" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Creating a FetchRequest that can use Mock data </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#is-fetchrequest-breaking-the-unidirectional-data-flow" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> Is FetchRequest breaking the unidirectional data flow? </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#nsfetchedresultscontroller" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> NSFetchedResultsController </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#custom-types-that-conform-to-dynamicproperty-protocol" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> Custom Types that Conform to DynamicProperty Protocol </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#usage-of-mockablefetchrequest" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> Usage of MockableFetchRequest </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#explanation-of-mockablefetchrequest-code" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> Explanation of MockableFetchRequest Code </a> </div> </li><li class="xl:pl-4 pl-1 pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#sectionedfetchrequest" class="inline-block font-normal relative before:content-[&#34;-&#34;] before:hidden xl:before:block before:absolute before:left-[-10px] before:text-default before:w-0 break-words"> SectionedFetchRequest </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary hover:font-black"> <a href="#summary-and-introduction-to-the-next-article" class="inline-block hover:text-secondary text-heading font-medium relative before:hidden xl:before:block before:content-[&#34;▪&#34;] before:absolute before:left-[-15px] before:text-heading before:w-0 py-1 break-words"> Summary and Introduction to the Next Article </a> </div> </li>  </ul> </div> </div> </div> <script type="module" src="/_astro/TOC.astro_astro_type_script_index_0_lang.ARhKvemZ.js"></script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        if ('/en/posts/modern-core-data-data-definition/' !== '#') {
          window.location.href = '/en/posts/modern-core-data-data-definition/';
        }
      } catch (e) {
        console.log('Navigation failed:', e);
      }
    " data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class="cursor-pointer" aria-label="Next post"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-previous"></use> </svg> </button>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>SwiftUI and Core Data: Data Definition</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> </div> <script>(function(){const url = "/en/posts/modern-core-data-data-definition/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        if ('/en/posts/modern-core-data-respond-data-safely/' !== '#') {
          window.location.href = '/en/posts/modern-core-data-respond-data-safely/';
        }
      } catch (e) {
        console.log('Navigation failed:', e);
      }
    " data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class="cursor-pointer" aria-label="Previous post"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-next"></use> </svg> </button>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>SwiftUI and Core Data: Safely Responding to Data</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/modern-core-data-respond-data-safely/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=SwiftUI%20and%20Core%20Data%3A%20Data%20Fetching&url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmodern-core-data-fetcher%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter" data-tooltip-target="tooltip-share-with-twitter" data-tooltip-placement="left"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-twitter"></use> </svg> </a>  </div> <div id="tooltip-share-with-twitter" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-32 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on X</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <button type="button" onclick="
      try {
        window.open('https://bsky.app/intent/compose?text=SwiftUI%20and%20Core%20Data%3A%20Data%20Fetching%0A by %40fatbobman.com %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmodern-core-data-fetcher%2F%0A #ios #swift', '_blank');
      } catch (e) {
        console.log('Failed to open BlueSky share');
      }
    " id="sidebar-share-with-bluesky" data-tooltip-target="tooltip-share-with-bluesky" data-tooltip-placement="left" class="cursor-pointer" aria-label="Share on BlueSky"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-bluesky"></use> </svg> </button>  </div> <div id="tooltip-share-with-bluesky" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on BlueSky</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Fmodern-core-data-fetcher%252F" target="_blank" id="sidebar-share-with-facebook" data-tooltip-target="tooltip-share-with-facebook" data-tooltip-placement="left"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-facebook"></use> </svg> </a>  </div> <div id="tooltip-share-with-facebook" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Facebook</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div>  <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmodern-core-data-fetcher%2F" target="_blank" id="sidebar-share-with-linkedin" data-tooltip-target="tooltip-share-with-linkedin" data-tooltip-placement="left"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-linkedin"></use> </svg> </a>  </div> <div id="tooltip-share-with-linkedin" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share on Linkedin</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="mailto:?subject=Article%3A%E3%80%90SwiftUI%20and%20Core%20Data%3A%20Data%20Fetching%E3%80%91&#38;body=Here's%20an%20article%20you%20may%20find%20interesting%3A%0A%0ASwiftUI%20and%20Core%20Data%3A%20Data%20Fetching%0A%0ALink%3A%20https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmodern-core-data-fetcher%2F" target="_blank" id="sidebar-share-with-email" data-tooltip-target="tooltip-share-with-email" data-tooltip-placement="left"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-email"></use> </svg> </a>  </div> <div id="tooltip-share-with-email" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-40 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share via Email</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" id="comment-button" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-share-with-comment" data-tooltip-placement="left"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-comment"></use> </svg>  </div> <div id="tooltip-share-with-comment" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Share Your Thoughts</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>
  const SCROLL_OFFSET = 80;
  
  document.addEventListener('DOMContentLoaded', function() {
    const commentButton = document.getElementById('comment-button');
    if (commentButton) {
      commentButton.addEventListener('click', function() {
        const gitalkContainer = document.getElementById('gitalk-container');
        if (gitalkContainer) {
          const topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: topPosition, behavior: 'smooth' });
        }
      });
    }
  });
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" data-tooltip-target="tooltip-back-to-top" data-tooltip-placement="left"> <use href="/_astro/iconCollection.C9WNJL2e.svg#icon-top"></use> </svg>  </div> <div id="tooltip-back-to-top" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-28 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Back to Top</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.DVW0R156.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block "> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Explore</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Subscribe</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary" target="_blank">Newsletter</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Connect &amp; Support</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/sponsorship/" class="hover:text-secondary" rel="sponsored"> Promote on Blog </a> <a href="/en/about/#contact" class="hover:text-secondary">Contact Me</a> <a href="https://www.buymeacoffee.com/fatbobman" class="hover:text-secondary" target="_blank">Buy Me a Coffee ☕️</a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs tracking-normal">Copyright ©  2025
Fatbobman Digital Limited. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <button type="button" onclick="
        try {
          window.open('https://beian.miit.gov.cn/#/Integrated/index', '_blank');
        } catch (e) {
          console.log('Failed to open ICP link:', e);
        }
      " class="text-xxs hover:underline text-muted tracking-wide" aria-label="ICP Registration Information">
辽ICP备20006550号-1
</button> </div> </div> </div> </div> </footer> </footer> </div> <section> <div id="weekly-modal" data-subscribeText="Join Now" data-placeholder="Subscribe with your email"> <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"> <!-- Modal content --> <div class="relative bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-lg shadow-2xl border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button id="popup-modal-close-button" type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4 md:w-[480px] sm:w-80 mx-auto"> <div class="sm:hidden md:block text-base text-center font-bold text-gray-900 dark:text-blue-100 pt-4 pb-2 ">Weekly Swift &amp; SwiftUI Highlights - Every Monday</div> <iframe class="mx-auto sm:w-[320px] md:w-[480px] sm:h-[200px] md:h-[320px] dark:opacity-80 dark:rounded-lg dark:shadow-2xl dark:border-gray-600" src="https://weekly.fatbobman.com/embed" style="border:0px solid #EEE; background:white; width: 100%; max-width: 480px;"></iframe> </div> </div> </div> </div> </section> <script type="module" src="/_astro/WeeklyModalLoader.astro_astro_type_script_index_0_lang.CmhzHyOM.js"></script>  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js" async></script> <script src="https://analytics.ahrefs.com/analytics.js" data-key="KF0NNRpbcfyJPzijzZEiOw" async></script> <script>
  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', () => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"搜索",buttonAriaLabel:"搜索"},modal:{searchBox:{resetButtonTitle:"清除搜索关键字",resetButtonAriaLabel:"清除搜索关键字",cancelButtonText:"取消",cancelButtonAriaLabel:"取消"},startScreen:{recentSearchesTitle:"最近搜索",noRecentSearchesText:"当前没有搜索历史记录",saveRecentSearchButtonTitle:"保存本次搜索",removeRecentSearchButtonTitle:"从搜索历史中移除",favoriteSearchesTitle:"收藏夹",removeFavoriteSearchButtonTitle:"从收藏夹移除"},errorScreen:{titleText:"无法获取结果",helpText:"请检查网络连接"},footer:{selectText:"选择",selectKeyAriaLabel:"选择",navigateText:"切换",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"退出",closeKeyAriaLabel:"Escape key",searchByText:"引擎支持"},noResultsScreen:{noResultsText:"无法找到对应结果",suggestedQueryText:"可以尝试搜索如下内容",reportMissingResultsText:"确认本次搜索应该返回内容？",reportMissingResultsLinkText:"请告知我们"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <!--Magic Fix 解决在 Safari 下搜索框取消后会滚动到页面底部--> <div class="fixed"> <input type="text"> </div> </body></html>
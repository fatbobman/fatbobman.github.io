<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>A Deep Dive Into Observation - A New Way to Boost SwiftUI Performance | Fatbobman&#39;s Blog</title>
<meta name="description" content="Explore the Observation framework in Swift 5.9: Learn its creation, usage, and benefits for SwiftUI performance. Understand how it improves upon KVO and Combine. ">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/mastering-observation/">
<meta property="og:title" content="A Deep Dive Into Observation - A New Way to Boost SwiftUI Performance | Fatbobman&#39;s Blog">
<meta property="og:description" content="Explore the Observation framework in Swift 5.9: Learn its creation, usage, and benefits for SwiftUI performance. Understand how it improves upon KVO and Combine. ">
<meta property="og:url" content="https://fatbobman.com/en/posts/mastering-observation/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://cdn.fatbobman.com/card/mastering-observation-en.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="Fatbobman's Blog"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/mastering-observation/"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/mastering-observation/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.C3fvyPtB.css">
<link rel="stylesheet" href="/_astro/about.DZfzqhGN.css">
<link rel="stylesheet" href="/_astro/_slug_.BRLGXoDU.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-6 sm:pt-6 font-black w-[240px] sm:w-[300px] pb-2 sm:pb-0"> <svg fill="currentColor" class="text-heading" width="500"> <use href="/_astro/blogTitle.Ca1NZNqJ.svg#blog-title"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-aifadian"></use> </svg> </div> </a> </li><li> <a href="/zh/posts/mastering-observation/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-aifadian"></use> </svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> <script type="module">function a(){const t=localStorage.getItem("lang"),e=document.getElementById("EN-check"),n=document.getElementById("ZH-check");e!==null&&n!==null&&(t==="en"?(e.classList.remove("hidden"),n.classList.add("hidden")):t==="zh"&&(n.classList.remove("hidden"),e.classList.add("hidden")))}document.addEventListener("DOMContentLoaded",()=>{a()});const l=document.getElementById("set-default-lang");l?.addEventListener("click",()=>{const t=document.getElementById("lang-data");if(t!=null){const e=t.dataset.lang;e!=null&&(localStorage.setItem("lang",e),a())}});</script> </div> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_system"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-computer"></use> </svg> <svg viewBox="0 0 1024 1024" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_dark"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-moon"></use> </svg> <svg viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" id="theme_icon_light"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-sun"></use> </svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg class="w-5 h-5" viewBox="0 0 1024 1024" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-sun"></use> </svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-moon"></use> </svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg class="w-5 h-5"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-computer"></use> </svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  // 获取按钮
  var themeButtonLight = document.getElementById('theme_button_light');
  var themeButtonDark = document.getElementById('theme_button_dark');
  var themeButtonSystem = document.getElementById('theme_button_system');
  // 获取图标
  var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
  var themeToggleLightIcon = document.getElementById('theme_icon_light');
  var themeToggleSystemIcon = document.getElementById('theme_icon_system');

  function setTheme() {
    if (
      localStorage.getItem('color-theme') === 'dark' ||
      (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function setThemeButton() {
    let theme = localStorage.getItem('color-theme');
    if (theme === 'dark') {
      themeToggleDarkIcon.classList.remove('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else if (theme === 'light') {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.remove('hidden');
      themeToggleSystemIcon.classList.add('hidden');
    } else {
      themeToggleDarkIcon.classList.add('hidden');
      themeToggleLightIcon.classList.add('hidden');
      themeToggleSystemIcon.classList.remove('hidden');
    }
  }

  function resetTheme() {
    setTheme();
    setThemeButton();
  }

  resetTheme();

  // 监听暗黑模式的变化
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    resetTheme();
  });

  // 保证其他的页面也能够监听到 localStorage 的变化
  window.addEventListener('storage', function (event) {
    if (event.key === 'color-theme') {
      resetTheme();
    }
  });


  // Listen for clicks on the button themeToggleDarkIcon
  themeButtonDark.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'dark');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleLightIcon
  themeButtonLight.addEventListener('click', function () {
    localStorage.setItem('color-theme', 'light');
    resetTheme();
  });

  // // Listen for clicks on the button themeToggleSystemIcon
  themeButtonSystem.addEventListener('click', function () {
    localStorage.removeItem('color-theme');
    resetTheme();
  });
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Quick Tips </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> About </a> </ul> </nav> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/tags/SwiftUI/">
#SwiftUI </a><a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/tags/Swift/">
#Swift </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/posts/mastering-observation/" id="language-switcher-for-topic"> #中文版 </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">A Deep Dive Into Observation: A New Way to Boost SwiftUI Performance</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2023-06-19T00:12:00.000Z">Jun 19, 2023</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 

<p>At WWDC 2023, Apple introduced a new member of the Swift standard library - the Observation framework. Its appearance is expected to alleviate the long-standing issue of unnecessary updates to SwiftUI views for developers. This article will comprehensively and thoroughly explore the Observation framework in a Q&amp;A format, including its reasons for creation, usage methods, workings, and precautions.</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="why-create-the-observation-framework">Why create the Observation framework</h2>
<p>Before Swift 5.9, Apple did not provide developers with a unified and efficient mechanism for observing changes to reference type properties. KVO is limited to use by NSObject subclasses, Combine cannot provide precise observation at the property level, and neither can achieve cross-platform support.</p>
<p>In addition, in SwiftUI, the source of truth for reference type data sources is implemented using the ObservableObject protocol based on the Combine framework. This leads to a large number of unnecessary view refreshes in SwiftUI, which affects the performance of SwiftUI applications.</p>
<p>To address these limitations, the Observation framework was introduced in Swift 5.9. Compared to existing KVO and Combine, it has the following advantages:</p>
<ol>
<li>It is applicable to all Swift reference types, not just NSObject subclasses, and provides cross-platform support.</li>
<li>Provides precise observation at the property level without the need for special annotations on observable properties.</li>
<li>Reduces unnecessary view updates in SwiftUI and improves application performance.</li>
</ol>
<h2 id="how-to-declare-an-observable-object">How to Declare an Observable Object</h2>
<p>Using the Combine framework, we can declare an observable reference type as follows:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObservableObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> fullName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        firstName </span><span style="color:#AB5959;--shiki-dark:#F286C4">+</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#AB5959;--shiki-dark:#F286C4"> +</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">firstName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">lastName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">count</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">firstName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">lastName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>When the firstName, lastName, and count of the instance change, <code>@Published</code> will send notifications through <code>objectWillChange</code>(ObjectWillChangePublisher) to inform all subscribers that the current instance is about to change.</p>
<p>Using the Observation framework, we will use a completely different declaration:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Yang</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Xu</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> fullName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        firstName </span><span style="color:#AB5959;--shiki-dark:#F286C4">+</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#AB5959;--shiki-dark:#F286C4"> +</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">firstName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">lastName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">count</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">firstName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">lastName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<ul>
<li>Add <code>@Observalbe</code> annotation before the class declaration, and there is no need to specify that the Store type should comply with a certain protocol.</li>
<li>There is no need to use <code>@Published</code> to annotate properties that can trigger notifications. Any stored property that is not specifically annotated can be observed.</li>
<li>Computed properties can be observed (in the example, <code>fullName</code> can also be observed).</li>
<li>For properties that do not want to be observed, they need to be annotated with <code>@ObservationIgnored</code> in front of them.</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// count cannot be observed</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationIgnored</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span></code></pre></div>
<ul>
<li>All properties must have literal default values, even if a custom <code>init</code> method is provided.</li>
</ul>
<p>Compared to the Combine-based declaration, Observation makes the declaration of observable objects more concise and intuitive, while also providing support for observing computed properties.</p>
<h2 id="what-did-observable-do">What did @Observable do</h2>
<p>Unlike other common keywords that start with <code>@</code> (such as the <code>@Published</code> property wrapper and <code>@available</code> conditional compilation), <code>@Observable</code> here represents a macro.</p>
<p>Macros are a new feature added in Swift 5.9. They allow developers to manipulate and process Swift code at compile time. Developers can provide a macro definition that will execute during compilation and modify, add, or remove code from the source code.</p>
<p>In Xcode 15, right-click on <code>@Observable</code> and select “Expand Macro” to see the code generated by the <code>@Observable</code> macro:</p>
<p><img src="https://cdn.fatbobman.com/expend-macro-demo-2_2023-06-19_08.38.08.2023-06-19%2008_38_52.gif" alt="https://cdn.fatbobman.com/expend-macro-demo-2_2023-06-19_08.38.08.2023-06-19%2008_38_52.gif"/></p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationTracked</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Yang</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        get</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            access</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> \.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">firstName</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            return</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> _firstName</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        set</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            withMutation</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> \.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">firstName</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                _firstName </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> newValue</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationTracked</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // This code can also be expanded here.</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Xu</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> fullName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        firstName </span><span style="color:#AB5959;--shiki-dark:#F286C4">+</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#AB5959;--shiki-dark:#F286C4"> +</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationIgnored</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">firstName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">lastName</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">count</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">firstName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">lastName</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> lastName</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#BF9EEE">count</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> count</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationIgnored</span><span style="color:#1E754F;--shiki-dark:#F286C4"> private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$observationRegistrar </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> ObservationRegistrar</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    internal</span><span style="color:#AB5959;--shiki-dark:#F286C4"> nonisolated</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func</span><span style="color:#59873A;--shiki-dark:#62E884"> access</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">Member</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;(</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">        keyPath</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: KeyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">Store, Member</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    )</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#BF9EEE">        _</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$observationRegistrar.</span><span style="color:#998418;--shiki-dark:#97E1F1">access</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    internal</span><span style="color:#AB5959;--shiki-dark:#F286C4"> nonisolated</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func</span><span style="color:#59873A;--shiki-dark:#62E884"> withMutation</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">Member</span><span style="color:#999999;--shiki-dark:#F6F6F4">,</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> T</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;(</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">        keyPath</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: KeyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">Store, Member</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#62E884">        _</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> mutation</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> throws</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> T</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    )</span><span style="color:#AB5959;--shiki-dark:#F286C4"> rethrows</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> T </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">        try</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$observationRegistrar.</span><span style="color:#998418;--shiki-dark:#97E1F1">withMutation</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">of</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">keyPath</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> keyPath, mutation</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationIgnored</span><span style="color:#1E754F;--shiki-dark:#F286C4"> private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> _firstName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Yang</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">ObservationIgnored</span><span style="color:#1E754F;--shiki-dark:#F286C4"> private</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> _lastName: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Xu</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Observable </span><span style="color:#999999;--shiki-dark:#F6F6F4">{}</span></span></code></pre></div>
<p>As can be seen, the <code>Observable</code> macro adjusts our original declaration. In the <code>Store</code>, an <code>ObservationRegistrar</code> structure is declared to maintain and manage the relationship between observable properties and observers. Stored properties are rewritten as computed properties, and the original value is saved in a version with the same name but with the <code>_</code> prefix. In the <code>get</code> and <code>set</code> methods, observers are registered and notified through <code>_$observationRegistrar</code>. Finally, the macro adds code to make the observable object conform to the <code>Observable</code> protocol (similar to <code>Sendable</code>, it does not provide any implementation, but serves only as an identifier).</p>
<h2 id="how-to-use-observable-objects-in-views">How to Use Observable Objects in Views</h2>
<h3 id="declaring-observable-objects-in-views">Declaring Observable Objects in Views</h3>
<p>Unlike a Source of Truth that conforms to the ObservableObject protocol, we use <code>@State</code> in views to ensure the lifecycle of observable objects.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">   ....</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">       ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h3 id="injecting-observable-objects-into-the-view-hierarchy-using-environment">Injecting Observable Objects into the View Hierarchy Using Environment</h3>
<p>Compared to the Source of Truth that adheres to the ObservableObject protocol, Observable Objects declared using the Observation framework have more diverse and flexible options for environment injection.</p>
<ul>
<li>Injecting instances through environment</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">   ....</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObservationTest</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> App </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Scene </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        WindowGroup</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">Store.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Inject through environment in view</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">       ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<ul>
<li>Customize EnvironmentKey</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> StoreKey</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentKey </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    static</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> defaultValue </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">extension</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> EnvironmentValues</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store: Store </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        get</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">StoreKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">        set</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#999999;--shiki-dark:#F6F6F4">[</span><span style="color:#393A34;--shiki-dark:#F6F6F4">StoreKey.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">]</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> newValue </span><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">\.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Inject through environment in view</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">       ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<ul>
<li>Inject optional values</li>
</ul>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObservationTest</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> App </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> Scene </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        WindowGroup</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">                .</span><span style="color:#998418;--shiki-dark:#97E1F1">environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Environment</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">Store.</span><span style="color:#1E754F;--shiki-dark:#F286C4">self</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store:Store</span><span style="color:#999999;--shiki-dark:#F286C4">?</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Inject through environment in view</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">       if</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> firstName </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span><span style="color:#AB5959;--shiki-dark:#F286C4">?</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.firstName  </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">                Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">firstName</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">       }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Among them, both custom EnvironmentKey and injection of optional values perfectly solve the problem of Preview crashes caused by forgetting to inject. Especially EnvironmentKey gives developers the ability to provide default values.</p>
<p>Perhaps some people may feel confused why the injection method of observable objects declared using the Observation framework is similar to that of value types, while reference types that comply with the ObservableObject protocol require the use of methods that indicate Object to inject (StateObject, EnvironmentObject). Won’t this cause confusion?</p>
<p>It can be expected that in the development of iOS 17+ applications, the scenarios where observable objects declared through the Observation framework and observable objects that comply with the ObservableObject protocol appear simultaneously will become less and less. Therefore, soon, reference types and value types will be highly unified in their injection forms (there will almost never be a scenario where environmentObject or StateObject are used).</p>
<h3 id="passing-observable-objects-in-views">Passing Observable Objects in Views</h3>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store:Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">       ....</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Both <code>let</code> and <code>var</code> can be used.</p>
<h3 id="creating-a-binding-type">Creating a Binding Type</h3>
<p>The Binding type provides SwiftUI with the ability to implement two-way data binding. Using the Observation framework, we can create the corresponding Binding type for a property in the following ways.</p>
<p>Method One:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ContentView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Bindable</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store:Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">       TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Method Two:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store:Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">       @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Bindable</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">       TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4">$store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Method Three：</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> SubView</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store:Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name:Binding</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;{</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">        .</span><span style="color:#AB5959;--shiki-dark:#F286C4">init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">get</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">name</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#998418;--shiki-dark:#97E1F1">set</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">name</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> $0</span><span style="color:#999999;--shiki-dark:#F6F6F4"> })</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">       TextField</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">,</span><span style="color:#998418;--shiki-dark:#97E1F1">text</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4">name</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h2 id="does-the-observation-framework-support-older-versions-of-swiftui">Does the Observation framework support older versions of SwiftUI?</h2>
<p>Not supported.</p>
<p>However, due to the open-source nature of Observation, developers in the community have already modified its source code and packaged it, launching third-party libraries for lower versions of Observation:</p>
<ul>
<li><a href="https://github.com/onevcat/ObservationBP?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">ObservationBP</a></li>
<li><a href="https://github.com/pointfreeco/swift-perception?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">swift-perception</a></li>
</ul>
<h2 id="how-to-observe-observable-objects">How to observe observable objects</h2>
<p>The Observation framework provides a global function called <code>withObservationTracking</code>. With this function, developers can track whether the properties of an observable object have changed.</p>
<p>Function signature:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">func</span><span style="color:#59873A;--shiki-dark:#62E884"> withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4">&lt;</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">T</span><span style="color:#999999;--shiki-dark:#F6F6F4">&gt;(</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#62E884">    _</span><span style="color:#393A34;font-style:inherit;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic"> apply</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> T,</span></span>
<span class="line"><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">    onChange</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">autoclosure</span><span style="color:#999999;--shiki-dark:#F6F6F4"> ()</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#999999;--shiki-dark:#F6F6F4"> ()</span><span style="color:#999999;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Void</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#AB5959;--shiki-dark:#F286C4"> -&gt;</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> T</span></span></code></pre></div>
<p>Test 1:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 10</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 20</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> c </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 20</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> sum </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#AB5959;--shiki-dark:#F286C4"> +</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span><span style="color:#998418;--shiki-dark:#97E1F1"> onChange</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Store Changed a:</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">store.</span><span style="color:#B56959;--shiki-dark:#F6F6F4">a</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B56959;--shiki-dark:#E7EE98"> b:</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">store.</span><span style="color:#B56959;--shiki-dark:#F6F6F4">b</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B56959;--shiki-dark:#E7EE98"> c:</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">store.</span><span style="color:#B56959;--shiki-dark:#F6F6F4">c</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">c</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// No output</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Output</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// Store Changed a:10 b:20 c:100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// No output</span></span></code></pre></div>
<p>Test 2:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">   print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">   DispatchQueue.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">main</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#998418;--shiki-dark:#97E1F1">asyncAfter</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">deadline</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> .</span><span style="color:#998418;--shiki-dark:#97E1F1">now</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#AB5959;--shiki-dark:#F286C4"> +</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0.3</span><span style="color:#999999;--shiki-dark:#F6F6F4">){</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">      store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">   }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span><span style="color:#998418;--shiki-dark:#97E1F1"> onChange</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Store Changed</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// No output</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// No output</span></span></code></pre></div>
<p>In the official documentation for <code>withObservationTracking</code> provided by Apple, the function is explained as follows:</p>
<ul>
<li>apply: A closure that contains properties to track</li>
<li>onChange: The closure invoked when the value of a property changes</li>
<li>Returns: The value that the <code>apply</code> closure returns if it has a return value; otherwise, there is no return value</li>
</ul>
<p>However, the description is too simple, and there are still some confusing points:</p>
<ul>
<li>How does <code>withObservationTracking</code> determine which properties in the <code>apply</code> closure can be observed?</li>
<li>Why do some observable properties in the apply closure not trigger callbacks after being modified? (Test 2)</li>
<li>Is the observation behavior created by <code>withObservationTracking</code> disposable or persistent?</li>
<li>When is the <code>onChange</code> closure invoked? Does “when the value of a property changes” mean before or after the property is changed?</li>
</ul>
<p>Fortunately, the Observation framework is part of the Swift 5.9 standard library. We can learn more information by examining its <a href="https://github.com/apple/swift/tree/main/stdlib/public/Observation/Sources/Observation?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">source code</a>.</p>
<h2 id="what-is-the-observation-principle-of-the-observation-framework">What is the observation principle of the Observation framework?</h2>
<p>By reading the code, we can understand the process of creating observations with <code>withObservationTracking</code>. I will summarize it as follows:</p>
<h3 id="creating-observation-phase">Creating observation phase</h3>
<ul>
<li><code>withObservationTracking</code> creates an <code>_AccessList</code> in the current thread’s <code>_ThreadLocal.value</code>.</li>
<li>The apply closure is executed.</li>
<li>When the observable property of an observable object is called (triggered by the apply closure), the <code>access</code> method is used to save the correspondence between the observable property and the callback closure in the ObservationRegistrar of the observable object instance (the callback closure here is used to call the onChange closure in withObservationTracking).</li>
<li><code>withObservationTracking</code> saves the correspondence between the observable property and the onChange callback closure in <code>_AccessList</code>.</li>
</ul>
<h3 id="when-the-observed-property-is-about-to-change">When the observed property is about to change</h3>
<ul>
<li>The observed property will call the <code>willSet</code> method in ObservationRegistrar and find the callback closure corresponding to the current property KeyPath.</li>
<li>By calling the closure, the <code>onChange</code> closure is called in the thread initiated by <code>withObservationTracking</code>.</li>
<li>After the <code>onChange</code> closure is called, the information corresponding to the <code>_AccessList</code> in the current thread of <code>withObservationTracking</code> is cleared.</li>
<li>Clear the correspondence between the properties and the callback closures related to this observation operation in ObservationRegistrar.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>By sorting out, we can get the following conclusions:</p>
<ul>
<li>Only observable properties that are read (by calling their get method) in the apply closure will be observed (which explains the issue in test 2).</li>
<li>The observation operation created by <code>withObservationTracking</code> is a one-time behavior. Any observable property changes will end this observation after calling the onChange function.</li>
<li>The onChange closure is called before the property value changes (in the willSet method).</li>
<li>Multiple observable properties can be observed in one observation operation. Any property value changes will end this observation.</li>
<li>The observation behavior is thread-safe. <code>withObservationTracking</code> can run in another thread, and the onChange closure will run in the thread initiated by <code>withObservationTracking</code>.</li>
<li>Only observable properties can be observed. Observable objects that only appear in the apply closure will not create observation operations (which explains test 2).</li>
</ul>
<blockquote>
<p>Currently, the Observation framework does not provide an API for creating continuous observation behavior. Perhaps this part of the function will be added in later versions.</p>
</blockquote>
<h2 id="how-to-observe-property-changes-in-swiftui-views">How to observe property changes in SwiftUI views</h2>
<p>Based on the workings of the Observation framework, we can speculate that SwiftUI probably creates a connection between observable properties and view updates using the following methods:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">   var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">       ...</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">   }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> bodyValue </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    viewA.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">body</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span><span style="color:#998418;--shiki-dark:#97E1F1"> onChange</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    PreparingToRe</span><span style="color:#AB5959;--shiki-dark:#F286C4">-</span><span style="color:#998418;--shiki-dark:#97E1F1">evaluateTheBodyValue</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>As summarized in the previous text, we concluded that “only observable properties that are read within the apply closure (by calling their get method) will be observed.” Therefore, we can draw the following conclusion:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Changes in store.a will trigger a re-evaluation of the body.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">Button</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">Hi</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">){</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">    store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">abc</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Changes in store.b will not trigger a re-evaluation of the body.</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<h2 id="can-a-class-annotated-with-observable-still-conform-to-the-observableobject-protocol">Can a class annotated with @Observable still conform to the ObservableObject protocol?</h2>
<p>Yes, it can. However, there may be conflicts between the @Published property wrapper and the @Observable macro. To resolve this, we can use <code>withObservationTracking</code>.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">final</span><span style="color:#AB5959;--shiki-dark:#F286C4"> class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> ObservableObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> age </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">    init</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">name</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span><span style="color:#999999;--shiki-dark:#F286C4"> =</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;&quot;</span><span style="color:#393A34;--shiki-dark:#F6F6F4">, </span><span style="color:#59873A;font-style:inherit;--shiki-dark:#62E884;--shiki-dark-font-style:italic">age</span><span style="color:#393A34;--shiki-dark:#F6F6F4">: </span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#999999;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 0</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">name</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name</span></span>
<span class="line"><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic">        self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">age</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> age</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        observeProperties</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    private</span><span style="color:#AB5959;--shiki-dark:#F286C4"> func</span><span style="color:#59873A;--shiki-dark:#62E884"> observeProperties</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> name</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> age</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span><span style="color:#998418;--shiki-dark:#97E1F1"> onChange</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> [</span><span style="color:#1E754F;--shiki-dark:#F286C4">weak</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#393A34;--shiki-dark:#F6F6F4">] </span><span style="color:#1E754F;--shiki-dark:#F286C4">in</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">            guard</span><span style="color:#1E754F;--shiki-dark:#F286C4"> let</span><span style="color:#A65E2B;font-style:inherit;--shiki-dark:#BF9EEE;--shiki-dark-font-style:italic"> self</span><span style="color:#1E754F;--shiki-dark:#F286C4"> else</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span><span style="color:#1E754F;--shiki-dark:#F286C4"> return</span><span style="color:#999999;--shiki-dark:#F6F6F4"> }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">            objectWillChange.</span><span style="color:#998418;--shiki-dark:#97E1F1">send</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            observeProperties</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<blockquote>
<p>If necessary, you can use custom macros to complete the repetitive work of introducing all observable properties in the observeProperties method.</p>
</blockquote>
<h2 id="can-obervable-and-observableobject-coexist-in-a-view">Can @Obervable and ObservableObject coexist in a view?</h2>
<p>Sure. In a single view, it is possible for observable objects declared in different ways to coexist.</p>
<p>For example, an Observation object that conforms to both types of observation pathways mentioned earlier (an observable object conforming to <code>ObservableObject</code>), when declared with <code>@StateObject</code>, will cause the view to respond to both types of observation. If declared with <code>@State</code>, the view will respond only in the manner defined by the observation’s method.”</p>
<h2 id="does-observable-support-nesting-where-the-property-of-one-observable-is-another-observable">Does Observable support nesting (where the property of one Observable is another Observable)?</h2>
<p>Support.</p>
<p>Since <code>@Published</code> only supports value types, it is difficult to implement nested logic for observable objects that conform to the ObservableObject protocol:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">ObservableObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">ObserableObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 10</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">a.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // Does not trigger view update</span></span></code></pre></div>
<p>I once wrote a <code>@PublishedObject</code> property wrapper to solve this problem. For more information, please read the article “<a href="/en/posts/adding-published-ability-to-custom-property-wrapper-types/" target="_blank">Going Beyond @Published:Empowering Custom Property Wrappers</a>”. In principle, <code>@PublishedObject</code> uses the <code>objectWillChange</code> of the external object A (<em>enclosing instance</em>) to notify A’s subscribers when the property of B changes. In other words, a highly coupled approach is used to achieve nesting of observable objects.</p>
<p>However, nesting of observable objects created through the Observation framework is much simpler. When creating an observation operation with <code>withObservationTracking</code>, every observable property that is read will actively create a relationship with the subscriber. It can be correctly tracked regardless of its position in the relationship chain or how it exists (such as arrays, dictionaries, etc.).</p>
<p>For example:</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observabl</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">   var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">   var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observable</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">   var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">withObservationTracking</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">   let</span><span style="color:#998418;--shiki-dark:#BF9EEE"> _</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span><span style="color:#998418;--shiki-dark:#97E1F1"> onChange</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">    print</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">update</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>For the above code, both of the following two methods will invoke the onChange closure (only called once).</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">a.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#393A34;--shiki-dark:#F6F6F4">.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">// or</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#F6F6F4">a.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#AB5959;--shiki-dark:#F286C4"> =</span><span style="color:#998418;--shiki-dark:#97E1F1"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span></code></pre></div>
<p>In the line <code>let _ = a.b.b</code>, observations are created for two observable properties from different objects and different levels, <code>a.b</code> and <code>b.b</code>. This is the strength of the Observation framework.</p>
<h2 id="observation-has-the-performance-issue-of-observableobject-been-resolved">Observation: Has the performance issue of ObservableObject been resolved?</h2>
<p>Yes, the Observation framework has improved the performance of observable objects in SwiftUI from two aspects:</p>
<ul>
<li>By observing observable properties in views instead of observable objects, a lot of unnecessary view updates can be reduced.</li>
<li>Compared to the publisher-subscriber model of Combine, the callback mechanism of Observation is more efficient.</li>
</ul>
<p>However, because the Observation framework does not yet support creating sustainable observation behaviors, views need to recreate observation operations every time they are evaluated. We need more time to evaluate whether this will cause new performance issues.</p>
<h2 id="will-the-observation-framework-affect-swiftui-programming-habits">Will the Observation framework affect SwiftUI programming habits?</h2>
<p>For me, yes.</p>
<p>For example, currently, developers usually use structs to build the state model of the application. After using the Observation framework, in order to implement property-level observation, we should use the Observation framework to create observable objects, and even build the state model with nested observable objects.</p>
<p>In addition, many of the optimization techniques we used in the views will also change. For example, when using ObservableObject, we will reduce unnecessary refresh by only introducing data that is useful for the current view.</p>
<blockquote>
<p>For more optimization techniques for views, please read the article “<a href="/en/posts/avoid_repeated_calculations_of_swiftui_views/" target="_blank">How to Avoid Repeating SwiftUI View Updates</a>”.</p>
</blockquote>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">ObservableObject </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">Published</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">hello</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Root</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">StateObject</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        VStack</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            A</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">a</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">a</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            B</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">b</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">Int</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B">    // only get a(Int)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body:</span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">store.</span><span style="color:#B56959;--shiki-dark:#F6F6F4">a</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span><span style="color:#A0ADA0;--shiki-dark:#7B7F8B"> // only get b(String)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b:</span><span style="color:#998418;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">String</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body:</span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>When <code>store.b</code> changes, only the Root and B views will be re-evaluated.</p>
<p>After switching to the Observation framework, the optimization strategy mentioned above will no longer be the optimal solution. Instead, the previously discouraged method is more suitable for the new observable objects.</p>
<div>
        <div class="flex justify-between items-center h-8 font-semibold bg-block border border-gray-200 dark:border-[#4b5563] shadow-md text-heading text-xs rounded-tl-md rounded-tr-md">
          <span class="px-4 py-1">Swift</span>
          <button class="copy-button py-1 px-4" onclick="copyCode(this, event)">
          <div class="copy-text">
            <span class="flex items-center justify-center sm:hover:text-secondary">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                <use xlink:href="#icon-clipboard"></use>
              </svg>
            </span>
          </div>
          <div class="copied-text hidden">
            <span class="flex items-center justify-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" stroke="currentColor">
                  <use xlink:href="#icon-check"></use>
             </svg>
              Copied!
            </span>
          </div>
        </button>
        </div>
      <pre class="astro-code astro-code-themes vitesse-light dracula-soft" style="background-color:#ffffff;--shiki-dark-bg:#282A36;color:#393a34;--shiki-dark:#f6f6f4;overflow-x:auto" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#999999;--shiki-dark:#F286C4">@</span><span style="color:#AB5959;--shiki-dark:#F286C4">Observabl</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">class</span><span style="color:#2E8F82;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> a </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#2F798A;--shiki-dark:#BF9EEE"> 1</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> b </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#B5695977;--shiki-dark:#DEE492"> &quot;</span><span style="color:#B56959;--shiki-dark:#E7EE98">hello</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> Root</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F286C4">    @</span><span style="color:#AB5959;--shiki-dark:#F286C4">State</span><span style="color:#1E754F;--shiki-dark:#F286C4"> var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store </span><span style="color:#AB5959;--shiki-dark:#F286C4">=</span><span style="color:#998418;--shiki-dark:#97E1F1"> Store</span><span style="color:#999999;--shiki-dark:#F6F6F4">()</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body: </span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        VStack</span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            A</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">            B</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#998418;--shiki-dark:#97E1F1">store</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> A</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store: Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body:</span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F286C4">\(</span><span style="color:#B56959;--shiki-dark:#E7EE98">store.</span><span style="color:#B56959;--shiki-dark:#F6F6F4">a</span><span style="color:#B56959;--shiki-dark:#F286C4">)</span><span style="color:#B5695977;--shiki-dark:#DEE492">&quot;</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#F286C4">struct</span><span style="color:#2E8F82;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic"> B</span><span style="color:#999999;--shiki-dark:#F6F6F4">:</span><span style="color:#59873A;font-style:inherit;--shiki-dark:#97E1F1;--shiki-dark-font-style:italic">View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    let</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> store: Store</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#F286C4">    var</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> body:</span><span style="color:#1E754F;--shiki-dark:#F286C4">some</span><span style="color:#393A34;--shiki-dark:#F6F6F4"> View </span><span style="color:#999999;--shiki-dark:#F6F6F4">{</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#97E1F1">        Text</span><span style="color:#999999;--shiki-dark:#F6F6F4">(</span><span style="color:#393A34;--shiki-dark:#F6F6F4">store.</span><span style="color:#B07D48;--shiki-dark:#F6F6F4">b</span><span style="color:#999999;--shiki-dark:#F6F6F4">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#F6F6F4">}</span></span></code></pre></div>
<p>Only properties that appear in the body and are read will trigger a view update. After modification, only the B view will be re-evaluated when <code>store.b</code> changes.</p>
<p>As the Observation framework is still a new thing, its API is also constantly evolving. As more and more SwiftUI applications are converted to this framework, developers will summarize more experience of use.</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="conclusion-1">Conclusion</h2>
<p>Through the discussion in this article, readers should have gained a better understanding of the Observation framework and how it can improve the performance of SwiftUI. Although the Observation framework is currently tightly integrated with SwiftUI, with the enrichment of its API, it is believed that it will appear in more and more application scenarios, not just limited to SwiftUI.</p> </div> </article> <script type="module" src="/_astro/WeeklySubscribeModal.astro_astro_type_script_index_0_lang.Bs-YSeM_.js"></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Modal backdrop with flex centering --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 items-center justify-center"> <div id="default-modal" class="hidden relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">Every Monday, sharing handpicked Swift and SwiftUI development highlights with you.</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script type="module" src="/_astro/WeeklySubscribe1.astro_astro_type_script_index_0_lang.BKbVN22B.js"></script> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">Continue Reading</button> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2023-06-19T00:12:00.000Z",
  "datePublished": "2023-06-19T00:12:00.000Z",
  "description": "Explore the Observation framework in Swift 5.9: Learn its creation, usage, and benefits for SwiftUI performance. Understand how it improves upon KVO and Combine. ",
  "headline": "A Deep Dive Into Observation: A New Way to Boost SwiftUI Performance",
  "image": {
    "@type": "ImageObject",
    "url": [
      {
        "url": "https://cdn.fatbobman.com/card/mastering-observation-en.png"
      }
    ]
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/mastering-observation/"
  },
  "url": "https://fatbobman.com/en/posts/mastering-observation/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">Get weekly handpicked updates on Swift and SwiftUI!</div> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver(() => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        // const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <svg class="w-5 h-5 me-2 -ms-1" fill="none" stroke="none" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-buymecoffee"></use> </svg> <span class="text-black font-bold">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0">  <button type="button" class="bg-[#3b82f6] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.paypal.com/paypalme/fatbobman')"> <svg width="24" height="24" class="w-4 h-4 me-2 -ms-1" aria-hidden="true" stroke="none"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-paypal"></use> </svg> <span class="text-white font-bold hover:text-yellow-100">Donate via Paypal</span> </button> </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/en";

  // 根据中英文对应不同的 adCacheKey
  const adCacheKey = 'dynamicAdCache' + (window.location.pathname.includes('/zh/') ? 'ZH' : 'EN');

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">Related Posts</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">Related Posts</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/avoid_repeated_calculations_of_swiftui_views/" id="relatedPosts-How to Avoid Repeating SwiftUI View Updates"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">How to Avoid Repeating SwiftUI View Updates</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/swiftuilifecycle/" id="relatedPosts-Lifecycle of SwiftUI Views"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Lifecycle of SwiftUI Views</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/weekly/issue-066" id="relatedPosts-Weekly #66 - Integrating AI into the Daily Workflow"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #66 - Integrating AI into the Daily Workflow</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/stateobject_and_observedobject/" id="relatedPosts-SwiftUI’s StateObject and ObservedObject: The Key Differences"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">SwiftUI’s StateObject and ObservedObject: The Key Differences</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/the_composable_architecture/" id="relatedPosts-The Composable Architecture (TCA)"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">The Composable Architecture (TCA)</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/swiftui-state/" id="relatedPosts-@State Research in SwiftUI"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">@State Research in SwiftUI</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="深度解读 Observation —— SwiftUI 性能提升的新途径" data-lang="en"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" defer></script></div>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        const response = await fetch('https://fatbobman.com/status/comment');
        const data = await response.text();
        console.log(data);
        if (data === '1') {
          var container = document.getElementById('gitalk-container');
          if (container) {
            var commentID = container.getAttribute('data-comment-id');
            var lang = container.getAttribute('data-lang');

            var gitalk = new Gitalk({
              clientID: 'fcf61195c7f73253dc8b',
              clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
              repo: 'blogComments',
              owner: 'fatbobman',
              admin: ['fatbobman'],
              id: commentID.split('/').pop().substring(0, 49),
              distractionFreeMode: true,
              createIssueManually: true,
              language: lang,
            });

            gitalk.render('gitalk-container');
          }
        }
      });
    </script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-end pb-2" id="toc-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#why-create-the-observation-framework" class=""> Why create the Observation framework </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#how-to-declare-an-observable-object" class=""> How to Declare an Observable Object </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#what-did-observable-do" class=""> What did @Observable do </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#how-to-use-observable-objects-in-views" class=""> How to Use Observable Objects in Views </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#declaring-observable-objects-in-views" class=""> Declaring Observable Objects in Views </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#injecting-observable-objects-into-the-view-hierarchy-using-environment" class=""> Injecting Observable Objects into the View Hierarchy Using Environment </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#passing-observable-objects-in-views" class=""> Passing Observable Objects in Views </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#creating-a-binding-type" class=""> Creating a Binding Type </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#does-the-observation-framework-support-older-versions-of-swiftui?" class=""> Does the Observation framework support older versions of SwiftUI? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#how-to-observe-observable-objects" class=""> How to observe observable objects </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#what-is-the-observation-principle-of-the-observation-framework?" class=""> What is the observation principle of the Observation framework? </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#creating-observation-phase" class=""> Creating observation phase </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#when-the-observed-property-is-about-to-change" class=""> When the observed property is about to change </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#conclusion" class=""> Conclusion </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#how-to-observe-property-changes-in-swiftui-views" class=""> How to observe property changes in SwiftUI views </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#can-a-class-annotated-with-observable-still-conform-to-the-observableobject-protocol?" class=""> Can a class annotated with @Observable still conform to the ObservableObject protocol? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#can-obervable-and-observableobject-coexist-in-a-view?" class=""> Can @Obervable and ObservableObject coexist in a view? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#does-observable-support-nesting-where-the-property-of-one-observable-is-another-observable?" class=""> Does Observable support nesting (where the property of one Observable is another Observable)? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#observation-has-the-performance-issue-of-observableobject-been-resolved?" class=""> Observation: Has the performance issue of ObservableObject been resolved? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#will-the-observation-framework-affect-swiftui-programming-habits?" class=""> Will the Observation framework affect SwiftUI programming habits? </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#conclusion" class=""> Conclusion </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/en/posts/new-features-of-scrollview-in-swiftui5/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Deep Dive into the New Features of ScrollView in SwiftUI 5</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/new-features-of-scrollview-in-swiftui5/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/en/posts/mastering-transaction/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-next"></use> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>The Secret to Flawless SwiftUI Animations: A Deep Dive into Transactions</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/mastering-transaction/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=A%20Deep%20Dive%20Into%20Observation%3A%20A%20New%20Way%20to%20Boost%20SwiftUI%20Performance&url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmastering-observation%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-twitter"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=A%20Deep%20Dive%20Into%20Observation%3A%20A%20New%20Way%20to%20Boost%20SwiftUI%20Performance%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmastering-observation%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Fmastering-observation%252F" target="_blank" id="sidebar-share-with-facebook"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-facebook"></use> </svg> </a>  </div>  <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmastering-observation%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-linkedin"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="mailto:?subject=Article%3A%E3%80%90A%20Deep%20Dive%20Into%20Observation%3A%20A%20New%20Way%20to%20Boost%20SwiftUI%20Performance%E3%80%91&#38;body=Here's%20an%20article%20you%20may%20find%20interesting%3A%0A%0AA%20Deep%20Dive%20Into%20Observation%3A%20A%20New%20Way%20to%20Boost%20SwiftUI%20Performance%0A%0ALink%3A%20https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fmastering-observation%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-email"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" id="comment-button" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-comment"></use> </svg>  </div> <script>
  const SCROLL_OFFSET = 80;
  
  document.addEventListener('DOMContentLoaded', function() {
    const commentButton = document.getElementById('comment-button');
    if (commentButton) {
      commentButton.addEventListener('click', function() {
        const gitalkContainer = document.getElementById('gitalk-container');
        if (gitalkContainer) {
          const topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: topPosition, behavior: 'smooth' });
        }
      });
    }
  });
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/_astro/iconCollection.BDk6xFEU.svg#icon-top"></use> </svg>  </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.XHrm3OJt.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Website</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">Health Notes</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Follow</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">Newsletter</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a>  <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Info</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/about/" class="hover:text-secondary">About</a> <a href="/en/sponsorship/" class="hover:text-secondary"> Sponsor </a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright ©  2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js" async></script> <script>
  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', () => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"搜索",buttonAriaLabel:"搜索"},modal:{searchBox:{resetButtonTitle:"清除搜索关键字",resetButtonAriaLabel:"清除搜索关键字",cancelButtonText:"取消",cancelButtonAriaLabel:"取消"},startScreen:{recentSearchesTitle:"最近搜索",noRecentSearchesText:"当前没有搜索历史记录",saveRecentSearchButtonTitle:"保存本次搜索",removeRecentSearchButtonTitle:"从搜索历史中移除",favoriteSearchesTitle:"收藏夹",removeFavoriteSearchButtonTitle:"从收藏夹移除"},errorScreen:{titleText:"无法获取结果",helpText:"请检查网络连接"},footer:{selectText:"选择",selectKeyAriaLabel:"选择",navigateText:"切换",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"退出",closeKeyAriaLabel:"Escape key",searchByText:"引擎支持"},noResultsScreen:{noResultsText:"无法找到对应结果",suggestedQueryText:"可以尝试搜索如下内容",reportMissingResultsText:"确认本次搜索应该返回内容？",reportMissingResultsLinkText:"请告知我们"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> <!--Magic Fix 解决在 Safari 下搜索框取消后会滚动到页面底部--> <div class="fixed"> <input type="text"> </div> </body></html>
<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><!-- <link rel="shortcut icon" href={iconSVG.src} /> --><link rel="icon" type="image/png" sizes="16x16" href="/_astro/favicon-16x16.2312221518-2.DhhY-2ao.png"><link rel="icon" type="image/png" sizes="32x32" href="/_astro/favicon-32x32.2312221518-2.BbUzUdRZ.png"><link rel="mask-icon" href="/_astro/faviconSVG-32x32.2312221518-2.ll_gTgJS.svg"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.2312227635.BE1WvNvp.png"><title>Old Man New Soldier - A Development Memoir of an iOS APP | Fatbobman&#39;s Blog</title>
<meta name="description" content="A developer’s journey of relearning programming &amp; building an iOS app, Health Notes, using SwiftUI, Combine, &amp; Core Data. Learn about challenges, tips, &amp; insights.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://fatbobman.com/en/posts/healthnote_development_log_2020/">
<meta property="og:title" content="Old Man New Soldier - A Development Memoir of an iOS APP | Fatbobman&#39;s Blog">
<meta property="og:description" content="A developer’s journey of relearning programming &amp; building an iOS app, Health Notes, using SwiftUI, Combine, &amp; Core Data. Learn about challenges, tips, &amp; insights.">
<meta property="og:url" content="https://fatbobman.com/en/posts/healthnote_development_log_2020/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://fatbobman.com/images/blog-card.png">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="fatbobman.com">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@fatbobman">
<meta name="twitter:creator" content="@fatbobman"><link rel="alternate" type="application/rss+xml" title="RSS Feed for My Website" href="https://fatbobman.com/en/rss.xml"><link rel="sitemap" href="/sitemap-index.xml"><meta name="keywords" content="Swift 编程,Swift Programming,SwiftUI 教程,SwiftUI Tutorials,Core Data 实践,Core Data Practices,SwiftData 应用,SwiftData Applications,iOS 开发,iOS Development,Swift UI 设计,Swift UI Design,Swift 性能优化,Swift Performance Optimization,Swift 编码技巧,Swift Coding Techniques,iOS 应用开发,iOS App Development,Swift 数据管理,Swift Data Management,SwiftUI 布局,SwiftUI Layout,SwiftUI 动画,SwiftUI Animation"><meta name="apple-mobile-web-app-title" content="Fatbobman's Blog"><link rel="alternate" hreflang="en" href="https://fatbobman.com/en/posts/healthnote_development_log_2020/"><link rel="alternate" hreflang="zh" href="https://fatbobman.com/zh/posts/healthnote_development_log_2020/"><!-- <BasicScripts /> --><!-- <script is:inline>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?14e5d60a3ea6276655f9d14c58b1fcd0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> --><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5C7N4MF5');</script> <!-- End Google Tag Manager --><script>
      // Immediately set theme before page renders
      if (
        localStorage.getItem('color-theme') === 'dark' ||
        (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('dark');
      }
    </script><link rel="stylesheet" href="/_astro/about.BQ_9qyzD.css">
<link rel="stylesheet" href="/_astro/about.X3vGeUiH.css">
<link rel="stylesheet" href="/_astro/_slug_.Bvjfq7nf.css">
<style>.sticky[data-astro-cid-4wsjtibl]{position:fixed;top:0;left:50%;transform:translate(-50%);width:100%;max-width:100%}
</style></head> <body class="antialiased text-default bg-page">  <div class="flex flex-col min-h-screen justify-between "> <div> <header> <div class="bg-block" id="wholeHeader" data-astro-cid-4wsjtibl> <div id="blogTitle"> <a href="/en/"> <div class="flex space-x-4 mx-auto text-center pt-16 sm:pt-12 font-black w-[240px] sm:w-[300px] pb-6 sm:pb-1"> <svg class="text-heading" width="337" height="63"> <use href="/images/title-fatbobman.svg#main"></use> </svg> <svg class="text-primary mt-[-6px] sm:mt-[-5px]" width="130" height="91"> <use href="/images/title-blog.svg#main"></use> </svg> </div> </a> </div> <div class="bg-block z-50 shadow-custom-light dark:shadow-custom-dark" id="stickyHeader" data-astro-cid-4wsjtibl> <div class="max-w-5xl flex flex-wrap items-center justify-between mx-auto p-2 sm:p-0" data-astro-cid-4wsjtibl> <div class="flex space-x-2" data-astro-cid-4wsjtibl> <div id="lang-data" data-lang="en" style="display: none;"></div> <button id="language-dropdown-button" data-dropdown-toggle="language-dropdown-menu" type="button" class="p-2 w-10 h-10 font-medium text-default hover:text-secondary hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg"> EN </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-page divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="language-dropdown-menu"> <ul class="py-2 font-medium text-sm" role="none"> <li> <a href class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
English
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="EN-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <a href="/zh/posts/healthnote_development_log_2020/" class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem"> <div class="inline-flex items-center">
中文
<svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 ml-2 hidden text-primary" id="ZH-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6.979 3.074a6 6 0 0 1 4.988 1.425l.037 .033l.034 -.03a6 6 0 0 1 4.733 -1.44l.246 .036a6 6 0 0 1 3.364 10.008l-.18 .185l-.048 .041l-7.45 7.379a1 1 0 0 1 -1.313 .082l-.094 -.082l-7.493 -7.422a6 6 0 0 1 3.176 -10.215z" stroke-width="0" fill="currentColor"></path></svg> </div> </a> </li> <li> <div class="border-t border-gray-200 dark:border-gray-800 w-4/5 mx-auto my-2"></div> <button class="block px-4 py-2 text-default hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" role="menuitem" id="set-default-lang"> <div class="inline-flex items-center"> Set English as Default </div> </button> </li> </ul> </div> <script type="module" src="/_astro/LanguageButton.astro_astro_type_script_index_0_lang.D258ff8M.js"></script> <button id="theme-dropdown-button" data-dropdown-toggle="theme-dropdown-menu" type="button" class="group p-2 w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg viewBox="0 0 24 24" id="theme_icon_system" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <svg viewBox="0 0 24 24" id="theme_icon_dark" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <svg viewBox="0 0 24 24" id="theme_icon_light" class="w-5 h-5 text-default fill-current group-hover:text-secondary hidden" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> </button> <!-- Dropdown --> <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700" id="theme-dropdown-menu"> <ul class="py-2 font-medium" role="none"> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_light"> <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current" astro-icon="tabler:sun"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></g></svg> <span class="ml-2 dark:hover:text-white">Light</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_dark"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></svg> <span class="ml-2 text-default dark:hover:text-white">Dark</span> </button> </li> <li class="hover:bg-gray-100 dark:hover:bg-gray-600"> <button class="flex px-4 py-2 text-sm align-text-center dark:hover:text-white text-default" id="theme_button_system"> <svg viewBox="0 0 24 24" class="w-5 h-5" astro-icon="tabler:device-laptop"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon-tabler"><path d="M3 19h18"/><rect width="14" height="10" x="5" y="6" rx="1"/></g></svg> <span class="ml-2 dark:hover:text-white">System</span> </button> </li> </ul> </div> <script>
  (async () => {
    const { setTheme } = await import('/js/theme.js');
    // Use setTheme here
    // Change the icons inside the button based on previous settings
    // 如果 localStorage 里面有设置过 color-theme 的值, 则 themeToggleSystemIcon.classList.remove('hidden')
    function setThemeButton() {
      let theme = localStorage.getItem('color-theme');
      if (theme === 'dark') {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else if (theme === 'light') {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleSystemIcon.classList.add('hidden');
      } else {
        themeToggleDarkIcon.classList.add('hidden');
        themeToggleLightIcon.classList.add('hidden');
        themeToggleSystemIcon.classList.remove('hidden');
      }
    }

    // 监听暗黑模式的变化
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
      setThemeButton();
    });

    // 保证其他的页面也能够监听到 localStorage 的变化
    window.addEventListener('storage', function (event) {
      if (event.key === 'color-theme') {
        setThemeButton();
      }
    });

    function resetTheme() {
      setTheme();
      setThemeButton();
    }

    // 获取按钮
    var themeButtonLight = document.getElementById('theme_button_light');
    var themeButtonDark = document.getElementById('theme_button_dark');
    var themeButtonSystem = document.getElementById('theme_button_system');
    // 获取图标
    var themeToggleDarkIcon = document.getElementById('theme_icon_dark');
    var themeToggleLightIcon = document.getElementById('theme_icon_light');
    var themeToggleSystemIcon = document.getElementById('theme_icon_system');

    // Listen for clicks on the button themeToggleDarkIcon
    themeButtonDark.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'dark');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleLightIcon
    themeButtonLight.addEventListener('click', function () {
      localStorage.setItem('color-theme', 'light');
      resetTheme();
    });

    // // Listen for clicks on the button themeToggleSystemIcon
    themeButtonSystem.addEventListener('click', function () {
      localStorage.removeItem('color-theme');
      resetTheme();
    });

    resetTheme();
  })();
</script> <div id="docsearch" class="group w-10 h-10 text-default hover:bg-gray-100 dark:hover:bg-page focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600 rounded-lg flex items-center justify-center"> <svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg> </div> </div> <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 mx-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false" id="navbar-toggle-button"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5 text-default" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <nav class="hidden w-full md:block md:w-auto px-4 z-40" id="navbar-solid-bg"> <ul class="flex flex-col font-bold mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700"> <a href="/en/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Home </a><a href="/en/posts/" class="block py-2 px-3 md:p-0 rounded text-invert bg-secondary md:bg-transparent md:text-secondary md:dark:bg-transparent" aria-current="page"> Articles </a><a href="/en/weekly/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Weekly </a><a href="/en/snippet/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> Quick Tips </a><a href="/en/about/" class="block py-2 px-3 md:p-0 rounded  text-heading md:hover:text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 md:hover:bg-transparent md:dark:hover:bg-transparent"> About </a> </ul> </nav> <script type="module" src="/_astro/Navbar.astro_astro_type_script_index_0_lang.BaBuaNi4.js"></script> </div> </div> <div id="placeholder" class="hidden" data-astro-cid-4wsjtibl></div> </div> <script>(function(){const enableSticky = true;
const enableStickyInMobile = true;

  window.onload = function () {
    checkStickyHeader();
    stickySetup();
  };

  window.addEventListener('resize', stickySetup);

  function checkStickyHeader() {
    const title = document.getElementById('blogTitle');
    const stickyHeader = document.getElementById('stickyHeader');
    const placeholder = document.getElementById('placeholder');

    if (title && stickyHeader && placeholder) {
      const offset = title.offsetTop + title.offsetHeight;

      if (shouldStick() && window.scrollY >= offset) {
        stickyHeader.classList.add('sticky');
        placeholder.style.display = 'block';
        placeholder.style.height = `${stickyHeader.offsetHeight}px`;
      } else {
        stickyHeader.classList.remove('sticky');
        placeholder.style.display = 'none';
      }
    }
  }

  function shouldStick() {
    if (!enableSticky) return false;

    let isMobile = window.matchMedia('(max-width: 640px)').matches;
    if (isMobile && !enableStickyInMobile) return false;

    return true;
  }

  function stickySetup() {
    window.onscroll = checkStickyHeader;
  }
})();</script>  </header> <main class="w-full mx-auto max-w-3xl p-4 md:p-6 "> <div class="container mx-auto space-y-6 sm:space-y-12">   <div class="mx-auto space-y-4 text-center py-10" style="width:80%"> <div class="flex mx-auto justify-center"> <div class="flex mx-auto justify-center"> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/en/tags/Dev Diary/">
#Dev Diary </a> <a class="text-xs font-medium sm:font-semibold mx-2 text-muted hover:text-secondary" href="/zh/posts/healthnote_development_log_2020/" id="language-switcher-for-topic"> #中文版 </a> </div> </div> <h1 class="text-2xl font-bold leadi md:text-3xl text-heading">Old Man New Soldier - A Development Memoir of an iOS APP</h1> <p class="text-sm text-default"> <a itemprop="author" href="https://x.com/intent/follow?screen_name=fatbobman" target="_blank" class="hover:text-secondary font-medium">Fatbobman</a> <!-- <time datetime={`${post.data.publishDate.toISOString()}`}>{date}</time> --> </p> <p class="text-xs text-muted"> Published on <time datetime="2022-09-06T00:12:00.000Z">Sep 6, 2022</time>  </p> </div> <svg style="display: none;"> <symbol id="icon-clipboard" viewBox="0 0 1024 1024"> <path d="M426.666667 42.666667l170.666667 0q41.344 0 74.325333 23.850667t46.336 61.482667l50.005333 0q52.992 0 90.496 37.504t37.504 90.496l0 597.333333q0 52.992-37.504 90.496t-90.496 37.504l-512 0q-52.992 0-90.496-37.504t-37.504-90.496l0-597.333333q0-52.992 37.504-90.496t90.496-37.504l50.005333 0q13.312-37.674667 46.336-61.482667t74.325333-23.850667zM768 213.333333l-50.005333 0q-13.312 37.674667-46.336 61.482667t-74.325333 23.850667l-170.666667 0q-41.344 0-74.325333-23.850667t-46.336-61.482667l-50.005333 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333l0 597.333333q0 17.664 12.501333 30.165333t30.165333 12.501333l512 0q17.664 0 30.165333-12.501333t12.501333-30.165333l0-597.333333q0-17.664-12.501333-30.165333t-30.165333-12.501333zM597.333333 128l-170.666667 0q-17.664 0-30.165333 12.501333t-12.501333 30.165333 12.501333 30.165333 30.165333 12.501333l170.666667 0q17.664 0 30.165333-12.501333t12.501333-30.165333-12.501333-30.165333-30.165333-12.501333z"></path> </symbol> <symbol id="icon-check" viewBox="0 0 1024 1024"> <path d="M421.858 683.366l401.796-448.518c18.66-20.828 50.668-22.586 71.498-3.928 20.828 18.66 22.586 50.67 3.928 71.498L463.638 788.494c-18.606 20.768-50.5 22.586-71.344 4.066l-263.29-233.924c-20.906-18.572-22.796-50.576-4.222-71.48 18.574-20.906 50.576-22.796 71.48-4.222L421.86 683.366z"></path> </symbol> </svg> <div class="relative" id="article-area"> <article class="prose dark:prose-invert mx-auto w-full"> <div> 

<p>This article was written by me in early 2020, documenting my journey of relearning programming. Looking back now, although some of the technical understandings mentioned in the article may seem naive (<strong>please ignore the technical details in this article</strong>), it is still quite interesting. Coincidentally, the number of articles on my blog has reached 100, so I have brought this article back to remind myself of my original intentions.</p>
<ul>
<li>
<p>The name of the app is <a href="https://apps.apple.com/us/app/health-notes-for-everyone/id1534513553?&utm_source=Fatbobman%20Blog&utm_medium=web&utm_campaign=Fatbobman%20Blog" rel="noreferrer noopener">Health Notes</a>., Health Notes provides a powerful custom data type feature to meet the need of recording data for most of the health items in your life. You can create individual health data recording notes for each family member, or create corresponding notes for a specific item or a specific period of time.</p>
</li>
</ul>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="foreword">Foreword</h2>
<p>I started using computers at a relatively early age (my first computer model was the CP-80, with an MC6800 CPU), and I began learning programming early as well (starting with the Chinese learning machine and the domestic Apple II compatible machine). I have always been interested in computers and programming, but have never truly made writing code my profession. Although I have used several programming languages to write some code on different platforms, none of them could be considered a complete product. I habitually keep up with the latest trends in the information industry and some new technological directions, but due to business and other reasons, I have not touched programming at all since more than 10 years ago.</p>
<p>In the past 6-7 years, due to illness, my energy has been mainly focused on treatment. As someone who dislikes taking notes, I need to record a large amount of data every day due to treatment needs (although I mainly rely on my wife). Two years ago, through surgery, my illness greatly improved and I thought I would need to record less data. However, things did not go as planned. While the amount of data decreased, the number of data types greatly increased, and it is clear that these data will need to be recorded throughout my lifetime.</p>
<p><picture>
                    <source media="(max-width: 479px)" srcset="https://cdn.fatbobman.com/v2-e7d830909ff35974d795b314a12adcff_1440w.jpeg?imageView2/0/w/500"/>
                    <source media="(max-width: 767px)" srcset="https://cdn.fatbobman.com/v2-e7d830909ff35974d795b314a12adcff_1440w.jpeg?imageView2/0/w/768"/>
                    <source media="(max-width: 1024px)" srcset="https://cdn.fatbobman.com/v2-e7d830909ff35974d795b314a12adcff_1440w.jpeg?imageView2/0/w/1024"/>
                    <img src="https://cdn.fatbobman.com/v2-e7d830909ff35974d795b314a12adcff_1440w.jpeg" alt="https://cdn.fatbobman.com/v2-e7d830909ff35974d795b314a12adcff_1440w.jpeg" loading="lazy" decoding="async"/>
                  </picture></p>
<p>The lab report in the above figure is the blood test results within the past year.</p>
<p>I have also used spreadsheets to organize data before, but it was not convenient. With the abundance of apps available today, I have tried many of them to attempt centralized management, but the results were not satisfactory. Considering that my body has already recovered to a good state, I decided to try and create an app that meets my own needs. On one hand, it can exercise my brain, and on the other hand, it can help me regain my interest in the current field.</p>
<p>In the past decade, the development of information technology has been enormous, and many new technologies, methods, concepts, and previously unimaginable computing power upgrades have posed a significant challenge to me as an old rookie.</p>
<h2 id="selection-of-development-platform-and-framework">Selection of Development Platform and Framework</h2>
<p>As a long-time user of Apple products (from Apple II-compatible machines, Apple II, grayscale PowerBooks, pseudo-color PowerBooks, several generations of iMacs, MacBook Pros, and numerous other Apple products), developing an app for use on iOS is a natural idea.</p>
<p>This app is mainly aimed at people like me who have a long-term interest in managing and analyzing health-related data.</p>
<p>I once considered using a cross-platform development framework, but ultimately chose native development for the following reasons:</p>
<ul>
<li>I don’t have any Android devices around me</li>
<li>Limited ability and energy, unable to do large-scale adaptation</li>
<li>When I had plans to develop, it happened shortly after the end of WWDC 2019, and Apple’s new SwiftUI, Combine, and new features in Core Data were very attractive to me</li>
<li>Driven by interest, there is no commercial pressure or historical burden, so immature or uncertain technologies can be directly adopted</li>
</ul>
<p>After some research, I finally chose the combination of SwiftUI + Combine + Core Data. There are both blessings and hardships, and there will be more explanations in the following text.</p>
<h2 id="technical-preparation">Technical Preparation</h2>
<p>My biggest concern after not touching code for over a decade is not that my knowledge reserve is insufficient, but rather that I’ve lost my feel for it. Unfortunately, my worries were confirmed.</p>
<p>I’ve encountered many programming languages before, so understanding the basic syntax of a programming language isn’t a problem for me. The challenge lies in how to utilize its features. Although the learning cost of Objective-C is higher than that of Swift, after version 5.0, Swift has gradually become stable. Thus, Swift is currently a good choice for iOS development, as it’s faster and more efficient.</p>
<p>I bought a few beginner’s books on Swift (they were truly basic) and read them twice. I thought it wouldn’t be difficult to read other people’s code, but I found that I couldn’t understand much of it because most Swift code uses generics, functional programming, and other features that are only briefly mentioned in beginner’s books. Fortunately, I found some excellent books written by ObjCCN that helped me gain more knowledge and understanding of Swift. Although some of the materials were difficult to comprehend, I persevered, and the rewards were great.</p>
<p>After mastering the basic syntax of Swift, I began to learn SwiftUI. Initially, I read Apple’s official documentation and examples. As someone who lacks experience with UIKit, I didn’t immediately feel the benefits of declarative programming (my last programming memory was in the unreleased period of Django, when I first encountered the MVC pattern). It wasn’t until I needed to mix SwiftUI with UIKit to develop a particular feature that I truly appreciated the advantages of declarative programming.</p>
<p>The examples in Apple’s official materials were good, but when I tried to use them as a blueprint to create a complete app, I didn’t know where to start. Thus, I want to thank ObjCCN’s Wang Wei for his book on SwiftUI and Combine programming. I started reading it when it was available for pre-order, and I’ve benefited greatly from it. Specifically, I now have a more comprehensive understanding of the reactive ideas behind Combine. Strictly speaking, SwiftUI cannot be separated from Combine, but Combine can be integrated with other frameworks.</p>
<p>Compared to declarative thinking, reactive programming has brought me more shock. Especially in the later development process, as I deepened my understanding, I increasingly felt its charm.</p>
<p>With a certain technical foundation in implementing app UI, I started to consider the choice of data persistence with database.</p>
<p>I have used relational databases a long time ago, so I have some foundation. But I had no idea what kind of product or framework should be used on the mobile side. I thought that since it is an interest project, I can take the opportunity to learn more about popular mobile data persistence solutions. I read some NoSQL materials and also touched on some mainstream cloud data solutions, each with its own characteristics, and I couldn’t make up my mind for a while.</p>
<p>Actually, I planned to use Core Data at the beginning, but because there is not much information about it and the learning curve is steep, and also I feel that domestic app developers generally do not like to use it, so I temporarily put it aside. After repeated weighing, I still chose Core Data. First of all, its built-in cloud synchronization under iOS 13 is very attractive to me (basically free and cost-effective), and secondly, because Core Data is not an ORM (it should be called an object graph management framework), it has many other advantages in terms of performance and security.</p>
<p>There are many problems when learning Core Data, mainly reflected in the lack of information and difficulty in getting started. The best material I can find now is the Chinese version of Core Data created by objc, but to be honest, this book is not suitable for beginners to read. Through constantly searching for information online, watching YouTube videos, and studying the confusing explanations in Apple’s documents, it took me nearly a month to get started. As my understanding deepens, my fondness for Core Data also deepens. If your app does not intend to be cross-platform (only supports the Apple ecosystem), or you want to use native methods to manage local data under iOS, Core Data is really a very good choice. For example, for my app that runs only on iOS, excellent cloud synchronization can be achieved with minimal code overhead. In addition, if you make good use of Core Data’s features, you can get extremely convenient dynamic data management process under SwiftUI + Combine.</p>
<p>During the preparatory period, I also studied two video courses on DesignCode’s SwiftUI and Sketch, especially Sketch, which played a significant role in my later development.</p>
<p>Starting from the National Day holiday in 2019, I entered a learning state and by the end of November, I had gained the ability to build a complete app in about two months (in my opinion). From November 24th (the time of the first commit on Git), I officially entered the development stage.</p>
<h2 id="formal-development">Formal Development</h2>
<p>Due to careful consideration of the requirements (knowing what kind of tools I need), progress in the first few days was very fast. SwiftUI provided me with a highly efficient environment, and the prototype of the entire app could be run in a short time. However, when it came to connecting the specific implementation and data flow together, I found that everything was not so simple.</p>
<p>There are several difficulties:</p>
<ul>
<li>
<p>SwiftUI has limited functionality</p>
<p>When it comes to implementing many functions, it is found that many scenarios still need to be completed through UIKit. To this end, I spent some time learning about UIKit (at least how to mix the two together). In the final app, almost half of the display control was actually completed under UIKit, even the most basic requirement like TextField, sometimes the native version of SwiftUI couldn’t handle it.</p>
</li>
<li>
<p>There are too many bugs in SwiftUI and Combine</p>
<p>Although I was prepared for some imperfections in the new product, the number of bugs is far more than I expected. During the entire development process, I reported more than ten obvious bugs through feedback, and many strange phenomena that I could not reproduce with short routines. Anyway, after gradually figuring out the temperaments of these two “old men”, I can basically get along with these bugs peacefully.</p>
</li>
<li>
<p>Programming approach</p>
</li>
</ul>
<p>Although I have the awareness of using the latest programming approaches and have been striving towards this direction in design and development, on the one hand, there is the inertia of previous experience, and on the other hand, my mastery of new ideas is still shallow. As a result, I took many detours in the entire development process. My data flow control logic was basically rewritten four times, and the current version of the code is half the size of the previous version, while being able to accomplish more functions, be more stable, and update the data in each view dynamically without intervention.</p>
<ul>
<li>Development environment</li>
</ul>
<p>As someone who has not been involved in programming for many years, I still cannot fully adapt to the complex IDE tools of today for quite some time. In addition, some of Xcode’s error prompts are quite mysterious, with some being accurate and others being inexplicable, leading simple errors to strange places. It took me almost half a month to figure out what to trust and what not to trust.</p>
<p>In addition, package management, version control, and other aspects of development are all new subjects for me. Every time I encounter a new problem, it feels like a spiritual practice.</p>
<ul>
<li>App Store review</li>
</ul>
<p>In this development, I intended to encounter more new challenges. I used various methods such as in-app purchases and automatic renewal in the app. Later, I found that I had dug a big pit for myself and was very lucky to finally solve it. The main problem is not technical, but because I have no experience in app review, I went through many wrong paths.</p>
<p>Overall, after a month and a half of development (including half a month of various review issues), the first version has now been launched on the App Store.</p>
<p>Although I have the awareness of using the latest programming ideas and have been striving towards this direction in design and development, on the one hand, it is the inertia of previous experience, and on the other hand, it is the shallow understanding of new ideas, which has caused me to take many detours in the entire development process. My data flow control logic has been basically rewritten four times. The current version has half the amount of code compared to the previous versions, while completing more functions, being more stable, and updating the data in each view dynamically without intervention.</p>
<h2 id="complaints-tips-experience-and-summary">Complaints, Tips, Experience, and Summary</h2>
<p>This article is basically in a stream of consciousness state, writing whatever comes to mind. The following is about some problems, bugs, summarized skills, and a little bit of experience I encountered during development. There is no necessary order. If there are any errors, I hope everyone can offer constructive criticism 😅.</p>
<h3 id="tabview">TabView</h3>
<p>TabView in SwiftUi is a convenient control that can be used to easily implement standard screen bottom page switching with just a few lines of code. However, it has several issues:</p>
<ul>
<li>Poor control over the layout of items, which can be adjusted through some means but is not elegant;</li>
<li>Switching pages will reset the state of the view. For example, if view1 has a ScrollView and you have scrolled it, when you switch to another view through TabView and then switch back, ScrollView will not stay in its original position but will go back to the top.</li>
<li>Due to the reset when switching, efficiency is terrible when loading complex pages. When switching, TabView completely destroys the original view, and the efficiency of destruction is low. This causes the switching to flash like pressing the shutter of a mechanical camera if the page is complex. This is the most unacceptable issue among all the problems.</li>
</ul>
<p>Originally, I thought about bridging to UIKit if it doesn’t work out, but in the end, I used the solution of simulating TabView functionality through ZStack. This solved the above problems and gained more control. Of course, there are also disadvantages. After using ZStack, all views are initialized and displayed even if they are not visible, and they will not be destroyed. Therefore, the means of intervention through onAppear and onDisappear are lost (other alternative methods have been adopted in the end).</p>
<h3 id="scrollview">ScrollView</h3>
<p>ScrollView in SwiftUI follows the characteristics of other SwiftUI controls, making it very easy to use, but it hardly provides any additional control options. In my app, it is still competent in most cases, but when combined with certain UIKit implementations, it may result in strange phenomena. Finally, in some pages, using UIScrollView was the only way to solve the problem.</p>
<h3 id="navigationview">NavigationView</h3>
<p>There are many strange phenomena.</p>
<p>The biggest one is that if the content of the view is complex and the barItem uses Chinese or images, when slowly sliding back from the left side of the screen, there will be overlapping NavigationBarItems at the top of different Views, causing the buttons of BarItems to fail. I have communicated with Apple through feedback several times for this bug, but because it is difficult to reproduce with simple examples, I almost wrote a small program alone to give them feedback. Currently, this bug has not been resolved, so in order to prevent users from experiencing problems (although it only occurs occasionally, it is also annoying), I temporarily shielded the function of sliding back from the left side of the screen in the app.</p>
<p>NavigationLink in the simulator can only be used once, and the second click will fail, but there is no problem on the actual device.</p>
<p>It is difficult to directly return to the root view. Using dissmiss can only return to the upper view. In the beta version of Xcode 11, some unconventional methods can be used to achieve this function, but they have now been blocked. This makes it difficult for me to implement the function of returning to the root view of a TabView by double-clicking on the icon, which is quite annoying. In fact, there is also a stupid way, which is to manage a View Stack by yourself, and then use onReceive to pass the dismiss command to the view layer by layer. However, because this multi-layer return is explicit, that is, there are complete animations, when it exceeds one layer, the user’s feeling will be weirder. Finally, I only used this method when the view was behind the ZStack.</p>
<h3 id="sheet">Sheet</h3>
<p>The problem is quite strange.</p>
<p>The environment value and environment object must be explicitly injected, otherwise it will cause runtime errors. From this point of view, Sheet should be isolated from other views in terms of data environment.</p>
<p>When a view has dynamically changing data based on ForEach, if the view is in a sheet, changes in data will cause exceptions to be triggered. If the view is extracted from the sheet and displayed directly, this problem does not occur.</p>
<p>Complex Forms in the same view will also cause exceptions when switching between Sheet and non-Sheet.</p>
<h3 id="textfield">TextField</h3>
<p>There is no problem with simple applications, except that multi-line input is not supported.</p>
<p>However, if the binding text of TextField is judged and processed in real time, the system’s built-in Chinese input method will not be able to input Chinese characters, while most third-party input methods do not have this problem. Finally, UITextView is used to solve the problem.</p>
<p>If TextField is in a ScrollView, when switching between different Segment Pickers, using the system’s built-in Chinese input method will cause a crash. There is no problem with English and third-party Chinese input.</p>
<p>It does not support hiding the input method after input, and requires a workaround through UIKit.</p>
<h3 id="text">Text</h3>
<p>There are no major problems, it’s quite easy to use, but the layout control is a bit weak.</p>
<h3 id="form">Form</h3>
<p>If <code>if</code> is used in <code>Form</code> to dynamically display content based on conditions, there may be strange events. The same code sometimes compiles normally, and sometimes does not. The same <code>Form</code> code can sometimes compile normally in a <code>Sheet</code>, but when moved out of the <code>Sheet</code>, it compiles with errors, and sometimes the opposite is true.</p>
<h3 id="list">List</h3>
<p><code>List</code> has the ability to lazily load data, which is very suitable for scenarios with a large amount of data. However, its layout control ability is poor. If you must use methods similar to <code>UITableView.appearance</code> to set up in <code>init</code>, the settings in a single view will affect the entire app (unless you can control the initialization and destruction of that view very well). This is also a problem with control display settings in SwiftUI at present (mainly because the official does not recommend or support such behavior). If UIKit is used to modify settings in various views, they are not isolated from each other.</p>
<p>If there is an animation, the efficiency will be low when there is a lot of data, and using <code>id</code> to force a redraw can solve this problem.</p>
<h3 id="vstack-hstack-zstack">VStack HStack ZStack</h3>
<p>The layout control is very convenient and can complete relatively complex layout construction in a short time. However, its support for <code>ViewBuilder</code> types is relatively limited, and the <code>Stack</code> that can be contained in a single <code>Stack</code> cannot be too complex (currently, Apple has only defined a few forms of <code>TupleView</code>). Especially for the <code>Stack</code> after the <code>if</code>, the requirements are strict. Sometimes, determining the <code>some view</code> in the conditional branch can be extremely demanding, but sometimes it can be relaxed appropriately.</p>
<h3 id="picker">Picker</h3>
<p>The categories are sufficient, but the details need to be further improved. The Segment must be fully displayed with animation before switching, giving a sticky feeling. The Date takes up a large area.</p>
<h3 id="foreach">ForEach</h3>
<p>The only way to control loops in view declarations, but the control needs to be strengthened.</p>
<p>If <code>data: Range&lt;Int&gt;</code> is used, the range is immutable. For example, <code>0..&lt;students.count</code> will result in game over if the number of students changes dynamically.</p>
<h3 id="geometryreader-preferencekey-etc">GeometryReader PreferenceKey, etc.</h3>
<p>A good way for views to recognize themselves. With Geometry Proxy, sufficient space information can be obtained, and if information needs to be passed to the upper layer view, it can be completed through PreferenceKey.</p>
<h3 id="preview">Preview</h3>
<p>Great idea, works great for simple view responses. However, once the view gets more complex, sometimes it’s more satisfying to just rebuild. Additionally, if the initial parameters of the view are complicated, like passing an NSManagedObject directly, building the preview is also difficult. Most of the time, it’s just deleted, but it’s very useful when building the framework.</p>
<h3 id="combine">Combine</h3>
<p>Very useful and convenient. It also works well with many of the system’s built-in frameworks, worthy of system-level support.</p>
<p>The efficiency is currently problematic. Most of the controls in SwiftUI use the bind method to respond and pass data, which is designed to be very clear, but it can feel sticky to execute. Complex sheets are particularly noticeable. All asynchronous design responses will have some delay. I hope that in the future, there will be some optimization for the response. There are a few places in my app where the response to the sheet popping up is slow (moving the view out of the sheet and using NavigationLink to display it works well), especially when exiting. I feel that there is a serious efficiency bug in the code for destroying views in SwiftUI (see the TabView above).</p>
<h3 id="core-data">Core Data</h3>
<p>The new iCloud sync-based (not CloudKit) is very useful, and the setup is also very convenient.</p>
<p>The data in the cloud database in the app in the development environment does not communicate with the app data downloaded from the app store (with the same id). The data in the simulator during development cannot be synchronized with the data on the actual machine, and must be tested on multiple actual machines.</p>
<p>My app has a pure local database (no need for synchronization) and a synchronization database, each in different configurations. Relationships cannot be established between different configurations, after all, they are two different sqlite libraries.</p>
<p>Do not use Core Data like a database.</p>
<p>Relationship is a good thing, and the system will automatically maintain the relationship between data.</p>
<p>Thanks to Relationship, in most cases, there is no need to design primary keys yourself, which is a great convenience. However, when you need to manually export and back up the database, problems arise. You cannot use the system’s built-in primary key or ObjectID. Finally, identifiable properties were added to the Entite that needed to be exported. The normal program operation does not depend on this property at all, but when exporting JSON, these properties are used to mark their relationship.</p>
<p>In the managed context, the data execution efficiency is very high.</p>
<p>@FetchRequest is very good at dynamically managing data, and any changes in data in SwiftUI can be dynamically reflected.</p>
<p>@FetchRequest can only be dynamically set once through parameters in init (cannot be dynamically modified). If you need to display different predicates or sorting results, you can only reset them through the upper level view.</p>
<p>@FetchRequest cannot set more optimization parameters such as fetchLimit.</p>
<h3 id="in-app-purchase">In-App Purchase</h3>
<p>Technically, it is not complicated, because I do not need to set up a server for secondary authentication, so the logic is much simpler. The only thing is that Apple’s initial completion feedback after the purchase cannot guarantee that the user has paid, so it is necessary to query in the background to ensure that the payment is successful. There will be no prompts for refunds, so updating the receipt regularly is enough.</p>
<h3 id="app-store-review">App Store Review</h3>
<p>My review time was longer than usual because I didn’t fully understand how to use it. Most of the issues were related to in-app purchases.</p>
<p>Initially, I had missing metadata and had to resubmit a few times before realizing that I needed to include screenshots and notes for in-app purchases.</p>
<p>Later, I discovered that I also needed to select the in-app purchase options in the app submission process.</p>
<p>If I hadn’t made any changes at that point, it would have been fine. However, I made changes to the metadata for the pricing while the app was already under review, resulting in the app being rejected and the pricing staying in review status.</p>
<p>After waiting for a while, I deleted the original pricing data and created new pricing data, which was then approved for review.</p>
<p>I then filled in the new pricing data in the app submission and was rejected again.</p>
<p>The original description did not have a detailed explanation of in-app purchases, but after modifying it, it was finally approved.</p>
<p>The main reason for the long process was that each feedback took one day, and Apple’s responses were too vague, leaving me confused.</p>
<h3 id="other-topics-will-be-written-later">Other topics will be written later</h3>
<p>Although there are still many shortcomings, the direction of SwiftUI + Combine is definitely correct and can bring significant efficiency improvements even now. I believe it will improve greatly in the next 2-3 years. CoreData is very useful, and native iOS programs should consider it more.</p>
<div class="dynamic-ad-container pt-4"></div>
<h2 id="conclusion">Conclusion</h2>
<p>I accidentally wrote a lot, but it can be considered as a simple summary of these past few months.</p>
<p>Note: This article was written 3 years ago and many of the issues mentioned were caused by the framework’s immaturity and a lack of deep understanding of SwiftUI and Core Data at the time. Rereading the content now, I still have many feelings, but I also feel a clear sense of growth over the years.</p>
<p>This memoir documents the development of an iOS app using SwiftUI, Combine, Core Data, and other frameworks. The author shares their experiences with bugs, programming approaches, and the development environment, as well as tips for working with various controls and features like TabView, ScrollView, NavigationView, TextField, and In-App Purchase. The author concludes that SwiftUI + Combine is a promising development direction and that Core Data is highly useful for native iOS programs.</p>
<p>This article recounts how the author re-learned programming and developed iOS apps after turning 40, including the ups and downs of the learning process.</p> </div> </article> <script type="module" src="/_astro/WeeklySubscribeModal.astro_astro_type_script_index_0_lang.C4utatll.js"></script> <!-- Modal toggle --><button data-modal-target="default-modal" data-modal-toggle="default-modal" class="hidden text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
Toggle modal
</button> <!-- Modal backdrop with flex centering --> <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 items-center justify-center"> <div id="default-modal" class="hidden relative p-4 w-full max-w-2xl"> <!-- Modal content --> <div class="relative bg-white rounded-lg shadow-2xl dark:bg-gray-800 border-gray-200 border dark:border-gray-600"> <!-- Modal header --> <div class="flex items-center justify-between px-4 md:px-5 pt-4 pb-0 rounded-t dark:border-gray-600"> <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="default-modal"> <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"></path> </svg> <span class="sr-only">Close modal</span> </button> </div> <!-- Modal body --> <div class="px-4 md:px-5 pb-4"> <div class="w-full mx-auto text-center px-6 pb-6"> <div class="text-lg font-semibold text-gray-900 dark:text-blue-100 pt-4 pb-8">Every Monday, sharing handpicked Swift and SwiftUI development highlights with you.</div> <div id="custom-substack-embed1"></div> <!-- <div class="text-gray-700 dark:text-blue-200 text-xs font-medium pt-4">{bottomTip}</div> --> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };

    // 创建一个新的 MutationObserver 实例
    const observer = new MutationObserver((mutationsList, observer) => {
      // 遍历所有的 mutations
      for (let mutation of mutationsList) {
        // 如果这个 mutation 是一个子节点的添加或删除
        if (mutation.type === 'childList') {
          // 查找订阅框
          const widget = document.querySelector('.custom-substack-widget1');
          if (widget) {
            // 查找 input 元素
            const input = widget.querySelector('input');
            const button = widget.querySelector('button');
            // 根据当前的颜色方案修改订阅框的样式
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              // 暗黑模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            } else {
              // 正常模式
              widget.style.border = 'var(--subscribe-widget-border)';
              widget.style.padding = '0.3rem';
              widget.style.borderRadius = '0.7rem 0.7rem 0.7rem 0.7rem';
              widget.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.border = '0px solid #000';
              input.style.backgroundColor = 'var(--subscribe-input-background)';
              input.style.padding = '0.5rem';
              // input.style.border = '1px solid #E2E8F0';
              input.style.outline = 'none';
              button.style.backgroundColor = 'var(--subscribe-button-background)';
              button.style.color = 'var(--subscribe-button-text)';
              button.style.fontWeight = 'bold';
              button.style.padding = '0.5rem 1rem';
              button.style.borderRadius = '0.5rem 0.5rem 0.5rem 0.5rem';
              button.style.maxWidth = '100px';
            }

            if (window.matchMedia('(max-width: 640px)').matches) {
              // 屏幕尺寸小于 640px
              widget.style.maxWidth = '325px';
            } else {
              // 屏幕尺寸大于或等于 640px
              widget.style.maxWidth = '600px';
            }
            // 停止观察
            observer.disconnect();
          }
        }
      }
    });

    // 开始观察 #custom-substack-embed 元素的子节点的变化
    observer.observe(document.getElementById('custom-substack-embed1'), { childList: true });
  })();</script> <script src="/js/subscriber.js" async></script> </div> <div class="flex justify-center pb-6"> <button data-modal-hide="default-modal" type="button" class="text-gray-600 dark:text-gray-400 bg-transparent hover:text-gray-800 dark:hover:text-gray-200 font-medium rounded-lg text-sm px-8 py-2.5 text-center transition-colors">Continue Reading</button> </div> </div> </div> </div> </div> <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "author": {
    "@type": "Person",
    "name": "Fatbobman",
    "url": "https://twitter.com/fatbobman"
  },
  "dateModified": "2022-09-06T00:12:00.000Z",
  "datePublished": "2022-09-06T00:12:00.000Z",
  "description": "A developer’s journey of relearning programming & building an iOS app, Health Notes, using SwiftUI, Combine, & Core Data. Learn about challenges, tips, & insights.",
  "headline": "Old Man New Soldier - A Development Memoir of an iOS APP",
  "image": {
    "@type": "ImageObject"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fatbobman.com/en/posts/healthnote_development_log_2020/"
  },
  "url": "https://fatbobman.com/en/posts/healthnote_development_log_2020/",
  "publisher": {
    "@type": "Organization",
    "name": "Fatbobman's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fatbobman.com/images/blog-card.png"
    }
  }
}</script> <div class="w-full mx-auto text-center pb-0 sm:pb-6 pt-8"> <div id="custom-substack-embed"></div> <div class="text-xs font-medium text-heading p-4">Get weekly handpicked updates on Swift and SwiftUI!</div> <script>(function(){const subscribeText = "Join Now";
const placeholder = "Subscribe with your email";

    window.CustomSubstackWidget = {
      substackUrl: 'weekly.fatbobman.com',
      placeholder: placeholder,
      buttonText: subscribeText,
      theme: 'custom',
      colors: {
        primary: '#F50000',
        input: '#000000',
        email: '#777777',
        text: '#000000',
      },
    };
  
    const observer = new MutationObserver((mutationsList) => {
      const widget = document.querySelector('.custom-substack-widget');
      if (widget) {
        const input = widget.querySelector('input');
        const button = widget.querySelector('button');
  
        // 设置样式（合并暗黑模式与默认模式逻辑）
        const darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        widget.style.padding = '0.5rem';
        widget.style.borderRadius = '1.2rem';
        widget.style.border = '0.1px solid var(--aw-color-text-muted)';
        input.style.border = '0px solid #000';
        input.style.backgroundColor = 'var(--aw-background-color)';
        button.style.backgroundColor = 'var(--subscribe-button-background)';
        button.style.color = 'var(--subscribe-button-text)';
        button.style.borderRadius = '0.8rem';
        button.style.maxWidth = '100px';
        button.style.fontWeight = 'bold';
  
        // 响应式调整
        widget.style.maxWidth = window.matchMedia('(max-width: 640px)').matches
          ? '325px'
          : '400px';
  
        observer.disconnect(); // 停止观察
      }
    });
  
    // 开始观察
    observer.observe(document.getElementById('custom-substack-embed'), { childList: true });
  })();</script> <script src="https://substackapi.com/widget.js" defer></script> </div> <div class="pt-6 pb-6  dark:border-gray-700"> <!-- <p class="flex justify-center align-center text-sm font-medium text-heading">
    { lang === Lang.ZH && <SupportMeTextZH /> }
    { lang === Lang.EN && <SupportMeTextEN /> }
  </p> --> <div class="flex flex-col sm:flex-row justify-center items-center mx-auto sm:space-x-8 align-center pt-2"> <button type="button" class="text-gray-900 bg-yellow-200 hover:bg-yellow-300 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700 me-2 mb-2" onclick="window.open('https://www.buymeacoffee.com/fatbobman')"> <img src="/images/buymeacoffee.svg" alt="Buy me a coffee" class="w-5 h-5 me-2 -ms-1" decoding="async" loading="lazy"> <span class="text-black font-bold">Buy me a coffee</span> </button> <div class="pt-4 sm:pt-0">  <button type="button" class="bg-[#3b82f6] hover:bg-blue-700 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:border-gray-700  me-2 mb-2" onclick="window.open('https://www.paypal.com/paypalme/fatbobman')"> <img src="/images/paypal.svg" alt="" width="24" height="24" loading="lazy" decoding="async" class="w-4 h-4 me-2 -ms-1" aria-hidden="true"> <span class="text-white font-bold hover:text-yellow-100">Donate via Paypal</span> </button> </div> </div> </div> <!-- <WeeklySubscribe1 lang={lang} top={0} bottom={4}/> --> <div id="copy-alert" class="hidden fixed bottom-28 right-5"> <div id="alert-1" class="flex items-center p-4 mb-4 text-blue-800 rounded-lg bg-blue-50/90 dark:bg-gray-800/90 dark:text-blue-400" role="alert"> <div class="text-sm font-medium">Link copied</div> </div> </div> <style>
  .copy-icon {
    position: absolute;
    left: -30px; /* 根据您的布局调整位置 */
    top: 50%; /* 将图标定位到标题的中间高度 */
    transform: translateY(-50%); /* 垂直居中对齐图标 */
    cursor: pointer;
    transition: opacity 0.6s ease;
    pointer-events: all; /* 始终响应鼠标事件 */
  }

  article h2,
  article h3,
  article h4,
  article h5 {
    position: relative;
  }

  #copy-alert {
    position: fixed;
    bottom: -100px; /* 初始在视窗下方 */
    right: 20px;
    transition: bottom 0.5s ease-in-out;
  }

  /* 进入动画 */
  @keyframes slideIn {
    from {
      bottom: -100px;
    }
    to {
      bottom: 0px;
    }
  }

  /* 消失动画 */
  @keyframes slideOut {
    from {
      bottom: 20px;
    }
    to {
      bottom: -100px;
    }
  }
</style> <script>
  var hideTimeout; // 用于保存自动隐藏定时器的引用
  document.querySelectorAll('article h2, article h3, article h4, article h5').forEach(function (header) {
    var copyIcon = document.createElement('span');
    copyIcon.innerHTML =
      '<svg fill="currentColor" aria-hidden="true" stroke="currentColor" class="w-5 h-5 hidden md:block hover:text-secondary" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M861.866667 164.266667c-87.466667-87.466667-230.4-89.6-320-2.133334l-68.266667 68.266667c-12.8 12.8-12.8 32 0 44.8s32 12.8 44.8 0l68.266667-68.266667c64-61.866667 166.4-61.866667 230.4 2.133334 64 64 64 168.533333 2.133333 232.533333l-117.333333 119.466667c-34.133333 34.133333-81.066667 51.2-128 49.066666-46.933333-4.266667-91.733333-27.733333-119.466667-66.133333-10.666667-14.933333-29.866667-17.066667-44.8-6.4-14.933333 10.666667-17.066667 29.866667-6.4 44.8 40.533333 53.333333 100.266667 87.466667 166.4 91.733333h17.066667c59.733333 0 119.466667-23.466667 162.133333-68.266666l117.333333-119.466667c83.2-89.6 83.2-234.666667-4.266666-322.133333z"></path><path d="M505.6 750.933333l-66.133333 68.266667c-64 61.866667-166.4 61.866667-230.4-2.133333-64-64-64-168.533333-2.133334-232.533334l117.333334-119.466666c34.133333-34.133333 81.066667-51.2 128-49.066667 46.933333 4.266667 91.733333 27.733333 119.466666 66.133333 10.666667 14.933333 29.866667 17.066667 44.8 6.4 14.933333-10.666667 17.066667-29.866667 6.4-44.8-40.533333-53.333333-100.266667-87.466667-166.4-91.733333-66.133333-4.266667-130.133333 19.2-177.066666 66.133333l-117.333334 119.466667c-85.333333 89.6-85.333333 234.666667 2.133334 322.133333 44.8 44.8 102.4 66.133333 162.133333 66.133334 57.6 0 115.2-21.333333 160-64l66.133333-68.266667c12.8-12.8 12.8-32 0-44.8-14.933333-10.666667-34.133333-10.666667-46.933333 2.133333z"></path></svg>'; // 使用您选择的图标
    copyIcon.className = 'copy-icon';
    copyIcon.style.opacity = '0'; // 默认透明
    header.insertBefore(copyIcon, header.firstChild);

    header.addEventListener('mouseover', function () {
      copyIcon.style.opacity = '1';
    });
    header.addEventListener('mouseout', function () {
      copyIcon.style.opacity = '0';
    });

    copyIcon.addEventListener('click', function () {
        var url = window.location.href.split('#')[0] + '#' + header.id;
        navigator.clipboard.writeText(url).then(function () {
            var alertDiv = document.getElementById('copy-alert');
            if (alertDiv) {
                alertDiv.classList.remove('hidden'); // 确保提示框是可见的
                alertDiv.style.display = 'block'; // 显示提示框
                clearTimeout(hideTimeout); // 清除之前的定时器
                alertDiv.style.animation = 'none'; // 先清除之前的动画
                setTimeout(function () {
                    alertDiv.style.animation = 'slideIn 0.5s forwards'; // 应用新动画
                }, 10);

                // 设置自动隐藏定时器
                hideTimeout = setTimeout(function () {
                    alertDiv.style.animation = 'slideOut 0.5s forwards'; // 应用消失动画
                    setTimeout(function () {
                        alertDiv.style.display = 'none';
                    }, 500);
                }, 3000);
            }
        });
    });
  });
</script> <script>
function copyCode(button, event) {
  event.preventDefault();
  const codeBlock = button.parentNode.nextElementSibling.textContent; // 获取代码内容
  navigator.clipboard.writeText(codeBlock).then(() => {
    // 显示 "Copied"
    button.querySelector('.copy-text').style.display = 'none';
    button.querySelector('.copied-text').style.display = 'inline';

    // 3秒后恢复
    setTimeout(() => {
      button.querySelector('.copy-text').style.display = 'inline';
      button.querySelector('.copied-text').style.display = 'none';
    }, 3000);
  });
}
</script> <script>(function(){const url = "https://fatbobman.com/ads/en";

  // 根据中英文对应不同的 adCacheKey
  const adCacheKey = 'dynamicAdCache' + (window.location.pathname.includes('/zh/') ? 'ZH' : 'EN');

  // 尝试从缓存中获取广告
  const cachedAd = JSON.parse(localStorage.getItem(adCacheKey));
  const now = Date.now();

  if (cachedAd && cachedAd.expiresAt > now) {
    console.log('Using cached ad');
    console.log(cachedAd.expiresAt - now);
    // 如果缓存有效，直接使用缓存的广告
    renderAd(cachedAd.content);
  } else {
    console.log('Fetching ad from the server');
    // 如果缓存无效，从服务器获取广告
    fetch(url, {
      headers: {
        'Accept': 'text/html',
      },
      cache: 'default'
    })
      .then(response => {
        const maxAgeMatch = response.headers.get('Cache-Control')?.match(/max-age=(\d+)/);
        const maxAge = maxAgeMatch ? parseInt(maxAgeMatch[1], 10) : 0;

        if (!response.ok || maxAge <= 0) {
          throw new Error('Invalid response or missing Cache-Control');
        }

        return response.text().then(adContent => {
          const expiresAt = now + maxAge * 1000; // 计算失效时间
          // 缓存广告内容
          localStorage.setItem(adCacheKey, JSON.stringify({ content: adContent, expiresAt }));
          // 渲染广告
          renderAd(adContent);
        });
      })
      .catch(error => console.error('Error loading the ad:', error));
  }

  // 渲染广告函数
  function renderAd(html) {
    const adSlots = document.querySelectorAll('.dynamic-ad-container');
    adSlots.forEach(slot => {
      slot.innerHTML = html;
    });
  }
})();</script> <script type="module">var c=document.querySelectorAll("article");c.forEach(function(r){var a=r.querySelectorAll("a");a.forEach(function(e){var t=e.getAttribute("href");t&&t.startsWith("http")&&!t.includes("fatbobman.com")&&!t.includes("fatbobman.github.com")&&!t.includes("localhost")&&e.setAttribute("target","_blank")})});</script> <!-- <LeaveFeedback lang={lang} /> --> <section class="pt-10"><div class="max-w-5xl sm:px-4 py-2 mx-auto"><div class="grid gap-4 sm:gap-2 sm:mx-4 sm:grid-cols-12"><div class="col-span-12 sm:col-span-3 hidden sm:block"><div class="text-center sm:text-left mt-3 mb-14 before:block before:w-24 before:h-1 before:mb-3 before:rounded before:mx-auto sm:before:mx-0 before:bg-secondary"><h3 class="text-lg font-medium text-default">Related Posts</h3></div></div><div class="sm:hidden text-lg font-medium text-heading col-span-12 text-left">Related Posts</div><div class="relative col-span-12 sm:px-4 space-y-6 sm:col-span-9"><div class="col-span-12 space-y-2 relative sm:px-4 sm:col-span-8 sm:space-y-4 sm:before:absolute sm:before:top-2 sm:before:bottom-0 sm:before:w-0.5 sm:before:-left-3 before:bg-block"><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/healthnote2-release/" id="relatedPosts-Health Notes 2.0 Official Version is Complete!"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Health Notes 2.0 Official Version is Complete!</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/5th-anniversary-of-kidney-transplant/" id="relatedPosts-Five Years Since the Transplant"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Five Years Since the Transplant</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/weekly/issue-056" id="relatedPosts-Weekly #56 - Reflections on the Pixelmator Acquisition"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Weekly #56 - Reflections on the Pixelmator Acquisition</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/healthnotes2year/" id="relatedPosts-Reflecting on Two Years of Using Health Notes and My Physical Condition in Recent Years"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Reflecting on Two Years of Using Health Notes and My Physical Condition in Recent Years</h3></div></a><a class="flex flex-col sm:relative sm:before:absolute sm:before:top-2 sm:before:w-2 sm:before:h-2 sm:before:rounded-full sm:before:left-[-31px] sm:before:z-[1] before:bg-secondary group cursor-pointer" href="/en/posts/healthnote2-development-memo-1/" id="relatedPosts-Development Musings for Health Notes 2.0 (Part 1)"><div class="flex items-start"><div class="w-[7px] h-[7px] bg-secondary ml-4 mr-2 flex-shrink-0 mt-2 sm:hidden" style="border-radius: 50%;"></div><h3 class="text-default group-hover:text-secondary">Development Musings for Health Notes 2.0 (Part 1)</h3></div></a></div></div></div></div></section> <!-- <BottomWeeklySubscribe lang={lang} /> --> <div><div id="gitalk-container" data-comment-id="老人新兵 —— 一款 iOS APP 的开发手记" data-lang="en"></div><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" defer></script></div>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        const response = await fetch('https://fatbobman.com/status/comment');
        const data = await response.text();
        console.log(data);
        if (data === '1') {
          var container = document.getElementById('gitalk-container');
          if (container) {
            var commentID = container.getAttribute('data-comment-id');
            var lang = container.getAttribute('data-lang');

            var gitalk = new Gitalk({
              clientID: 'fcf61195c7f73253dc8b',
              clientSecret: '0ac2907be08248a1fcb5312e27480ad535c682e5',
              repo: 'blogComments',
              owner: 'fatbobman',
              admin: ['fatbobman'],
              id: commentID.split('/').pop().substring(0, 49),
              distractionFreeMode: true,
              createIssueManually: true,
              language: lang,
            });

            gitalk.render('gitalk-container');
          }
        }
      });
    </script> <div class="hidden xl:block w-44 lg:absolute" id="toc" style="left: -30px; top: 0px"> <div class="text-muted items-center justify-center overflow-x-clip"> <div class="w-full flex justify-end pb-2" id="toc-button"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" id="toc-list-switcher"> <use href="/images/iconCollection.svg#icon-toc"></use> </svg>  </div> </div> <div class="text-default text-xs hidden" id="toc-list"> <ul> <li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#foreword" class=""> Foreword </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#selection-of-development-platform-and-framework" class=""> Selection of Development Platform and Framework </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#technical-preparation" class=""> Technical Preparation </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#formal-development" class=""> Formal Development </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#complaints-tips-experience-and-summary" class=""> Complaints, Tips, Experience, and Summary </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#tabview" class=""> TabView </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#scrollview" class=""> ScrollView </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#navigationview" class=""> NavigationView </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#sheet" class=""> Sheet </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#textfield" class=""> TextField </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#text" class=""> Text </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#form" class=""> Form </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#list" class=""> List </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#vstack-hstack-zstack" class=""> VStack HStack ZStack </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#picker" class=""> Picker </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#foreach" class=""> ForEach </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#geometryreader-preferencekey-etc" class=""> GeometryReader PreferenceKey, etc. </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#preview" class=""> Preview </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#combine" class=""> Combine </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#core-data" class=""> Core Data </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#in-app-purchase" class=""> In-App Purchase </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#app-store-review" class=""> App Store Review </a> </div> </li><li class="pl-2 pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#other-topics-will-be-written-later" class=""> Other topics will be written later </a> </div> </li><li class=" pb-1"> <div class="text-muted hover:text-secondary items-center justify-start"> <a href="#conclusion" class=""> Conclusion </a> </div> </li> </ul> </div> </div> </div> <style>
  #toc-list {
    transition: all 0.9s ease-in-out;
  }

  #toc-button {
    transition: all 0.9s ease-in-out;
  }
</style> <script>
  function getOffsetTop(element) {
    var offsetTop = 0;
    while (element) {
      offsetTop += element.offsetTop;
      element = element.offsetParent;
    }
    return offsetTop;
  }

  var toc = document.querySelector('#toc');
  // 获取 sidebar 在浏览器中的初始 top 值
  var initialTop = getOffsetTop(toc);
  var positioningElement = document.querySelector('#article-area'); // 定位视图的选择器
  var stickyPoint = 150;
  var tocPadding = 30;
  var tocTopOffset = 4;
  var sidebarWidth = toc.offsetWidth;

  function adjustTocPosition() {
    var sidebarOffsetTop = toc.getBoundingClientRect().top;
    if (sidebarOffsetTop <= stickyPoint) {
      // 获取 positioningElement 的左侧侧与浏览器左侧之间的距离
      var positioningElementRight = (window.innerWidth - positioningElement.getBoundingClientRect().width) / 2;
      toc.style.position = 'fixed';
      toc.style.top = stickyPoint + 'px';
      toc.style.left = positioningElementRight - toc.getBoundingClientRect().width - tocPadding + 'px';
    }

    if (window.scrollY <= initialTop - stickyPoint) {
      toc.style.position = 'absolute';
      toc.style.top = tocTopOffset + 'px';
      toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';
    }
  }

  document.addEventListener('scroll', adjustTocPosition);
  window.addEventListener('resize', adjustTocPosition);
  // doc 加载完成后，调整 toc 的位置
  toc.style.left = -(tocPadding + toc.getBoundingClientRect().width) + 'px';

  document.addEventListener('DOMContentLoaded', function () {
    const tocList = document.getElementById('toc-list');
    const tocButton = document.getElementById('toc-button');

    // 更新toc-list和toc-button的显示状态
    function updateDisplay() {
      const showToc = localStorage.getItem('showToc') === 'true';
      if (showToc) {
        tocList.classList.remove('hidden');
        tocButton.classList.add('justify-start');
        tocButton.classList.remove('justify-end');
      } else {
        tocList.classList.add('hidden');
        tocButton.classList.remove('justify-start');
        tocButton.classList.add('justify-end');
      }
    }

    // 初始状态检查
    updateDisplay();

    // 点击事件监听器，用于切换toc-list的显示状态并更新按钮位置
    tocButton.addEventListener('click', function () {
      const isHidden = tocList.classList.contains('hidden');
      localStorage.setItem('showToc', isHidden);
      updateDisplay();
    });
  });
</script> <div class="hidden md:block md:absolute" id="sidebar" style="right: -50px; top: 0px"> <div class="invisible flex flex-col space-y-4 text-muted items-center justify-center opacity-0 transition-all duration-1000 delay-300 ease-out" id="sidebar-content"> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/en/posts/centering_the_view_in_swiftui/" data-tooltip-target="tooltip-next-post" data-tooltip-placement="left" id="sidebar-next-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-previous"></use> </svg> </a>  </div> <div id="tooltip-next-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>Several Ways to Center Views in SwiftUI</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + ←</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/centering_the_view_in_swiftui/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowLeft') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="/en/posts/how_to_judge_scrollview_is_scrolling/" data-tooltip-target="tooltip-previous-post" data-tooltip-placement="left" id="sidebar-previous-post" class> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-next"></use> <symbol id="icon-next" viewBox="0 0 24 24" fill="currentColor"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12.089 3.634a2 2 0 0 0 -1.089 1.78l-.001 2.586h-6.999a2 2 0 0 0 -2 2v4l.005 .15a2 2 0 0 0 1.995 1.85l6.999 -.001l.001 2.587a2 2 0 0 0 3.414 1.414l6.586 -6.586a2 2 0 0 0 0 -2.828l-6.586 -6.586a2 2 0 0 0 -2.18 -.434l-.145 .068z" stroke-width="0" fill="currentColor"></path> </symbol> </svg> </a>  </div> <div id="tooltip-previous-post" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 w-44 text-sm font-medium text-gray-200 bg-gray-600/90 rounded-lg shadow-sm transition-opacity duration-300 tooltip dark:bg-gray-700/90"> <div> <div>How to Determine if ScrollView, List is Currently Scrolling in SwiftUI</div> <div class="text-xs text-yellow-200 font-extrabold pt-2">⌥ + →</div> </div> <div class="tooltip-arrow" data-popper-arrow></div> </div> <script>(function(){const url = "/en/posts/how_to_judge_scrollview_is_scrolling/";
const isHidden = false;

  document.addEventListener('keydown', (e) => {
    // Check if Alt+RightArrow or just RightArrow was pressed
    if (e.altKey && e.key === 'ArrowRight') {
      // Only navigate if there's a URL and the button isn't hidden
      if (url && !isHidden) {
        e.preventDefault(); // Prevent default browser behavior
        window.location.href = url;
      }
    }
  });
})();</script> <!-- <DictButton lang={lang} post = {post}/> --> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://x.com/intent/tweet?text=Old%20Man%20New%20Soldier%20-%20A%20Development%20Memoir%20of%20an%20iOS%20APP&url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fhealthnote_development_log_2020%2F&hashtags=ios%2Cswiftlang&via=fatbobman" target="_blank" id="sidebar-share-with-twitter"> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-twitter"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://bsky.app/intent/compose?text=Old%20Man%20New%20Soldier%20-%20A%20Development%20Memoir%20of%20an%20iOS%20APP%0A by %40fatbobman.bsky.social %0Ahttps%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fhealthnote_development_log_2020%2F%0A #ios #swift" target="_blank" id="sidebar-share-with-bluesky"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="0.4" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"> <use href="/images/iconCollection.svg#icon-bluesky"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="https://www.facebook.com/sharer/sharer.php?u=https%253A%252F%252Ffatbobman.com%252Fen%252Fposts%252Fhealthnote_development_log_2020%252F" target="_blank" id="sidebar-share-with-facebook"> <svg stroke="currentColor" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-facebook"></use> </svg> </a>  </div>  <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:16px; height:16px;">  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fhealthnote_development_log_2020%2F" target="_blank" id="sidebar-share-with-linkedin"> <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="0.1" viewBox="0 0 15 15"> <use href="/images/iconCollection.svg#icon-linkedin"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <a href="mailto:?subject=Article%3A%E3%80%90Old%20Man%20New%20Soldier%20-%20A%20Development%20Memoir%20of%20an%20iOS%20APP%E3%80%91&#38;body=Here's%20an%20article%20you%20may%20find%20interesting%3A%0A%0AOld%20Man%20New%20Soldier%20-%20A%20Development%20Memoir%20of%20an%20iOS%20APP%0A%0ALink%3A%20https%3A%2F%2Ffatbobman.com%2Fen%2Fposts%2Fhealthnote_development_log_2020%2F" target="_blank" id="sidebar-share-with-email"> <svg fill="currentColor" stroke="currentColor" stroke-width="20" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-email"></use> </svg> </a>  </div> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" stroke-width="20" onclick="scrollToElement()" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <use href="/images/iconCollection.svg#icon-comment"></use> </svg>  </div> <script>
  var offset = 80
  function scrollToElement() {
    var gitalkContainer = document.getElementById('gitalk-container');
    if (gitalkContainer) {
      var topPosition = gitalkContainer.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: topPosition, behavior: 'smooth' });
    }
  }
</script> <div class="opacity-50 text-heading hover:opacity-100 hover:text-secondary " style="width:20px; height:20px;">  <svg fill="currentColor" stroke="currentColor" onclick="window.scrollTo({top:0,behavior:'smooth'})" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"> <!-- <path d="M862.464 161.536l-700.928 0c-30.976 0-56.096-25.12-56.096-56.096l0-28.064c0-30.944 25.12-56.064 56.096-56.064l700.896 0c30.976 0 56.096 25.12 56.096 56.064l0 28.032c0 31.008-25.12 56.096-56.096 56.096l0 0 0 0zM138.528 531.68c0 0 306.816-245.792 309.888-248.864 14.304-13.888 31.904-22.368 49.952-25.312 1.76-0.32 3.488-0.608 5.248-0.8 2.816-0.32 5.6-0.352 8.384-0.352 2.816-0.032 5.568 0.032 8.352 0.352 1.792 0.192 3.552 0.48 5.28 0.8 18.048 2.976 35.616 11.424 49.92 25.312 3.104 3.008 309.856 248.864 309.856 248.864 33.152 32.224 30.304 65.44-2.784 97.696s-77.376 3.04-110.496-29.216l-190.08-150.432 0 496.864c0 31.008-25.088 56.096-56.096 56.096l-28 0c-30.976 0-56.096-25.12-56.096-56.096l0-496.864-190.048 150.432c-33.088 32.288-77.408 61.536-110.496 29.216-33.056-32.256-35.872-65.44-2.816-97.696l0 0 0 0z"></path> --> <use href="/images/iconCollection.svg#icon-top"></use> </svg>  </div> </div> </div> <script type="module" src="/_astro/SideBar.astro_astro_type_script_index_0_lang.DxYLTPMj.js"></script> </div>   </div> </main> </div> <footer> <footer class="bg-block"> <div class="mx-auto w-full max-w-3xl px-4 md:px-6"> <div class="container flex flex-col items-center pt-10"> <div class="flex flex-row justify-around w-full space-x-3"> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Website</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://apps.apple.com/us/app/id1534513553" class="hover:text-secondary" target="_blank">Health Notes</a> <a href="https://discord.gg/zhou-zi-de-swiftji-shi-ben-967978112509935657" class="hover:text-secondary" target="_blank">Discord</a> <a href="/en/posts/" class="hover:text-secondary">Posts</a> <a href="/en/tags/" class="hover:text-secondary">Tags</a> <a href="/en/collections/" class="hover:text-secondary">Collections</a> <a href="/en/snippet/" class="hover:text-secondary">Quick Tips</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Follow</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="https://weekly.fatbobman.com" class="hover:text-secondary">Newsletter</a> <a href="https://x.com/intent/follow?screen_name=fatbobman" class="hover:text-secondary" target="_blank">Twitter</a> <a href="https://mastodon.social/@fatbobman" class="hover:text-secondary" target="_blank">Mastodon</a> <a href="https://www.linkedin.com/in/fatbobman/" class="hover:text-secondary" target="_blank">Linkedin</a> <a href="https://bsky.app/profile/fatbobman.bsky.social" class="hover:text-secondary" target="_blank">Blue Sky</a>  <a href="https://github.com/fatbobman" class="hover:text-secondary" target="_blank">GitHub</a> <a href="/rss.xml" class="hover:text-secondary hover:font-medium" target="_blank">RSS</a> </div> </div> <div class="flex flex-col space-y-4"> <h2 class="font-bold text-heading">Info</h2> <div class="flex flex-col space-y-2 text-sm text-default font-medium"> <a href="/en/about/" class="hover:text-secondary">About</a> <a href="/en/sponsorship/" class="hover:text-secondary"> Sponsor </a> </div> </div> </div> <div class="pb-0"> <div class="flex items-center justify-center w-full px-6 pt-12 text-sm"> <span class="text-muted text-xs">Copyright ©  2025 <a href="https://x.com/fatbobman" class="border-b-secondary border-b-[1px]">Fatbobman Digital Limited</a>. All Rights
            Reserved.</span> </div> <div class="flex items-center justify-center w-full px-6 pt-2 text-sm pb-10"> <span> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" class="block text-xs text-muted">
辽ICP备20006550号-1
</a> </span> </div> </div> </div> </div> </footer> </footer> </div>   <!-- <script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"></script> --><script type="module" src="/js/theme.js"></script> <script>(function(){const currentLang = "en";

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  // 为每个需要清除 focus 状态的按钮都添加一个 clear-focus 类, 下面的代码将在点击后自动移除 focus 状态
  document.addEventListener('DOMContentLoaded', (event) => {
    // 获取所有具有 'clear-focus' 类的按钮
    const buttons = document.querySelectorAll('.clear-focus');

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        setTimeout(() => {
          button.blur();
        }, 0);
      });
    });
  });

  window.onpageshow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
  };
})();</script> <div id="docsearch-container-data" data-lang="en" data-searchtext="Search..."></div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" defer></script> <script type="module">function r(e,t){const a={button:{buttonText:"搜索",buttonAriaLabel:"搜索"},modal:{searchBox:{resetButtonTitle:"清除搜索关键字",resetButtonAriaLabel:"清除搜索关键字",cancelButtonText:"取消",cancelButtonAriaLabel:"取消"},startScreen:{recentSearchesTitle:"最近搜索",noRecentSearchesText:"当前没有搜索历史记录",saveRecentSearchButtonTitle:"保存本次搜索",removeRecentSearchButtonTitle:"从搜索历史中移除",favoriteSearchesTitle:"收藏夹",removeFavoriteSearchButtonTitle:"从收藏夹移除"},errorScreen:{titleText:"无法获取结果",helpText:"请检查网络连接"},footer:{selectText:"选择",selectKeyAriaLabel:"选择",navigateText:"切换",navigateUpKeyAriaLabel:"Arrow up",navigateDownKeyAriaLabel:"Arrow down",closeText:"退出",closeKeyAriaLabel:"Escape key",searchByText:"引擎支持"},noResultsScreen:{noResultsText:"无法找到对应结果",suggestedQueryText:"可以尝试搜索如下内容",reportMissingResultsText:"确认本次搜索应该返回内容？",reportMissingResultsLinkText:"请告知我们"}}};if(typeof window<"u"){const n=window.docsearch;n({appId:"MVXKD4F4BR",apiKey:"a1b4111c3de8b9f60eeca6da001711da",indexName:"fatbobman",container:"#docsearch",insights:!0,placeholder:t,maxResultsPerGroup:50,translations:e==="zh"?a:void 0,searchParameters:{facetFilters:[`lang:${e}`],hitsPerPage:50}})}}function o(){const e=document.getElementById("docsearch-container-data");if(!e){console.error("Search container not found");return}const t=e.dataset.lang,a=e.dataset.searchtext;r(t,a)}window.addEventListener("load",()=>{document.querySelector('script[src*="docsearch"]')&&o()});</script> <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5C7N4MF5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!-- End Google Tag Manager (noscript) --> </body></html>
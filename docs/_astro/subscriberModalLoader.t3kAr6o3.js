const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/subscriberModalShower.CXD6IA7Y.js","_astro/preload-helper.CLcXU_4U.js","_astro/index.X8V1lpj1.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./preload-helper.CLcXU_4U.js";const g=40*1e3,T=60*60*4*1e3,p="subcribeModalLastShownTime";let r,e={subscribeText:"",placeholder:"",embedUrl:"",iframeClass:"",iframeStyle:""},d=!1,w=!1,v=null;document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&d&&(b(),d=!1)});function E(){const t=localStorage.getItem(p),i=Date.now();return t?i-parseInt(t,10)>=T:!0}function u(){localStorage.setItem(p,Date.now().toString())}function m(){r&&clearTimeout(r),r=setTimeout(()=>{E()?(S(),u(),document.visibilityState==="visible"?b():d=!0):console.log("not load modal")},g)}function b(){y(()=>import("./subscriberModalShower.CXD6IA7Y.js"),__vite__mapDeps([0,1,2])).then(t=>{t.showModal({subscribeText:e.subscribeText,placeholder:e.placeholder,embedUrl:e.embedUrl,iframeClass:e.iframeClass,iframeStyle:e.iframeStyle})})}function o(){b(),u()}function _({subscribeText:t,placeholder:i,embedUrl:n,iframeClass:a,iframeStyle:s}){e.subscribeText=t,e.placeholder=i,e.embedUrl=n||"",e.iframeClass=a||"",e.iframeStyle=s||"",window.addEventListener("open-subscribe-modal",()=>{o()}),w||(v=function(l){const c=l.target?.closest?.('a[href="#subscript"]');if(!c)return;const h=c.id==="subscribe-bottom-btn"?"bottom":c.id==="sidebar-share-with-subscribe"?"sidebar":"unknown";typeof window.dataLayer<"u"&&(window.dataLayer.push({event:"subscribe_click",content_type:"newsletter_subscribe",click_location:h,lang:document.documentElement.lang||"zh"}),console.log("[Subscribe Tracking] Subscribe button clicked:",h)),l.preventDefault(),l.stopPropagation(),o()},document.addEventListener("click",v,!0),w=!0);function f(){window.location.hash==="#subscript"&&(o(),window.history.replaceState(null,"",window.location.pathname+window.location.search))}f(),window.addEventListener("hashchange",f)}function L(){["mousemove","keydown","scroll","click"].forEach(i=>{document.addEventListener(i,m)})}function S(){["mousemove","keydown","scroll","click"].forEach(i=>{document.removeEventListener(i,m)})}function k({subscribeText:t,placeholder:i,embedUrl:n,iframeClass:a,iframeStyle:s}){e.subscribeText=t,e.placeholder=i,e.embedUrl=n||"",e.iframeClass=a||"",e.iframeStyle=s||"",L(),m()}const M={initModalIdleChecker:k,initModalManual:_,triggerModal:o,setupEventListeners:L,removeEventListeners:S,canShowModal:E,updateLastShownTime:u};export{M as default};
